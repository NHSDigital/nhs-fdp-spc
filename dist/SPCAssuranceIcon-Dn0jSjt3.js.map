{"version":3,"file":"SPCAssuranceIcon-Dn0jSjt3.js","sources":["../../../src/components/DataVisualisation/charts/SPC/SPCChart/logic/spcConstants.ts","../../../src/components/DataVisualisation/charts/SPC/SPCChart/logic/spcDescriptors.ts","../../../src/components/DataVisualisation/charts/SPC/SPCIcons/SPCConstants.ts","../../../src/components/DataVisualisation/charts/SPC/SPCIcons/tokenUtils.ts","../../../src/components/DataVisualisation/charts/SPC/SPCChart/SPCChart.constants.ts","../../../src/components/DataVisualisation/charts/SPC/SPCIcons/SPCIcon.tsx","../../../src/components/DataVisualisation/charts/SPC/SPCIcons/SPCAssuranceIcon.tsx"],"sourcesContent":["// Centralised SPC engine constants, enums, and registry metadata\n\n// Chart types supported by the SPC engine\nexport enum ChartType {\n\tXmR = \"XmR\",\n\tT = \"T\",\n\tG = \"G\",\n}\n\n// Core enums to share with UI/icon layers\nexport enum ImprovementDirection {\n\tUp = \"Up\",\n\tDown = \"Down\",\n\tNeither = \"Neither\",\n}\n\nexport enum VariationIcon {\n\tImprovement = \"improvement\",\n\tConcern = \"concern\",\n\tNeither = \"neither\",\n\t/** Preferred identifier for no‑judgement/suppressed cases. */\n\tSuppressed = \"suppressed\",\n}\n\n// Stable identifiers for rule categories used in ranking / conflict metadata\nexport enum SpcRuleId {\n\tSinglePoint = \"single_point\",\n\tTwoSigma = \"two_sigma\",\n\tShift = \"shift\",\n\tTrend = \"trend\",\n}\n\n// Stable ordered precedence list (index +1 gives rank)\nexport const RULE_PRECEDENCE: SpcRuleId[] = [\n\tSpcRuleId.SinglePoint,\n\tSpcRuleId.TwoSigma,\n\tSpcRuleId.Shift,\n\tSpcRuleId.Trend,\n];\n\n// Derive rank map from RULE_PRECEDENCE (1-based)\nexport const RULE_RANK_BY_ID: Record<SpcRuleId, number> =\n\tRULE_PRECEDENCE.reduce(\n\t\t(acc, id, i) => {\n\t\t\tacc[id] = i + 1;\n\t\t\treturn acc;\n\t\t},\n\t\t{} as Record<SpcRuleId, number>\n\t);\n\n// Human friendly labels (retained for backward compatibility)\n/**\n * @deprecated Use `RULE_METADATA[id].label` or `RULES_IN_RANK_ORDER` instead.\n */\nexport const RULE_LABEL: Record<SpcRuleId, string> = {\n\t[SpcRuleId.SinglePoint]: \"Single point beyond process limit\",\n\t[SpcRuleId.TwoSigma]: \"Two of three beyond 2σ on one side\",\n\t[SpcRuleId.Shift]: \"Sustained shift (run)\",\n\t[SpcRuleId.Trend]: \"Monotonic trend\",\n};\n\n// Unified rule metadata registry\nexport enum SpcRuleCategory {\n\tPoint = \"point\",\n\tCluster = \"cluster\",\n\tSustained = \"sustained\",\n}\n\nexport interface SpcRuleMetadataEntry {\n\tid: SpcRuleId;\n\trank: number;\n\tlabel: string;\n\tcategory: SpcRuleCategory;\n\tparticipatesInRanking: boolean;\n}\n\nconst RULE_CATEGORY: Record<SpcRuleId, SpcRuleCategory> = {\n\t[SpcRuleId.SinglePoint]: SpcRuleCategory.Point,\n\t[SpcRuleId.TwoSigma]: SpcRuleCategory.Cluster,\n\t[SpcRuleId.Shift]: SpcRuleCategory.Sustained,\n\t[SpcRuleId.Trend]: SpcRuleCategory.Sustained,\n};\n\nexport const RULE_METADATA: Record<SpcRuleId, SpcRuleMetadataEntry> =\n\tRULE_PRECEDENCE.reduce(\n\t\t(acc, id, index) => {\n\t\t\tacc[id] = {\n\t\t\t\tid,\n\t\t\t\trank: index + 1,\n\t\t\t\tlabel: RULE_LABEL[id],\n\t\t\t\tcategory: RULE_CATEGORY[id],\n\t\t\t\tparticipatesInRanking: true,\n\t\t\t};\n\t\t\treturn acc;\n\t\t},\n\t\t{} as Record<SpcRuleId, SpcRuleMetadataEntry>\n\t);\n\nexport const RULES_IN_RANK_ORDER: SpcRuleMetadataEntry[] = RULE_PRECEDENCE.map(\n\t(id) => RULE_METADATA[id]\n);\n\n// Directional side (high vs low) for special-cause classification\nexport enum Side {\n\tUp = \"up\",\n\tDown = \"down\",\n}\n\n// Raw rule tag identifiers (snake_case) used in ruleTags audit trail\nexport enum SpcRawRuleTag {\n\tSinglePointAbove = \"single_above\",\n\tSinglePointBelow = \"single_below\",\n\tTwoOfThreeAbove = \"two_of_three_above\",\n\tTwoOfThreeBelow = \"two_of_three_below\",\n\tFourOfFiveAbove = \"four_of_five_above\",\n\tFourOfFiveBelow = \"four_of_five_below\",\n\tShiftHigh = \"shift_high\",\n\tShiftLow = \"shift_low\",\n\tTrendIncreasing = \"trend_inc\",\n\tTrendDecreasing = \"trend_dec\",\n\tFifteenInnerThird = \"fifteen_inner_third\",\n}\n\n// Map raw rule tags (side-specific flags) to canonical ranked rule ids\nexport const RAW_TAG_TO_RULE_ID: Partial<Record<SpcRawRuleTag, SpcRuleId>> = {\n\t[SpcRawRuleTag.SinglePointAbove]: SpcRuleId.SinglePoint,\n\t[SpcRawRuleTag.SinglePointBelow]: SpcRuleId.SinglePoint,\n\t[SpcRawRuleTag.TwoOfThreeAbove]: SpcRuleId.TwoSigma,\n\t[SpcRawRuleTag.TwoOfThreeBelow]: SpcRuleId.TwoSigma,\n\t[SpcRawRuleTag.ShiftHigh]: SpcRuleId.Shift,\n\t[SpcRawRuleTag.ShiftLow]: SpcRuleId.Shift,\n\t[SpcRawRuleTag.TrendIncreasing]: SpcRuleId.Trend,\n\t[SpcRawRuleTag.TrendDecreasing]: SpcRuleId.Trend,\n\t// FourOfFiveAbove / FourOfFiveBelow intentionally omitted from ranking\n\t// FifteenInnerThird intentionally omitted from ranking\n};\n\nexport enum AssuranceIcon {\n\tPass = \"pass\",\n\tFail = \"fail\",\n\tNone = \"none\",\n}\n\n// Baseline suggestion trigger reason ordering (string values used in snapshots/docs)\nexport enum BaselineSuggestionReason {\n\tShift = \"shift\",\n\tTrend = \"trend\",\n\tPoint = \"point\",\n}\n\n// Precedence strategies for variation classification\nexport enum PrecedenceStrategy {\n\tLegacy = \"legacy\",\n\tDirectionalFirst = \"directional_first\",\n}\n\n// Optional conflict precedence mode (SQL v2.6a style ranking)\nexport enum ConflictPrecedenceMode {\n\tNone = \"none\",\n\tSqlRankingV26a = \"sql_ranking_v2_6a\",\n}\n\n// Unified prime direction (used by SQL compatibility & potential conflict pruning metadata)\nexport enum PrimeDirection {\n\tUpwards = \"Upwards\",\n\tDownwards = \"Downwards\",\n\tSame = \"Same\",\n}\n\n// Unified pruning mode enumeration for rows\nexport enum PruningMode {\n\tSql = \"sql\",\n\tConflict = \"conflict\",\n}\n\n// Row alias field names (forward-compatible deprecations / planned renames)\nexport enum SpcRowAliasField {\n\tImprovementValueBeforePruning = \"improvementValueBeforePruning\",\n\tConcernValueBeforePruning = \"concernValueBeforePruning\",\n}\n","import { VariationIcon, AssuranceIcon } from \"./spcConstants\";\n\n// Stable identifiers for rule flags mapped from SpcRow boolean properties (enum for stronger typing)\nexport enum SpcRuleId {\n\tSinglePointUp = 'singlePointUp',\n\tSinglePointDown = 'singlePointDown',\n\tTwoOfThreeUp = 'twoOfThreeUp',\n\tTwoOfThreeDown = 'twoOfThreeDown',\n\tFourOfFiveUp = 'fourOfFiveUp',\n\tFourOfFiveDown = 'fourOfFiveDown',\n\tShiftUp = 'shiftUp',\n\tShiftDown = 'shiftDown',\n\tTrendUp = 'trendUp',\n\tTrendDown = 'trendDown'\n}\n\nexport interface SpcRuleGlossaryEntry {\n\t/** Short label suitable for dense tooltip list */\n\ttooltip: string;\n\t/** Longer narration fragment (not full sentence) used when assembling live region text */\n\tnarration: string;\n}\n\n\texport const ruleGlossary: Record<SpcRuleId, SpcRuleGlossaryEntry> = {\n\t\t[SpcRuleId.SinglePointUp]: {\n\t\ttooltip: \"Single point above upper control limit\",\n\t\tnarration: \"Single point beyond a control limit\",\n\t},\n\t\t[SpcRuleId.SinglePointDown]: {\n\t\ttooltip: \"Single point below lower control limit\",\n\t\tnarration: \"Single point beyond a control limit\",\n\t},\n\t\t[SpcRuleId.TwoOfThreeUp]: {\n\t\ttooltip: \"Two of three points beyond +2σ\",\n\t\tnarration: \"Two of three points beyond two sigma (same side)\",\n\t},\n\t\t[SpcRuleId.TwoOfThreeDown]: {\n\t\ttooltip: \"Two of three points beyond -2σ\",\n\t\tnarration: \"Two of three points beyond two sigma (same side)\",\n\t},\n\t\t[SpcRuleId.FourOfFiveUp]: {\n\t\ttooltip: \"Four of five points beyond +1σ\",\n\t\tnarration: \"Four of five points beyond one sigma (same side)\",\n\t},\n\t\t[SpcRuleId.FourOfFiveDown]: {\n\t\ttooltip: \"Four of five points beyond -1σ\",\n\t\tnarration: \"Four of five points beyond one sigma (same side)\",\n\t},\n\t\t[SpcRuleId.ShiftUp]: {\n\t\ttooltip: \"Shift: run of points above centre line\",\n\t\tnarration: \"Shift (run on one side of mean)\",\n\t},\n\t\t[SpcRuleId.ShiftDown]: {\n\t\ttooltip: \"Shift: run of points below centre line\",\n\t\tnarration: \"Shift (run on one side of mean)\",\n\t},\n\t\t[SpcRuleId.TrendUp]: {\n\t\ttooltip: \"Trend: consecutive increasing points\",\n\t\tnarration: \"Trend (consecutive increases)\",\n\t},\n\t\t[SpcRuleId.TrendDown]: {\n\t\ttooltip: \"Trend: consecutive decreasing points\",\n\t\tnarration: \"Trend (consecutive decreases)\",\n\t},\n};\n\n// Minimal structural type carrying the directional rule flags — enables use with\n// both legacy SpcRow and v2-mapped UI rows without forcing casts.\ntype RuleFlagCarrier = {\n  specialCauseSinglePointUp?: boolean;\n  specialCauseSinglePointDown?: boolean;\n  specialCauseTwoOfThreeUp?: boolean;\n  specialCauseTwoOfThreeDown?: boolean;\n  specialCauseFourOfFiveUp?: boolean;\n  specialCauseFourOfFiveDown?: boolean;\n  specialCauseShiftUp?: boolean;\n  specialCauseShiftDown?: boolean;\n  specialCauseTrendUp?: boolean;\n  specialCauseTrendDown?: boolean;\n};\n\n/** Extract the triggered rule identifiers for a given SPC row */\nexport function extractRuleIds(row: RuleFlagCarrier | undefined | null): SpcRuleId[] {\n\tif (!row) return [];\n\tconst ids: SpcRuleId[] = [];\n\tif (row.specialCauseSinglePointUp) ids.push(SpcRuleId.SinglePointUp);\n\tif (row.specialCauseSinglePointDown) ids.push(SpcRuleId.SinglePointDown);\n\tif (row.specialCauseTwoOfThreeUp) ids.push(SpcRuleId.TwoOfThreeUp);\n\tif (row.specialCauseTwoOfThreeDown) ids.push(SpcRuleId.TwoOfThreeDown);\n\tif (row.specialCauseFourOfFiveUp) ids.push(SpcRuleId.FourOfFiveUp);\n\tif (row.specialCauseFourOfFiveDown) ids.push(SpcRuleId.FourOfFiveDown);\n\tif (row.specialCauseShiftUp) ids.push(SpcRuleId.ShiftUp);\n\tif (row.specialCauseShiftDown) ids.push(SpcRuleId.ShiftDown);\n\tif (row.specialCauseTrendUp) ids.push(SpcRuleId.TrendUp);\n\tif (row.specialCauseTrendDown) ids.push(SpcRuleId.TrendDown);\n\treturn ids;\n}\n\n/** Standardised human readable label for variation classification */\nexport function variationLabel(icon: VariationIcon | undefined): string | null {\n\tswitch (icon) {\n\t\tcase VariationIcon.Improvement:\n\t\t\treturn \"Improvement signal\";\n\t\tcase VariationIcon.Concern:\n\t\t\treturn \"Concern signal\";\n\t\tcase VariationIcon.Neither:\n\t\t\treturn \"Common cause variation\";\n\t\tcase VariationIcon.Suppressed:\n\t\t\treturn null; // suppressed / not enough data\n\t\tdefault:\n\t\t\treturn null;\n\t}\n}\n\n/** Human readable assurance (target) classification */\nexport function assuranceLabel(icon: AssuranceIcon | undefined): string | null {\n\tswitch (icon) {\n\t\tcase AssuranceIcon.Pass:\n\t\t\treturn \"Target met\";\n\t\tcase AssuranceIcon.Fail:\n\t\t\treturn \"Target not met\";\n\t\tdefault:\n\t\t\treturn null;\n\t}\n}\n\n/** Zone classification given mean + sigma + value */\nexport function zoneLabel(\n\tmean: number | null | undefined,\n\tsigma: number,\n\tvalue: number\n): string | null {\n\tif (mean == null || !Number.isFinite(sigma) || sigma <= 0) return null;\n\tconst z = Math.abs((value - mean) / sigma);\n\tif (z < 1) return \"Within 1σ\";\n\tif (z < 2) return \"Between 1–2σ\";\n\tif (z < 3) return \"Between 2–3σ\";\n\treturn \"Beyond 3σ\";\n}\n\n// ------------------------- Shared visual tokens (source of truth) -------------------------\n// Canonical mapping of engine variation icons -> CSS token (with fallback hex).\nexport const VARIATION_COLOR_TOKENS: Record<\n\tVariationIcon,\n\t{ token: string; hex: string }\n> = {\n\timprovement: {\n\t\ttoken: \"var(--nhs-fdp-color-data-viz-spc-improvement, #00B0F0)\",\n\t\thex: \"#00B0F0\",\n\t},\n\tconcern: {\n\t\ttoken: \"var(--nhs-fdp-color-data-viz-spc-concern, #E46C0A)\",\n\t\thex: \"#E46C0A\",\n\t},\n\tneither: {\n\t\ttoken: \"var(--nhs-fdp-color-data-viz-spc-common-cause, #A6A6A6)\",\n\t\thex: \"#A6A6A6\",\n\t},\n\tsuppressed: {\n\t\ttoken: \"var(--nhs-fdp-color-data-viz-spc-no-judgement, #490092)\",\n\t\thex: \"#490092\",\n\t},\n};\n\nexport function getVariationColorToken(\n\ticon: VariationIcon | undefined\n): string {\n\tif (!icon) return VARIATION_COLOR_TOKENS.neither.token;\n\treturn (\n\t\tVARIATION_COLOR_TOKENS[icon]?.token ?? VARIATION_COLOR_TOKENS.neither.token\n\t);\n}\n\nexport function getVariationColorHex(icon: VariationIcon | undefined): string {\n\tif (!icon) return VARIATION_COLOR_TOKENS.neither.hex;\n\treturn (\n\t\tVARIATION_COLOR_TOKENS[icon]?.hex ?? VARIATION_COLOR_TOKENS.neither.hex\n\t);\n}\n","// Simple three‑state assurance enum\nexport enum AssuranceResult {\n\tPass = \"pass\",\n\tFail = \"fail\",\n\tUncertain = \"uncertain\",\n}\n\n// Pull canonical SPC palette from engine logic (source of truth)\nimport { VARIATION_COLOR_TOKENS } from \"../SPCChart/descriptors\";\n\n// Default colours aligned to variation icon palette\nexport const DEFAULT_COLOURS: Record<AssuranceResult, string> = {\n\t[AssuranceResult.Pass]: \"#00B0F0\", // blue\n\t[AssuranceResult.Fail]: \"#E46C0A\", // orange\n\t[AssuranceResult.Uncertain]: \"#A6A6A6\", // grey\n};\n\n// Default letters to show for each state\nexport const DEFAULT_LETTERS: Record<AssuranceResult, string> = {\n\t[AssuranceResult.Pass]: \"P\",\n\t[AssuranceResult.Fail]: \"F\",\n\t[AssuranceResult.Uncertain]: \"?\",\n};\n\n// Metric polarity tells us if \"higher\" is good or bad for interpretation text.\nexport enum MetricPolarity {\n\tHigherIsBetter = \"higher_is_better\",\n\tLowerIsBetter = \"lower_is_better\",\n\tContextDependent = \"context_dependent\",\n}\n\n// Orientation / geometry (was TrendDirection / Layout earlier)\nexport enum Direction {\n\tHigher = \"higher\",\n\tLower = \"lower\",\n}\n\nexport enum VariationJudgement {\n\tImproving = \"improving\",\n\tDeteriorating = \"deteriorating\",\n\tNo_Judgement = \"no_judgement\",\n\tNone = \"none\",\n}\n\nexport enum VariationState {\n\tSpecialCauseImproving = \"special_cause_improving\",\n\tSpecialCauseDeteriorating = \"special_cause_deteriorating\",\n\tCommonCause = \"common_cause\",\n\tSpecialCauseNoJudgement = \"special_cause_no_judgement\",\n}\n\nexport interface VariationColourDef {\n\thex: string;\n\tstroke?: string;\n\tfill?: string;\n\tlabel: string;\n\tdescription: string;\n\ttext?: string;\n\tjudgement?: VariationJudgement;\n}\n\n// Geometry constants (legacy 300x300 artboard)\nexport const ICON_VIEWBOX = \"0 0 300 300\";\nexport const ICON_SIZE = 300; // default px\nexport const ICON_CX = 150;\nexport const ICON_CY = 150;\nexport const ICON_R = 113.25;\nexport const POINT_RADIUS = 16;\n\n// Base polygon path currently used for No Judgement glyph (points upward by default)\nexport const NO_JUDGEMENT_GLYPH_PATH =\n\t\"M 90.26,185.42 L 149.31,126.37 127.44,104.51 209.81,90.66 195.96,173.02 174.09,151.16 115.05,210.2 90.26,185.42 Z M 90.26,185.42\";\n\n// Accessible text colour picker (simple luminance threshold)\nconst pickTextColour = (hex: string) => {\n\tconst c = hex.replace(\"#\", \"\");\n\tconst r = parseInt(c.slice(0, 2), 16) / 255;\n\tconst g = parseInt(c.slice(2, 4), 16) / 255;\n\tconst b = parseInt(c.slice(4, 6), 16) / 255;\n\tconst srgb = [r, g, b].map((v) =>\n\t\tv <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4)\n\t);\n\tconst L = 0.2126 * srgb[0] + 0.7152 * srgb[1] + 0.0722 * srgb[2];\n\treturn L < 0.55 ? \"#ffffff\" : \"#212b32\";\n};\n\nexport const VARIATION_COLOURS: Record<VariationState, VariationColourDef> = {\n\t[VariationState.SpecialCauseDeteriorating]: {\n\t\thex: VARIATION_COLOR_TOKENS.concern.hex,\n\t\tjudgement: VariationJudgement.Deteriorating,\n\t\tlabel: \"Special Cause (Deteriorating)\",\n\t\tdescription:\n\t\t\t\"Deteriorating variation detected (special cause) relative to baseline.\",\n\t},\n\t[VariationState.SpecialCauseImproving]: {\n\t\thex: VARIATION_COLOR_TOKENS.improvement.hex,\n\t\tjudgement: VariationJudgement.Improving,\n\t\tlabel: \"Special Cause (Improving)\",\n\t\tdescription:\n\t\t\t\"Improving variation detected (special cause) relative to baseline.\",\n\t},\n\t[VariationState.CommonCause]: {\n\t\thex: VARIATION_COLOR_TOKENS.neither.hex,\n\t\tjudgement: VariationJudgement.None,\n\t\tlabel: \"Common Cause\",\n\t\tdescription: \"Common cause variation only – no special cause detected.\",\n\t},\n\t[VariationState.SpecialCauseNoJudgement]: {\n\t\thex: VARIATION_COLOR_TOKENS.suppressed.hex,\n\t\tjudgement: VariationJudgement.No_Judgement,\n\t\tlabel: \"Special Cause (No Judgement)\",\n\t\tdescription:\n\t\t\t\"Special cause detected without assigning improving/deteriorating judgement.\",\n\t},\n};\n\nObject.values(VARIATION_COLOURS).forEach((def) => {\n\tif (!def.text) def.text = pickTextColour(def.hex);\n});\n\nexport const getVariationColour = (state: VariationState) =>\n\tVARIATION_COLOURS[state];\nexport const getVariationTrend = (state: VariationState): VariationJudgement =>\n\tVARIATION_COLOURS[state].judgement || VariationJudgement.None;\n\nexport interface Point {\n\tcx: number;\n\tcy: number;\n}\n\nexport const POINT_LAYOUTS = {\n\tspecial: {\n\t\thigher: [\n\t\t\t{ cx: 77.5, cy: 158.5 },\n\t\t\t{ cx: 114, cy: 175 },\n\t\t\t{ cx: 150.5, cy: 158.5 },\n\t\t\t{ cx: 188, cy: 125 },\n\t\t\t{ cx: 225, cy: 137 },\n\t\t],\n\t\tlower: [\n\t\t\t{ cx: 77.5, cy: 139.5 },\n\t\t\t{ cx: 114, cy: 124.5 },\n\t\t\t{ cx: 150.5, cy: 139.5 },\n\t\t\t{ cx: 188, cy: 175.5 },\n\t\t\t{ cx: 224.5, cy: 162 },\n\t\t],\n\t},\n\tcommon: [\n\t\t{ cx: 76.5, cy: 149.5 },\n\t\t{ cx: 113, cy: 179.5 },\n\t\t{ cx: 149.5, cy: 117 },\n\t\t{ cx: 187, cy: 171 },\n\t\t{ cx: 223.5, cy: 158 },\n\t],\n} as const;\n\nexport function computePointPositions(\n\tstate: VariationState,\n\tdirection: Direction\n): Point[] {\n\tlet src;\n\tif (state === VariationState.CommonCause) src = POINT_LAYOUTS.common;\n\telse\n\t\tsrc =\n\t\t\tPOINT_LAYOUTS.special[direction === Direction.Lower ? \"lower\" : \"higher\"];\n\treturn src.map((p) => ({ ...p }));\n}\n\n// Narrow type for example payloads (matches derivation form accepted by SPCVariationIcon)\ninterface VariationExampleData {\n\tjudgement: VariationJudgement;\n\tpolarity: MetricPolarity;\n\ttrend?: Direction; // only required for No_Judgement / None examples\n}\n\nexport const variationExamples: {\n\tid: string;\n\tlabel: string;\n\tdata: VariationExampleData;\n}[] = [\n\t{\n\t\tid: \"improve-higher\",\n\t\tlabel: \"Improving (Higher is Better) – Trend is Higher\",\n\t\tdata: {\n\t\t\tjudgement: VariationJudgement.Improving,\n\t\t\tpolarity: MetricPolarity.HigherIsBetter,\n\t\t},\n\t},\n\t{\n\t\tid: \"improve-lower\",\n\t\tlabel: \"Improving (Lower is Better) – Trend is Lower\",\n\t\tdata: {\n\t\t\tjudgement: VariationJudgement.Improving,\n\t\t\tpolarity: MetricPolarity.LowerIsBetter,\n\t\t},\n\t},\n\t{\n\t\tid: \"deteriorate-higher\",\n\t\tlabel: \"Deteriorating (Higher is Better) – Trend is Lower\",\n\t\tdata: {\n\t\t\tjudgement: VariationJudgement.Deteriorating,\n\t\t\tpolarity: MetricPolarity.HigherIsBetter,\n\t\t},\n\t},\n\t{\n\t\tid: \"deteriorate-lower\",\n\t\tlabel: \"Deteriorating (Lower is Better) – Trend is Higher\",\n\t\tdata: {\n\t\t\tjudgement: VariationJudgement.Deteriorating,\n\t\t\tpolarity: MetricPolarity.LowerIsBetter,\n\t\t},\n\t},\n\t{\n\t\tid: \"no-judgement-higher\",\n\t\tlabel: \"Special Cause (No Judgement) – Trend is Higher\",\n\t\tdata: {\n\t\t\tjudgement: VariationJudgement.No_Judgement,\n\t\t\tpolarity: MetricPolarity.ContextDependent,\n\t\t\ttrend: Direction.Higher,\n\t\t},\n\t},\n\t{\n\t\tid: \"no-judgement-lower\",\n\t\tlabel: \"Special Cause (No Judgement) – Lower\",\n\t\tdata: {\n\t\t\tjudgement: VariationJudgement.No_Judgement,\n\t\t\tpolarity: MetricPolarity.ContextDependent,\n\t\t\ttrend: Direction.Lower,\n\t\t},\n\t},\n\t{\n\t\tid: \"common-cause-higher\",\n\t\tlabel: \"Common Cause – Higher layout\",\n\t\tdata: {\n\t\t\tjudgement: VariationJudgement.None,\n\t\t\tpolarity: MetricPolarity.HigherIsBetter,\n\t\t\ttrend: Direction.Higher,\n\t\t},\n\t},\n\t{\n\t\tid: \"common-cause-lower\",\n\t\tlabel: \"Common Cause – Lower layout\",\n\t\tdata: {\n\t\t\tjudgement: VariationJudgement.None,\n\t\t\tpolarity: MetricPolarity.HigherIsBetter,\n\t\t\ttrend: Direction.Lower,\n\t\t},\n\t},\n];\n\nexport const assuranceExamples = [\n\t{\n\t\tid: \"assurance-pass\",\n\t\tlabel: \"Assurance Pass\",\n\t\tstatus: AssuranceResult.Pass,\n\t},\n\t{\n\t\tid: \"assurance-fail\",\n\t\tlabel: \"Assurance Fail\",\n\t\tstatus: AssuranceResult.Fail,\n\t},\n\t{\n\t\tid: \"assurance-uncertain\",\n\t\tlabel: \"Assurance Uncertain\",\n\t\tstatus: AssuranceResult.Uncertain,\n\t},\n];\n\n// Compatibility re-exports: canonical tokens & helpers live in SPCChart logic; re-export here for older imports\nexport { VARIATION_COLOR_TOKENS } from \"../SPCChart/descriptors\";\nexport { getVariationColorToken, getVariationColorHex } from \"../SPCChart/descriptors\";\nexport type { VariationIcon } from \"../SPCChart/logic_v2/types\";\n","// Shared token lookup utilities for SPC icons.\nlet spcTokenRoot: Record<string, any> | null = null;\ntry {\n\t// Dynamic require to avoid breaking SSR if tokens file not present at runtime.\n\t// @ts-ignore - compiled artifact path resolved post-build\n\tconst tokens = require(\"@fergusbisset/nhs-fdp-design-system/dist/js/tokens.json\");\n\tspcTokenRoot = tokens?.color?.[\"data-viz\"]?.spc || null;\n} catch {\n\t// Swallow – fall back to provided colour fallbacks.\n}\n\nexport const tokenColour = (key: string, fallback: string): string => {\n\tif (!spcTokenRoot) return fallback;\n\tconst parts = key.split(\".\");\n\tlet current: any = spcTokenRoot;\n\tfor (const p of parts) {\n\t\tif (current == null) break;\n\t\tcurrent = current[p];\n\t}\n\tconst val = current;\n\tif (val == null) return fallback;\n\tif (typeof val === \"string\" || typeof val === \"number\") return String(val);\n\tif (val.$value != null) return String(val.$value);\n\tif (val.value != null) return String(val.value);\n\treturn fallback;\n};\n\nexport const getGradientOpacities = () => ({\n\t// Lightened defaults (previous 0.18 -> 0.12, 0.06 -> 0.03) to reduce intensity of wash.\n\tstart: tokenColour(\"gradient.stop.start-opacity\", \"0.12\"),\n\tmid: tokenColour(\"gradient.stop.mid-opacity\", \"0.03\"),\n\tend: tokenColour(\"gradient.stop.end-opacity\", \"0\"),\n\ttriStart: tokenColour(\n\t\t\"gradient.stop.triangle-start-opacity\",\n\t\ttokenColour(\"gradient.stop.start-opacity\", \"0.12\")\n\t),\n\ttriMid: tokenColour(\n\t\t\"gradient.stop.triangle-mid-opacity\",\n\t\ttokenColour(\"gradient.stop.mid-opacity\", \"0.03\")\n\t),\n\ttriEnd: tokenColour(\n\t\t\"gradient.stop.triangle-end-opacity\",\n\t\ttokenColour(\"gradient.stop.end-opacity\", \"0\")\n\t),\n});\n\n// Centralised mapping from enums to token names and fallbacks to avoid scattered string literals\nimport { VariationIcon as UiVariationIcon } from \"../SPCChart/types\";\nimport { VariationState } from \"./SPCConstants\";\n\nexport const SPC_TOKEN_KEYS = {\n\timprovement: \"improvement\",\n\tconcern: \"concern\",\n\tnoJudgement: \"no-judgement\",\n\tcommon: \"common-cause\",\n} as const;\n\nexport const SPC_FALLBACK_HEX = {\n\timprovement: \"#00B0F0\",\n\tconcern: \"#E46C0A\",\n\tnoJudgement: \"#490092\",\n\tcommon: \"#A6A6A6\",\n} as const;\n\nexport const colourImprovement = () => tokenColour(SPC_TOKEN_KEYS.improvement, SPC_FALLBACK_HEX.improvement);\nexport const colourConcern = () => tokenColour(SPC_TOKEN_KEYS.concern, SPC_FALLBACK_HEX.concern);\nexport const colourNoJudgement = () => tokenColour(SPC_TOKEN_KEYS.noJudgement, SPC_FALLBACK_HEX.noJudgement);\nexport const colourCommon = () => tokenColour(SPC_TOKEN_KEYS.common, SPC_FALLBACK_HEX.common);\n\n/** Map UI VariationIcon to token colour */\nexport function colourForSignal(icon: UiVariationIcon | null | undefined): string {\n\tswitch (icon) {\n\t\tcase UiVariationIcon.Improvement:\n\t\t\treturn colourImprovement();\n\t\tcase UiVariationIcon.Concern:\n\t\t\treturn colourConcern();\n\t\tcase UiVariationIcon.Neither:\n\t\tcase UiVariationIcon.Suppressed:\n\t\tdefault:\n\t\t\treturn colourCommon();\n\t}\n}\n\n/** Map series-level VariationState to token colour used for series strokes/bands */\nexport function colourForState(state: VariationState | null | undefined): string {\n\tswitch (state) {\n\t\tcase VariationState.SpecialCauseImproving:\n\t\t\treturn colourImprovement();\n\t\tcase VariationState.SpecialCauseDeteriorating:\n\t\t\treturn colourConcern();\n\t\tcase VariationState.SpecialCauseNoJudgement:\n\t\t\treturn colourNoJudgement();\n\t\tcase VariationState.CommonCause:\n\t\tdefault:\n\t\t\treturn colourCommon();\n\t}\n}\n\n","// UI-only SPC constants for icon/gradient rendering. Defined locally to avoid storybook-only import paths.\n\nexport enum SpcGradientCategory {\n\tConcern = \"concern\",\n\tImprovement = \"improvement\",\n\tNoJudgement = \"noJudgement\",\n\tCommon = \"common\",\n}\n\nexport enum SpcEmbeddedIconVariant {\n\tClassic = \"classic\",\n\tTriangle = \"triangle\",\n\tTriangleWithRun = \"triangleWithRun\",\n}\n\nexport enum LetterMode {\n\tDirection = \"direction\",\n\tPolarity = \"polarity\",\n}\n\nexport enum SpcLetterGlyph {\n\tH = \"H\",\n\tL = \"L\",\n\tNone = \"\",\n}\n\nexport default SpcGradientCategory;\n","import React, { useId, useMemo } from \"react\";\nimport { tokenColour, getGradientOpacities, colourForState } from \"./tokenUtils\";\nimport {\n\tcomputePointPositions,\n\tDirection,\n\tgetVariationColour,\n\tgetVariationTrend,\n\tMetricPolarity,\n\tPoint,\n\tVariationJudgement,\n\tVariationState,\n} from \"./SPCConstants\";\n\n// Token utilities now sourced from shared tokenUtils module.\n// Import VariationIcon enum from SPC engine to permit direct usage with icon component.\n// Updated: point to advanced SPC engine (legacy ../../xmr/spc path removed during refactor)\nimport { VariationIcon as SpcEngineVariationIcon, ImprovementDirection } from \"../engine\";\n// Also accept UI-level VariationIcon (Improvement/Concern/Neither/Suppressed)\nimport { VariationIcon as UiVariationIcon } from \"../SPCChart/types\";\nimport { SpcEmbeddedIconVariant, LetterMode, SpcLetterGlyph } from \"../SPCChart/SPCChart.constants\";\nimport type { SpcPrecomputedSummary } from \"../utils/precompute\";\n\n// Friendly alias exported for consumers who want to pass just the engine icon key\nexport type SpcEngineIconPayload = {\n\tvariationIcon: SpcEngineVariationIcon;\n\ttrend?: Direction;\n\tpolarity?: MetricPolarity;\n};\n\n// (Removed duplicate local colour system; rely on canonical palette & helpers from SPCConstants.)\n\n// --- Point layout system ----------------------------------------------------\n// We render five recent data points; their vertical positions vary with state + direction\n// Coordinates are in icon space (300x300). We preserve r=16.\n// Chosen layouts (provided examples):\n// - special cause (current \"higher\" pattern)       : existing original coordinates\n// - special cause (\"lower\" pattern)                : alternate set provided\n// - common cause (neutral variation)               : all grey positions provided\n// - special cause no judgement uses direction to choose between higher/lower layout\n\n/**\n * Payload driving the variation icon.\n *\n * The `state` determines the SPC classification (special cause improving/deteriorating,\n * common cause or special cause with no judgement) and therefore the colour.\n * The optional `trend/direction` explicitly controls whether the variation is moving\n * higher or lower relative to the baseline. This allows all eight logical\n * permutations (state × trend) to be specified directly. When omitted,\n * a trend will be derived for special cause improving/deteriorating states\n * only; other states will default to 'higher'.\n *\n * `polarity` is retained for alt‑text copy but has no effect on colour or\n * letter rendering.\n */\n/**\n * @deprecated Use engine-aligned payload: { variationIcon, improvementDirection, specialCauseNeutral?, trend? }\n * Retained temporarily for backward compatibility. Will be removed in a future minor version once downstream usages migrate.\n */\nexport interface SpcVariationPayload {\n\tstate: VariationState;\n\ttrend?: Direction; // explicitly choose geometry (higher/lower)\n\tpolarity?: MetricPolarity;\n}\n\n// New: direct engine variation icon payload (maps engine-level VariationIcon enum to a state)\nexport interface SpcVariationEngineIconPayload {\n\tvariationIcon: SpcEngineVariationIcon | UiVariationIcon;\n\ttrend?: Direction; // orientation override\n\tpolarity?: MetricPolarity; // optional explicit polarity\n\timprovementDirection?: ImprovementDirection; // engine-style polarity input (preferred over polarity when provided)\n\tspecialCauseNeutral?: boolean; // distinguishes neutral special-cause (purple) from common cause when variationIcon === Neither\n\thighSideSignal?: boolean; // optional side hint for neutral special-cause arrow orientation\n\tlowSideSignal?: boolean; // optional side hint for neutral special-cause arrow orientation\n}\n\n/**\n * V2 (derivable) payload – supply semantic \"what we know\" and let the icon infer \"how to draw\".\n *\n * Inputs\n *  - judgement: SPC variation judgement at the most recent point.\n *      * improving        -> maps to VariationState.SpecialCauseImproving (special cause, positive)\n *      * deteriorating    -> maps to VariationState.SpecialCauseDeteriorating (special cause, negative)\n *      * no_judgement     -> maps to VariationState.SpecialCauseNoJudgement (special cause detected but cannot label direction)\n *      * none             -> maps to VariationState.CommonCause (no special cause)\n *  - polarity: MetricPolarity describing whether higher values are desirable, lower are desirable, or it is context dependent.\n *  - trend (optional): Explicit geometric direction (higher / lower). Only used / needed when the judgement itself does\n *    not imply a direction (no_judgement, none) OR when inference would be ambiguous (e.g. polarity context dependent).\n *\n * Derivation Logic (implemented in resolveStateAndLayout):\n *  1. State mapping is direct from judgement (see above).\n *  2. Direction inference:\n *      a. If judgement is Improving:\n *           - If polarity === LowerIsBetter, a reduction is desirable so the trend is considered Lower.\n *           - Otherwise (HigherIsBetter or ContextDependent), assume Higher.\n *      b. If judgement is Deteriorating:\n *           - If polarity === LowerIsBetter, an increase is undesirable -> direction inferred Higher.\n *           - Otherwise, inferred Lower.\n *      c. If judgement is No_Judgement or None:\n *           - We cannot infer reliably; use provided trend prop or fall back to Higher as a neutral default.\n *  3. Polarity is carried through for potential use in externally generated aria text / tooltips but does not\n *     currently alter colour once state is fixed (colour is keyed solely by final VariationState).\n *\n * Rendering Effects of Derived Values:\n *  - state selects the colour (ring, letter, special glyph) via getVariationColour(state).\n *  - direction selects which set of 5 point coordinates are used (higher vs lower layout) via computePointPositions.\n *  - letter (H / L) is only rendered when judgement is Improving or Deteriorating; it reflects the final direction.\n *  - SpecialCauseNoJudgement renders the purple arrow glyph; direction rotates / orients that glyph.\n *  - CommonCause (state = common cause) suppresses letter and arrow; all points render grey and the ring is grey.\n *  - Special cause states colour the last two data points; common cause keeps all points grey.\n *\n * When to Provide trend explicitly:\n *  - Always for judgement = No_Judgement or None (otherwise a default of Higher is applied which may misrepresent geometry).\n *  - Optionally for Improving/Deteriorating if you wish to override the inferred direction (rare; would make semantics inconsistent).\n *\n * Examples:\n *  { judgement: Improving, polarity: HigherIsBetter } -> state special_cause_improving, direction higher, letter H\n *  { judgement: Improving, polarity: LowerIsBetter }  -> state special_cause_improving, direction lower,  letter L\n *  { judgement: Deteriorating, polarity: HigherIsBetter } -> state special_cause_deteriorating, direction lower,  letter L\n *  { judgement: Deteriorating, polarity: LowerIsBetter }  -> state special_cause_deteriorating, direction higher, letter H\n *  { judgement: No_Judgement, polarity: HigherIsBetter, trend: Lower } -> state special_cause_no_judgement, direction lower, arrow rotated, no letter\n *  { judgement: None, polarity: ContextDependent, trend: Higher } -> state common_cause, direction higher, grey ring, no letter\n */\n/**\n * @deprecated Supply engine payload instead. If you still need automatic letter orientation, pass improvementDirection and omit trend.\n */\nexport interface SpcVariationDerivePayload {\n\tjudgement: VariationJudgement;\n\tpolarity: MetricPolarity;\n\ttrend?: Direction; // required when judgement is no_judgement/none OR polarity is context_dependent\n}\n\nexport type SpcVariationInput =\n\t| SpcVariationPayload\n\t| SpcVariationDerivePayload\n\t| SpcVariationParsimonious\n\t| SpcVariationEngineIconPayload;\n\n/**\n * Strict, parsimonious V2 shape — requires orientation when judgement is neutral\n * or when polarity is context-dependent. This enforces compile-time clarity.\n */\n/**\n * @deprecated Parsimonious form superseded by engine payload. Prefer { variationIcon, improvementDirection, specialCauseNeutral }.\n */\nexport type SpcVariationParsimonious =\n\t| {\n\t\t\tjudgement: VariationJudgement.Improving;\n\t\t\tpolarity: MetricPolarity.HigherIsBetter | MetricPolarity.LowerIsBetter;\n\t  }\n\t| {\n\t\t\tjudgement: VariationJudgement.Deteriorating;\n\t\t\tpolarity: MetricPolarity.HigherIsBetter | MetricPolarity.LowerIsBetter;\n\t  }\n\t| {\n\t\t\tjudgement: VariationJudgement.No_Judgement;\n\t\t\tpolarity: MetricPolarity;\n\t\t\ttrend: Direction;\n\t  }\n\t| {\n\t\t\tjudgement: VariationJudgement.None;\n\t\t\tpolarity: MetricPolarity;\n\t\t\ttrend: Direction;\n\t  };\n\nexport interface SpcVariationAltIconProps extends SpcIconBaseProps {\n\tdata: SpcVariationParsimonious;\n}\n\n/**\n * Normalise either V1 (state/layout) or V2 (judgement+polarity) into { state, layout, polarity } for rendering.\n */\nconst resolveStateAndLayout = (\n\tinput: SpcVariationInput\n): {\n\tstate: VariationState;\n\tdirection: Direction;\n\tpolarity: MetricPolarity;\n} => {\n\t// Runtime deprecation warning (fires once) for legacy payloads (state / judgement forms)\n\tconst emitDeprecation = () => {\n\t\tif (!(globalThis as any).__spcIconDeprecationEmitted) {\n\t\t\tconsole.warn(\n\t\t\t\t\"[SPCVariationIcon] Deprecated payload shape detected. Migrate to { variationIcon, improvementDirection, specialCauseNeutral?, trend? }.\"\n\t\t\t);\n\t\t\t(globalThis as any).__spcIconDeprecationEmitted = true;\n\t\t}\n\t};\n\t// Engine/UI VariationIcon mapping support\n\tif ((input as SpcVariationEngineIconPayload).variationIcon !== undefined) {\n\t\tconst eng = input as SpcVariationEngineIconPayload;\n\t\t// Determine polarity preference: improvementDirection overrides explicit polarity prop.\n\t\tlet polarity: MetricPolarity | undefined = undefined;\n\t\tif (eng.improvementDirection !== undefined) {\n\t\t\tpolarity =\n\t\t\t\teng.improvementDirection === ImprovementDirection.Up\n\t\t\t\t\t? MetricPolarity.HigherIsBetter\n\t\t\t\t\t: eng.improvementDirection === ImprovementDirection.Down\n\t\t\t\t\t\t? MetricPolarity.LowerIsBetter\n\t\t\t\t\t\t: MetricPolarity.ContextDependent;\n\t\t} else if (eng.polarity) {\n\t\t\tpolarity = eng.polarity;\n\t\t}\n\t\t// Map variation icon (supports both UI-level and engine-level enums) to internal state\n\t\tlet state: VariationState;\n\t\tconst rawIcon = (eng as any).variationIcon as any;\n\t\tif (\n\t\t\trawIcon === UiVariationIcon.Improvement ||\n\t\t\trawIcon === UiVariationIcon.Concern ||\n\t\t\trawIcon === UiVariationIcon.Neither ||\n\t\t\trawIcon === UiVariationIcon.Suppressed\n\t\t) {\n\t\t\t// UI-level icon mapping\n\t\t\tif (rawIcon === UiVariationIcon.Improvement) state = VariationState.SpecialCauseImproving;\n\t\t\telse if (rawIcon === UiVariationIcon.Concern) state = VariationState.SpecialCauseDeteriorating;\n\t\t\telse if (rawIcon === UiVariationIcon.Neither) state = VariationState.CommonCause;\n\t\t\telse /* Suppressed */ state = VariationState.SpecialCauseNoJudgement;\n\t\t} else {\n\t\t\t// Engine-level icon mapping (High/Low/CommonCause)\n\t\t\tswitch (eng.variationIcon) {\n\t\t\t\tcase SpcEngineVariationIcon.ImprovementHigh:\n\t\t\t\tcase SpcEngineVariationIcon.ImprovementLow:\n\t\t\t\t\tstate = VariationState.SpecialCauseImproving; break;\n\t\t\t\tcase SpcEngineVariationIcon.ConcernHigh:\n\t\t\t\tcase SpcEngineVariationIcon.ConcernLow:\n\t\t\t\t\tstate = VariationState.SpecialCauseDeteriorating; break;\n\t\t\t\tcase SpcEngineVariationIcon.NeitherHigh:\n\t\t\t\tcase SpcEngineVariationIcon.NeitherLow:\n\t\t\t\t\tstate = eng.specialCauseNeutral\n\t\t\t\t\t\t? VariationState.SpecialCauseNoJudgement\n\t\t\t\t\t\t: VariationState.CommonCause; break;\n\t\t\t\tcase SpcEngineVariationIcon.CommonCause:\n\t\t\t\t\tstate = VariationState.CommonCause; break;\n\t\t\t\tdefault:\n\t\t\t\t\tstate = VariationState.SpecialCauseNoJudgement; break;\n\t\t\t}\n\t\t}\n\t\tlet direction: Direction | undefined = eng.trend as Direction | undefined;\n\t\tif (!direction) {\n\t\t\tif (state === VariationState.SpecialCauseImproving) {\n\t\t\t\tdirection = polarity === MetricPolarity.LowerIsBetter ? Direction.Lower : Direction.Higher;\n\t\t\t} else if (state === VariationState.SpecialCauseDeteriorating) {\n\t\t\t\tdirection = polarity === MetricPolarity.LowerIsBetter ? Direction.Higher : Direction.Lower;\n\t\t\t} else if (state === VariationState.SpecialCauseNoJudgement) {\n\t\t\t\t// Prefer explicit side hints when supplied\n\t\t\t\tif (eng.highSideSignal && !eng.lowSideSignal) direction = Direction.Higher;\n\t\t\t\telse if (eng.lowSideSignal && !eng.highSideSignal) direction = Direction.Lower;\n\t\t\t\telse direction = Direction.Higher; // fallback\n\t\t\t} else {\n\t\t\t\t// Common cause: pick provided trend if any, otherwise neutral default\n\t\t\t\tdirection = Direction.Higher;\n\t\t\t}\n\t\t}\n\t\treturn { state, direction, polarity: polarity ?? MetricPolarity.ContextDependent };\n\t}\n\t// Legacy explicit state payload\n\tif ((input as SpcVariationPayload).state !== undefined) {\n\t\temitDeprecation();\n\t\tconst v1 = input as SpcVariationPayload;\n\t\tlet direction: Direction | undefined = v1.trend as Direction | undefined;\n\t\tif (\n\t\t\t!direction &&\n\t\t\t(v1.state === VariationState.SpecialCauseImproving ||\n\t\t\t\tv1.state === VariationState.SpecialCauseDeteriorating) &&\n\t\t\tv1.polarity\n\t\t) {\n\t\t\tif (v1.state === VariationState.SpecialCauseImproving) {\n\t\t\t\tdirection =\n\t\t\t\t\tv1.polarity === MetricPolarity.LowerIsBetter\n\t\t\t\t\t\t? Direction.Lower\n\t\t\t\t\t\t: Direction.Higher;\n\t\t\t} else {\n\t\t\t\tdirection =\n\t\t\t\t\tv1.polarity === MetricPolarity.LowerIsBetter\n\t\t\t\t\t\t? Direction.Higher\n\t\t\t\t\t\t: Direction.Lower;\n\t\t\t}\n\t\t}\n\t\tif (!direction) {\n\t\t\tif (v1.state === VariationState.SpecialCauseImproving)\n\t\t\t\tdirection = Direction.Higher;\n\t\t\telse if (v1.state === VariationState.SpecialCauseDeteriorating)\n\t\t\t\tdirection = Direction.Lower;\n\t\t\telse direction = Direction.Higher;\n\t\t}\n\t\treturn {\n\t\t\tstate: v1.state,\n\t\t\tdirection,\n\t\t\tpolarity: v1.polarity ?? MetricPolarity.ContextDependent,\n\t\t};\n\t}\n\t// Derivation payload based on judgement + polarity\n\tconst v2 = input as SpcVariationDerivePayload;\n\temitDeprecation();\n\tconst map: Record<VariationJudgement, VariationState> = {\n\t\t[VariationJudgement.Improving]: VariationState.SpecialCauseImproving,\n\t\t[VariationJudgement.Deteriorating]:\n\t\t\tVariationState.SpecialCauseDeteriorating,\n\t\t[VariationJudgement.No_Judgement]: VariationState.SpecialCauseNoJudgement,\n\t\t[VariationJudgement.None]: VariationState.CommonCause,\n\t};\n\tconst state = map[v2.judgement];\n\tlet direction: Direction;\n\tif (v2.judgement === VariationJudgement.Improving) {\n\t\tdirection =\n\t\t\tv2.polarity === MetricPolarity.LowerIsBetter\n\t\t\t\t? Direction.Lower\n\t\t\t\t: Direction.Higher;\n\t} else if (v2.judgement === VariationJudgement.Deteriorating) {\n\t\tdirection =\n\t\t\tv2.polarity === MetricPolarity.LowerIsBetter\n\t\t\t\t? Direction.Higher\n\t\t\t\t: Direction.Lower;\n\t} else {\n\t\tdirection = (v2.trend ?? Direction.Higher) as Direction;\n\t}\n\treturn { state, direction, polarity: v2.polarity };\n};\n\n/**\n * Derive a rich, sentence‑level aria description for assistive tech.\n * This version aligns with MDC accessibility and NHS style.\n */\nexport interface VariationNarrativeContext {\n\tmeasureName?: string; // e.g. \"Emergency department 4h performance\"\n\tdatasetContext?: string; // e.g. \"Monthly trust-wide data\"\n\torganisation?: string; // e.g. \"University Hospital A\"\n\ttimeframe?: string; // e.g. \"Jan 2024 – Jul 2025\"\n\tadditionalNote?: string; // free-form note (intervention, caveat)\n}\n\nexport function deriveVariationAriaDescription(\n\tinput: SpcVariationInput,\n\tcontext?: VariationNarrativeContext\n): string {\n\tconst { state, direction, polarity } = resolveStateAndLayout(input);\n\tconst judgement = getVariationTrend(state);\n\n\t// Use plain-English SPC phrasing: sustained run above/below the mean\n\tconst sideWord = direction === Direction.Higher ? \"above\" : \"below\";\n\tconst trendWord = direction === Direction.Higher ? \"upwards\" : \"downwards\";\n\n\tconst polarityClause = (() => {\n\t\tswitch (polarity) {\n\t\t\tcase MetricPolarity.HigherIsBetter:\n\t\t\t\treturn \"For this measure, higher values are better.\";\n\t\t\tcase MetricPolarity.LowerIsBetter:\n\t\t\t\treturn \"For this measure, lower values are better.\";\n\t\t\tdefault:\n\t\t\t\treturn \"Direction of improvement is context dependent.\";\n\t\t}\n\t})();\n\n\tconst base = (() => {\n\t\tswitch (judgement) {\n\t\t\tcase VariationJudgement.Improving:\n\t\t\t\treturn `Special cause improvement: recent data show a sustained run ${sideWord} the mean (unlikely due to random variation).`;\n\t\t\tcase VariationJudgement.Deteriorating:\n\t\t\t\treturn `Special cause deterioration: recent data show a sustained run ${sideWord} the mean (unlikely due to random variation).`;\n\t\t\tcase VariationJudgement.No_Judgement:\n\t\t\t\treturn `Special cause detected (no value judgement): recent data show a change in level, trending ${trendWord}.`;\n\t\t\tcase VariationJudgement.None:\n\t\t\tdefault:\n\t\t\t\treturn `Common cause variation: points vary randomly around the mean; no special cause detected.`;\n\t\t}\n\t})();\n\n\tconst parts = [\n\t\tbase,\n\t\tpolarityClause,\n\t\tcontext?.measureName ? `Measure: ${context.measureName}.` : null,\n\t\tcontext?.datasetContext ? `${context.datasetContext}.` : null,\n\t\tcontext?.organisation ? `Organisation: ${context.organisation}.` : null,\n\t\tcontext?.timeframe ? `Timeframe: ${context.timeframe}.` : null,\n\t\tcontext?.additionalNote ? context.additionalNote : null,\n\t];\n\treturn parts.filter(Boolean).join(\" \");\n}\n\n/** Assurance states – SPC‑based likelihood to meet target consistently. */\nexport type AssuranceState = \"likely\" | \"unlikely\" | \"uncertain\";\n\nexport interface SpcAssurancePayload {\n\tstate: AssuranceState; // No RAG colours; neutral glyphs.\n\ttargetLabel?: string; // e.g., \"95% within 4h\"\n}\n\n/** Shared visual props */\nexport interface SpcIconBaseProps {\n\tsize?: number; // px; default 44. Consider 32–44 for dense tables.\n\tariaLabel?: string; // override accessible label\n\tshowLetter?: boolean; // default true — render H/L\n\tdropShadow?: boolean; // default true – apply outer circle shadow\n\t/** When true, apply a diagonal (top-left -> bottom-right) colour wash instead of solid white interior. */\n\tgradientWash?: boolean;\n}\n\nexport interface SPCVariationIconProps extends SpcIconBaseProps {\n\tdata: SpcVariationInput;\n\t/** Optional: pass a precomputed SPC summary (rows/visuals) and we will derive the last-row icon automatically. */\n\tprecomputed?: SpcPrecomputedSummary;\n\t/** If using `precomputed`, provide the metric improvement direction to orient letters consistently. */\n\timprovementDirection?: ImprovementDirection;\n}\n\nexport interface SpcAssuranceIconProps extends SpcIconBaseProps {\n\tdata: SpcAssurancePayload;\n}\n\nexport interface SpcIconsProps {\n\tvariation: SPCVariationIconProps[\"data\"];\n\tassurance: SpcAssuranceIconProps[\"data\"];\n\tsize?: number;\n\tariaLabel?: string; // combined label for the pair\n}\n\n// Derive an H/L direction from the SPC state for backward compatibility.\n// Improving states imply movement upwards; deteriorating states imply downwards.\n// For states without an inherent judgement (common cause or no judgement),\n// return null to allow callers to specify their own direction.\n\nexport interface SPCVariationIconPropsAlt extends SPCVariationIconProps {\n\tvariant?: SpcEmbeddedIconVariant;\n\trunLength?: number;\n\t/** How to derive H/L when shown (default: direction). */\n\tletterMode?: LetterMode;\n\t/** Explicit override for the letter (takes precedence). Use '' to suppress. */\n\tletterOverride?: SpcLetterGlyph;\n}\n// (imports consolidated above)\n\n// Shared defs (filter + gradient) helper to avoid repetition across variants\nconst buildDefs = (\n\tcolourHex: string,\n\tshadowId: string,\n\twashId: string,\n\tdropShadow: boolean,\n\tgradientWash: boolean,\n\tstops: Array<{ offset: string; opacity: string }>\n) => (\n\t<defs>\n\t\t{dropShadow && (\n\t\t\t<filter id={shadowId} filterUnits=\"objectBoundingBox\">\n\t\t\t\t<feGaussianBlur stdDeviation=\"3\" />\n\t\t\t\t<feOffset dx=\"0\" dy=\"15\" result=\"blur\" />\n\t\t\t\t<feFlood floodColor=\"rgb(150,150,150)\" floodOpacity=\"1\" />\n\t\t\t\t<feComposite in2=\"blur\" operator=\"in\" result=\"colorShadow\" />\n\t\t\t\t<feComposite in=\"SourceGraphic\" in2=\"colorShadow\" operator=\"over\" />\n\t\t\t</filter>\n\t\t)}\n\t\t{gradientWash && (\n\t\t\t<linearGradient id={washId} x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n\t\t\t\t{stops.map((s) => (\n\t\t\t\t\t<stop\n\t\t\t\t\t\tkey={s.offset}\n\t\t\t\t\t\toffset={s.offset}\n\t\t\t\t\t\tstopColor={colourHex}\n\t\t\t\t\t\tstopOpacity={parseFloat(s.opacity)}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t</linearGradient>\n\t\t)}\n\t</defs>\n);\n\nexport const SPCVariationIcon = ({\n\tdata,\n\tprecomputed,\n\timprovementDirection,\n\tsize = 44,\n\tariaLabel,\n\tshowLetter = true,\n\tdropShadow = true,\n\tgradientWash = false,\n\tvariant = SpcEmbeddedIconVariant.Classic,\n\trunLength = 0,\n\t// Default changed to 'polarity' so letters reflect desirable direction (H = Higher is better, L = Lower is better)\n\tletterMode = LetterMode.Polarity,\n\tletterOverride,\n\t...rest\n}: SPCVariationIconPropsAlt & Record<string, unknown>) => {\n\tconst shadowId = useId();\n\tconst washId = useId();\n\t// Gradient opacities (classic + triangle variants)\n\tconst {\n\t\tstart: gradStart,\n\t\tmid: gradMid,\n\t\tend: gradEnd,\n\t\ttriStart: triGradStart,\n\t\ttriMid: triGradMid,\n\t\ttriEnd: triGradEnd,\n\t} = getGradientOpacities();\n\n\t// Resolve semantic state + layout once\n\tconst { state, direction, polarity, ariaInput } = useMemo(() => {\n\t\tif (precomputed && precomputed.lastVariationIcon !== undefined) {\n\t\t\t// Build engine-aligned payload from last variation icon\n\t\t\tconst iconPayload: SpcVariationEngineIconPayload = {\n\t\t\t\tvariationIcon: (precomputed.lastVariationIcon as unknown) as SpcEngineVariationIcon,\n\t\t\t\timprovementDirection: improvementDirection ?? ImprovementDirection.Neither,\n\t\t\t\t// Infer neutral special-cause when VariationState was mapped as Neither from engine NeitherHigh/Low\n\t\t\t\tspecialCauseNeutral:\n\t\t\t\t\tprecomputed.latestState === VariationState.SpecialCauseNoJudgement,\n\t\t\t\t// Side hints not strictly needed for improvement/concern, only for neutral arrow orientation\n\t\t\t};\n\t\t\tconst { state, direction, polarity } = resolveStateAndLayout(iconPayload);\n\t\t\treturn { state, direction, polarity, ariaInput: iconPayload };\n\t\t}\n\t\tconst { state, direction, polarity } = resolveStateAndLayout(data as SpcVariationInput);\n\t\treturn { state, direction, polarity, ariaInput: data as SpcVariationInput };\n\t}, [data, precomputed, improvementDirection]);\n\tconst colour = useMemo(() => getVariationColour(state), [state]);\n\tconst judgement = useMemo(() => getVariationTrend(state), [state]);\n\tconst showLetterForJudgement =\n\t\tjudgement === VariationJudgement.Improving ||\n\t\tjudgement === VariationJudgement.Deteriorating;\n\tlet letter = \"\";\n\t\n\tif (showLetter && showLetterForJudgement) {\n\t\tif (letterMode === LetterMode.Polarity) {\n\t\t\tif (polarity === MetricPolarity.HigherIsBetter) letter = \"H\";\n\t\t\telse if (polarity === MetricPolarity.LowerIsBetter) letter = \"L\";\n\t\t\telse letter = \"\";\n\t\t} else {\n\t\t\tletter = direction === Direction.Higher ? \"H\" : \"L\";\n\t\t}\n\t}\n\t\n\tif (letterOverride !== undefined) letter = letterOverride;\n\tconst isSpecial = state !== VariationState.CommonCause;\n\tconst isNoJudgement = state === VariationState.SpecialCauseNoJudgement;\n\tconst neutralGrey = tokenColour(\"common-cause\", \"#A6A6A6\");\n\tconst pointColour = isSpecial ? colour.hex : neutralGrey;\n\tconst points: Point[] = useMemo(\n\t\t() => computePointPositions(state, direction),\n\t\t[state, direction]\n\t);\n\tconst aria =\n\t\tariaLabel ||\n\t\t`${colour.label}${\n\t\t\tletter ? (direction === Direction.Higher ? \" – Higher\" : \" – Lower\") : \"\"\n\t\t}`;\n\tconst ariaDescription = deriveVariationAriaDescription(ariaInput as SpcVariationInput);\n\n\t// --- Triangle with run rendering (new) ---\n\tif (variant === SpcEmbeddedIconVariant.TriangleWithRun) {\n\t\t// Short triangle with run indicator (five small circles)\n\t\tconst triSize = 100;\n\t\tconst centerX = 150;\n\t\tconst centerY = 140;\n\t\tconst upTriangle = [\n\t\t\t[centerX, centerY - triSize / 2],\n\t\t\t[centerX - triSize / 2, centerY + triSize / 2],\n\t\t\t[centerX + triSize / 2, centerY + triSize / 2],\n\t\t];\n\t\tconst downTriangle = [\n\t\t\t[centerX, centerY + triSize / 2],\n\t\t\t[centerX - triSize / 2, centerY - triSize / 2],\n\t\t\t[centerX + triSize / 2, centerY - triSize / 2],\n\t\t];\n\t\t// flatLine intentionally omitted — rendered as a short line when needed directly in JSX\n\t\tlet shape: React.ReactNode = null;\n\t\t// Orientation now driven by inferred direction (not raw improving/deteriorating state) so\n\t\t// \"improving\" with LowerIsBetter shows a downward triangle and \"deteriorating\" with LowerIsBetter shows upward.\n\t\tif (\n\t\t\tstate === VariationState.SpecialCauseImproving ||\n\t\t\tstate === VariationState.SpecialCauseDeteriorating\n\t\t) {\n\t\t\tshape = (\n\t\t\t\t<polygon\n\t\t\t\t\tpoints={(direction === Direction.Higher ? upTriangle : downTriangle)\n\t\t\t\t\t\t.map((p) => p.join(\",\"))\n\t\t\t\t\t\t.join(\" \")}\n\t\t\t\t\tfill={colour.hex}\n\t\t\t\t\tstroke={colour.hex}\n\t\t\t\t\tstrokeWidth={6}\n\t\t\t\t\ttransform={\n\t\t\t\t\t\tdirection === Direction.Higher\n\t\t\t\t\t\t\t? \"translate(0, -8)\"\n\t\t\t\t\t\t\t: \"translate(0, 15)\"\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t);\n\t\t} else if (state === VariationState.SpecialCauseNoJudgement) {\n\t\t\tshape = (\n\t\t\t\t<polygon\n\t\t\t\t\tpoints={\n\t\t\t\t\t\tdirection === Direction.Higher\n\t\t\t\t\t\t\t? upTriangle.map((p) => p.join(\",\")).join(\" \")\n\t\t\t\t\t\t\t: downTriangle.map((p) => p.join(\",\")).join(\" \")\n\t\t\t\t\t}\n\t\t\t\t\tfill={colour.hex}\n\t\t\t\t\tstroke={colour.hex}\n\t\t\t\t\tstrokeWidth={6}\n\t\t\t\t\ttransform={\n\t\t\t\t\t\tdirection === Direction.Higher\n\t\t\t\t\t\t\t? \"translate(0,-7)\"\n\t\t\t\t\t\t\t: \"translate(0,14)\"\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t\t// Run circles\n\t\tconst runLen = Math.max(0, Math.min(5, Math.floor(runLength || 0)));\n\t\tconst runY = state === VariationState.CommonCause ? 160 : direction === Direction.Higher ? 220 : 70;\n\t\tconst runRadius = 10;\n\t\tconst runGap = 26;\n\t\tconst runStartX = centerX - 2 * runGap;\n\t\tconst runColor = state === VariationState.CommonCause ? neutralGrey : colourForState(state);\n\t\tconst runCircles = Array.from({ length: 5 }).map((_, i) => {\n\t\tconst filled = (state === VariationState.SpecialCauseImproving ||\n\t\t\t\tstate === VariationState.SpecialCauseDeteriorating) &&\n\t\t\t\ti >= 5 - runLen;\n\t\t\tconst fill = filled ? runColor : neutralGrey;\n\t\t\treturn (\n\t\t\t\t<circle\n\t\t\t\t\tkey={i}\n\t\t\t\t\tcx={runStartX + i * runGap}\n\t\t\t\t\tcy={runY}\n\t\t\t\t\tr={runRadius}\n\t\t\t\t\tfill={fill}\n\t\t\t\t\tstroke={fill}\n\t\t\t\t\tstrokeWidth={1}\n\t\t\t\t/>\n\t\t\t);\n\t\t});\n\t\tconst defs = buildDefs(\n\t\t\tcolour.hex,\n\t\t\tshadowId,\n\t\t\twashId,\n\t\t\tdropShadow,\n\t\t\tgradientWash,\n\t\t\t[\n\t\t\t\t{ offset: \"0%\", opacity: triGradStart },\n\t\t\t\t{ offset: \"75%\", opacity: triGradMid },\n\t\t\t\t{ offset: \"100%\", opacity: triGradEnd },\n\t\t\t]\n\t\t);\n\t\t// Keep common cause visually consistent regardless of supplied direction by fixing transform.\n\t\tconst groupTransform =\n\t\t\tstate === VariationState.CommonCause\n\t\t\t? \"translate(0,-10)\" // mimic the higher layout centring\n\t\t\t: direction === Direction.Higher\n\t\t\t? \"translate(0,-10)\"\n\t\t\t: \"translate(0,25)\";\n\t\treturn (\n\t\t\t<svg\n\t\t\t\twidth={size}\n\t\t\t\theight={size}\n\t\t\t\tviewBox=\"0 0 300 300\"\n\t\t\t\trole=\"img\"\n\t\t\t\taria-label={aria}\n\t\t\t\taria-description={ariaDescription}\n\t\t\t\t{...rest}\n\t\t\t>\n\t\t\t\t{defs}\n\t\t\t\t<circle\n\t\t\t\t\tstroke=\"none\"\n\t\t\t\t\tfill={gradientWash ? `url(#${washId})` : \"#ffffff\"}\n\t\t\t\t\t{...(dropShadow ? { filter: `url(#${shadowId})` } : {})}\n\t\t\t\t\tcx=\"150\"\n\t\t\t\t\tcy=\"150\"\n\t\t\t\t\tr=\"120\"\n\t\t\t\t/>\n\t\t\t\t<circle\n\t\t\t\t\tstroke={colour.hex}\n\t\t\t\t\tstrokeWidth={15}\n\t\t\t\t\tstrokeMiterlimit={10}\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tcx=\"150\"\n\t\t\t\t\tcy=\"150\"\n\t\t\t\t\tr=\"120\"\n\t\t\t\t/>\n\t\t\t\t<g transform={groupTransform}>\n\t\t\t\t\t{shape}\n\t\t\t\t\t{letter && (\n\t\t\t\t\t\t<text\n\t\t\t\t\t\t\tfill=\"#fff\"\n\t\t\t\t\t\t\tfontFamily=\"'Frutiger W01', Frutiger, Arial, 'Helvetica Neue', Helvetica, sans-serif\"\n\t\t\t\t\t\t\tfontWeight=\"bold\"\n\t\t\t\t\t\t\tfontSize={64}\n\t\t\t\t\t\t\tx=\"150\"\n\t\t\t\t\t\t\ty={direction === Direction.Higher ? 155 : 145}\n\t\t\t\t\t\t\ttextAnchor=\"middle\"\n\t\t\t\t\t\t\tdominantBaseline=\"middle\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{letter}\n\t\t\t\t\t\t</text>\n\t\t\t\t\t)}\n\t\t\t\t\t{runCircles}\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t);\n\t}\n\n\t// --- Alternative triangle rendering ---\n\tif (variant === SpcEmbeddedIconVariant.Triangle) {\n\t\t// Triangle geometry\n\t\t// Upward triangle: base at bottom, tip at top\n\t\t// Downward triangle: base at top, tip at bottom\n\t\t// Centered at (150,150), size ~120px\n\t\tconst triSize = 150;\n\t\tconst centerX = 150;\n\t\tconst centerY = 150;\n\t\tconst upTriangle = [\n\t\t\t[centerX, centerY - triSize / 2],\n\t\t\t[centerX - triSize / 2, centerY + triSize / 2],\n\t\t\t[centerX + triSize / 2, centerY + triSize / 2],\n\t\t];\n\t\tconst downTriangle = [\n\t\t\t[centerX, centerY + triSize / 2],\n\t\t\t[centerX - triSize / 2, centerY - triSize / 2],\n\t\t\t[centerX + triSize / 2, centerY - triSize / 2],\n\t\t];\n\t\t// Flat line for neither\n\t\tconst flatLine = [\n\t\t\t[centerX - triSize / 2, centerY + triSize / 2],\n\t\t\t[centerX + triSize / 2, centerY + triSize / 2],\n\t\t];\n\t\tlet shape: React.ReactNode = null;\n\t\t// Orientation now driven by direction (not state) for the same semantic reason as triangleWithRun.\n\t\tif (\n\t\t\tstate === VariationState.SpecialCauseImproving ||\n\t\t\tstate === VariationState.SpecialCauseDeteriorating\n\t\t) {\n\t\t\tshape = (\n\t\t\t\t<polygon\n\t\t\t\t\tpoints={(direction === Direction.Higher ? upTriangle : downTriangle)\n\t\t\t\t\t\t.map((p) => p.join(\",\"))\n\t\t\t\t\t\t.join(\" \")}\n\t\t\t\t\tfill={colour.hex}\n\t\t\t\t\tstroke={colour.hex}\n\t\t\t\t\tstrokeWidth={8}\n\t\t\t\t\ttransform={\n\t\t\t\t\t\tdirection === Direction.Higher\n\t\t\t\t\t\t\t? \"translate(0, -10)\"\n\t\t\t\t\t\t\t: \"translate(0, 10)\"\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t);\n\t\t} else if (state === VariationState.SpecialCauseNoJudgement) {\n\t\t\t// Up or down triangle, no letter\n\t\t\tshape = (\n\t\t\t\t<polygon\n\t\t\t\t\tpoints={\n\t\t\t\t\t\tdirection === Direction.Higher\n\t\t\t\t\t\t\t? upTriangle.map((p) => p.join(\",\")).join(\" \")\n\t\t\t\t\t\t\t: downTriangle.map((p) => p.join(\",\")).join(\" \")\n\t\t\t\t\t}\n\t\t\t\t\tfill={colour.hex}\n\t\t\t\t\tstroke={colour.hex}\n\t\t\t\t\tstrokeWidth={8}\n\t\t\t\t\ttransform={\n\t\t\t\t\t\tdirection === Direction.Higher\n\t\t\t\t\t\t\t? \"translate(0, -15)\"\n\t\t\t\t\t\t\t: \"translate(0, 15)\"\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t);\n\t\t} else if (state === VariationState.CommonCause) {\n\t\t\t// Flat line\n\t\t\tshape = (\n\t\t\t\t<line\n\t\t\t\t\tx1={flatLine[0][0]}\n\t\t\t\t\ty1={flatLine[0][1]}\n\t\t\t\t\tx2={flatLine[1][0]}\n\t\t\t\t\ty2={flatLine[1][1]}\n\t\t\t\t\tstroke={colour.hex}\n\t\t\t\t\tstrokeWidth={32}\n\t\t\t\t\tstrokeLinecap=\"square\"\n\t\t\t\t\ttransform=\"translate(0, -75)\"\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t\tconst defs = buildDefs(\n\t\t\tcolour.hex,\n\t\t\tshadowId,\n\t\t\twashId,\n\t\t\tdropShadow,\n\t\t\tgradientWash,\n\t\t\t[\n\t\t\t\t{ offset: \"0%\", opacity: triGradStart },\n\t\t\t\t{ offset: \"65%\", opacity: triGradMid },\n\t\t\t\t{ offset: \"100%\", opacity: triGradEnd },\n\t\t\t]\n\t\t);\n\t\treturn (\n\t\t\t<svg\n\t\t\t\twidth={size}\n\t\t\t\theight={size}\n\t\t\t\tviewBox=\"0 0 300 300\"\n\t\t\t\trole=\"img\"\n\t\t\t\taria-label={aria}\n\t\t\t\taria-description={ariaDescription}\n\t\t\t\t{...rest}\n\t\t\t>\n\t\t\t\t{defs}\n\t\t\t\t<circle\n\t\t\t\t\tstroke=\"none\"\n\t\t\t\t\tfill={gradientWash ? `url(#${washId})` : \"#ffffff\"}\n\t\t\t\t\t{...(dropShadow ? { filter: `url(#${shadowId})` } : {})}\n\t\t\t\t\tcx=\"150\"\n\t\t\t\t\tcy=\"150\"\n\t\t\t\t\tr=\"120\"\n\t\t\t\t/>\n\t\t\t\t<circle\n\t\t\t\t\tstroke={colour.hex}\n\t\t\t\t\tstrokeWidth={15}\n\t\t\t\t\tstrokeMiterlimit={10}\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tcx=\"150\"\n\t\t\t\t\tcy=\"150\"\n\t\t\t\t\tr=\"120\"\n\t\t\t\t/>\n\t\t\t\t{shape}\n\t\t\t\t{letter &&\n\t\t\t\t\t(state === VariationState.SpecialCauseImproving ||\n\t\t\t\t\t\tstate === VariationState.SpecialCauseDeteriorating) && (\n\t\t\t\t\t\t<text\n\t\t\t\t\t\t\tfill=\"#fff\"\n\t\t\t\t\t\t\tfontFamily=\"'Frutiger W01', Frutiger, Arial, 'Helvetica Neue', Helvetica, sans-serif\"\n\t\t\t\t\t\t\tfontWeight=\"bold\"\n\t\t\t\t\t\t\tfontSize={100}\n\t\t\t\t\t\t\tx=\"150\"\n\t\t\t\t\t\t\ty={direction === Direction.Higher ? \"170\" : \"140\"}\n\t\t\t\t\t\t\ttextAnchor=\"middle\"\n\t\t\t\t\t\t\tdominantBaseline=\"middle\"\n\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{letter}\n\t\t\t\t\t\t</text>\n\t\t\t\t\t)}\n\t\t\t</svg>\n\t\t);\n\t}\n\n\t// --- Default/classic rendering ---\n\tconst defs = buildDefs(\n\t\tcolour.hex,\n\t\tshadowId,\n\t\twashId,\n\t\tdropShadow,\n\t\tgradientWash,\n\t\t[\n\t\t\t{ offset: \"0%\", opacity: gradStart },\n\t\t\t{ offset: \"65%\", opacity: gradMid },\n\t\t\t{ offset: \"100%\", opacity: gradEnd },\n\t\t]\n\t);\n\treturn (\n\t\t<svg\n\t\t\twidth={size}\n\t\t\theight={size}\n\t\t\tviewBox=\"0 0 300 300\"\n\t\t\trole=\"img\"\n\t\t\taria-label={aria}\n\t\t\taria-description={ariaDescription}\n\t\t\t{...rest}\n\t\t>\n\t\t\t{defs}\n\t\t\t<circle\n\t\t\t\tstroke=\"none\"\n\t\t\t\tfill={gradientWash ? `url(#${washId})` : \"#ffffff\"}\n\t\t\t\t{...(dropShadow ? { filter: `url(#${shadowId})` } : {})}\n\t\t\t\tcx=\"150\"\n\t\t\t\tcy=\"150\"\n\t\t\t\tr=\"120\"\n\t\t\t/>\n\t\t\t<circle\n\t\t\t\tstroke={colour.hex}\n\t\t\t\tstrokeWidth={15}\n\t\t\t\tstrokeMiterlimit={10}\n\t\t\t\tfill=\"none\"\n\t\t\t\tcx=\"150\"\n\t\t\t\tcy=\"150\"\n\t\t\t\tr=\"120\"\n\t\t\t/>\n\t\t\t{letter && (\n\t\t\t\t<text\n\t\t\t\t\tfill={colour.hex}\n\t\t\t\t\tfontFamily=\"Arial-BoldMT, Arial, 'Helvetica Neue', Helvetica, sans-serif\"\n\t\t\t\t\tfontWeight=\"bold\"\n\t\t\t\t\tfontSize={176}\n\t\t\t\t\ttransform=\"translate(86.67, 54) scale(0.5, 0.5)\"\n\t\t\t\t\ttextAnchor=\"end\"\n\t\t\t\t>\n\t\t\t\t\t<tspan x=\"120\" y={direction === Direction.Lower ? \"340\" : \"155\"}>\n\t\t\t\t\t\t{letter}\n\t\t\t\t\t</tspan>\n\t\t\t\t</text>\n\t\t\t)}\n\t\t\t{/* Special Cause (No Judgement) arrow glyph: vertical arrow indicating orientation.\n\t\t\t\tUp (layout Higher) shows arrow pointing up; Down (layout Lower) rotates 90°. */}\n\t\t\t{isNoJudgement ? (\n\t\t\t\t<path\n\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\t\tstroke=\"none\"\n\t\t\t\t\tfill={colour.hex}\n\t\t\t\t\t{...(direction === Direction.Lower\n\t\t\t\t\t\t? { transform: \"rotate(90 150 150)\" }\n\t\t\t\t\t\t: { transform: \"translate(-5 0) rotate(0 150 150)\" })}\n\t\t\t\t\td=\"M 90.26,185.42 L 149.31,126.37 127.44,104.51 209.81,90.66 195.96,173.02 174.09,151.16 115.05,210.2 90.26,185.42 Z M 90.26,185.42\"\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<>\n\t\t\t\t\t{/* Trend path connecting the five point centres */}\n\t\t\t\t\t{points.length === 5 && (\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke={neutralGrey}\n\t\t\t\t\t\t\tstrokeWidth={12}\n\t\t\t\t\t\t\tstrokeLinecap=\"round\"\n\t\t\t\t\t\t\tstrokeLinejoin=\"round\"\n\t\t\t\t\t\t\topacity={0.9}\n\t\t\t\t\t\t\td={`M ${points.map((p) => `${p.cx} ${p.cy}`).join(\" L \")}`}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t\t{/* Data points (last two coloured when judgement positive or negative) */}\n\t\t\t\t\t{points.map((p: Point, i: number) => {\n\t\t\t\t\t\tconst specialIdx = i >= points.length - 2 && isSpecial; // last two\n\t\t\t\t\t\tconst fill = specialIdx ? pointColour : neutralGrey;\n\t\t\t\t\t\tconst stroke = fill;\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\t\tstroke={stroke}\n\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\tstrokeMiterlimit={10}\n\t\t\t\t\t\t\t\tfill={fill}\n\t\t\t\t\t\t\t\tcx={p.cx}\n\t\t\t\t\t\t\t\tcy={p.cy}\n\t\t\t\t\t\t\t\tr={16}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\t\t\t\t</>\n\t\t\t)}\n\t\t</svg>\n\t);\n};\n\nSPCVariationIcon.displayName = \"SPCVariationIcon\";\n","import { useId } from \"react\";\nimport { getGradientOpacities } from './tokenUtils';\nimport {\n\tAssuranceResult,\n\tDEFAULT_COLOURS,\n\tDEFAULT_LETTERS,\n} from \"./SPCConstants\";\n\nexport interface AssuranceIconProps {\n\tstatus: AssuranceResult;\n\tsize?: number; // px\n\tariaLabel?: string; // override accessible label\n\tdropShadow?: boolean;\n\t/** When true apply a diagonal colour wash instead of solid white interior */\n\tgradientWash?: boolean;\n\tcolourOverride?: string; // optional single colour override for ring, letter & accent path\n\tletterOverride?: string; // optional override for displayed letter\n\tshowTrendLines?: boolean; // allow hiding decorative lines if needed\n\t\"data-testid\"?: string;\n}\n\nexport const SPCAssuranceIcon = ({\n\tstatus,\n\tsize = 44,\n\tariaLabel,\n\tdropShadow = true,\n\tcolourOverride,\n\tgradientWash = false,\n\tletterOverride,\n\tshowTrendLines = true,\n\t...rest\n}: AssuranceIconProps & Record<string, unknown>) => {\n\tconst shadowId = useId();\n\tconst washId = useId();\n\t// Gradient stop opacity tokens via shared util\n\tconst { start: gradStart, mid: gradMid, end: gradEnd } = getGradientOpacities();\n\tconst colour = colourOverride || DEFAULT_COLOURS[status];\n\tconst letter = (letterOverride || DEFAULT_LETTERS[status]).slice(0, 2); // safety – limit length\n\tconst aria = ariaLabel || `Assurance ${status}`;\n\n\treturn (\n\t\t<svg\n\t\t\twidth={size}\n\t\t\theight={size}\n\t\t\tviewBox=\"0 0 300 300\"\n\t\t\trole=\"img\"\n\t\t\taria-label={aria}\n\t\t\t{...rest}\n\t\t>\n\t\t\t<defs>\n\t\t\t\t{dropShadow && (\n\t\t\t\t\t<filter id={shadowId} filterUnits=\"objectBoundingBox\">\n\t\t\t\t\t\t<feGaussianBlur stdDeviation=\"3\" />\n\t\t\t\t\t\t<feOffset dx=\"-1\" dy=\"15\" result=\"blur\" />\n\t\t\t\t\t\t<feFlood floodColor=\"rgb(166,166,166)\" floodOpacity=\"1\" />\n\t\t\t\t\t\t<feComposite in2=\"blur\" operator=\"in\" result=\"colorShadow\" />\n\t\t\t\t\t\t<feComposite in=\"SourceGraphic\" in2=\"colorShadow\" operator=\"over\" />\n\t\t\t\t\t</filter>\n\t\t\t\t)}\n\t\t\t\t{gradientWash && (\n\t\t\t\t\t<linearGradient id={washId} x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n\t\t\t\t\t\t<stop offset=\"0%\" stopColor={colour} stopOpacity={parseFloat(gradStart)} />\n\t\t\t\t\t\t<stop offset=\"65%\" stopColor={colour} stopOpacity={parseFloat(gradMid)} />\n\t\t\t\t\t\t<stop offset=\"100%\" stopColor=\"#ffffff\" stopOpacity={parseFloat(gradEnd)} />\n\t\t\t\t\t</linearGradient>\n\t\t\t\t)}\n\t\t\t</defs>\n\t\t\t<circle\n\t\t\t\tstroke=\"none\"\n\t\t\t\tfill={gradientWash ? `url(#${washId})` : '#ffffff'}\n\t\t\t\t{...(dropShadow ? { filter: `url(#${shadowId})` } : {})}\n\t\t\t\tcx=\"150\"\n\t\t\t\tcy=\"150\"\n\t\t\t\tr=\"120\"\n\t\t\t/>\n\t\t\t{/* Letter */}\n\t\t\t<text\n\t\t\t\tfill={colour}\n\t\t\t\tfontFamily=\"Arial-BoldMT, Arial, 'Helvetica Neue', Helvetica, sans-serif\"\n\t\t\t\tfontWeight=\"bold\"\n\t\t\t\tfontSize={176}\n\t\t\t\tx={0}\n\t\t\t\ty={0}\n\t\t\t\ttransform=\"translate(121.01, 32) scale(0.5, 0.5)\"\n\t\t\t\ttextAnchor=\"middle\"\n\t\t\t>\n\t\t\t\t<tspan x={60} y={184}>\n\t\t\t\t\t{letter}\n\t\t\t\t</tspan>\n\t\t\t</text>\n\t\t\t{showTrendLines && (\n\t\t\t\t<>\n\t\t\t\t\t{/* Coloured baseline / target line (changes geometry if Fail) */}\n\t\t\t\t\t{status === AssuranceResult.Fail ? (\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tid=\"fail-line\"\n\t\t\t\t\t\t\tstroke={colour}\n\t\t\t\t\t\t\tstrokeWidth={9.5}\n\t\t\t\t\t\t\tstrokeMiterlimit={9.5}\n\t\t\t\t\t\t\tstrokeDasharray=\"35,10\"\n\t\t\t\t\t\t\tstrokeDashoffset={0}\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\td=\"M 33,143 L 268,143\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : status === AssuranceResult.Uncertain ? (\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tid=\"uncertain-line\"\n\t\t\t\t\t\t\tstroke=\"rgb(166, 166, 166)\"\n\t\t\t\t\t\t\tstrokeWidth={9.5}\n\t\t\t\t\t\t\tstrokeMiterlimit={9.5}\n\t\t\t\t\t\t\tstrokeDasharray=\"16.5,10\"\n\t\t\t\t\t\t\tstrokeDashoffset={0}\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\td=\"M 36,174 L 266,174\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tid=\"pass-line\"\n\t\t\t\t\t\t\tstroke={colour}\n\t\t\t\t\t\t\tstrokeWidth={9.5}\n\t\t\t\t\t\t\tstrokeMiterlimit={9.5}\n\t\t\t\t\t\t\tstrokeDasharray=\"35,10\"\n\t\t\t\t\t\t\tstrokeDashoffset={0}\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\td=\"M 48,204 L 254,204\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t\t{/* Grey underlying squiggle / sparkline bezier */}\n\t\t\t\t\t<path\n\t\t\t\t\t\tid=\"data-sparkline\"\n\t\t\t\t\t\tstroke=\"rgb(166, 166, 166)\"\n\t\t\t\t\t\tstrokeWidth={12}\n\t\t\t\t\t\tstrokeMiterlimit={12}\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\td=\"M 59.9,187.91 C 72.79,171.72 87.33,158.06 104.4,157.83 121.91,158.58 140.94,187.85 153.4,189.91 164.1,192.12 163.78,171.38 169.17,170.53 172.87,169.55 174.88,187.45 184.94,189.24 197,191.86 230.54,184.47 239.01,185.9\"\n\t\t\t\t\t/>\n\t\t\t\t\t<circle\n\t\t\t\t\t\tstroke={colour}\n\t\t\t\t\t\tstrokeWidth={15}\n\t\t\t\t\t\tstrokeMiterlimit={10}\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tcx=\"150\"\n\t\t\t\t\t\tcy=\"150\"\n\t\t\t\t\t\tr=\"120\"\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</svg>\n\t);\n};\n\nSPCAssuranceIcon.displayName = \"SPCAssuranceIcon\";\n"],"names":["ChartType","ImprovementDirection","VariationIcon","RULE_PRECEDENCE","acc","id","i","RULE_LABEL","RULE_CATEGORY","RULE_METADATA","index","SpcRawRuleTag","AssuranceIcon","BaselineSuggestionReason","ruleGlossary","extractRuleIds","row","ids","variationLabel","icon","assuranceLabel","zoneLabel","mean","sigma","value","z","VARIATION_COLOR_TOKENS","getVariationColorToken","getVariationColorHex","AssuranceResult","DEFAULT_COLOURS","DEFAULT_LETTERS","MetricPolarity","Direction","VariationJudgement","VariationState","pickTextColour","hex","c","r","g","b","srgb","v","VARIATION_COLOURS","def","getVariationColour","state","getVariationTrend","POINT_LAYOUTS","computePointPositions","direction","src","p","spcTokenRoot","tokenColour","key","fallback","parts","current","val","getGradientOpacities","SPC_TOKEN_KEYS","SPC_FALLBACK_HEX","colourImprovement","colourConcern","colourNoJudgement","colourCommon","colourForState","SpcGradientCategory","SpcEmbeddedIconVariant","LetterMode","resolveStateAndLayout","input","emitDeprecation","eng","polarity","rawIcon","UiVariationIcon","SpcEngineVariationIcon","v1","v2","deriveVariationAriaDescription","context","judgement","sideWord","trendWord","polarityClause","buildDefs","colourHex","shadowId","washId","dropShadow","gradientWash","stops","React","s","SPCVariationIcon","data","precomputed","improvementDirection","size","ariaLabel","showLetter","variant","runLength","letterMode","letterOverride","rest","useId","gradStart","gradMid","gradEnd","triGradStart","triGradMid","triGradEnd","ariaInput","useMemo","iconPayload","colour","showLetterForJudgement","letter","isSpecial","isNoJudgement","neutralGrey","pointColour","points","aria","ariaDescription","upTriangle","downTriangle","shape","runLen","runY","runRadius","runGap","runStartX","runColor","runCircles","_","fill","defs","groupTransform","flatLine","stroke","SPCAssuranceIcon","status","colourOverride","showTrendLines"],"mappings":"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"}