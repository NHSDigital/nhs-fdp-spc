{"version":3,"file":"types-BjMeC7Zi.js","sources":["../../../src/components/DataVisualisation/charts/SPC/SPCChart/logic_v2/types.ts"],"sourcesContent":["// Strongly-typed enums and core types mirroring SQL v2.6a naming.\n// These names are chosen to be easy to cross-reference with the SQL script and docs.\n\n// Supported chart types — v2.6a parity focuses on XmR; T and G can be added as needed\nexport enum ChartType {\n\tXmR = \"XmR\",\n\tT = \"T\",\n\tG = \"G\",\n}\n\n// How a metric is judged: higher is better, lower is better, or neither (neutral)\nexport enum ImprovementDirection {\n\tUp = \"Up\",\n\tDown = \"Down\",\n\tNeither = \"Neither\",\n}\n\n// Variation icon classification used for testing parity against SQL.\n// SQL v2.6a emits icons only for the last point, but we retain a per-row value for convenience.\nexport enum VariationIcon {\n\tImprovementHigh = \"ImprovementHigh\", // improvement on the high side (metric Up)\n\tImprovementLow = \"ImprovementLow\", // improvement on the low side (metric Down)\n\tConcernHigh = \"ConcernHigh\", // concern on the high side (metric Down)\n\tConcernLow = \"ConcernLow\", // concern on the low side (metric Up)\n\tNeitherHigh = \"NeitherHigh\", // neutral with a high-side special cause for Neither metrics\n\tNeitherLow = \"NeitherLow\", // neutral with a low-side special cause for Neither metrics\n\tCommonCause = \"CommonCause\", // no special cause detected contributing to icon\n}\n\n// Assurance outcome relative to target and process limits (XmR only in this module)\nexport enum AssuranceIcon {\n\tNone = \"None\",\n\tPass = \"Pass\",\n\tHitOrMiss = \"HitOrMiss\",\n\tFail = \"Fail\",\n}\n\n// Identifiers for rule types used in ranking and diagnostics\nexport enum SpcRuleId {\n\tSinglePoint = \"SinglePoint\",\n\tTwoSigma = \"TwoSigma\",\n\tShift = \"Shift\",\n\tTrend = \"Trend\",\n}\n\n// Direction determined by comparing the strongest rule rank on each side\nexport enum PrimeDirection {\n\tUpwards = \"Upwards\",\n\tDownwards = \"Downwards\",\n\tSame = \"Same\",\n}\n\n// Convenience to describe which side of the mean a signal sits on\nexport enum Side {\n\tUp = \"Up\",\n\tDown = \"Down\",\n}\n\n// Policy to apply when PrimeDirection is Same and both candidates exist\nexport enum MetricConflictRule {\n\tImprovement = \"Improvement\",\n\tConcern = \"Concern\",\n}\n\n// Strategy for resolving conflicts when both improvement and concern candidates exist\nexport enum ConflictStrategy {\n\t// Maintain SQL v2.6a parity: use PrimeDirection first, then MetricConflictRule only when PrimeDirection is Same\n\tSqlPrimeThenRule = \"SqlPrimeThenRule\",\n\t// Excel-style: always prefer the improvement side when a conflict exists (ignores PrimeDirection)\n\tPreferImprovement = \"PreferImprovement\",\n\t// Custom rule hierarchy: choose the side that contains the highest-precedence rule from a provided order\n\tRuleHierarchy = \"RuleHierarchy\",\n}\n\n// Strategy to select which mean-side trend segment(s) participate after splitting a run at crossings - integral for special cause conflict resolution\nexport enum TrendSegmentationStrategy {\n\t// Highlight all favourable-side segments\n\tFavourableSide = \"FavourableSide\",\n\t// Highlight the first favourable-side segment that occurs after a crossing; if no crossing occurred,\n\t// fall back to the longest favourable-side segment (by length)\n\tCrossingAfterFavourable = \"CrossingAfterFavourable\",\n\t// Highlight the favourable-side segment with the greatest absolute distance from mean\n\tExtremeFavourable = \"ExtremeFavourable\",\n\t// Always pick the first favourable-side segment in the run (chronological)\n\tFirstFavourable = \"FirstFavourable\",\n\t// Pick the longest favourable-side segment by length (ties broken by earliest)\n\tLongestFavourable = \"LongestFavourable\",\n\t// Pick the last favourable-side segment in the run (chronological)\n\tLastFavourable = \"LastFavourable\",\n\t// Unfavourable variants — mirror the above but for the opposite mean side\n\tUnfavourableSide = \"UnfavourableSide\",\n\t// Highlight the first unfavourable-side segment that occurs after a crossing; if no crossing occurred, fall back to the longest unfavourable-side segment (by length)\n\tCrossingAfterUnfavourable = \"CrossingAfterUnfavourable\",\n\t// Highlight the unfavourable-side segment with the greatest absolute distance from mean\n\tExtremeUnfavourable = \"ExtremeUnfavourable\",\n\t// Always pick the first unfavourable-side segment in the run (chronological)\n\tFirstUnfavourable = \"FirstUnfavourable\",\n\t// Pick the longest unfavourable-side segment by length (ties broken by earliest)\n\tLongestUnfavourable = \"LongestUnfavourable\",\n\t// Pick the last unfavourable-side segment in the run (chronological)\n\tLastUnfavourable = \"LastUnfavourable\",\n}\n\n// Controls when favourable trend segmentation should apply\nexport enum TrendSegmentationMode {\n\t// Do not apply segmentation at all\n\tOff = \"Off\",\n\t// Apply segmentation automatically only when a conflict is detected in the series/partition\n\tAutoWhenConflict = \"AutoWhenConflict\",\n\t// Always apply segmentation regardless of conflicts (legacy boolean=true behaviour)\n\tAlways = \"Always\",\n}\n\n// The input row shape accepted by the engine\nexport interface SpcInputRowV2 {\n\tx: string | number | Date;\n\tvalue?: number | null;\n\tghost?: boolean;\n\tbaseline?: boolean;\n\ttarget?: number | null;\n}\n\n// Settings that influence rule thresholds and pruning behaviour\n// Flat v2.6a settings (back-compat). Consider using the hierarchical form below for more semantic grouping.\nexport interface SpcSettingsV26a {\n\tminimumPoints?: number; // global gating\n\tshiftPoints?: number; // default 6\n\ttrendPoints?: number; // default 6\n\texcludeMovingRangeOutliers?: boolean; // default false\n\tmetricConflictRule?: MetricConflictRule; // default Improvement (tie-break when PrimeDirection is Same)\n\t// Parity-specific controls\n\ttrendAcrossPartitions?: boolean; // default false (SQL v2.2+ enables; preset turns on)\n\ttwoSigmaIncludeAboveThree?: boolean; // default false (preset turns on)\n\t// Optional early warning rule (excluded from conflict ranking)\n\tenableFourOfFiveRule?: boolean; // default false\n\t// Conflict handling: when both improvement and concern candidates\n\t// exist for a point (typically due to trend crossing the mean), prefer keeping\n\t// the improvement side regardless of PrimeDirection. Default false to retain\n\t// SQL v2.6a parity (PrimeDirection first, then MetricConflictRule only on ties).\n\t// NOTE: When this flag is true, the engine disables favourable trend segmentation\n\t// (both per-partition and across partitions). As a consequence, segmentation-dependent\n\t// controls like `preferTrendWhenConflict` and `trendDominatesHighlightedWindow` will have\n\t// no effect for those rows because no highlighted trend window is established.\n\tpreferImprovementWhenConflict?: boolean;\n\t// Configurable conflict resolution strategy; default keeps SQL parity.\n\tconflictStrategy?: ConflictStrategy;\n\t// When true, if both improvement and concern candidates exist on a row and one of the trend flags\n\t// (trendUp/trendDown) is present after segmentation, prefer the trend side and prune the other.\n\t// This helps datasets where a trend segment should dominate over non-trend rules within its window.\n\tpreferTrendWhenConflict?: boolean;\n\t// When using ConflictStrategy.RuleHierarchy, precedence order for rules from highest to lowest\n\t// Default mirrors SQL ranking: Trend > Shift > TwoSigma > SinglePoint\n\truleHierarchy?: SpcRuleId[];\n\t// When true, once the chart has at least `minimumPoints` non-ghosted values overall,\n\t// compute limits and evaluate rules across entire partitions (retrospective colouring of early rows).\n\t// When false (default), eligibility is per-point (prospective) using pointRank.\n\tchartLevelEligibility?: boolean;\n\t// When true (default), after trend flags are backfilled, split runs at mean crossings and\n\t// keep only favourable-side segments for contribution to classification, using a strategy.\n\t// This resolves Special-cause conflicts when a run crosses the mean by recoding the pre-crossing\n\t// segment to not participate in variation classification.\n\t// Deprecated: prefer trendSegmentationMode. If provided, `true` maps to `Always`, `false` maps to `Off`.\n\ttrendFavourableSegmentation?: boolean;\n\t// When and how to apply favourable trend segmentation. Default behaviour is `AutoWhenConflict` to\n\t// minimise impact on datasets without conflicts while resolving cross-mean trend conflicts when present.\n\ttrendSegmentationMode?: TrendSegmentationMode;\n\t// When true, within highlighted trend segments (post-segmentation), drop opposite-side non-trend\n\t// rule flags (singlePoint/twoSigma/shift) so the highlighted trend segment dominates classification\n\t// in its window. Default false to preserve SQL parity. Works independently of preferTrendWhenConflict\n\t// by manipulating rule flags earlier in the pipeline. Has no effect when\n\t// `preferImprovementWhenConflict` is true (segmentation disabled by engine gating).\n\ttrendDominatesHighlightedWindow?: boolean;\n\t// Strategy for picking which favourable-side segment(s) to keep when a run crosses the mean.\n\t// Default: TrendSegmentationStrategy.CrossingAfterFavourable — first favourable segment after crossing, else longest favourable.\n\ttrendSegmentationStrategy?: TrendSegmentationStrategy;\n}\n\n// Hierarchical settings (semantic grouping). Shipped alongside a normaliser for back-compat.\nexport interface SpcSettingsHierarchical {\n\tthresholds?: {\n\t\t/** Minimum non-ghost points required to enable limits/rules (per partition by default). */\n\t\tminimumPoints?: number;\n\t\t/** Shift run length (default 6). */\n\t\tshiftPoints?: number;\n\t\t/** Trend run length (default 6). */\n\t\ttrendPoints?: number;\n\t\t/** Exclude MR outliers when estimating sigma (XmR). */\n\t\texcludeMovingRangeOutliers?: boolean;\n\t};\n\teligibility?: {\n\t\t/** If true, once chart has >= minimumPoints overall, evaluate across partitions retroactively. */\n\t\tchartLevel?: boolean;\n\t};\n\tparity?: {\n\t\t/** Enable strict trend detection across partitions (SQL v2.2+). */\n\t\ttrendAcrossPartitions?: boolean;\n\t\t/** Count >3σ points toward the two-of-three rule. */\n\t\ttwoSigmaIncludeAboveThree?: boolean;\n\t\t/** Enable optional early-warning rule: 4-of-5 beyond 1σ (excluded from ranking). */\n\t\tenableFourOfFiveRule?: boolean;\n\t};\n\tconflict?: {\n\t\t/** Optimistically keep Improvement when both sides exist (disables trend segmentation). */\n\t\tpreferImprovementWhenConflict?: boolean;\n\t\t/** Prefer the trend side when both sides exist and a trend flag is present after segmentation. */\n\t\tpreferTrendWhenConflict?: boolean;\n\t\t/** Strategy for conflict resolution (default SQL parity). */\n\t\tstrategy?: ConflictStrategy;\n\t\t/** Optional rule precedence order (used with strategy RuleHierarchy). */\n\t\truleHierarchy?: SpcRuleId[];\n\t\t/** Tie-break rule when PrimeDirection is Same. */\n\t\tmetricRuleOnTie?: MetricConflictRule;\n\t};\n\ttrend?: {\n\t\tsegmentation?: {\n\t\t\t/** When to apply favourable-side segmentation. Prefer this over the legacy boolean. */\n\t\t\tmode?: TrendSegmentationMode;\n\t\t\t/** Legacy alias (true -> Always, false -> Off). */\n\t\t\tfavourableSegmentation?: boolean;\n\t\t\t/** Strategy to pick which favourable segment(s) to keep. */\n\t\t\tstrategy?: TrendSegmentationStrategy;\n\t\t\t/** If true, trend dominates inside its highlighted window. */\n\t\t\tdominatesHighlightedWindow?: boolean;\n\t\t};\n\t};\n}\n\n// Settings input accepted by public APIs: flat (legacy) or hierarchical (preferred)\nexport type SpcSettingsInput = SpcSettingsV26a | SpcSettingsHierarchical;\n\n// The fully computed row emitted by the engine\nexport interface SpcRowV2 {\n\trowId: number;\n\tx: string | number | Date;\n\tvalue: number | null;\n\tghost: boolean;\n\tpartitionId: number;\n\tpointRank: number;\n\tmean: number | null;\n\tupperProcessLimit: number | null;\n\tlowerProcessLimit: number | null;\n\tupperTwoSigma: number | null;\n\tlowerTwoSigma: number | null;\n\tupperOneSigma: number | null;\n\tlowerOneSigma: number | null;\n\t// Rule flags (directional)\n\tsinglePointUp: boolean;\n\tsinglePointDown: boolean;\n\ttwoSigmaUp: boolean;\n\ttwoSigmaDown: boolean;\n\tfourOfFiveUp: boolean;\n\tfourOfFiveDown: boolean;\n\tshiftUp: boolean;\n\tshiftDown: boolean;\n\ttrendUp: boolean;\n\ttrendDown: boolean;\n\t// Candidate values (post-pruning optional)\n\tspecialCauseImprovementValue: number | null;\n\tspecialCauseConcernValue: number | null;\n\t// Summary (per-row for testing convenience)\n\tvariationIcon: VariationIcon;\n\t// Diagnostics\n\tprimeDirection?: PrimeDirection;\n\tprimeRank?: number;\n\tprimeRuleId?: SpcRuleId;\n}\n\n// The arguments to build an SPC result\nexport interface BuildArgsV2 {\n\tchartType: ChartType;\n\tmetricImprovement: ImprovementDirection;\n\tdata: SpcInputRowV2[];\n\t/**\n\t * Settings may be provided in flat (v2.6a) or hierarchical form. The engine normalises these.\n\t */\n\tsettings?: SpcSettingsInput;\n}\n\n// The build result containing all rows (warnings kept separate for clarity in this module)\nexport interface SpcResultV2 {\n\trows: SpcRowV2[];\n}\n\n// ------------------------- Warning metadata (shared with chart UI) -------------------------\n// These mirror the legacy v1 enums but live alongside v2 so SPCChart can consume\n// them without depending on the v1 module.\nexport enum SpcWarningSeverity {\n\tInfo = \"info\",\n\tWarning = \"warning\",\n\tError = \"error\",\n}\n\nexport enum SpcWarningCategory {\n\tConfig = \"config\",\n\tData = \"data\",\n\tLimits = \"limits\",\n\tSpecialCause = \"special_cause\",\n\tBaseline = \"baseline\",\n\tLogic = \"logic\",\n\tTarget = \"target\",\n\tGhost = \"ghost\",\n\tPartition = \"partition\",\n}\n\n// Stable catalog of warning codes (public surface)\nexport enum SpcWarningCode {\n\tUnknownChartType = 'unknown_chart_type',\n\tInsufficientPointsGlobal = 'insufficient_points_global',\n\tVariationConflictRow = 'variation_conflict_row',\n\tNullValuesExcluded = 'null_values_excluded',\n\tTargetIgnoredRareEvent = 'target_ignored_rare_event',\n\tGhostRowsRareEvent = 'ghost_rows_rare_event',\n\tInsufficientPointsPartition = 'insufficient_points_partition',\n\tBaselineWithSpecialCause = 'baseline_with_special_cause',\n\tPartitionCapApplied = 'partition_cap_applied',\n\tGlobalCapApplied = 'global_cap_applied',\n}\n\nexport interface SpcWarning {\n\tcode: SpcWarningCode; // stable identifier\n\tmessage: string; // human-readable text\n\tseverity?: SpcWarningSeverity;\n\tcategory?: SpcWarningCategory;\n\tcontext?: Record<string, unknown>; // optional structured data (counts, ids, etc.)\n}\n"],"names":["ChartType","ImprovementDirection","VariationIcon","SpcRuleId","PrimeDirection","Side","MetricConflictRule","ConflictStrategy","TrendSegmentationStrategy","TrendSegmentationMode","SpcWarningSeverity","SpcWarningCategory","SpcWarningCode"],"mappings":"AAIO,IAAKA,sBAAAA,OACXA,EAAA,MAAM,OACNA,EAAA,IAAI,KACJA,EAAA,IAAI,KAHOA,IAAAA,KAAA,CAAA,CAAA,GAOAC,sBAAAA,OACXA,EAAA,KAAK,MACLA,EAAA,OAAO,QACPA,EAAA,UAAU,WAHCA,IAAAA,KAAA,CAAA,CAAA,GAQAC,sBAAAA,OACXA,EAAA,kBAAkB,mBAClBA,EAAA,iBAAiB,kBACjBA,EAAA,cAAc,eACdA,EAAA,aAAa,cACbA,EAAA,cAAc,eACdA,EAAA,aAAa,cACbA,EAAA,cAAc,eAPHA,IAAAA,KAAA,CAAA,CAAA,GAmBAC,sBAAAA,OACXA,EAAA,cAAc,eACdA,EAAA,WAAW,YACXA,EAAA,QAAQ,SACRA,EAAA,QAAQ,SAJGA,IAAAA,KAAA,CAAA,CAAA,GAQAC,sBAAAA,OACXA,EAAA,UAAU,WACVA,EAAA,YAAY,aACZA,EAAA,OAAO,QAHIA,IAAAA,KAAA,CAAA,CAAA,GAOAC,sBAAAA,OACXA,EAAA,KAAK,MACLA,EAAA,OAAO,QAFIA,IAAAA,KAAA,CAAA,CAAA,GAMAC,sBAAAA,OACXA,EAAA,cAAc,eACdA,EAAA,UAAU,WAFCA,IAAAA,KAAA,CAAA,CAAA,GAMAC,sBAAAA,OAEXA,EAAA,mBAAmB,oBAEnBA,EAAA,oBAAoB,qBAEpBA,EAAA,gBAAgB,iBANLA,IAAAA,KAAA,CAAA,CAAA,GAUAC,sBAAAA,OAEXA,EAAA,iBAAiB,kBAGjBA,EAAA,0BAA0B,2BAE1BA,EAAA,oBAAoB,qBAEpBA,EAAA,kBAAkB,mBAElBA,EAAA,oBAAoB,qBAEpBA,EAAA,iBAAiB,kBAEjBA,EAAA,mBAAmB,oBAEnBA,EAAA,4BAA4B,6BAE5BA,EAAA,sBAAsB,uBAEtBA,EAAA,oBAAoB,qBAEpBA,EAAA,sBAAsB,uBAEtBA,EAAA,mBAAmB,oBAzBRA,IAAAA,KAAA,CAAA,CAAA,GA6BAC,sBAAAA,OAEXA,EAAA,MAAM,OAENA,EAAA,mBAAmB,oBAEnBA,EAAA,SAAS,UANEA,IAAAA,KAAA,CAAA,CAAA,GAsLAC,sBAAAA,OACXA,EAAA,OAAO,QACPA,EAAA,UAAU,WACVA,EAAA,QAAQ,SAHGA,IAAAA,KAAA,CAAA,CAAA,GAMAC,sBAAAA,OACXA,EAAA,SAAS,UACTA,EAAA,OAAO,QACPA,EAAA,SAAS,UACTA,EAAA,eAAe,iBACfA,EAAA,WAAW,YACXA,EAAA,QAAQ,SACRA,EAAA,SAAS,UACTA,EAAA,QAAQ,SACRA,EAAA,YAAY,aATDA,IAAAA,KAAA,CAAA,CAAA,GAaAC,sBAAAA,OACXA,EAAA,mBAAmB,sBACnBA,EAAA,2BAA2B,8BAC3BA,EAAA,uBAAuB,0BACvBA,EAAA,qBAAqB,wBACrBA,EAAA,yBAAyB,6BACzBA,EAAA,qBAAqB,yBACrBA,EAAA,8BAA8B,iCAC9BA,EAAA,2BAA2B,+BAC3BA,EAAA,sBAAsB,yBACtBA,EAAA,mBAAmB,sBAVRA,IAAAA,KAAA,CAAA,CAAA;"}