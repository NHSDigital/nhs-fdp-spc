{"version":3,"file":"index.esm.js","sources":["../../../src/components/DataVisualisation/hooks/useChartDimensions.ts","../../../src/components/DataVisualisation/core/ChartRoot.tsx","../../../node_modules/d3-array/src/ascending.js","../../../node_modules/d3-array/src/descending.js","../../../node_modules/d3-array/src/bisector.js","../../../node_modules/d3-array/src/number.js","../../../node_modules/d3-array/src/bisect.js","../../../node_modules/d3-array/src/extent.js","../../../node_modules/d3-array/src/ticks.js","../../../node_modules/d3-scale/src/init.js","../../../node_modules/d3-color/src/define.js","../../../node_modules/d3-color/src/color.js","../../../node_modules/d3-interpolate/src/constant.js","../../../node_modules/d3-interpolate/src/color.js","../../../node_modules/d3-interpolate/src/rgb.js","../../../node_modules/d3-interpolate/src/numberArray.js","../../../node_modules/d3-interpolate/src/array.js","../../../node_modules/d3-interpolate/src/date.js","../../../node_modules/d3-interpolate/src/number.js","../../../node_modules/d3-interpolate/src/object.js","../../../node_modules/d3-interpolate/src/string.js","../../../node_modules/d3-interpolate/src/value.js","../../../node_modules/d3-interpolate/src/round.js","../../../node_modules/d3-scale/src/constant.js","../../../node_modules/d3-scale/src/number.js","../../../node_modules/d3-scale/src/continuous.js","../../../node_modules/d3-format/src/formatDecimal.js","../../../node_modules/d3-format/src/exponent.js","../../../node_modules/d3-format/src/formatGroup.js","../../../node_modules/d3-format/src/formatNumerals.js","../../../node_modules/d3-format/src/formatSpecifier.js","../../../node_modules/d3-format/src/formatTrim.js","../../../node_modules/d3-format/src/formatPrefixAuto.js","../../../node_modules/d3-format/src/formatRounded.js","../../../node_modules/d3-format/src/formatTypes.js","../../../node_modules/d3-format/src/identity.js","../../../node_modules/d3-format/src/locale.js","../../../node_modules/d3-format/src/defaultLocale.js","../../../node_modules/d3-format/src/precisionFixed.js","../../../node_modules/d3-format/src/precisionPrefix.js","../../../node_modules/d3-format/src/precisionRound.js","../../../node_modules/d3-scale/src/tickFormat.js","../../../node_modules/d3-scale/src/linear.js","../../../node_modules/d3-scale/src/nice.js","../../../node_modules/d3-time/src/interval.js","../../../node_modules/d3-time/src/millisecond.js","../../../node_modules/d3-time/src/duration.js","../../../node_modules/d3-time/src/second.js","../../../node_modules/d3-time/src/minute.js","../../../node_modules/d3-time/src/hour.js","../../../node_modules/d3-time/src/day.js","../../../node_modules/d3-time/src/week.js","../../../node_modules/d3-time/src/month.js","../../../node_modules/d3-time/src/year.js","../../../node_modules/d3-time/src/ticks.js","../../../node_modules/d3-time-format/src/locale.js","../../../node_modules/d3-time-format/src/defaultLocale.js","../../../node_modules/d3-scale/src/time.js","../../../node_modules/d3-shape/src/constant.js","../../../node_modules/d3-path/src/path.js","../../../node_modules/d3-shape/src/path.js","../../../node_modules/d3-shape/src/array.js","../../../node_modules/d3-shape/src/curve/linear.js","../../../node_modules/d3-shape/src/point.js","../../../node_modules/d3-shape/src/line.js","../../../node_modules/d3-shape/src/area.js","../../../node_modules/d3-shape/src/curve/monotone.js","../../../src/components/DataVisualisation/utils/scales.ts","../../../src/components/DataVisualisation/core/ScaleContext.tsx","../../../node_modules/classnames/index.js","../../../src/mapping/heading.ts","../../../src/components/Heading/Heading.tsx","../../../src/components/Panel/Panel.tsx","../../../src/components/Tables/Table.tsx","../../../src/mapping/tag.ts","../../../src/components/Tag/Tag.tsx","../../../src/components/DataVisualisation/charts/SPC/SPCChart/components/DiagnosticsPanel.tsx","../../../src/components/DataVisualisation/charts/SPC/SPCChart/components/EmbeddedIconsRow.tsx","../../../src/components/DataVisualisation/charts/SPC/SPCChart/utils/embeddedIcon.tsx","../../../src/components/DataVisualisation/charts/Axis/Axis.tokens.ts","../../../src/components/DataVisualisation/charts/Axis/Axis.tsx","../../../src/components/DataVisualisation/charts/GridLines/GridLines.tsx","../../../src/components/DataVisualisation/utils/colors.ts","../../../src/components/DataVisualisation/core/VisibilityContext.tsx","../../../src/components/DataVisualisation/core/TooltipContext.tsx","../../../src/components/DataVisualisation/series/LineSeriesPrimitive.tsx","../../../src/components/DataVisualisation/charts/SPC/SPCChart/SPCTooltipOverlay.tsx","../../../src/components/DataVisualisation/primitives/VisuallyHiddenLiveRegion.tsx","../../../src/components/DataVisualisation/charts/SPC/SPCChart/SPCSignalsInspector.tsx","../../../src/components/DataVisualisation/charts/SPC/SPCChart/gradientSequences.ts","../../../src/components/DataVisualisation/charts/SPC/SPCChart/SPCChart.props.ts","../../../src/components/DataVisualisation/charts/SPC/SPCChart/InternalSPC.tsx","../../../src/components/DataVisualisation/charts/SPC/utils/autoMetrics.ts","../../../src/components/DataVisualisation/charts/SPC/SPCChart/logic_v2/adapter.ts","../../../src/components/DataVisualisation/charts/SPC/utils/constants.ts","../../../src/components/DataVisualisation/charts/SPC/utils/transform.ts","../../../src/components/DataVisualisation/charts/SPC/SPCChart/hooks/useZeroAxisBreak.ts","../../../src/components/DataVisualisation/charts/SPC/SPCChart/utils/domain.ts","../../../src/components/DataVisualisation/charts/SPC/SPCChart/logic_v2/utils/autoRecalc.ts","../../../src/components/DataVisualisation/charts/SPC/SPCChart/SPCChart.tsx","../../../src/components/DataVisualisation/charts/SPC/utils/state.ts","../../../src/components/DataVisualisation/charts/SPC/utils/precompute.ts"],"sourcesContent":["import * as React from 'react';\n\nexport interface ChartDimensions {\n  width: number;\n  height: number;\n  innerWidth: number;\n  innerHeight: number;\n  margin: { top: number; right: number; bottom: number; left: number };\n  ref: React.RefObject<HTMLDivElement | null>;\n}\n\nexport function useChartDimensions(initial: Partial<ChartDimensions['margin']> = {}): ChartDimensions {\n  const ref = React.useRef<HTMLDivElement>(null);\n  const margin = React.useMemo(() => ({\n    top: initial.top ?? 16,\n    right: initial.right ?? 16,\n    bottom: initial.bottom ?? 32,\n    left: initial.left ?? 48\n  }), [initial.bottom, initial.left, initial.right, initial.top]);\n\n  const [dims, setDims] = React.useState({ width: 0, height: 0 });\n\n  React.useLayoutEffect(() => {\n    if (!ref.current) return;    \n    const ro = new ResizeObserver(entries => {\n      for (const entry of entries) {\n        const { width, height } = entry.contentRect;\n        setDims({ width, height });\n      }\n    });\n    ro.observe(ref.current);\n    return () => ro.disconnect();\n  }, []);\n\n  const innerWidth = Math.max(0, dims.width - margin.left - margin.right);\n  const innerHeight = Math.max(0, dims.height - margin.top - margin.bottom);\n\n  return { width: dims.width, height: dims.height, innerWidth, innerHeight, margin, ref };\n}\n","import * as React from 'react';\nimport { useChartDimensions, type ChartDimensions } from '../hooks/useChartDimensions';\n\nexport interface ChartRootProps {\n  /** Explicit height (px). Width is responsive to parent unless set via style */\n  height?: number;\n  /** Override margins (top,right,bottom,left) */\n  margin?: Partial<ChartDimensions['margin']>;\n  /** Optional explicit width; otherwise flex/parent controlled */\n  width?: number | string;\n  className?: string;\n  children: React.ReactNode;\n  role?: string;\n  ariaLabel?: string;\n}\n\ninterface ChartContextValue extends ChartDimensions {}\n\nconst ChartContext = React.createContext<ChartContextValue | null>(null);\nexport function useChartContext(): ChartContextValue | null { return React.useContext(ChartContext); }\n\nexport const ChartRoot: React.FC<ChartRootProps> = ({\n  height = 240,\n  margin,\n  width,\n  className = 'fdp-chart', // align with SCSS token application (.fdp-chart)\n  children,\n  role = 'group',\n  ariaLabel\n}) => {\n  const dims = useChartDimensions(margin);\n  const style: React.CSSProperties = { height, position: 'relative' };\n  if (width !== undefined) style.width = typeof width === 'number' ? `${width}px` : width;\n\n  return (\n    <div ref={dims.ref as any} className={className} style={style} role={role} aria-label={ariaLabel}>\n      <ChartContext.Provider value={dims}>\n        {children}\n      </ChartContext.Provider>\n    </div>\n  );\n};\n\nexport default ChartRoot;\n","export default function ascending(a, b) {\n  return a == null || b == null ? NaN : a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;\n}\n","export default function descending(a, b) {\n  return a == null || b == null ? NaN\n    : b < a ? -1\n    : b > a ? 1\n    : b >= a ? 0\n    : NaN;\n}\n","import ascending from \"./ascending.js\";\nimport descending from \"./descending.js\";\n\nexport default function bisector(f) {\n  let compare1, compare2, delta;\n\n  // If an accessor is specified, promote it to a comparator. In this case we\n  // can test whether the search value is (self-) comparable. We can’t do this\n  // for a comparator (except for specific, known comparators) because we can’t\n  // tell if the comparator is symmetric, and an asymmetric comparator can’t be\n  // used to test whether a single value is comparable.\n  if (f.length !== 2) {\n    compare1 = ascending;\n    compare2 = (d, x) => ascending(f(d), x);\n    delta = (d, x) => f(d) - x;\n  } else {\n    compare1 = f === ascending || f === descending ? f : zero;\n    compare2 = f;\n    delta = f;\n  }\n\n  function left(a, x, lo = 0, hi = a.length) {\n    if (lo < hi) {\n      if (compare1(x, x) !== 0) return hi;\n      do {\n        const mid = (lo + hi) >>> 1;\n        if (compare2(a[mid], x) < 0) lo = mid + 1;\n        else hi = mid;\n      } while (lo < hi);\n    }\n    return lo;\n  }\n\n  function right(a, x, lo = 0, hi = a.length) {\n    if (lo < hi) {\n      if (compare1(x, x) !== 0) return hi;\n      do {\n        const mid = (lo + hi) >>> 1;\n        if (compare2(a[mid], x) <= 0) lo = mid + 1;\n        else hi = mid;\n      } while (lo < hi);\n    }\n    return lo;\n  }\n\n  function center(a, x, lo = 0, hi = a.length) {\n    const i = left(a, x, lo, hi - 1);\n    return i > lo && delta(a[i - 1], x) > -delta(a[i], x) ? i - 1 : i;\n  }\n\n  return {left, center, right};\n}\n\nfunction zero() {\n  return 0;\n}\n","export default function number(x) {\n  return x === null ? NaN : +x;\n}\n\nexport function* numbers(values, valueof) {\n  if (valueof === undefined) {\n    for (let value of values) {\n      if (value != null && (value = +value) >= value) {\n        yield value;\n      }\n    }\n  } else {\n    let index = -1;\n    for (let value of values) {\n      if ((value = valueof(value, ++index, values)) != null && (value = +value) >= value) {\n        yield value;\n      }\n    }\n  }\n}\n","import ascending from \"./ascending.js\";\nimport bisector from \"./bisector.js\";\nimport number from \"./number.js\";\n\nconst ascendingBisect = bisector(ascending);\nexport const bisectRight = ascendingBisect.right;\nexport const bisectLeft = ascendingBisect.left;\nexport const bisectCenter = bisector(number).center;\nexport default bisectRight;\n","export default function extent(values, valueof) {\n  let min;\n  let max;\n  if (valueof === undefined) {\n    for (const value of values) {\n      if (value != null) {\n        if (min === undefined) {\n          if (value >= value) min = max = value;\n        } else {\n          if (min > value) min = value;\n          if (max < value) max = value;\n        }\n      }\n    }\n  } else {\n    let index = -1;\n    for (let value of values) {\n      if ((value = valueof(value, ++index, values)) != null) {\n        if (min === undefined) {\n          if (value >= value) min = max = value;\n        } else {\n          if (min > value) min = value;\n          if (max < value) max = value;\n        }\n      }\n    }\n  }\n  return [min, max];\n}\n","const e10 = Math.sqrt(50),\n    e5 = Math.sqrt(10),\n    e2 = Math.sqrt(2);\n\nfunction tickSpec(start, stop, count) {\n  const step = (stop - start) / Math.max(0, count),\n      power = Math.floor(Math.log10(step)),\n      error = step / Math.pow(10, power),\n      factor = error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1;\n  let i1, i2, inc;\n  if (power < 0) {\n    inc = Math.pow(10, -power) / factor;\n    i1 = Math.round(start * inc);\n    i2 = Math.round(stop * inc);\n    if (i1 / inc < start) ++i1;\n    if (i2 / inc > stop) --i2;\n    inc = -inc;\n  } else {\n    inc = Math.pow(10, power) * factor;\n    i1 = Math.round(start / inc);\n    i2 = Math.round(stop / inc);\n    if (i1 * inc < start) ++i1;\n    if (i2 * inc > stop) --i2;\n  }\n  if (i2 < i1 && 0.5 <= count && count < 2) return tickSpec(start, stop, count * 2);\n  return [i1, i2, inc];\n}\n\nexport default function ticks(start, stop, count) {\n  stop = +stop, start = +start, count = +count;\n  if (!(count > 0)) return [];\n  if (start === stop) return [start];\n  const reverse = stop < start, [i1, i2, inc] = reverse ? tickSpec(stop, start, count) : tickSpec(start, stop, count);\n  if (!(i2 >= i1)) return [];\n  const n = i2 - i1 + 1, ticks = new Array(n);\n  if (reverse) {\n    if (inc < 0) for (let i = 0; i < n; ++i) ticks[i] = (i2 - i) / -inc;\n    else for (let i = 0; i < n; ++i) ticks[i] = (i2 - i) * inc;\n  } else {\n    if (inc < 0) for (let i = 0; i < n; ++i) ticks[i] = (i1 + i) / -inc;\n    else for (let i = 0; i < n; ++i) ticks[i] = (i1 + i) * inc;\n  }\n  return ticks;\n}\n\nexport function tickIncrement(start, stop, count) {\n  stop = +stop, start = +start, count = +count;\n  return tickSpec(start, stop, count)[2];\n}\n\nexport function tickStep(start, stop, count) {\n  stop = +stop, start = +start, count = +count;\n  const reverse = stop < start, inc = reverse ? tickIncrement(stop, start, count) : tickIncrement(start, stop, count);\n  return (reverse ? -1 : 1) * (inc < 0 ? 1 / -inc : inc);\n}\n","export function initRange(domain, range) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: this.range(domain); break;\n    default: this.range(range).domain(domain); break;\n  }\n  return this;\n}\n\nexport function initInterpolator(domain, interpolator) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: {\n      if (typeof domain === \"function\") this.interpolator(domain);\n      else this.range(domain);\n      break;\n    }\n    default: {\n      this.domain(domain);\n      if (typeof interpolator === \"function\") this.interpolator(interpolator);\n      else this.range(interpolator);\n      break;\n    }\n  }\n  return this;\n}\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import define, {extend} from \"./define.js\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex = /^#([0-9a-f]{3,8})$/,\n    reRgbInteger = new RegExp(`^rgb\\\\(${reI},${reI},${reI}\\\\)$`),\n    reRgbPercent = new RegExp(`^rgb\\\\(${reP},${reP},${reP}\\\\)$`),\n    reRgbaInteger = new RegExp(`^rgba\\\\(${reI},${reI},${reI},${reN}\\\\)$`),\n    reRgbaPercent = new RegExp(`^rgba\\\\(${reP},${reP},${reP},${reN}\\\\)$`),\n    reHslPercent = new RegExp(`^hsl\\\\(${reN},${reP},${reP}\\\\)$`),\n    reHslaPercent = new RegExp(`^hsla\\\\(${reN},${reP},${reP},${reN}\\\\)$`);\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  copy(channels) {\n    return Object.assign(new this.constructor, this, channels);\n  },\n  displayable() {\n    return this.rgb().displayable();\n  },\n  hex: color_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: color_formatHex,\n  formatHex8: color_formatHex8,\n  formatHsl: color_formatHsl,\n  formatRgb: color_formatRgb,\n  toString: color_formatRgb\n});\n\nfunction color_formatHex() {\n  return this.rgb().formatHex();\n}\n\nfunction color_formatHex8() {\n  return this.rgb().formatHex8();\n}\n\nfunction color_formatHsl() {\n  return hslConvert(this).formatHsl();\n}\n\nfunction color_formatRgb() {\n  return this.rgb().formatRgb();\n}\n\nexport default function color(format) {\n  var m, l;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex.exec(format)) ? (l = m[1].length, m = parseInt(m[1], 16), l === 6 ? rgbn(m) // #ff0000\n      : l === 3 ? new Rgb((m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1) // #f00\n      : l === 8 ? rgba(m >> 24 & 0xff, m >> 16 & 0xff, m >> 8 & 0xff, (m & 0xff) / 0xff) // #ff000000\n      : l === 4 ? rgba((m >> 12 & 0xf) | (m >> 8 & 0xf0), (m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), (((m & 0xf) << 4) | (m & 0xf)) / 0xff) // #f000\n      : null) // invalid hex\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format]) // eslint-disable-line no-prototype-builtins\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb() {\n    return this;\n  },\n  clamp() {\n    return new Rgb(clampi(this.r), clampi(this.g), clampi(this.b), clampa(this.opacity));\n  },\n  displayable() {\n    return (-0.5 <= this.r && this.r < 255.5)\n        && (-0.5 <= this.g && this.g < 255.5)\n        && (-0.5 <= this.b && this.b < 255.5)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: rgb_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: rgb_formatHex,\n  formatHex8: rgb_formatHex8,\n  formatRgb: rgb_formatRgb,\n  toString: rgb_formatRgb\n}));\n\nfunction rgb_formatHex() {\n  return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}`;\n}\n\nfunction rgb_formatHex8() {\n  return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity) ? 1 : this.opacity) * 255)}`;\n}\n\nfunction rgb_formatRgb() {\n  const a = clampa(this.opacity);\n  return `${a === 1 ? \"rgb(\" : \"rgba(\"}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${a === 1 ? \")\" : `, ${a})`}`;\n}\n\nfunction clampa(opacity) {\n  return isNaN(opacity) ? 1 : Math.max(0, Math.min(1, opacity));\n}\n\nfunction clampi(value) {\n  return Math.max(0, Math.min(255, Math.round(value) || 0));\n}\n\nfunction hex(value) {\n  value = clampi(value);\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  clamp() {\n    return new Hsl(clamph(this.h), clampt(this.s), clampt(this.l), clampa(this.opacity));\n  },\n  displayable() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  formatHsl() {\n    const a = clampa(this.opacity);\n    return `${a === 1 ? \"hsl(\" : \"hsla(\"}${clamph(this.h)}, ${clampt(this.s) * 100}%, ${clampt(this.l) * 100}%${a === 1 ? \")\" : `, ${a})`}`;\n  }\n}));\n\nfunction clamph(value) {\n  value = (value || 0) % 360;\n  return value < 0 ? value + 360 : value;\n}\n\nfunction clampt(value) {\n  return Math.max(0, Math.min(1, value || 0));\n}\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","export default x => () => x;\n","import constant from \"./constant.js\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nfunction exponential(a, b, y) {\n  return a = Math.pow(a, y), b = Math.pow(b, y) - a, y = 1 / y, function(t) {\n    return Math.pow(a + t * b, y);\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport function gamma(y) {\n  return (y = +y) === 1 ? nogamma : function(a, b) {\n    return b - a ? exponential(a, b, y) : constant(isNaN(a) ? b : a);\n  };\n}\n\nexport default function nogamma(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","import {rgb as colorRgb} from \"d3-color\";\nimport basis from \"./basis.js\";\nimport basisClosed from \"./basisClosed.js\";\nimport nogamma, {gamma} from \"./color.js\";\n\nexport default (function rgbGamma(y) {\n  var color = gamma(y);\n\n  function rgb(start, end) {\n    var r = color((start = colorRgb(start)).r, (end = colorRgb(end)).r),\n        g = color(start.g, end.g),\n        b = color(start.b, end.b),\n        opacity = nogamma(start.opacity, end.opacity);\n    return function(t) {\n      start.r = r(t);\n      start.g = g(t);\n      start.b = b(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n\n  rgb.gamma = rgbGamma;\n\n  return rgb;\n})(1);\n\nfunction rgbSpline(spline) {\n  return function(colors) {\n    var n = colors.length,\n        r = new Array(n),\n        g = new Array(n),\n        b = new Array(n),\n        i, color;\n    for (i = 0; i < n; ++i) {\n      color = colorRgb(colors[i]);\n      r[i] = color.r || 0;\n      g[i] = color.g || 0;\n      b[i] = color.b || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    color.opacity = 1;\n    return function(t) {\n      color.r = r(t);\n      color.g = g(t);\n      color.b = b(t);\n      return color + \"\";\n    };\n  };\n}\n\nexport var rgbBasis = rgbSpline(basis);\nexport var rgbBasisClosed = rgbSpline(basisClosed);\n","export default function(a, b) {\n  if (!b) b = [];\n  var n = a ? Math.min(b.length, a.length) : 0,\n      c = b.slice(),\n      i;\n  return function(t) {\n    for (i = 0; i < n; ++i) c[i] = a[i] * (1 - t) + b[i] * t;\n    return c;\n  };\n}\n\nexport function isNumberArray(x) {\n  return ArrayBuffer.isView(x) && !(x instanceof DataView);\n}\n","import value from \"./value.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  return (isNumberArray(b) ? numberArray : genericArray)(a, b);\n}\n\nexport function genericArray(a, b) {\n  var nb = b ? b.length : 0,\n      na = a ? Math.min(nb, a.length) : 0,\n      x = new Array(na),\n      c = new Array(nb),\n      i;\n\n  for (i = 0; i < na; ++i) x[i] = value(a[i], b[i]);\n  for (; i < nb; ++i) c[i] = b[i];\n\n  return function(t) {\n    for (i = 0; i < na; ++i) c[i] = x[i](t);\n    return c;\n  };\n}\n","export default function(a, b) {\n  var d = new Date;\n  return a = +a, b = +b, function(t) {\n    return d.setTime(a * (1 - t) + b * t), d;\n  };\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return a * (1 - t) + b * t;\n  };\n}\n","import value from \"./value.js\";\n\nexport default function(a, b) {\n  var i = {},\n      c = {},\n      k;\n\n  if (a === null || typeof a !== \"object\") a = {};\n  if (b === null || typeof b !== \"object\") b = {};\n\n  for (k in b) {\n    if (k in a) {\n      i[k] = value(a[k], b[k]);\n    } else {\n      c[k] = b[k];\n    }\n  }\n\n  return function(t) {\n    for (k in i) c[k] = i[k](t);\n    return c;\n  };\n}\n","import number from \"./number.js\";\n\nvar reA = /[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,\n    reB = new RegExp(reA.source, \"g\");\n\nfunction zero(b) {\n  return function() {\n    return b;\n  };\n}\n\nfunction one(b) {\n  return function(t) {\n    return b(t) + \"\";\n  };\n}\n\nexport default function(a, b) {\n  var bi = reA.lastIndex = reB.lastIndex = 0, // scan index for next number in b\n      am, // current match in a\n      bm, // current match in b\n      bs, // string preceding current number in b, if any\n      i = -1, // index in s\n      s = [], // string constants and placeholders\n      q = []; // number interpolators\n\n  // Coerce inputs to strings.\n  a = a + \"\", b = b + \"\";\n\n  // Interpolate pairs of numbers in a & b.\n  while ((am = reA.exec(a))\n      && (bm = reB.exec(b))) {\n    if ((bs = bm.index) > bi) { // a string precedes the next number in b\n      bs = b.slice(bi, bs);\n      if (s[i]) s[i] += bs; // coalesce with previous string\n      else s[++i] = bs;\n    }\n    if ((am = am[0]) === (bm = bm[0])) { // numbers in a & b match\n      if (s[i]) s[i] += bm; // coalesce with previous string\n      else s[++i] = bm;\n    } else { // interpolate non-matching numbers\n      s[++i] = null;\n      q.push({i: i, x: number(am, bm)});\n    }\n    bi = reB.lastIndex;\n  }\n\n  // Add remains of b.\n  if (bi < b.length) {\n    bs = b.slice(bi);\n    if (s[i]) s[i] += bs; // coalesce with previous string\n    else s[++i] = bs;\n  }\n\n  // Special optimization for only a single match.\n  // Otherwise, interpolate each of the numbers and rejoin the string.\n  return s.length < 2 ? (q[0]\n      ? one(q[0].x)\n      : zero(b))\n      : (b = q.length, function(t) {\n          for (var i = 0, o; i < b; ++i) s[(o = q[i]).i] = o.x(t);\n          return s.join(\"\");\n        });\n}\n","import {color} from \"d3-color\";\nimport rgb from \"./rgb.js\";\nimport {genericArray} from \"./array.js\";\nimport date from \"./date.js\";\nimport number from \"./number.js\";\nimport object from \"./object.js\";\nimport string from \"./string.js\";\nimport constant from \"./constant.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  var t = typeof b, c;\n  return b == null || t === \"boolean\" ? constant(b)\n      : (t === \"number\" ? number\n      : t === \"string\" ? ((c = color(b)) ? (b = c, rgb) : string)\n      : b instanceof color ? rgb\n      : b instanceof Date ? date\n      : isNumberArray(b) ? numberArray\n      : Array.isArray(b) ? genericArray\n      : typeof b.valueOf !== \"function\" && typeof b.toString !== \"function\" || isNaN(b) ? object\n      : number)(a, b);\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return Math.round(a * (1 - t) + b * t);\n  };\n}\n","export default function constants(x) {\n  return function() {\n    return x;\n  };\n}\n","export default function number(x) {\n  return +x;\n}\n","import {bisect} from \"d3-array\";\nimport {interpolate as interpolateValue, interpolateNumber, interpolateRound} from \"d3-interpolate\";\nimport constant from \"./constant.js\";\nimport number from \"./number.js\";\n\nvar unit = [0, 1];\n\nexport function identity(x) {\n  return x;\n}\n\nfunction normalize(a, b) {\n  return (b -= (a = +a))\n      ? function(x) { return (x - a) / b; }\n      : constant(isNaN(b) ? NaN : 0.5);\n}\n\nfunction clamper(a, b) {\n  var t;\n  if (a > b) t = a, a = b, b = t;\n  return function(x) { return Math.max(a, Math.min(b, x)); };\n}\n\n// normalize(a, b)(x) takes a domain value x in [a,b] and returns the corresponding parameter t in [0,1].\n// interpolate(a, b)(t) takes a parameter t in [0,1] and returns the corresponding range value x in [a,b].\nfunction bimap(domain, range, interpolate) {\n  var d0 = domain[0], d1 = domain[1], r0 = range[0], r1 = range[1];\n  if (d1 < d0) d0 = normalize(d1, d0), r0 = interpolate(r1, r0);\n  else d0 = normalize(d0, d1), r0 = interpolate(r0, r1);\n  return function(x) { return r0(d0(x)); };\n}\n\nfunction polymap(domain, range, interpolate) {\n  var j = Math.min(domain.length, range.length) - 1,\n      d = new Array(j),\n      r = new Array(j),\n      i = -1;\n\n  // Reverse descending domains.\n  if (domain[j] < domain[0]) {\n    domain = domain.slice().reverse();\n    range = range.slice().reverse();\n  }\n\n  while (++i < j) {\n    d[i] = normalize(domain[i], domain[i + 1]);\n    r[i] = interpolate(range[i], range[i + 1]);\n  }\n\n  return function(x) {\n    var i = bisect(domain, x, 1, j) - 1;\n    return r[i](d[i](x));\n  };\n}\n\nexport function copy(source, target) {\n  return target\n      .domain(source.domain())\n      .range(source.range())\n      .interpolate(source.interpolate())\n      .clamp(source.clamp())\n      .unknown(source.unknown());\n}\n\nexport function transformer() {\n  var domain = unit,\n      range = unit,\n      interpolate = interpolateValue,\n      transform,\n      untransform,\n      unknown,\n      clamp = identity,\n      piecewise,\n      output,\n      input;\n\n  function rescale() {\n    var n = Math.min(domain.length, range.length);\n    if (clamp !== identity) clamp = clamper(domain[0], domain[n - 1]);\n    piecewise = n > 2 ? polymap : bimap;\n    output = input = null;\n    return scale;\n  }\n\n  function scale(x) {\n    return x == null || isNaN(x = +x) ? unknown : (output || (output = piecewise(domain.map(transform), range, interpolate)))(transform(clamp(x)));\n  }\n\n  scale.invert = function(y) {\n    return clamp(untransform((input || (input = piecewise(range, domain.map(transform), interpolateNumber)))(y)));\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? (domain = Array.from(_, number), rescale()) : domain.slice();\n  };\n\n  scale.range = function(_) {\n    return arguments.length ? (range = Array.from(_), rescale()) : range.slice();\n  };\n\n  scale.rangeRound = function(_) {\n    return range = Array.from(_), interpolate = interpolateRound, rescale();\n  };\n\n  scale.clamp = function(_) {\n    return arguments.length ? (clamp = _ ? true : identity, rescale()) : clamp !== identity;\n  };\n\n  scale.interpolate = function(_) {\n    return arguments.length ? (interpolate = _, rescale()) : interpolate;\n  };\n\n  scale.unknown = function(_) {\n    return arguments.length ? (unknown = _, scale) : unknown;\n  };\n\n  return function(t, u) {\n    transform = t, untransform = u;\n    return rescale();\n  };\n}\n\nexport default function continuous() {\n  return transformer()(identity, identity);\n}\n","export default function(x) {\n  return Math.abs(x = Math.round(x)) >= 1e21\n      ? x.toLocaleString(\"en\").replace(/,/g, \"\")\n      : x.toString(10);\n}\n\n// Computes the decimal coefficient and exponent of the specified number x with\n// significant digits p, where x is positive and p is in [1, 21] or undefined.\n// For example, formatDecimalParts(1.23) returns [\"123\", 0].\nexport function formatDecimalParts(x, p) {\n  if ((i = (x = p ? x.toExponential(p - 1) : x.toExponential()).indexOf(\"e\")) < 0) return null; // NaN, ±Infinity\n  var i, coefficient = x.slice(0, i);\n\n  // The string returned by toExponential either has the form \\d\\.\\d+e[-+]\\d+\n  // (e.g., 1.2e+3) or the form \\de[-+]\\d+ (e.g., 1e+3).\n  return [\n    coefficient.length > 1 ? coefficient[0] + coefficient.slice(2) : coefficient,\n    +x.slice(i + 1)\n  ];\n}\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport default function(x) {\n  return x = formatDecimalParts(Math.abs(x)), x ? x[1] : NaN;\n}\n","export default function(grouping, thousands) {\n  return function(value, width) {\n    var i = value.length,\n        t = [],\n        j = 0,\n        g = grouping[0],\n        length = 0;\n\n    while (i > 0 && g > 0) {\n      if (length + g + 1 > width) g = Math.max(1, width - length);\n      t.push(value.substring(i -= g, i + g));\n      if ((length += g + 1) > width) break;\n      g = grouping[j = (j + 1) % grouping.length];\n    }\n\n    return t.reverse().join(thousands);\n  };\n}\n","export default function(numerals) {\n  return function(value) {\n    return value.replace(/[0-9]/g, function(i) {\n      return numerals[+i];\n    });\n  };\n}\n","// [[fill]align][sign][symbol][0][width][,][.precision][~][type]\nvar re = /^(?:(.)?([<>=^]))?([+\\-( ])?([$#])?(0)?(\\d+)?(,)?(\\.\\d+)?(~)?([a-z%])?$/i;\n\nexport default function formatSpecifier(specifier) {\n  if (!(match = re.exec(specifier))) throw new Error(\"invalid format: \" + specifier);\n  var match;\n  return new FormatSpecifier({\n    fill: match[1],\n    align: match[2],\n    sign: match[3],\n    symbol: match[4],\n    zero: match[5],\n    width: match[6],\n    comma: match[7],\n    precision: match[8] && match[8].slice(1),\n    trim: match[9],\n    type: match[10]\n  });\n}\n\nformatSpecifier.prototype = FormatSpecifier.prototype; // instanceof\n\nexport function FormatSpecifier(specifier) {\n  this.fill = specifier.fill === undefined ? \" \" : specifier.fill + \"\";\n  this.align = specifier.align === undefined ? \">\" : specifier.align + \"\";\n  this.sign = specifier.sign === undefined ? \"-\" : specifier.sign + \"\";\n  this.symbol = specifier.symbol === undefined ? \"\" : specifier.symbol + \"\";\n  this.zero = !!specifier.zero;\n  this.width = specifier.width === undefined ? undefined : +specifier.width;\n  this.comma = !!specifier.comma;\n  this.precision = specifier.precision === undefined ? undefined : +specifier.precision;\n  this.trim = !!specifier.trim;\n  this.type = specifier.type === undefined ? \"\" : specifier.type + \"\";\n}\n\nFormatSpecifier.prototype.toString = function() {\n  return this.fill\n      + this.align\n      + this.sign\n      + this.symbol\n      + (this.zero ? \"0\" : \"\")\n      + (this.width === undefined ? \"\" : Math.max(1, this.width | 0))\n      + (this.comma ? \",\" : \"\")\n      + (this.precision === undefined ? \"\" : \".\" + Math.max(0, this.precision | 0))\n      + (this.trim ? \"~\" : \"\")\n      + this.type;\n};\n","// Trims insignificant zeros, e.g., replaces 1.2000k with 1.2k.\nexport default function(s) {\n  out: for (var n = s.length, i = 1, i0 = -1, i1; i < n; ++i) {\n    switch (s[i]) {\n      case \".\": i0 = i1 = i; break;\n      case \"0\": if (i0 === 0) i0 = i; i1 = i; break;\n      default: if (!+s[i]) break out; if (i0 > 0) i0 = 0; break;\n    }\n  }\n  return i0 > 0 ? s.slice(0, i0) + s.slice(i1 + 1) : s;\n}\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport var prefixExponent;\n\nexport default function(x, p) {\n  var d = formatDecimalParts(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1],\n      i = exponent - (prefixExponent = Math.max(-8, Math.min(8, Math.floor(exponent / 3))) * 3) + 1,\n      n = coefficient.length;\n  return i === n ? coefficient\n      : i > n ? coefficient + new Array(i - n + 1).join(\"0\")\n      : i > 0 ? coefficient.slice(0, i) + \".\" + coefficient.slice(i)\n      : \"0.\" + new Array(1 - i).join(\"0\") + formatDecimalParts(x, Math.max(0, p + i - 1))[0]; // less than 1y!\n}\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport default function(x, p) {\n  var d = formatDecimalParts(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1];\n  return exponent < 0 ? \"0.\" + new Array(-exponent).join(\"0\") + coefficient\n      : coefficient.length > exponent + 1 ? coefficient.slice(0, exponent + 1) + \".\" + coefficient.slice(exponent + 1)\n      : coefficient + new Array(exponent - coefficient.length + 2).join(\"0\");\n}\n","import formatDecimal from \"./formatDecimal.js\";\nimport formatPrefixAuto from \"./formatPrefixAuto.js\";\nimport formatRounded from \"./formatRounded.js\";\n\nexport default {\n  \"%\": (x, p) => (x * 100).toFixed(p),\n  \"b\": (x) => Math.round(x).toString(2),\n  \"c\": (x) => x + \"\",\n  \"d\": formatDecimal,\n  \"e\": (x, p) => x.toExponential(p),\n  \"f\": (x, p) => x.toFixed(p),\n  \"g\": (x, p) => x.toPrecision(p),\n  \"o\": (x) => Math.round(x).toString(8),\n  \"p\": (x, p) => formatRounded(x * 100, p),\n  \"r\": formatRounded,\n  \"s\": formatPrefixAuto,\n  \"X\": (x) => Math.round(x).toString(16).toUpperCase(),\n  \"x\": (x) => Math.round(x).toString(16)\n};\n","export default function(x) {\n  return x;\n}\n","import exponent from \"./exponent.js\";\nimport formatGroup from \"./formatGroup.js\";\nimport formatNumerals from \"./formatNumerals.js\";\nimport formatSpecifier from \"./formatSpecifier.js\";\nimport formatTrim from \"./formatTrim.js\";\nimport formatTypes from \"./formatTypes.js\";\nimport {prefixExponent} from \"./formatPrefixAuto.js\";\nimport identity from \"./identity.js\";\n\nvar map = Array.prototype.map,\n    prefixes = [\"y\",\"z\",\"a\",\"f\",\"p\",\"n\",\"µ\",\"m\",\"\",\"k\",\"M\",\"G\",\"T\",\"P\",\"E\",\"Z\",\"Y\"];\n\nexport default function(locale) {\n  var group = locale.grouping === undefined || locale.thousands === undefined ? identity : formatGroup(map.call(locale.grouping, Number), locale.thousands + \"\"),\n      currencyPrefix = locale.currency === undefined ? \"\" : locale.currency[0] + \"\",\n      currencySuffix = locale.currency === undefined ? \"\" : locale.currency[1] + \"\",\n      decimal = locale.decimal === undefined ? \".\" : locale.decimal + \"\",\n      numerals = locale.numerals === undefined ? identity : formatNumerals(map.call(locale.numerals, String)),\n      percent = locale.percent === undefined ? \"%\" : locale.percent + \"\",\n      minus = locale.minus === undefined ? \"−\" : locale.minus + \"\",\n      nan = locale.nan === undefined ? \"NaN\" : locale.nan + \"\";\n\n  function newFormat(specifier) {\n    specifier = formatSpecifier(specifier);\n\n    var fill = specifier.fill,\n        align = specifier.align,\n        sign = specifier.sign,\n        symbol = specifier.symbol,\n        zero = specifier.zero,\n        width = specifier.width,\n        comma = specifier.comma,\n        precision = specifier.precision,\n        trim = specifier.trim,\n        type = specifier.type;\n\n    // The \"n\" type is an alias for \",g\".\n    if (type === \"n\") comma = true, type = \"g\";\n\n    // The \"\" type, and any invalid type, is an alias for \".12~g\".\n    else if (!formatTypes[type]) precision === undefined && (precision = 12), trim = true, type = \"g\";\n\n    // If zero fill is specified, padding goes after sign and before digits.\n    if (zero || (fill === \"0\" && align === \"=\")) zero = true, fill = \"0\", align = \"=\";\n\n    // Compute the prefix and suffix.\n    // For SI-prefix, the suffix is lazily computed.\n    var prefix = symbol === \"$\" ? currencyPrefix : symbol === \"#\" && /[boxX]/.test(type) ? \"0\" + type.toLowerCase() : \"\",\n        suffix = symbol === \"$\" ? currencySuffix : /[%p]/.test(type) ? percent : \"\";\n\n    // What format function should we use?\n    // Is this an integer type?\n    // Can this type generate exponential notation?\n    var formatType = formatTypes[type],\n        maybeSuffix = /[defgprs%]/.test(type);\n\n    // Set the default precision if not specified,\n    // or clamp the specified precision to the supported range.\n    // For significant precision, it must be in [1, 21].\n    // For fixed precision, it must be in [0, 20].\n    precision = precision === undefined ? 6\n        : /[gprs]/.test(type) ? Math.max(1, Math.min(21, precision))\n        : Math.max(0, Math.min(20, precision));\n\n    function format(value) {\n      var valuePrefix = prefix,\n          valueSuffix = suffix,\n          i, n, c;\n\n      if (type === \"c\") {\n        valueSuffix = formatType(value) + valueSuffix;\n        value = \"\";\n      } else {\n        value = +value;\n\n        // Determine the sign. -0 is not less than 0, but 1 / -0 is!\n        var valueNegative = value < 0 || 1 / value < 0;\n\n        // Perform the initial formatting.\n        value = isNaN(value) ? nan : formatType(Math.abs(value), precision);\n\n        // Trim insignificant zeros.\n        if (trim) value = formatTrim(value);\n\n        // If a negative value rounds to zero after formatting, and no explicit positive sign is requested, hide the sign.\n        if (valueNegative && +value === 0 && sign !== \"+\") valueNegative = false;\n\n        // Compute the prefix and suffix.\n        valuePrefix = (valueNegative ? (sign === \"(\" ? sign : minus) : sign === \"-\" || sign === \"(\" ? \"\" : sign) + valuePrefix;\n        valueSuffix = (type === \"s\" ? prefixes[8 + prefixExponent / 3] : \"\") + valueSuffix + (valueNegative && sign === \"(\" ? \")\" : \"\");\n\n        // Break the formatted value into the integer “value” part that can be\n        // grouped, and fractional or exponential “suffix” part that is not.\n        if (maybeSuffix) {\n          i = -1, n = value.length;\n          while (++i < n) {\n            if (c = value.charCodeAt(i), 48 > c || c > 57) {\n              valueSuffix = (c === 46 ? decimal + value.slice(i + 1) : value.slice(i)) + valueSuffix;\n              value = value.slice(0, i);\n              break;\n            }\n          }\n        }\n      }\n\n      // If the fill character is not \"0\", grouping is applied before padding.\n      if (comma && !zero) value = group(value, Infinity);\n\n      // Compute the padding.\n      var length = valuePrefix.length + value.length + valueSuffix.length,\n          padding = length < width ? new Array(width - length + 1).join(fill) : \"\";\n\n      // If the fill character is \"0\", grouping is applied after padding.\n      if (comma && zero) value = group(padding + value, padding.length ? width - valueSuffix.length : Infinity), padding = \"\";\n\n      // Reconstruct the final output based on the desired alignment.\n      switch (align) {\n        case \"<\": value = valuePrefix + value + valueSuffix + padding; break;\n        case \"=\": value = valuePrefix + padding + value + valueSuffix; break;\n        case \"^\": value = padding.slice(0, length = padding.length >> 1) + valuePrefix + value + valueSuffix + padding.slice(length); break;\n        default: value = padding + valuePrefix + value + valueSuffix; break;\n      }\n\n      return numerals(value);\n    }\n\n    format.toString = function() {\n      return specifier + \"\";\n    };\n\n    return format;\n  }\n\n  function formatPrefix(specifier, value) {\n    var f = newFormat((specifier = formatSpecifier(specifier), specifier.type = \"f\", specifier)),\n        e = Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3,\n        k = Math.pow(10, -e),\n        prefix = prefixes[8 + e / 3];\n    return function(value) {\n      return f(k * value) + prefix;\n    };\n  }\n\n  return {\n    format: newFormat,\n    formatPrefix: formatPrefix\n  };\n}\n","import formatLocale from \"./locale.js\";\n\nvar locale;\nexport var format;\nexport var formatPrefix;\n\ndefaultLocale({\n  thousands: \",\",\n  grouping: [3],\n  currency: [\"$\", \"\"]\n});\n\nexport default function defaultLocale(definition) {\n  locale = formatLocale(definition);\n  format = locale.format;\n  formatPrefix = locale.formatPrefix;\n  return locale;\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step) {\n  return Math.max(0, -exponent(Math.abs(step)));\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step, value) {\n  return Math.max(0, Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3 - exponent(Math.abs(step)));\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step, max) {\n  step = Math.abs(step), max = Math.abs(max) - step;\n  return Math.max(0, exponent(max) - exponent(step)) + 1;\n}\n","import {tickStep} from \"d3-array\";\nimport {format, formatPrefix, formatSpecifier, precisionFixed, precisionPrefix, precisionRound} from \"d3-format\";\n\nexport default function tickFormat(start, stop, count, specifier) {\n  var step = tickStep(start, stop, count),\n      precision;\n  specifier = formatSpecifier(specifier == null ? \",f\" : specifier);\n  switch (specifier.type) {\n    case \"s\": {\n      var value = Math.max(Math.abs(start), Math.abs(stop));\n      if (specifier.precision == null && !isNaN(precision = precisionPrefix(step, value))) specifier.precision = precision;\n      return formatPrefix(specifier, value);\n    }\n    case \"\":\n    case \"e\":\n    case \"g\":\n    case \"p\":\n    case \"r\": {\n      if (specifier.precision == null && !isNaN(precision = precisionRound(step, Math.max(Math.abs(start), Math.abs(stop))))) specifier.precision = precision - (specifier.type === \"e\");\n      break;\n    }\n    case \"f\":\n    case \"%\": {\n      if (specifier.precision == null && !isNaN(precision = precisionFixed(step))) specifier.precision = precision - (specifier.type === \"%\") * 2;\n      break;\n    }\n  }\n  return format(specifier);\n}\n","import {ticks, tickIncrement} from \"d3-array\";\nimport continuous, {copy} from \"./continuous.js\";\nimport {initRange} from \"./init.js\";\nimport tickFormat from \"./tickFormat.js\";\n\nexport function linearish(scale) {\n  var domain = scale.domain;\n\n  scale.ticks = function(count) {\n    var d = domain();\n    return ticks(d[0], d[d.length - 1], count == null ? 10 : count);\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    var d = domain();\n    return tickFormat(d[0], d[d.length - 1], count == null ? 10 : count, specifier);\n  };\n\n  scale.nice = function(count) {\n    if (count == null) count = 10;\n\n    var d = domain();\n    var i0 = 0;\n    var i1 = d.length - 1;\n    var start = d[i0];\n    var stop = d[i1];\n    var prestep;\n    var step;\n    var maxIter = 10;\n\n    if (stop < start) {\n      step = start, start = stop, stop = step;\n      step = i0, i0 = i1, i1 = step;\n    }\n    \n    while (maxIter-- > 0) {\n      step = tickIncrement(start, stop, count);\n      if (step === prestep) {\n        d[i0] = start\n        d[i1] = stop\n        return domain(d);\n      } else if (step > 0) {\n        start = Math.floor(start / step) * step;\n        stop = Math.ceil(stop / step) * step;\n      } else if (step < 0) {\n        start = Math.ceil(start * step) / step;\n        stop = Math.floor(stop * step) / step;\n      } else {\n        break;\n      }\n      prestep = step;\n    }\n\n    return scale;\n  };\n\n  return scale;\n}\n\nexport default function linear() {\n  var scale = continuous();\n\n  scale.copy = function() {\n    return copy(scale, linear());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return linearish(scale);\n}\n","export default function nice(domain, interval) {\n  domain = domain.slice();\n\n  var i0 = 0,\n      i1 = domain.length - 1,\n      x0 = domain[i0],\n      x1 = domain[i1],\n      t;\n\n  if (x1 < x0) {\n    t = i0, i0 = i1, i1 = t;\n    t = x0, x0 = x1, x1 = t;\n  }\n\n  domain[i0] = interval.floor(x0);\n  domain[i1] = interval.ceil(x1);\n  return domain;\n}\n","const t0 = new Date, t1 = new Date;\n\nexport function timeInterval(floori, offseti, count, field) {\n\n  function interval(date) {\n    return floori(date = arguments.length === 0 ? new Date : new Date(+date)), date;\n  }\n\n  interval.floor = (date) => {\n    return floori(date = new Date(+date)), date;\n  };\n\n  interval.ceil = (date) => {\n    return floori(date = new Date(date - 1)), offseti(date, 1), floori(date), date;\n  };\n\n  interval.round = (date) => {\n    const d0 = interval(date), d1 = interval.ceil(date);\n    return date - d0 < d1 - date ? d0 : d1;\n  };\n\n  interval.offset = (date, step) => {\n    return offseti(date = new Date(+date), step == null ? 1 : Math.floor(step)), date;\n  };\n\n  interval.range = (start, stop, step) => {\n    const range = [];\n    start = interval.ceil(start);\n    step = step == null ? 1 : Math.floor(step);\n    if (!(start < stop) || !(step > 0)) return range; // also handles Invalid Date\n    let previous;\n    do range.push(previous = new Date(+start)), offseti(start, step), floori(start);\n    while (previous < start && start < stop);\n    return range;\n  };\n\n  interval.filter = (test) => {\n    return timeInterval((date) => {\n      if (date >= date) while (floori(date), !test(date)) date.setTime(date - 1);\n    }, (date, step) => {\n      if (date >= date) {\n        if (step < 0) while (++step <= 0) {\n          while (offseti(date, -1), !test(date)) {} // eslint-disable-line no-empty\n        } else while (--step >= 0) {\n          while (offseti(date, +1), !test(date)) {} // eslint-disable-line no-empty\n        }\n      }\n    });\n  };\n\n  if (count) {\n    interval.count = (start, end) => {\n      t0.setTime(+start), t1.setTime(+end);\n      floori(t0), floori(t1);\n      return Math.floor(count(t0, t1));\n    };\n\n    interval.every = (step) => {\n      step = Math.floor(step);\n      return !isFinite(step) || !(step > 0) ? null\n          : !(step > 1) ? interval\n          : interval.filter(field\n              ? (d) => field(d) % step === 0\n              : (d) => interval.count(0, d) % step === 0);\n    };\n  }\n\n  return interval;\n}\n","import {timeInterval} from \"./interval.js\";\n\nexport const millisecond = timeInterval(() => {\n  // noop\n}, (date, step) => {\n  date.setTime(+date + step);\n}, (start, end) => {\n  return end - start;\n});\n\n// An optimized implementation for this simple case.\nmillisecond.every = (k) => {\n  k = Math.floor(k);\n  if (!isFinite(k) || !(k > 0)) return null;\n  if (!(k > 1)) return millisecond;\n  return timeInterval((date) => {\n    date.setTime(Math.floor(date / k) * k);\n  }, (date, step) => {\n    date.setTime(+date + step * k);\n  }, (start, end) => {\n    return (end - start) / k;\n  });\n};\n\nexport const milliseconds = millisecond.range;\n","export const durationSecond = 1000;\nexport const durationMinute = durationSecond * 60;\nexport const durationHour = durationMinute * 60;\nexport const durationDay = durationHour * 24;\nexport const durationWeek = durationDay * 7;\nexport const durationMonth = durationDay * 30;\nexport const durationYear = durationDay * 365;\n","import {timeInterval} from \"./interval.js\";\nimport {durationSecond} from \"./duration.js\";\n\nexport const second = timeInterval((date) => {\n  date.setTime(date - date.getMilliseconds());\n}, (date, step) => {\n  date.setTime(+date + step * durationSecond);\n}, (start, end) => {\n  return (end - start) / durationSecond;\n}, (date) => {\n  return date.getUTCSeconds();\n});\n\nexport const seconds = second.range;\n","import {timeInterval} from \"./interval.js\";\nimport {durationMinute, durationSecond} from \"./duration.js\";\n\nexport const timeMinute = timeInterval((date) => {\n  date.setTime(date - date.getMilliseconds() - date.getSeconds() * durationSecond);\n}, (date, step) => {\n  date.setTime(+date + step * durationMinute);\n}, (start, end) => {\n  return (end - start) / durationMinute;\n}, (date) => {\n  return date.getMinutes();\n});\n\nexport const timeMinutes = timeMinute.range;\n\nexport const utcMinute = timeInterval((date) => {\n  date.setUTCSeconds(0, 0);\n}, (date, step) => {\n  date.setTime(+date + step * durationMinute);\n}, (start, end) => {\n  return (end - start) / durationMinute;\n}, (date) => {\n  return date.getUTCMinutes();\n});\n\nexport const utcMinutes = utcMinute.range;\n","import {timeInterval} from \"./interval.js\";\nimport {durationHour, durationMinute, durationSecond} from \"./duration.js\";\n\nexport const timeHour = timeInterval((date) => {\n  date.setTime(date - date.getMilliseconds() - date.getSeconds() * durationSecond - date.getMinutes() * durationMinute);\n}, (date, step) => {\n  date.setTime(+date + step * durationHour);\n}, (start, end) => {\n  return (end - start) / durationHour;\n}, (date) => {\n  return date.getHours();\n});\n\nexport const timeHours = timeHour.range;\n\nexport const utcHour = timeInterval((date) => {\n  date.setUTCMinutes(0, 0, 0);\n}, (date, step) => {\n  date.setTime(+date + step * durationHour);\n}, (start, end) => {\n  return (end - start) / durationHour;\n}, (date) => {\n  return date.getUTCHours();\n});\n\nexport const utcHours = utcHour.range;\n","import {timeInterval} from \"./interval.js\";\nimport {durationDay, durationMinute} from \"./duration.js\";\n\nexport const timeDay = timeInterval(\n  date => date.setHours(0, 0, 0, 0),\n  (date, step) => date.setDate(date.getDate() + step),\n  (start, end) => (end - start - (end.getTimezoneOffset() - start.getTimezoneOffset()) * durationMinute) / durationDay,\n  date => date.getDate() - 1\n);\n\nexport const timeDays = timeDay.range;\n\nexport const utcDay = timeInterval((date) => {\n  date.setUTCHours(0, 0, 0, 0);\n}, (date, step) => {\n  date.setUTCDate(date.getUTCDate() + step);\n}, (start, end) => {\n  return (end - start) / durationDay;\n}, (date) => {\n  return date.getUTCDate() - 1;\n});\n\nexport const utcDays = utcDay.range;\n\nexport const unixDay = timeInterval((date) => {\n  date.setUTCHours(0, 0, 0, 0);\n}, (date, step) => {\n  date.setUTCDate(date.getUTCDate() + step);\n}, (start, end) => {\n  return (end - start) / durationDay;\n}, (date) => {\n  return Math.floor(date / durationDay);\n});\n\nexport const unixDays = unixDay.range;\n","import {timeInterval} from \"./interval.js\";\nimport {durationMinute, durationWeek} from \"./duration.js\";\n\nfunction timeWeekday(i) {\n  return timeInterval((date) => {\n    date.setDate(date.getDate() - (date.getDay() + 7 - i) % 7);\n    date.setHours(0, 0, 0, 0);\n  }, (date, step) => {\n    date.setDate(date.getDate() + step * 7);\n  }, (start, end) => {\n    return (end - start - (end.getTimezoneOffset() - start.getTimezoneOffset()) * durationMinute) / durationWeek;\n  });\n}\n\nexport const timeSunday = timeWeekday(0);\nexport const timeMonday = timeWeekday(1);\nexport const timeTuesday = timeWeekday(2);\nexport const timeWednesday = timeWeekday(3);\nexport const timeThursday = timeWeekday(4);\nexport const timeFriday = timeWeekday(5);\nexport const timeSaturday = timeWeekday(6);\n\nexport const timeSundays = timeSunday.range;\nexport const timeMondays = timeMonday.range;\nexport const timeTuesdays = timeTuesday.range;\nexport const timeWednesdays = timeWednesday.range;\nexport const timeThursdays = timeThursday.range;\nexport const timeFridays = timeFriday.range;\nexport const timeSaturdays = timeSaturday.range;\n\nfunction utcWeekday(i) {\n  return timeInterval((date) => {\n    date.setUTCDate(date.getUTCDate() - (date.getUTCDay() + 7 - i) % 7);\n    date.setUTCHours(0, 0, 0, 0);\n  }, (date, step) => {\n    date.setUTCDate(date.getUTCDate() + step * 7);\n  }, (start, end) => {\n    return (end - start) / durationWeek;\n  });\n}\n\nexport const utcSunday = utcWeekday(0);\nexport const utcMonday = utcWeekday(1);\nexport const utcTuesday = utcWeekday(2);\nexport const utcWednesday = utcWeekday(3);\nexport const utcThursday = utcWeekday(4);\nexport const utcFriday = utcWeekday(5);\nexport const utcSaturday = utcWeekday(6);\n\nexport const utcSundays = utcSunday.range;\nexport const utcMondays = utcMonday.range;\nexport const utcTuesdays = utcTuesday.range;\nexport const utcWednesdays = utcWednesday.range;\nexport const utcThursdays = utcThursday.range;\nexport const utcFridays = utcFriday.range;\nexport const utcSaturdays = utcSaturday.range;\n","import {timeInterval} from \"./interval.js\";\n\nexport const timeMonth = timeInterval((date) => {\n  date.setDate(1);\n  date.setHours(0, 0, 0, 0);\n}, (date, step) => {\n  date.setMonth(date.getMonth() + step);\n}, (start, end) => {\n  return end.getMonth() - start.getMonth() + (end.getFullYear() - start.getFullYear()) * 12;\n}, (date) => {\n  return date.getMonth();\n});\n\nexport const timeMonths = timeMonth.range;\n\nexport const utcMonth = timeInterval((date) => {\n  date.setUTCDate(1);\n  date.setUTCHours(0, 0, 0, 0);\n}, (date, step) => {\n  date.setUTCMonth(date.getUTCMonth() + step);\n}, (start, end) => {\n  return end.getUTCMonth() - start.getUTCMonth() + (end.getUTCFullYear() - start.getUTCFullYear()) * 12;\n}, (date) => {\n  return date.getUTCMonth();\n});\n\nexport const utcMonths = utcMonth.range;\n","import {timeInterval} from \"./interval.js\";\n\nexport const timeYear = timeInterval((date) => {\n  date.setMonth(0, 1);\n  date.setHours(0, 0, 0, 0);\n}, (date, step) => {\n  date.setFullYear(date.getFullYear() + step);\n}, (start, end) => {\n  return end.getFullYear() - start.getFullYear();\n}, (date) => {\n  return date.getFullYear();\n});\n\n// An optimized implementation for this simple case.\ntimeYear.every = (k) => {\n  return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : timeInterval((date) => {\n    date.setFullYear(Math.floor(date.getFullYear() / k) * k);\n    date.setMonth(0, 1);\n    date.setHours(0, 0, 0, 0);\n  }, (date, step) => {\n    date.setFullYear(date.getFullYear() + step * k);\n  });\n};\n\nexport const timeYears = timeYear.range;\n\nexport const utcYear = timeInterval((date) => {\n  date.setUTCMonth(0, 1);\n  date.setUTCHours(0, 0, 0, 0);\n}, (date, step) => {\n  date.setUTCFullYear(date.getUTCFullYear() + step);\n}, (start, end) => {\n  return end.getUTCFullYear() - start.getUTCFullYear();\n}, (date) => {\n  return date.getUTCFullYear();\n});\n\n// An optimized implementation for this simple case.\nutcYear.every = (k) => {\n  return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : timeInterval((date) => {\n    date.setUTCFullYear(Math.floor(date.getUTCFullYear() / k) * k);\n    date.setUTCMonth(0, 1);\n    date.setUTCHours(0, 0, 0, 0);\n  }, (date, step) => {\n    date.setUTCFullYear(date.getUTCFullYear() + step * k);\n  });\n};\n\nexport const utcYears = utcYear.range;\n","import {bisector, tickStep} from \"d3-array\";\nimport {durationDay, durationHour, durationMinute, durationMonth, durationSecond, durationWeek, durationYear} from \"./duration.js\";\nimport {millisecond} from \"./millisecond.js\";\nimport {second} from \"./second.js\";\nimport {timeMinute, utcMinute} from \"./minute.js\";\nimport {timeHour, utcHour} from \"./hour.js\";\nimport {timeDay, unixDay} from \"./day.js\";\nimport {timeSunday, utcSunday} from \"./week.js\";\nimport {timeMonth, utcMonth} from \"./month.js\";\nimport {timeYear, utcYear} from \"./year.js\";\n\nfunction ticker(year, month, week, day, hour, minute) {\n\n  const tickIntervals = [\n    [second,  1,      durationSecond],\n    [second,  5,  5 * durationSecond],\n    [second, 15, 15 * durationSecond],\n    [second, 30, 30 * durationSecond],\n    [minute,  1,      durationMinute],\n    [minute,  5,  5 * durationMinute],\n    [minute, 15, 15 * durationMinute],\n    [minute, 30, 30 * durationMinute],\n    [  hour,  1,      durationHour  ],\n    [  hour,  3,  3 * durationHour  ],\n    [  hour,  6,  6 * durationHour  ],\n    [  hour, 12, 12 * durationHour  ],\n    [   day,  1,      durationDay   ],\n    [   day,  2,  2 * durationDay   ],\n    [  week,  1,      durationWeek  ],\n    [ month,  1,      durationMonth ],\n    [ month,  3,  3 * durationMonth ],\n    [  year,  1,      durationYear  ]\n  ];\n\n  function ticks(start, stop, count) {\n    const reverse = stop < start;\n    if (reverse) [start, stop] = [stop, start];\n    const interval = count && typeof count.range === \"function\" ? count : tickInterval(start, stop, count);\n    const ticks = interval ? interval.range(start, +stop + 1) : []; // inclusive stop\n    return reverse ? ticks.reverse() : ticks;\n  }\n\n  function tickInterval(start, stop, count) {\n    const target = Math.abs(stop - start) / count;\n    const i = bisector(([,, step]) => step).right(tickIntervals, target);\n    if (i === tickIntervals.length) return year.every(tickStep(start / durationYear, stop / durationYear, count));\n    if (i === 0) return millisecond.every(Math.max(tickStep(start, stop, count), 1));\n    const [t, step] = tickIntervals[target / tickIntervals[i - 1][2] < tickIntervals[i][2] / target ? i - 1 : i];\n    return t.every(step);\n  }\n\n  return [ticks, tickInterval];\n}\n\nconst [utcTicks, utcTickInterval] = ticker(utcYear, utcMonth, utcSunday, unixDay, utcHour, utcMinute);\nconst [timeTicks, timeTickInterval] = ticker(timeYear, timeMonth, timeSunday, timeDay, timeHour, timeMinute);\n\nexport {utcTicks, utcTickInterval, timeTicks, timeTickInterval};\n","import {\n  timeDay,\n  timeSunday,\n  timeMonday,\n  timeThursday,\n  timeYear,\n  utcDay,\n  utcSunday,\n  utcMonday,\n  utcThursday,\n  utcYear\n} from \"d3-time\";\n\nfunction localDate(d) {\n  if (0 <= d.y && d.y < 100) {\n    var date = new Date(-1, d.m, d.d, d.H, d.M, d.S, d.L);\n    date.setFullYear(d.y);\n    return date;\n  }\n  return new Date(d.y, d.m, d.d, d.H, d.M, d.S, d.L);\n}\n\nfunction utcDate(d) {\n  if (0 <= d.y && d.y < 100) {\n    var date = new Date(Date.UTC(-1, d.m, d.d, d.H, d.M, d.S, d.L));\n    date.setUTCFullYear(d.y);\n    return date;\n  }\n  return new Date(Date.UTC(d.y, d.m, d.d, d.H, d.M, d.S, d.L));\n}\n\nfunction newDate(y, m, d) {\n  return {y: y, m: m, d: d, H: 0, M: 0, S: 0, L: 0};\n}\n\nexport default function formatLocale(locale) {\n  var locale_dateTime = locale.dateTime,\n      locale_date = locale.date,\n      locale_time = locale.time,\n      locale_periods = locale.periods,\n      locale_weekdays = locale.days,\n      locale_shortWeekdays = locale.shortDays,\n      locale_months = locale.months,\n      locale_shortMonths = locale.shortMonths;\n\n  var periodRe = formatRe(locale_periods),\n      periodLookup = formatLookup(locale_periods),\n      weekdayRe = formatRe(locale_weekdays),\n      weekdayLookup = formatLookup(locale_weekdays),\n      shortWeekdayRe = formatRe(locale_shortWeekdays),\n      shortWeekdayLookup = formatLookup(locale_shortWeekdays),\n      monthRe = formatRe(locale_months),\n      monthLookup = formatLookup(locale_months),\n      shortMonthRe = formatRe(locale_shortMonths),\n      shortMonthLookup = formatLookup(locale_shortMonths);\n\n  var formats = {\n    \"a\": formatShortWeekday,\n    \"A\": formatWeekday,\n    \"b\": formatShortMonth,\n    \"B\": formatMonth,\n    \"c\": null,\n    \"d\": formatDayOfMonth,\n    \"e\": formatDayOfMonth,\n    \"f\": formatMicroseconds,\n    \"g\": formatYearISO,\n    \"G\": formatFullYearISO,\n    \"H\": formatHour24,\n    \"I\": formatHour12,\n    \"j\": formatDayOfYear,\n    \"L\": formatMilliseconds,\n    \"m\": formatMonthNumber,\n    \"M\": formatMinutes,\n    \"p\": formatPeriod,\n    \"q\": formatQuarter,\n    \"Q\": formatUnixTimestamp,\n    \"s\": formatUnixTimestampSeconds,\n    \"S\": formatSeconds,\n    \"u\": formatWeekdayNumberMonday,\n    \"U\": formatWeekNumberSunday,\n    \"V\": formatWeekNumberISO,\n    \"w\": formatWeekdayNumberSunday,\n    \"W\": formatWeekNumberMonday,\n    \"x\": null,\n    \"X\": null,\n    \"y\": formatYear,\n    \"Y\": formatFullYear,\n    \"Z\": formatZone,\n    \"%\": formatLiteralPercent\n  };\n\n  var utcFormats = {\n    \"a\": formatUTCShortWeekday,\n    \"A\": formatUTCWeekday,\n    \"b\": formatUTCShortMonth,\n    \"B\": formatUTCMonth,\n    \"c\": null,\n    \"d\": formatUTCDayOfMonth,\n    \"e\": formatUTCDayOfMonth,\n    \"f\": formatUTCMicroseconds,\n    \"g\": formatUTCYearISO,\n    \"G\": formatUTCFullYearISO,\n    \"H\": formatUTCHour24,\n    \"I\": formatUTCHour12,\n    \"j\": formatUTCDayOfYear,\n    \"L\": formatUTCMilliseconds,\n    \"m\": formatUTCMonthNumber,\n    \"M\": formatUTCMinutes,\n    \"p\": formatUTCPeriod,\n    \"q\": formatUTCQuarter,\n    \"Q\": formatUnixTimestamp,\n    \"s\": formatUnixTimestampSeconds,\n    \"S\": formatUTCSeconds,\n    \"u\": formatUTCWeekdayNumberMonday,\n    \"U\": formatUTCWeekNumberSunday,\n    \"V\": formatUTCWeekNumberISO,\n    \"w\": formatUTCWeekdayNumberSunday,\n    \"W\": formatUTCWeekNumberMonday,\n    \"x\": null,\n    \"X\": null,\n    \"y\": formatUTCYear,\n    \"Y\": formatUTCFullYear,\n    \"Z\": formatUTCZone,\n    \"%\": formatLiteralPercent\n  };\n\n  var parses = {\n    \"a\": parseShortWeekday,\n    \"A\": parseWeekday,\n    \"b\": parseShortMonth,\n    \"B\": parseMonth,\n    \"c\": parseLocaleDateTime,\n    \"d\": parseDayOfMonth,\n    \"e\": parseDayOfMonth,\n    \"f\": parseMicroseconds,\n    \"g\": parseYear,\n    \"G\": parseFullYear,\n    \"H\": parseHour24,\n    \"I\": parseHour24,\n    \"j\": parseDayOfYear,\n    \"L\": parseMilliseconds,\n    \"m\": parseMonthNumber,\n    \"M\": parseMinutes,\n    \"p\": parsePeriod,\n    \"q\": parseQuarter,\n    \"Q\": parseUnixTimestamp,\n    \"s\": parseUnixTimestampSeconds,\n    \"S\": parseSeconds,\n    \"u\": parseWeekdayNumberMonday,\n    \"U\": parseWeekNumberSunday,\n    \"V\": parseWeekNumberISO,\n    \"w\": parseWeekdayNumberSunday,\n    \"W\": parseWeekNumberMonday,\n    \"x\": parseLocaleDate,\n    \"X\": parseLocaleTime,\n    \"y\": parseYear,\n    \"Y\": parseFullYear,\n    \"Z\": parseZone,\n    \"%\": parseLiteralPercent\n  };\n\n  // These recursive directive definitions must be deferred.\n  formats.x = newFormat(locale_date, formats);\n  formats.X = newFormat(locale_time, formats);\n  formats.c = newFormat(locale_dateTime, formats);\n  utcFormats.x = newFormat(locale_date, utcFormats);\n  utcFormats.X = newFormat(locale_time, utcFormats);\n  utcFormats.c = newFormat(locale_dateTime, utcFormats);\n\n  function newFormat(specifier, formats) {\n    return function(date) {\n      var string = [],\n          i = -1,\n          j = 0,\n          n = specifier.length,\n          c,\n          pad,\n          format;\n\n      if (!(date instanceof Date)) date = new Date(+date);\n\n      while (++i < n) {\n        if (specifier.charCodeAt(i) === 37) {\n          string.push(specifier.slice(j, i));\n          if ((pad = pads[c = specifier.charAt(++i)]) != null) c = specifier.charAt(++i);\n          else pad = c === \"e\" ? \" \" : \"0\";\n          if (format = formats[c]) c = format(date, pad);\n          string.push(c);\n          j = i + 1;\n        }\n      }\n\n      string.push(specifier.slice(j, i));\n      return string.join(\"\");\n    };\n  }\n\n  function newParse(specifier, Z) {\n    return function(string) {\n      var d = newDate(1900, undefined, 1),\n          i = parseSpecifier(d, specifier, string += \"\", 0),\n          week, day;\n      if (i != string.length) return null;\n\n      // If a UNIX timestamp is specified, return it.\n      if (\"Q\" in d) return new Date(d.Q);\n      if (\"s\" in d) return new Date(d.s * 1000 + (\"L\" in d ? d.L : 0));\n\n      // If this is utcParse, never use the local timezone.\n      if (Z && !(\"Z\" in d)) d.Z = 0;\n\n      // The am-pm flag is 0 for AM, and 1 for PM.\n      if (\"p\" in d) d.H = d.H % 12 + d.p * 12;\n\n      // If the month was not specified, inherit from the quarter.\n      if (d.m === undefined) d.m = \"q\" in d ? d.q : 0;\n\n      // Convert day-of-week and week-of-year to day-of-year.\n      if (\"V\" in d) {\n        if (d.V < 1 || d.V > 53) return null;\n        if (!(\"w\" in d)) d.w = 1;\n        if (\"Z\" in d) {\n          week = utcDate(newDate(d.y, 0, 1)), day = week.getUTCDay();\n          week = day > 4 || day === 0 ? utcMonday.ceil(week) : utcMonday(week);\n          week = utcDay.offset(week, (d.V - 1) * 7);\n          d.y = week.getUTCFullYear();\n          d.m = week.getUTCMonth();\n          d.d = week.getUTCDate() + (d.w + 6) % 7;\n        } else {\n          week = localDate(newDate(d.y, 0, 1)), day = week.getDay();\n          week = day > 4 || day === 0 ? timeMonday.ceil(week) : timeMonday(week);\n          week = timeDay.offset(week, (d.V - 1) * 7);\n          d.y = week.getFullYear();\n          d.m = week.getMonth();\n          d.d = week.getDate() + (d.w + 6) % 7;\n        }\n      } else if (\"W\" in d || \"U\" in d) {\n        if (!(\"w\" in d)) d.w = \"u\" in d ? d.u % 7 : \"W\" in d ? 1 : 0;\n        day = \"Z\" in d ? utcDate(newDate(d.y, 0, 1)).getUTCDay() : localDate(newDate(d.y, 0, 1)).getDay();\n        d.m = 0;\n        d.d = \"W\" in d ? (d.w + 6) % 7 + d.W * 7 - (day + 5) % 7 : d.w + d.U * 7 - (day + 6) % 7;\n      }\n\n      // If a time zone is specified, all fields are interpreted as UTC and then\n      // offset according to the specified time zone.\n      if (\"Z\" in d) {\n        d.H += d.Z / 100 | 0;\n        d.M += d.Z % 100;\n        return utcDate(d);\n      }\n\n      // Otherwise, all fields are in local time.\n      return localDate(d);\n    };\n  }\n\n  function parseSpecifier(d, specifier, string, j) {\n    var i = 0,\n        n = specifier.length,\n        m = string.length,\n        c,\n        parse;\n\n    while (i < n) {\n      if (j >= m) return -1;\n      c = specifier.charCodeAt(i++);\n      if (c === 37) {\n        c = specifier.charAt(i++);\n        parse = parses[c in pads ? specifier.charAt(i++) : c];\n        if (!parse || ((j = parse(d, string, j)) < 0)) return -1;\n      } else if (c != string.charCodeAt(j++)) {\n        return -1;\n      }\n    }\n\n    return j;\n  }\n\n  function parsePeriod(d, string, i) {\n    var n = periodRe.exec(string.slice(i));\n    return n ? (d.p = periodLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseShortWeekday(d, string, i) {\n    var n = shortWeekdayRe.exec(string.slice(i));\n    return n ? (d.w = shortWeekdayLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseWeekday(d, string, i) {\n    var n = weekdayRe.exec(string.slice(i));\n    return n ? (d.w = weekdayLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseShortMonth(d, string, i) {\n    var n = shortMonthRe.exec(string.slice(i));\n    return n ? (d.m = shortMonthLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseMonth(d, string, i) {\n    var n = monthRe.exec(string.slice(i));\n    return n ? (d.m = monthLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseLocaleDateTime(d, string, i) {\n    return parseSpecifier(d, locale_dateTime, string, i);\n  }\n\n  function parseLocaleDate(d, string, i) {\n    return parseSpecifier(d, locale_date, string, i);\n  }\n\n  function parseLocaleTime(d, string, i) {\n    return parseSpecifier(d, locale_time, string, i);\n  }\n\n  function formatShortWeekday(d) {\n    return locale_shortWeekdays[d.getDay()];\n  }\n\n  function formatWeekday(d) {\n    return locale_weekdays[d.getDay()];\n  }\n\n  function formatShortMonth(d) {\n    return locale_shortMonths[d.getMonth()];\n  }\n\n  function formatMonth(d) {\n    return locale_months[d.getMonth()];\n  }\n\n  function formatPeriod(d) {\n    return locale_periods[+(d.getHours() >= 12)];\n  }\n\n  function formatQuarter(d) {\n    return 1 + ~~(d.getMonth() / 3);\n  }\n\n  function formatUTCShortWeekday(d) {\n    return locale_shortWeekdays[d.getUTCDay()];\n  }\n\n  function formatUTCWeekday(d) {\n    return locale_weekdays[d.getUTCDay()];\n  }\n\n  function formatUTCShortMonth(d) {\n    return locale_shortMonths[d.getUTCMonth()];\n  }\n\n  function formatUTCMonth(d) {\n    return locale_months[d.getUTCMonth()];\n  }\n\n  function formatUTCPeriod(d) {\n    return locale_periods[+(d.getUTCHours() >= 12)];\n  }\n\n  function formatUTCQuarter(d) {\n    return 1 + ~~(d.getUTCMonth() / 3);\n  }\n\n  return {\n    format: function(specifier) {\n      var f = newFormat(specifier += \"\", formats);\n      f.toString = function() { return specifier; };\n      return f;\n    },\n    parse: function(specifier) {\n      var p = newParse(specifier += \"\", false);\n      p.toString = function() { return specifier; };\n      return p;\n    },\n    utcFormat: function(specifier) {\n      var f = newFormat(specifier += \"\", utcFormats);\n      f.toString = function() { return specifier; };\n      return f;\n    },\n    utcParse: function(specifier) {\n      var p = newParse(specifier += \"\", true);\n      p.toString = function() { return specifier; };\n      return p;\n    }\n  };\n}\n\nvar pads = {\"-\": \"\", \"_\": \" \", \"0\": \"0\"},\n    numberRe = /^\\s*\\d+/, // note: ignores next directive\n    percentRe = /^%/,\n    requoteRe = /[\\\\^$*+?|[\\]().{}]/g;\n\nfunction pad(value, fill, width) {\n  var sign = value < 0 ? \"-\" : \"\",\n      string = (sign ? -value : value) + \"\",\n      length = string.length;\n  return sign + (length < width ? new Array(width - length + 1).join(fill) + string : string);\n}\n\nfunction requote(s) {\n  return s.replace(requoteRe, \"\\\\$&\");\n}\n\nfunction formatRe(names) {\n  return new RegExp(\"^(?:\" + names.map(requote).join(\"|\") + \")\", \"i\");\n}\n\nfunction formatLookup(names) {\n  return new Map(names.map((name, i) => [name.toLowerCase(), i]));\n}\n\nfunction parseWeekdayNumberSunday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.w = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekdayNumberMonday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.u = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberSunday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.U = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberISO(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.V = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberMonday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.W = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseFullYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 4));\n  return n ? (d.y = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.y = +n[0] + (+n[0] > 68 ? 1900 : 2000), i + n[0].length) : -1;\n}\n\nfunction parseZone(d, string, i) {\n  var n = /^(Z)|([+-]\\d\\d)(?::?(\\d\\d))?/.exec(string.slice(i, i + 6));\n  return n ? (d.Z = n[1] ? 0 : -(n[2] + (n[3] || \"00\")), i + n[0].length) : -1;\n}\n\nfunction parseQuarter(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.q = n[0] * 3 - 3, i + n[0].length) : -1;\n}\n\nfunction parseMonthNumber(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.m = n[0] - 1, i + n[0].length) : -1;\n}\n\nfunction parseDayOfMonth(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.d = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseDayOfYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 3));\n  return n ? (d.m = 0, d.d = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseHour24(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.H = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMinutes(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.M = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseSeconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.S = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMilliseconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 3));\n  return n ? (d.L = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMicroseconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 6));\n  return n ? (d.L = Math.floor(n[0] / 1000), i + n[0].length) : -1;\n}\n\nfunction parseLiteralPercent(d, string, i) {\n  var n = percentRe.exec(string.slice(i, i + 1));\n  return n ? i + n[0].length : -1;\n}\n\nfunction parseUnixTimestamp(d, string, i) {\n  var n = numberRe.exec(string.slice(i));\n  return n ? (d.Q = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseUnixTimestampSeconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i));\n  return n ? (d.s = +n[0], i + n[0].length) : -1;\n}\n\nfunction formatDayOfMonth(d, p) {\n  return pad(d.getDate(), p, 2);\n}\n\nfunction formatHour24(d, p) {\n  return pad(d.getHours(), p, 2);\n}\n\nfunction formatHour12(d, p) {\n  return pad(d.getHours() % 12 || 12, p, 2);\n}\n\nfunction formatDayOfYear(d, p) {\n  return pad(1 + timeDay.count(timeYear(d), d), p, 3);\n}\n\nfunction formatMilliseconds(d, p) {\n  return pad(d.getMilliseconds(), p, 3);\n}\n\nfunction formatMicroseconds(d, p) {\n  return formatMilliseconds(d, p) + \"000\";\n}\n\nfunction formatMonthNumber(d, p) {\n  return pad(d.getMonth() + 1, p, 2);\n}\n\nfunction formatMinutes(d, p) {\n  return pad(d.getMinutes(), p, 2);\n}\n\nfunction formatSeconds(d, p) {\n  return pad(d.getSeconds(), p, 2);\n}\n\nfunction formatWeekdayNumberMonday(d) {\n  var day = d.getDay();\n  return day === 0 ? 7 : day;\n}\n\nfunction formatWeekNumberSunday(d, p) {\n  return pad(timeSunday.count(timeYear(d) - 1, d), p, 2);\n}\n\nfunction dISO(d) {\n  var day = d.getDay();\n  return (day >= 4 || day === 0) ? timeThursday(d) : timeThursday.ceil(d);\n}\n\nfunction formatWeekNumberISO(d, p) {\n  d = dISO(d);\n  return pad(timeThursday.count(timeYear(d), d) + (timeYear(d).getDay() === 4), p, 2);\n}\n\nfunction formatWeekdayNumberSunday(d) {\n  return d.getDay();\n}\n\nfunction formatWeekNumberMonday(d, p) {\n  return pad(timeMonday.count(timeYear(d) - 1, d), p, 2);\n}\n\nfunction formatYear(d, p) {\n  return pad(d.getFullYear() % 100, p, 2);\n}\n\nfunction formatYearISO(d, p) {\n  d = dISO(d);\n  return pad(d.getFullYear() % 100, p, 2);\n}\n\nfunction formatFullYear(d, p) {\n  return pad(d.getFullYear() % 10000, p, 4);\n}\n\nfunction formatFullYearISO(d, p) {\n  var day = d.getDay();\n  d = (day >= 4 || day === 0) ? timeThursday(d) : timeThursday.ceil(d);\n  return pad(d.getFullYear() % 10000, p, 4);\n}\n\nfunction formatZone(d) {\n  var z = d.getTimezoneOffset();\n  return (z > 0 ? \"-\" : (z *= -1, \"+\"))\n      + pad(z / 60 | 0, \"0\", 2)\n      + pad(z % 60, \"0\", 2);\n}\n\nfunction formatUTCDayOfMonth(d, p) {\n  return pad(d.getUTCDate(), p, 2);\n}\n\nfunction formatUTCHour24(d, p) {\n  return pad(d.getUTCHours(), p, 2);\n}\n\nfunction formatUTCHour12(d, p) {\n  return pad(d.getUTCHours() % 12 || 12, p, 2);\n}\n\nfunction formatUTCDayOfYear(d, p) {\n  return pad(1 + utcDay.count(utcYear(d), d), p, 3);\n}\n\nfunction formatUTCMilliseconds(d, p) {\n  return pad(d.getUTCMilliseconds(), p, 3);\n}\n\nfunction formatUTCMicroseconds(d, p) {\n  return formatUTCMilliseconds(d, p) + \"000\";\n}\n\nfunction formatUTCMonthNumber(d, p) {\n  return pad(d.getUTCMonth() + 1, p, 2);\n}\n\nfunction formatUTCMinutes(d, p) {\n  return pad(d.getUTCMinutes(), p, 2);\n}\n\nfunction formatUTCSeconds(d, p) {\n  return pad(d.getUTCSeconds(), p, 2);\n}\n\nfunction formatUTCWeekdayNumberMonday(d) {\n  var dow = d.getUTCDay();\n  return dow === 0 ? 7 : dow;\n}\n\nfunction formatUTCWeekNumberSunday(d, p) {\n  return pad(utcSunday.count(utcYear(d) - 1, d), p, 2);\n}\n\nfunction UTCdISO(d) {\n  var day = d.getUTCDay();\n  return (day >= 4 || day === 0) ? utcThursday(d) : utcThursday.ceil(d);\n}\n\nfunction formatUTCWeekNumberISO(d, p) {\n  d = UTCdISO(d);\n  return pad(utcThursday.count(utcYear(d), d) + (utcYear(d).getUTCDay() === 4), p, 2);\n}\n\nfunction formatUTCWeekdayNumberSunday(d) {\n  return d.getUTCDay();\n}\n\nfunction formatUTCWeekNumberMonday(d, p) {\n  return pad(utcMonday.count(utcYear(d) - 1, d), p, 2);\n}\n\nfunction formatUTCYear(d, p) {\n  return pad(d.getUTCFullYear() % 100, p, 2);\n}\n\nfunction formatUTCYearISO(d, p) {\n  d = UTCdISO(d);\n  return pad(d.getUTCFullYear() % 100, p, 2);\n}\n\nfunction formatUTCFullYear(d, p) {\n  return pad(d.getUTCFullYear() % 10000, p, 4);\n}\n\nfunction formatUTCFullYearISO(d, p) {\n  var day = d.getUTCDay();\n  d = (day >= 4 || day === 0) ? utcThursday(d) : utcThursday.ceil(d);\n  return pad(d.getUTCFullYear() % 10000, p, 4);\n}\n\nfunction formatUTCZone() {\n  return \"+0000\";\n}\n\nfunction formatLiteralPercent() {\n  return \"%\";\n}\n\nfunction formatUnixTimestamp(d) {\n  return +d;\n}\n\nfunction formatUnixTimestampSeconds(d) {\n  return Math.floor(+d / 1000);\n}\n","import formatLocale from \"./locale.js\";\n\nvar locale;\nexport var timeFormat;\nexport var timeParse;\nexport var utcFormat;\nexport var utcParse;\n\ndefaultLocale({\n  dateTime: \"%x, %X\",\n  date: \"%-m/%-d/%Y\",\n  time: \"%-I:%M:%S %p\",\n  periods: [\"AM\", \"PM\"],\n  days: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"],\n  shortDays: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\n  months: [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\n  shortMonths: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\n});\n\nexport default function defaultLocale(definition) {\n  locale = formatLocale(definition);\n  timeFormat = locale.format;\n  timeParse = locale.parse;\n  utcFormat = locale.utcFormat;\n  utcParse = locale.utcParse;\n  return locale;\n}\n","import {timeYear, timeMonth, timeWeek, timeDay, timeHour, timeMinute, timeSecond, timeTicks, timeTickInterval} from \"d3-time\";\nimport {timeFormat} from \"d3-time-format\";\nimport continuous, {copy} from \"./continuous.js\";\nimport {initRange} from \"./init.js\";\nimport nice from \"./nice.js\";\n\nfunction date(t) {\n  return new Date(t);\n}\n\nfunction number(t) {\n  return t instanceof Date ? +t : +new Date(+t);\n}\n\nexport function calendar(ticks, tickInterval, year, month, week, day, hour, minute, second, format) {\n  var scale = continuous(),\n      invert = scale.invert,\n      domain = scale.domain;\n\n  var formatMillisecond = format(\".%L\"),\n      formatSecond = format(\":%S\"),\n      formatMinute = format(\"%I:%M\"),\n      formatHour = format(\"%I %p\"),\n      formatDay = format(\"%a %d\"),\n      formatWeek = format(\"%b %d\"),\n      formatMonth = format(\"%B\"),\n      formatYear = format(\"%Y\");\n\n  function tickFormat(date) {\n    return (second(date) < date ? formatMillisecond\n        : minute(date) < date ? formatSecond\n        : hour(date) < date ? formatMinute\n        : day(date) < date ? formatHour\n        : month(date) < date ? (week(date) < date ? formatDay : formatWeek)\n        : year(date) < date ? formatMonth\n        : formatYear)(date);\n  }\n\n  scale.invert = function(y) {\n    return new Date(invert(y));\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? domain(Array.from(_, number)) : domain().map(date);\n  };\n\n  scale.ticks = function(interval) {\n    var d = domain();\n    return ticks(d[0], d[d.length - 1], interval == null ? 10 : interval);\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    return specifier == null ? tickFormat : format(specifier);\n  };\n\n  scale.nice = function(interval) {\n    var d = domain();\n    if (!interval || typeof interval.range !== \"function\") interval = tickInterval(d[0], d[d.length - 1], interval == null ? 10 : interval);\n    return interval ? domain(nice(d, interval)) : scale;\n  };\n\n  scale.copy = function() {\n    return copy(scale, calendar(ticks, tickInterval, year, month, week, day, hour, minute, second, format));\n  };\n\n  return scale;\n}\n\nexport default function time() {\n  return initRange.apply(calendar(timeTicks, timeTickInterval, timeYear, timeMonth, timeWeek, timeDay, timeHour, timeMinute, timeSecond, timeFormat).domain([new Date(2000, 0, 1), new Date(2000, 0, 2)]), arguments);\n}\n","export default function(x) {\n  return function constant() {\n    return x;\n  };\n}\n","const pi = Math.PI,\n    tau = 2 * pi,\n    epsilon = 1e-6,\n    tauEpsilon = tau - epsilon;\n\nfunction append(strings) {\n  this._ += strings[0];\n  for (let i = 1, n = strings.length; i < n; ++i) {\n    this._ += arguments[i] + strings[i];\n  }\n}\n\nfunction appendRound(digits) {\n  let d = Math.floor(digits);\n  if (!(d >= 0)) throw new Error(`invalid digits: ${digits}`);\n  if (d > 15) return append;\n  const k = 10 ** d;\n  return function(strings) {\n    this._ += strings[0];\n    for (let i = 1, n = strings.length; i < n; ++i) {\n      this._ += Math.round(arguments[i] * k) / k + strings[i];\n    }\n  };\n}\n\nexport class Path {\n  constructor(digits) {\n    this._x0 = this._y0 = // start of current subpath\n    this._x1 = this._y1 = null; // end of current subpath\n    this._ = \"\";\n    this._append = digits == null ? append : appendRound(digits);\n  }\n  moveTo(x, y) {\n    this._append`M${this._x0 = this._x1 = +x},${this._y0 = this._y1 = +y}`;\n  }\n  closePath() {\n    if (this._x1 !== null) {\n      this._x1 = this._x0, this._y1 = this._y0;\n      this._append`Z`;\n    }\n  }\n  lineTo(x, y) {\n    this._append`L${this._x1 = +x},${this._y1 = +y}`;\n  }\n  quadraticCurveTo(x1, y1, x, y) {\n    this._append`Q${+x1},${+y1},${this._x1 = +x},${this._y1 = +y}`;\n  }\n  bezierCurveTo(x1, y1, x2, y2, x, y) {\n    this._append`C${+x1},${+y1},${+x2},${+y2},${this._x1 = +x},${this._y1 = +y}`;\n  }\n  arcTo(x1, y1, x2, y2, r) {\n    x1 = +x1, y1 = +y1, x2 = +x2, y2 = +y2, r = +r;\n\n    // Is the radius negative? Error.\n    if (r < 0) throw new Error(`negative radius: ${r}`);\n\n    let x0 = this._x1,\n        y0 = this._y1,\n        x21 = x2 - x1,\n        y21 = y2 - y1,\n        x01 = x0 - x1,\n        y01 = y0 - y1,\n        l01_2 = x01 * x01 + y01 * y01;\n\n    // Is this path empty? Move to (x1,y1).\n    if (this._x1 === null) {\n      this._append`M${this._x1 = x1},${this._y1 = y1}`;\n    }\n\n    // Or, is (x1,y1) coincident with (x0,y0)? Do nothing.\n    else if (!(l01_2 > epsilon));\n\n    // Or, are (x0,y0), (x1,y1) and (x2,y2) collinear?\n    // Equivalently, is (x1,y1) coincident with (x2,y2)?\n    // Or, is the radius zero? Line to (x1,y1).\n    else if (!(Math.abs(y01 * x21 - y21 * x01) > epsilon) || !r) {\n      this._append`L${this._x1 = x1},${this._y1 = y1}`;\n    }\n\n    // Otherwise, draw an arc!\n    else {\n      let x20 = x2 - x0,\n          y20 = y2 - y0,\n          l21_2 = x21 * x21 + y21 * y21,\n          l20_2 = x20 * x20 + y20 * y20,\n          l21 = Math.sqrt(l21_2),\n          l01 = Math.sqrt(l01_2),\n          l = r * Math.tan((pi - Math.acos((l21_2 + l01_2 - l20_2) / (2 * l21 * l01))) / 2),\n          t01 = l / l01,\n          t21 = l / l21;\n\n      // If the start tangent is not coincident with (x0,y0), line to.\n      if (Math.abs(t01 - 1) > epsilon) {\n        this._append`L${x1 + t01 * x01},${y1 + t01 * y01}`;\n      }\n\n      this._append`A${r},${r},0,0,${+(y01 * x20 > x01 * y20)},${this._x1 = x1 + t21 * x21},${this._y1 = y1 + t21 * y21}`;\n    }\n  }\n  arc(x, y, r, a0, a1, ccw) {\n    x = +x, y = +y, r = +r, ccw = !!ccw;\n\n    // Is the radius negative? Error.\n    if (r < 0) throw new Error(`negative radius: ${r}`);\n\n    let dx = r * Math.cos(a0),\n        dy = r * Math.sin(a0),\n        x0 = x + dx,\n        y0 = y + dy,\n        cw = 1 ^ ccw,\n        da = ccw ? a0 - a1 : a1 - a0;\n\n    // Is this path empty? Move to (x0,y0).\n    if (this._x1 === null) {\n      this._append`M${x0},${y0}`;\n    }\n\n    // Or, is (x0,y0) not coincident with the previous point? Line to (x0,y0).\n    else if (Math.abs(this._x1 - x0) > epsilon || Math.abs(this._y1 - y0) > epsilon) {\n      this._append`L${x0},${y0}`;\n    }\n\n    // Is this arc empty? We’re done.\n    if (!r) return;\n\n    // Does the angle go the wrong way? Flip the direction.\n    if (da < 0) da = da % tau + tau;\n\n    // Is this a complete circle? Draw two arcs to complete the circle.\n    if (da > tauEpsilon) {\n      this._append`A${r},${r},0,1,${cw},${x - dx},${y - dy}A${r},${r},0,1,${cw},${this._x1 = x0},${this._y1 = y0}`;\n    }\n\n    // Is this arc non-empty? Draw an arc!\n    else if (da > epsilon) {\n      this._append`A${r},${r},0,${+(da >= pi)},${cw},${this._x1 = x + r * Math.cos(a1)},${this._y1 = y + r * Math.sin(a1)}`;\n    }\n  }\n  rect(x, y, w, h) {\n    this._append`M${this._x0 = this._x1 = +x},${this._y0 = this._y1 = +y}h${w = +w}v${+h}h${-w}Z`;\n  }\n  toString() {\n    return this._;\n  }\n}\n\nexport function path() {\n  return new Path;\n}\n\n// Allow instanceof d3.path\npath.prototype = Path.prototype;\n\nexport function pathRound(digits = 3) {\n  return new Path(+digits);\n}\n","import {Path} from \"d3-path\";\n\nexport function withPath(shape) {\n  let digits = 3;\n\n  shape.digits = function(_) {\n    if (!arguments.length) return digits;\n    if (_ == null) {\n      digits = null;\n    } else {\n      const d = Math.floor(_);\n      if (!(d >= 0)) throw new RangeError(`invalid digits: ${_}`);\n      digits = d;\n    }\n    return shape;\n  };\n\n  return () => new Path(digits);\n}\n","export var slice = Array.prototype.slice;\n\nexport default function(x) {\n  return typeof x === \"object\" && \"length\" in x\n    ? x // Array, TypedArray, NodeList, array-like\n    : Array.from(x); // Map, Set, iterable, string, or anything else\n}\n","function Linear(context) {\n  this._context = context;\n}\n\nLinear.prototype = {\n  areaStart: function() {\n    this._line = 0;\n  },\n  areaEnd: function() {\n    this._line = NaN;\n  },\n  lineStart: function() {\n    this._point = 0;\n  },\n  lineEnd: function() {\n    if (this._line || (this._line !== 0 && this._point === 1)) this._context.closePath();\n    this._line = 1 - this._line;\n  },\n  point: function(x, y) {\n    x = +x, y = +y;\n    switch (this._point) {\n      case 0: this._point = 1; this._line ? this._context.lineTo(x, y) : this._context.moveTo(x, y); break;\n      case 1: this._point = 2; // falls through\n      default: this._context.lineTo(x, y); break;\n    }\n  }\n};\n\nexport default function(context) {\n  return new Linear(context);\n}\n","export function x(p) {\n  return p[0];\n}\n\nexport function y(p) {\n  return p[1];\n}\n","import array from \"./array.js\";\nimport constant from \"./constant.js\";\nimport curveLinear from \"./curve/linear.js\";\nimport {withPath} from \"./path.js\";\nimport {x as pointX, y as pointY} from \"./point.js\";\n\nexport default function(x, y) {\n  var defined = constant(true),\n      context = null,\n      curve = curveLinear,\n      output = null,\n      path = withPath(line);\n\n  x = typeof x === \"function\" ? x : (x === undefined) ? pointX : constant(x);\n  y = typeof y === \"function\" ? y : (y === undefined) ? pointY : constant(y);\n\n  function line(data) {\n    var i,\n        n = (data = array(data)).length,\n        d,\n        defined0 = false,\n        buffer;\n\n    if (context == null) output = curve(buffer = path());\n\n    for (i = 0; i <= n; ++i) {\n      if (!(i < n && defined(d = data[i], i, data)) === defined0) {\n        if (defined0 = !defined0) output.lineStart();\n        else output.lineEnd();\n      }\n      if (defined0) output.point(+x(d, i, data), +y(d, i, data));\n    }\n\n    if (buffer) return output = null, buffer + \"\" || null;\n  }\n\n  line.x = function(_) {\n    return arguments.length ? (x = typeof _ === \"function\" ? _ : constant(+_), line) : x;\n  };\n\n  line.y = function(_) {\n    return arguments.length ? (y = typeof _ === \"function\" ? _ : constant(+_), line) : y;\n  };\n\n  line.defined = function(_) {\n    return arguments.length ? (defined = typeof _ === \"function\" ? _ : constant(!!_), line) : defined;\n  };\n\n  line.curve = function(_) {\n    return arguments.length ? (curve = _, context != null && (output = curve(context)), line) : curve;\n  };\n\n  line.context = function(_) {\n    return arguments.length ? (_ == null ? context = output = null : output = curve(context = _), line) : context;\n  };\n\n  return line;\n}\n","import array from \"./array.js\";\nimport constant from \"./constant.js\";\nimport curveLinear from \"./curve/linear.js\";\nimport line from \"./line.js\";\nimport {withPath} from \"./path.js\";\nimport {x as pointX, y as pointY} from \"./point.js\";\n\nexport default function(x0, y0, y1) {\n  var x1 = null,\n      defined = constant(true),\n      context = null,\n      curve = curveLinear,\n      output = null,\n      path = withPath(area);\n\n  x0 = typeof x0 === \"function\" ? x0 : (x0 === undefined) ? pointX : constant(+x0);\n  y0 = typeof y0 === \"function\" ? y0 : (y0 === undefined) ? constant(0) : constant(+y0);\n  y1 = typeof y1 === \"function\" ? y1 : (y1 === undefined) ? pointY : constant(+y1);\n\n  function area(data) {\n    var i,\n        j,\n        k,\n        n = (data = array(data)).length,\n        d,\n        defined0 = false,\n        buffer,\n        x0z = new Array(n),\n        y0z = new Array(n);\n\n    if (context == null) output = curve(buffer = path());\n\n    for (i = 0; i <= n; ++i) {\n      if (!(i < n && defined(d = data[i], i, data)) === defined0) {\n        if (defined0 = !defined0) {\n          j = i;\n          output.areaStart();\n          output.lineStart();\n        } else {\n          output.lineEnd();\n          output.lineStart();\n          for (k = i - 1; k >= j; --k) {\n            output.point(x0z[k], y0z[k]);\n          }\n          output.lineEnd();\n          output.areaEnd();\n        }\n      }\n      if (defined0) {\n        x0z[i] = +x0(d, i, data), y0z[i] = +y0(d, i, data);\n        output.point(x1 ? +x1(d, i, data) : x0z[i], y1 ? +y1(d, i, data) : y0z[i]);\n      }\n    }\n\n    if (buffer) return output = null, buffer + \"\" || null;\n  }\n\n  function arealine() {\n    return line().defined(defined).curve(curve).context(context);\n  }\n\n  area.x = function(_) {\n    return arguments.length ? (x0 = typeof _ === \"function\" ? _ : constant(+_), x1 = null, area) : x0;\n  };\n\n  area.x0 = function(_) {\n    return arguments.length ? (x0 = typeof _ === \"function\" ? _ : constant(+_), area) : x0;\n  };\n\n  area.x1 = function(_) {\n    return arguments.length ? (x1 = _ == null ? null : typeof _ === \"function\" ? _ : constant(+_), area) : x1;\n  };\n\n  area.y = function(_) {\n    return arguments.length ? (y0 = typeof _ === \"function\" ? _ : constant(+_), y1 = null, area) : y0;\n  };\n\n  area.y0 = function(_) {\n    return arguments.length ? (y0 = typeof _ === \"function\" ? _ : constant(+_), area) : y0;\n  };\n\n  area.y1 = function(_) {\n    return arguments.length ? (y1 = _ == null ? null : typeof _ === \"function\" ? _ : constant(+_), area) : y1;\n  };\n\n  area.lineX0 =\n  area.lineY0 = function() {\n    return arealine().x(x0).y(y0);\n  };\n\n  area.lineY1 = function() {\n    return arealine().x(x0).y(y1);\n  };\n\n  area.lineX1 = function() {\n    return arealine().x(x1).y(y0);\n  };\n\n  area.defined = function(_) {\n    return arguments.length ? (defined = typeof _ === \"function\" ? _ : constant(!!_), area) : defined;\n  };\n\n  area.curve = function(_) {\n    return arguments.length ? (curve = _, context != null && (output = curve(context)), area) : curve;\n  };\n\n  area.context = function(_) {\n    return arguments.length ? (_ == null ? context = output = null : output = curve(context = _), area) : context;\n  };\n\n  return area;\n}\n","function sign(x) {\n  return x < 0 ? -1 : 1;\n}\n\n// Calculate the slopes of the tangents (Hermite-type interpolation) based on\n// the following paper: Steffen, M. 1990. A Simple Method for Monotonic\n// Interpolation in One Dimension. Astronomy and Astrophysics, Vol. 239, NO.\n// NOV(II), P. 443, 1990.\nfunction slope3(that, x2, y2) {\n  var h0 = that._x1 - that._x0,\n      h1 = x2 - that._x1,\n      s0 = (that._y1 - that._y0) / (h0 || h1 < 0 && -0),\n      s1 = (y2 - that._y1) / (h1 || h0 < 0 && -0),\n      p = (s0 * h1 + s1 * h0) / (h0 + h1);\n  return (sign(s0) + sign(s1)) * Math.min(Math.abs(s0), Math.abs(s1), 0.5 * Math.abs(p)) || 0;\n}\n\n// Calculate a one-sided slope.\nfunction slope2(that, t) {\n  var h = that._x1 - that._x0;\n  return h ? (3 * (that._y1 - that._y0) / h - t) / 2 : t;\n}\n\n// According to https://en.wikipedia.org/wiki/Cubic_Hermite_spline#Representations\n// \"you can express cubic Hermite interpolation in terms of cubic Bézier curves\n// with respect to the four values p0, p0 + m0 / 3, p1 - m1 / 3, p1\".\nfunction point(that, t0, t1) {\n  var x0 = that._x0,\n      y0 = that._y0,\n      x1 = that._x1,\n      y1 = that._y1,\n      dx = (x1 - x0) / 3;\n  that._context.bezierCurveTo(x0 + dx, y0 + dx * t0, x1 - dx, y1 - dx * t1, x1, y1);\n}\n\nfunction MonotoneX(context) {\n  this._context = context;\n}\n\nMonotoneX.prototype = {\n  areaStart: function() {\n    this._line = 0;\n  },\n  areaEnd: function() {\n    this._line = NaN;\n  },\n  lineStart: function() {\n    this._x0 = this._x1 =\n    this._y0 = this._y1 =\n    this._t0 = NaN;\n    this._point = 0;\n  },\n  lineEnd: function() {\n    switch (this._point) {\n      case 2: this._context.lineTo(this._x1, this._y1); break;\n      case 3: point(this, this._t0, slope2(this, this._t0)); break;\n    }\n    if (this._line || (this._line !== 0 && this._point === 1)) this._context.closePath();\n    this._line = 1 - this._line;\n  },\n  point: function(x, y) {\n    var t1 = NaN;\n\n    x = +x, y = +y;\n    if (x === this._x1 && y === this._y1) return; // Ignore coincident points.\n    switch (this._point) {\n      case 0: this._point = 1; this._line ? this._context.lineTo(x, y) : this._context.moveTo(x, y); break;\n      case 1: this._point = 2; break;\n      case 2: this._point = 3; point(this, slope2(this, t1 = slope3(this, x, y)), t1); break;\n      default: point(this, this._t0, t1 = slope3(this, x, y)); break;\n    }\n\n    this._x0 = this._x1, this._x1 = x;\n    this._y0 = this._y1, this._y1 = y;\n    this._t0 = t1;\n  }\n}\n\nfunction MonotoneY(context) {\n  this._context = new ReflectContext(context);\n}\n\n(MonotoneY.prototype = Object.create(MonotoneX.prototype)).point = function(x, y) {\n  MonotoneX.prototype.point.call(this, y, x);\n};\n\nfunction ReflectContext(context) {\n  this._context = context;\n}\n\nReflectContext.prototype = {\n  moveTo: function(x, y) { this._context.moveTo(y, x); },\n  closePath: function() { this._context.closePath(); },\n  lineTo: function(x, y) { this._context.lineTo(y, x); },\n  bezierCurveTo: function(x1, y1, x2, y2, x, y) { this._context.bezierCurveTo(y1, x1, y2, x2, y, x); }\n};\n\nexport function monotoneX(context) {\n  return new MonotoneX(context);\n}\n\nexport function monotoneY(context) {\n  return new MonotoneY(context);\n}\n","import { scaleLinear, scaleTime } from 'd3-scale';\nimport { extent } from 'd3-array';\nimport { line as d3Line, curveMonotoneX } from 'd3-shape';\n\nexport function createXTimeScale<T>(data: T[], accessor: (d: T) => Date, range: [number, number]) {\n  const domain = extent(data, accessor) as [Date, Date];\n  return scaleTime().domain(domain).range(range);\n}\n\nexport function createYLinearScale<T>(data: T[], accessor: (d: T) => number, range: [number, number]) {\n  const [min, max] = extent(data, accessor) as [number, number];\n  // We want a small visual gap below the lowest plotted value when the series is strictly positive,\n  // instead of always anchoring at zero (which can waste vertical space if min is far from 0) or\n  // sitting the lowest point flush on the axis. If the minimum value is 0 or negative we keep the\n  // natural lower bound (no enforced gap) because the user explicitly allows that case.\n  const hasData = Number.isFinite(min) && Number.isFinite(max);\n  if (!hasData) {\n    return scaleLinear().domain([0, 0]).range(range); // empty / invalid fallback\n  }\n  let lower: number;\n  if (min <= 0) {\n    // Keep original behaviour for datasets that include zero or negative values.\n    lower = Math.min(0, min);\n  } else {\n    const span = max - min;\n    // Padding is 5% of span, with a fallback to 10% of min when span is tiny / zero.\n    const pad = (span > 0 ? span : min) * 0.1;\n    lower = Math.max(0, min - pad);\n    // Guard against floating precision causing lower == min.\n    if (lower === min) lower = Math.max(0, min * 0.9);\n  }\n  const upper = max ?? 0;\n  return scaleLinear()\n    .domain([lower, upper])\n    .nice()\n    .range(range);\n}\n\nexport function createLinePath<T>(\n  data: T[],\n  x: (d: T) => number,\n  y: (d: T) => number,\n  options?: { smooth?: boolean }\n) {\n  const lineGen = d3Line<T>()\n    .x(x)\n    .y(y);\n  if (options?.smooth !== false) {\n    lineGen.curve(curveMonotoneX);\n  }\n  return lineGen(data) ?? '';\n}\n","import * as React from \"react\";\nimport { createXTimeScale, createYLinearScale } from \"../utils/scales\";\nimport { useChartContext } from \"./ChartRoot\";\n\n// Provides d3 x/y scales + tick helpers for time-series line charts (initial scope).\nexport interface ScaleContextValue {\n\txScale: any; // d3 ScaleTime\n\tyScale: any; // d3 ScaleLinear\n\tgetXTicks: (count?: number) => Date[];\n\tgetYTicks: (count?: number) => number[];\n}\n\nconst ScaleContext = React.createContext<ScaleContextValue | null>(null);\nexport const useScaleContext = () => React.useContext(ScaleContext);\n\nexport interface LineScalesProviderProps<Datum extends { x: any; y: number }> {\n\tseries: { data: Datum[] }[];\n\t/** Explicit inner width; if omitted, derived from ChartRoot context (if available) */\n\tinnerWidth?: number; // width excluding margins\n\t/** Explicit inner height; if omitted, derived from ChartRoot context (if available) */\n\tinnerHeight?: number; // height excluding margins\n\tparseX?: (d: Datum) => Date; // custom accessor override\n\tchildren: React.ReactNode;\n\txTickCount?: number; // preferred default counts\n\tyTickCount?: number;\n\t/** Optional explicit y domain override (e.g. stacked totals). */\n\tyDomain?: [number, number];\n\t/** Inner padding (px) to leave between axis and plotted points — improves hover targets near edges. Default: 6px */\n\txPadding?: number;\n\tyPadding?: number;\n\t/** Optional extra bottom gap in pixels to reserve below plotted data (e.g., for y-axis break zig-zag). */\n\tyBottomGapPx?: number;\n}\n\nexport const LineScalesProvider = <Datum extends { x: any; y: number }>({\n\tseries,\n\tinnerWidth: innerWidthProp,\n\tinnerHeight: innerHeightProp,\n\tparseX: parseXProp,\n\tchildren,\n\txTickCount = 6,\n\tyTickCount = 5,\n\tyDomain,\n\txPadding,\n\tyPadding,\n\tyBottomGapPx,\n}: LineScalesProviderProps<Datum>) => {\n\tconst chartDims = useChartContext();\n\t// Prefer explicit values; fallback to chart context; final fallback 0 (will update on re-measure)\n\tconst innerWidth = innerWidthProp ?? chartDims?.innerWidth ?? 0;\n\tconst innerHeight = innerHeightProp ?? chartDims?.innerHeight ?? 0;\n\tconst allData = React.useMemo(() => series.flatMap((s) => s.data), [series]);\n\tconst parseX = React.useCallback(\n\t\t(d: Datum) => {\n\t\t\tif (parseXProp) return parseXProp(d);\n\t\t\tconst raw = (d as any).x;\n\t\t\treturn raw instanceof Date ? raw : new Date(raw);\n\t\t},\n\t\t[parseXProp]\n\t);\n\n\tconst xPad = xPadding ?? 6;\n\tconst yPad = yPadding ?? 6;\n\n\tconst xScale = React.useMemo(\n\t\t() =>\n\t\t\tcreateXTimeScale(allData, parseX as any, [\n\t\t\t\txPad,\n\t\t\t\tMath.max(0, innerWidth - xPad),\n\t\t\t]),\n\t\t[allData, parseX, innerWidth, xPad]\n\t);\n\tconst yScale = React.useMemo(() => {\n\t\tconst extraBottom = Math.max(0, yBottomGapPx ?? 0);\n\t\tconst bottomPixel = Math.max(0, innerHeight - (yPad + extraBottom));\n\t\tif (yDomain) {\n\t\t\tconst scale = createYLinearScale([], (d: any) => d.y, [\n\t\t\t\tbottomPixel,\n\t\t\t\tyPad,\n\t\t\t]);\n\t\t\tscale.domain(yDomain);\n\t\t\treturn scale;\n\t\t}\n\t\treturn createYLinearScale(allData, (d: any) => d.y, [bottomPixel, yPad]);\n\t}, [allData, innerHeight, yDomain, yPad, yBottomGapPx]);\n\n\tconst value: ScaleContextValue = React.useMemo(\n\t\t() => ({\n\t\t\txScale,\n\t\t\tyScale,\n\t\t\tgetXTicks: (count = xTickCount) => xScale.ticks(count),\n\t\t\tgetYTicks: (count = yTickCount) => yScale.ticks(count),\n\t\t}),\n\t\t[xScale, yScale, xTickCount, yTickCount]\n\t);\n\n\treturn (\n\t\t<ScaleContext.Provider value={value}>{children}</ScaleContext.Provider>\n\t);\n};\n\nexport default ScaleContext;\n","/*!\n\tCopyright (c) 2018 Jed Watson.\n\tLicensed under the MIT License (MIT), see\n\thttp://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames () {\n\t\tvar classes = '';\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (arg) {\n\t\t\t\tclasses = appendClass(classes, parseValue(arg));\n\t\t\t}\n\t\t}\n\n\t\treturn classes;\n\t}\n\n\tfunction parseValue (arg) {\n\t\tif (typeof arg === 'string' || typeof arg === 'number') {\n\t\t\treturn arg;\n\t\t}\n\n\t\tif (typeof arg !== 'object') {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (Array.isArray(arg)) {\n\t\t\treturn classNames.apply(null, arg);\n\t\t}\n\n\t\tif (arg.toString !== Object.prototype.toString && !arg.toString.toString().includes('[native code]')) {\n\t\t\treturn arg.toString();\n\t\t}\n\n\t\tvar classes = '';\n\n\t\tfor (var key in arg) {\n\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\tclasses = appendClass(classes, key);\n\t\t\t}\n\t\t}\n\n\t\treturn classes;\n\t}\n\n\tfunction appendClass (value, newClass) {\n\t\tif (!newClass) {\n\t\t\treturn value;\n\t\t}\n\t\n\t\tif (value) {\n\t\t\treturn value + ' ' + newClass;\n\t\t}\n\t\n\t\treturn value + newClass;\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","export interface HeadingInputProps {\n  level?: 1|2|3|4|5|6;\n  size?: 'xs'|'s'|'m'|'l'|'xl'|'xxl';\n  className?: string;\n  marginBottom?: string;\n}\n\nexport interface NormalisedHeadingModel {\n  tag: 'h1'|'h2'|'h3'|'h4'|'h5'|'h6';\n  classes: string;\n  style: Record<string, any> | undefined;\n}\n\nfunction deriveLevel(size?: string): 1|2|3|4|5|6 {\n  switch(size){\n    case 'xxl':\n    case 'xl': return 1;\n    case 'l': return 2;\n    case 'm': return 3;\n    case 's': return 4;\n    case 'xs': return 5;\n    default: return 2;\n  }\n}\n\nexport function mapHeadingProps(input: HeadingInputProps): NormalisedHeadingModel {\n  const level = input.level ?? deriveLevel(input.size);\n  const classes = [\n    'nhsuk-heading',\n    input.size ? `nhsuk-heading--${input.size}` : '',\n    input.className || ''\n  ].filter(Boolean).join(' ');\n  const style = input.marginBottom ? { marginBottom: input.marginBottom } : undefined;\n  return { tag: `h${level}` as any, classes, style };\n}\n","import React, { createElement } from \"react\";\nimport \"./Heading.scss\";\nimport { HeadingProps } from \"./Heading.types\";\nimport { mapHeadingProps } from \"../../mapping/heading\";\n\n/**\n * A reusable Heading component that abstracts heading level logic and provides consistent styling.\n * Separates semantic meaning (level) from visual appearance (size).\n *\n * If level is not provided, it will be automatically determined from the size prop:\n * - xxl/xl → h1\n * - l → h2\n * - m → h3\n * - s → h4\n * - xs → h5\n *\n * @example\n * <Heading level={1} size=\"xl\">Page Title</Heading>\n * <Heading level={2} size=\"l\" text=\"Section Title\" />\n * <Heading size=\"xl\" text=\"Auto h1 from size\" />\n * <Heading size=\"m\" text=\"Auto h3 from size\" />\n * <Heading level={2} text=\"Custom Spacing\" marginBottom=\"32px\" />\n */\nexport const Heading: React.FC<HeadingProps> = ({\n\tlevel,\n\tclassName,\n\ttext,\n\thtml,\n\tchildren,\n\tsize,\n\tmarginBottom,\n\t...rest\n}) => {\n\tconst model = mapHeadingProps({ level, size, className, marginBottom });\n\tconst content =\n\t\tchildren ||\n\t\t(html ? <span dangerouslySetInnerHTML={{ __html: html }} /> : text);\n\treturn createElement(\n\t\tmodel.tag,\n\t\t{ className: model.classes, style: model.style, ...rest },\n\t\tcontent\n\t);\n};\n","import React from 'react';\nimport classNames from 'classnames';\nimport './Panel.scss';\nimport { PanelProps } from './Panel.types';\nimport { Heading } from '../Heading';\n\nexport const Panel: React.FC<PanelProps> = ({\n  id,\n  className,\n  headingText,\n  headingHtml,\n  headingLevel = 2,\n  bodyText,\n  bodyHtml,\n  children,\n  ...props\n}) => {\n  const panelClasses = classNames(\n    'nhsuk-panel',\n    className\n  );\n\n  const renderHeading = () => {\n    if (!headingText && !headingHtml && !children) return null;\n\n    if (headingHtml) {\n      return (\n        <Heading\n          level={headingLevel}\n          className=\"nhsuk-panel__heading\"\n          html={headingHtml}\n          marginBottom=\"var(--panel-heading-margin, 24px)\"\n        />\n      );\n    }\n\n    if (headingText) {\n      return (\n        <Heading\n          level={headingLevel}\n          className=\"nhsuk-panel__heading\"\n          text={headingText}\n          marginBottom=\"var(--panel-heading-margin, 24px)\"\n        />\n      );\n    }\n\n    return null;\n  };\n\n  const renderBody = () => {\n    if (children) {\n      return <div className=\"nhsuk-panel__body\">{children}</div>;\n    }\n\n    if (bodyHtml) {\n      return (\n        <div \n          className=\"nhsuk-panel__body\"\n          dangerouslySetInnerHTML={{ __html: bodyHtml }}\n        />\n      );\n    }\n\n    if (bodyText) {\n      return (\n        <div className=\"nhsuk-panel__body\">\n          <p>{bodyText}</p>\n        </div>\n      );\n    }\n\n    return null;\n  };\n\n  return (\n    <div className={panelClasses} id={id} {...props}>\n      {renderHeading()}\n      {renderBody()}\n    </div>\n  );\n};\n","import React from \"react\";\nimport classNames from \"classnames\";\nimport type {\n\tTableProps,\n\tTableCellData,\n\tTableHeaderCellType,\n\tTableCaptionProps,\n\tTableBodyRowProps,\n\tTableHeaderCellComponentProps,\n\tTableDataCellComponentProps,\n} from \"./Table.types\";\nimport \"./Table.scss\";\nimport { Panel } from \"../Panel\";\nimport { Heading } from \"../Heading\";\n\n/**\n * Table component for displaying structured data\n *\n * Features:\n * - Responsive design with mobile-friendly stacked layout\n * - Accessible table structure with proper headers\n * - Support for complex cell types (headers, numeric, spans)\n * - Optional panel wrapper with heading\n * - Customisable caption and styling\n *\n * @param props - Table component props\n * @returns JSX element\n */\n// Shared highlighting utilities (module scope so all sub-components can use)\nconst prismGlobalRef: { current: any | null } = { current: null };\nconst ensurePrismGlobal = () => {\n\tif (prismGlobalRef.current) return prismGlobalRef.current;\n\ttry {\n\t\tprismGlobalRef.current = require('prismjs');\n\t\ttry { require('prismjs/components/prism-typescript'); } catch {}\n\t\ttry { require('prismjs/components/prism-tsx'); } catch {}\n\t\ttry { require('prismjs/components/prism-json'); } catch {}\n\t} catch { prismGlobalRef.current = null; }\n\treturn prismGlobalRef.current;\n};\nexport const fallbackHighlight = (code: string) => {\n\tconst patterns: { regex: RegExp; cls: string }[] = [\n\t\t{ regex: /\\b(import|from|export|const|let|var|return|if|else|for|while|switch|case|break|new|throw|try|catch|finally|class|extends|implements|interface|type|as|async|await|function)\\b/g, cls: 'kw' },\n\t\t{ regex: /(['\"`])(?:\\\\.|(?!\\1).)*\\1/g, cls: 'str' },\n\t\t{ regex: /\\/\\*[^]*?\\*\\/|\\/\\/.*$/gm, cls: 'com' },\n\t\t{ regex: /\\b([0-9]+(?:\\.[0-9]+)?)\\b/g, cls: 'num' },\n\t];\n\tlet html = code;\n\tpatterns.forEach(p => { html = html.replace(p.regex, m => `<span class=\\\"nhsuk-code-${p.cls}\\\">${m}</span>`); });\n\treturn html;\n};\nexport const highlightCode = (code: string, lang?: string, disable?: boolean) => {\n\tif (disable) return code;\n\tif (!lang) return code;\n\tconst Prism = ensurePrismGlobal();\n\tif (Prism && Prism.languages) {\n\t\tconst resolvedLang = Prism.languages[lang]\n\t\t\t? lang\n\t\t\t: (Prism.languages.typescript && (lang === 'ts' || lang === 'tsx' || lang === 'typescript')\n\t\t\t\t? 'typescript'\n\t\t\t\t: (Prism.languages.json && lang === 'json' ? 'json' : undefined));\n\t\tif (resolvedLang) {\n\t\t\ttry { return Prism.highlight(code, Prism.languages[resolvedLang], resolvedLang); } catch {}\n\t\t}\n\t}\n\treturn fallbackHighlight(code);\n};\n\nconst TableBase: React.FC<TableProps> = ({\n\trows,\n\thead,\n\tcaption,\n\tcaptionSize,\n\tfirstCellIsHeader = false,\n\tresponsive = false,\n\theading,\n\theadingLevel = 3,\n\tpanel = false,\n\tpanelClasses,\n\ttableClasses,\n\tclasses,\n\tattributes,\n\t\"data-testid\": testId,\n\tcolumns,\n\tdata,\n\tvisuallyHiddenCaption = false,\n}) => {\n\t// Build caption classes\n\tconst captionClass =\n\t\t`nhsuk-table__caption ${captionSize ? `nhsuk-table__caption--${captionSize}` : \"\"}`.trim();\n\n\t// Build table classes\n\tconst tableClassList = classNames(\n\t\t\"nhsuk-table\",\n\t\t{\n\t\t\t\"nhsuk-table-responsive\": responsive,\n\t\t},\n\t\ttableClasses\n\t);\n\n\t// Build container classes\n\tconst containerClassList = classNames(classes);\n\n\n\tconst renderHeaderCell = (cell: TableHeaderCellType, index: number) => {\n\tconst headerClasses = classNames(\n\t\t\"nhsuk-table__header\",\n\t\t{\n\t\t\t[`nhsuk-table__header--${cell.format}`]: cell.format,\n\t\t},\n\t\tcell.classes\n\t);\n\n\tconst headerAttributes = {\n\t\tscope: \"col\" as const,\n\t\t...(cell.colspan && { colSpan: cell.colspan }),\n\t\t...(cell.rowspan && { rowSpan: cell.rowspan }),\n\t\t...(responsive && { role: \"columnheader\" }),\n\t\t...cell.attributes,\n\t};\n\n\t\t// Determine content precedence: node > html > code > text\n\t\tlet content: React.ReactNode;\n\t\tif (cell.node != null) {\n\t\t\tcontent = <>{cell.node}</>;\n\t\t} else if (cell.html) {\n\t\t\tcontent = <span dangerouslySetInnerHTML={{ __html: cell.html }} />;\n\t\t} else if (cell.code != null) {\n\t\t\tconst isArray = Array.isArray(cell.code);\n\t\t\tconst codeString = isArray\n\t\t\t\t? (cell.code as string[]).join(\"\\n\")\n\t\t\t\t: (cell.code as string);\n\t\t\tconst isMultiline = isArray || codeString.includes(\"\\n\");\n\t\t\tconst codeProps = {\n\t\t\t\tclassName: classNames(\"nhsuk-table__code\", cell.codeClassName, {\n\t\t\t\t\t\"nhsuk-table__code--block\": isMultiline,\n\t\t\t\t\t\"nhsuk-table__code--inline\": !isMultiline,\n\t\t\t\t}),\n\t\t\t\t...(cell.codeLanguage ? { \"data-language\": cell.codeLanguage } : {}),\n\t\t\t};\n\t\t\tconst highlighted = highlightCode(codeString, (cell as any).codeLanguage); // header cells don't support disableHighlight currently\n\t\t\tcontent = isMultiline ? (\n\t\t\t\t<pre className=\"nhsuk-table__pre\">\n\t\t\t\t\t<code\n\t\t\t\t\t\t{...codeProps}\n\t\t\t\t\t\tdangerouslySetInnerHTML={{ __html: highlighted }}\n\t\t\t\t\t/>\n\t\t\t\t</pre>\n\t\t\t) : (\n\t\t\t\t<code\n\t\t\t\t\t{...codeProps}\n\t\t\t\t\tdangerouslySetInnerHTML={{ __html: highlighted }}\n\t\t\t\t/>\n\t\t\t);\n\t\t} else {\n\t\t\tcontent = cell.text;\n\t\t}\n\t\treturn (\n\t\t\t<th key={index} className={headerClasses} {...headerAttributes}>\n\t\t\t\t{content}\n\t\t\t</th>\n\t\t);\n\t};\n\n\tconst renderCell = (\n\t\tcell: TableCellData,\n\t\tcellIndex: number,\n\t\tisFirstCell: boolean\n\t) => {\n\t\t// Determine if this cell should be a row header either via global firstCellIsHeader or per-cell rowHeader flag\n\t\tconst isHeaderCell = (firstCellIsHeader && isFirstCell) || (cell as any).rowHeader;\n\n\t\tconst cellClasses = classNames(\n\t\t\tisHeaderCell ? \"nhsuk-table__header\" : \"nhsuk-table__cell\",\n\t\t\t{\n\t\t\t\t[`nhsuk-table__${isHeaderCell ? \"header\" : \"cell\"}--${cell.format}`]:\n\t\t\t\t\tcell.format,\n\t\t\t},\n\t\t\tcell.classes\n\t\t);\n\n\t\tconst cellAttributes = {\n\t\t\t...(isHeaderCell && { scope: \"row\" as const }),\n\t\t\t...(cell.colspan && { colSpan: cell.colspan }),\n\t\t\t...(cell.rowspan && { rowSpan: cell.rowspan }),\n\t\t\t...(responsive && {\n\t\t\t\trole: isHeaderCell ? \"rowheader\" : \"cell\",\n\t\t\t\t...(cell.header && { \"data-label\": cell.header }),\n\t\t\t}),\n\t\t\t...cell.attributes,\n\t\t};\n\n\t\tlet inner: React.ReactNode;\n\t\t// (highlighting utilities now hoisted above)\n\n\t\tif (cell.node != null) {\n\t\t\tinner = <>{cell.node}</>;\n\t\t} else if (cell.html) {\n\t\t\tinner = <span dangerouslySetInnerHTML={{ __html: cell.html }} />;\n\t\t} else if (cell.code != null) {\n\t\t\tconst isArray = Array.isArray(cell.code);\n\t\t\tconst codeString = isArray\n\t\t\t\t? (cell.code as string[]).join(\"\\n\")\n\t\t\t\t: (cell.code as string);\n\t\t\tconst isMultiline = isArray || codeString.includes(\"\\n\");\n\t\t\tconst codeProps = {\n\t\t\t\tclassName: classNames(\"nhsuk-table__code\", cell.codeClassName, {\n\t\t\t\t\t\"nhsuk-table__code--block\": isMultiline,\n\t\t\t\t\t\"nhsuk-table__code--inline\": !isMultiline,\n\t\t\t\t}),\n\t\t\t\t...(cell.codeLanguage ? { \"data-language\": cell.codeLanguage } : {}),\n\t\t\t};\n\t\t\tconst highlighted = highlightCode(\n\t\t\t\tcodeString,\n\t\t\t\tcell.codeLanguage,\n\t\t\t\tcell.disableHighlight\n\t\t\t);\n\t\t\tinner = isMultiline ? (\n\t\t\t\t<pre className=\"nhsuk-table__pre\">\n\t\t\t\t\t<code\n\t\t\t\t\t\t{...codeProps}\n\t\t\t\t\t\tdangerouslySetInnerHTML={{ __html: highlighted }}\n\t\t\t\t\t/>\n\t\t\t\t</pre>\n\t\t\t) : (\n\t\t\t\t<code\n\t\t\t\t\t{...codeProps}\n\t\t\t\t\tdangerouslySetInnerHTML={{ __html: highlighted }}\n\t\t\t\t/>\n\t\t\t);\n\t\t} else {\n\t\t\tinner = cell.text;\n\t\t}\n\n\t\tconst cellContent = (\n\t\t\t<>\n\t\t\t\t{responsive && cell.header && (\n\t\t\t\t\t<span className=\"nhsuk-table-responsive__heading\" aria-hidden=\"true\">\n\t\t\t\t\t\t{cell.header}{\" \"}\n\t\t\t\t\t</span>\n\t\t\t\t)}\n\t\t\t\t{inner}\n\t\t\t</>\n\t\t);\n\n\t\tconst Component = isHeaderCell ? \"th\" : \"td\";\n\n\t\treturn (\n\t\t\t<Component key={cellIndex} className={cellClasses} {...cellAttributes}>\n\t\t\t\t{cellContent}\n\t\t\t</Component>\n\t\t);\n\t};\n\n\t// Auto-build head/rows from columns + data if provided and explicit head/rows absent\n\tlet derivedHead = head;\n\tlet derivedRows = rows;\n\tif (!derivedHead && columns && columns.length) {\n\t\tderivedHead = columns.map((c) => ({\n\t\t\ttext: c.title,\n\t\t\tformat: c.format,\n\t\t\tclasses: c.headerClasses,\n\t\t\tattributes: c.headerAttributes,\n\t\t}));\n\t}\n\tif (!derivedRows && columns && data && data.length) {\n\t\tderivedRows = data.map((rowObj, rIdx) => {\n\t\t\treturn columns.map((c) => {\n\t\t\t\tconst raw = c.accessor ? c.accessor(rowObj, rIdx) : (rowObj as any)[c.key];\n\t\t\t\tlet base: any = { format: c.format, classes: c.cellClasses, attributes: c.cellAttributes };\n\t\t\t\tif (c.rowHeader) base.rowHeader = true;\n\t\t\t\tif (c.render) {\n\t\t\t\t\tconst rendered = c.render(raw, rowObj, rIdx, c);\n\t\t\t\t\tif (rendered == null || typeof rendered === 'boolean') return { ...base, text: '' };\n\t\t\t\t\tif (typeof rendered === 'string' || typeof rendered === 'number') {\n\t\t\t\t\t\treturn { ...base, text: String(rendered) };\n\t\t\t\t\t}\n\t\t\t\t\treturn { ...base, ...(rendered as any) };\n\t\t\t\t}\n\t\t\t\treturn { ...base, text: raw != null ? String(raw) : '' };\n\t\t\t});\n\t\t});\n\t}\n\n\tconst renderTable = () => (\n\t\t<table\n\t\t\tclassName={tableClassList}\n\t\t\t{...(responsive && { role: \"table\" })}\n\t\t\t{...attributes}\n\t\t\t{...(testId && { \"data-testid\": testId })}\n\t\t>\n\t\t\t{caption && (\n\t\t\t\t<caption className={classNames(captionClass, visuallyHiddenCaption && 'nhsuk-u-visually-hidden')}>\n\t\t\t\t\t{caption}\n\t\t\t\t</caption>\n\t\t\t)}\n\n\t\t\t{derivedHead && derivedHead.length > 0 && (\n\t\t\t\t<thead\n\t\t\t\t\tclassName=\"nhsuk-table__head\"\n\t\t\t\t\t{...(responsive && { role: \"rowgroup\" })}\n\t\t\t\t>\n\t\t\t\t\t<tr {...(responsive && { role: \"row\" })}>\n\t\t\t\t\t\t{derivedHead.map((cell: any, index: number) =>\n\t\t\t\t\t\t\trenderHeaderCell(cell, index)\n\t\t\t\t\t\t)}\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t)}\n\n\t\t\t<tbody className=\"nhsuk-table__body\">\n\t\t\t\t{derivedRows &&\n\t\t\t\t\tderivedRows.map((row: any, rowIndex: number) => (\n\t\t\t\t\t\t<tr\n\t\t\t\t\t\t\tkey={rowIndex}\n\t\t\t\t\t\t\tclassName=\"nhsuk-table__row\"\n\t\t\t\t\t\t\t{...(responsive && { role: \"row\" })}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{row.map((cell: any, cellIndex: number) =>\n\t\t\t\t\t\t\t\trenderCell(cell, cellIndex, cellIndex === 0)\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t))}\n\t\t\t</tbody>\n\t\t</table>\n\t);\n\n\tif (panel) {\n\t\treturn (\n\t\t\t<Panel className={panelClasses}>\n\t\t\t\t{heading && (\n\t\t\t\t\t<Heading level={headingLevel} className=\"nhsuk-table__heading-tab\">\n\t\t\t\t\t\t{heading}\n\t\t\t\t\t</Heading>\n\t\t\t\t)}\n\t\t\t\t{renderTable()}\n\t\t\t</Panel>\n\t\t);\n\t}\n\n\tif (containerClassList) {\n\t\treturn <div className={containerClassList}>{renderTable()}</div>;\n\t}\n\n\treturn renderTable();\n};\n\n// --- Sub-components ---\n\nexport const TableCaption: React.FC<TableCaptionProps> = ({\n\tchildren,\n\tsize,\n\tclassName,\n}) => {\n\tconst cls = classNames(\n\t\t\"nhsuk-table__caption\",\n\t\tsize && `nhsuk-table__caption--${size}`,\n\t\tclassName\n\t);\n\treturn <caption className={cls}>{children}</caption>;\n};\n\nexport const TableBodyRow: React.FC<TableBodyRowProps> = ({\n\tresponsive,\n\tclassName,\n\tchildren,\n\t...rest\n}) => {\n\tconst roleAttrs = responsive ? { role: \"row\" } : {};\n\treturn (\n\t\t<tr className={className} {...roleAttrs} {...rest}>\n\t\t\t{children}\n\t\t</tr>\n\t);\n};\n\nexport const TableHeaderCell: React.FC<TableHeaderCellComponentProps> = ({\n\ttext,\n\thtml,\n\tnode,\n\tcode,\n\tcodeLanguage,\n\tcodeClassName,\n\tdisableHighlight,\n\tformat,\n\tclasses,\n\tcolspan,\n\trowspan,\n\tattributes,\n\tresponsive,\n\tas = \"th\",\n}) => {\n\t// Uses shared highlightCode / fallbackHighlight utilities declared above\n\tconst headerClasses = classNames(\n\t\t\"nhsuk-table__header\",\n\t\t{ [`nhsuk-table__header--${format}`]: format },\n\t\tclasses\n\t);\n\tconst headerAttributes: any = {\n\t\tscope: \"col\",\n\t\t...(colspan && { colSpan: colspan }),\n\t\t...(rowspan && { rowSpan: rowspan }),\n\t\t...(responsive && { role: \"columnheader\" }),\n\t\t...attributes,\n\t};\n\tlet content: React.ReactNode;\n\tif (node != null) content = <>{node}</>;\n\telse if (html) content = <span dangerouslySetInnerHTML={{ __html: html }} />;\n\telse if (code != null) {\n\t\tconst isArray = Array.isArray(code);\n\t\tconst codeString = isArray\n\t\t\t? (code as string[]).join(\"\\n\")\n\t\t\t: (code as string);\n\t\tconst isMultiline = isArray || codeString.includes(\"\\n\");\n\t\tconst codeProps = {\n\t\t\tclassName: classNames(\"nhsuk-table__code\", codeClassName, {\n\t\t\t\t\"nhsuk-table__code--block\": isMultiline,\n\t\t\t\t\"nhsuk-table__code--inline\": !isMultiline,\n\t\t\t}),\n\t\t\t...(codeLanguage ? { \"data-language\": codeLanguage } : {}),\n\t\t};\n\t\tconst highlighted = highlightCode(\n\t\t\tcodeString,\n\t\t\tcodeLanguage,\n\t\t\tdisableHighlight\n\t\t);\n\t\tcontent = isMultiline ? (\n\t\t\t<pre className=\"nhsuk-table__pre\">\n\t\t\t\t<code\n\t\t\t\t\t{...codeProps}\n\t\t\t\t\tdangerouslySetInnerHTML={{ __html: highlighted }}\n\t\t\t\t/>\n\t\t\t</pre>\n\t\t) : (\n\t\t\t<code {...codeProps} dangerouslySetInnerHTML={{ __html: highlighted }} />\n\t\t);\n\t} else content = text;\n\tconst Component: any = as;\n\treturn (\n\t\t<Component className={headerClasses} {...headerAttributes}>\n\t\t\t{content}\n\t\t</Component>\n\t);\n};\n\nexport const TableCell: React.FC<TableDataCellComponentProps> = ({\n\ttext,\n\thtml,\n\tnode,\n\tcode,\n\tcodeLanguage,\n\tcodeClassName,\n\tdisableHighlight,\n\tformat,\n\tclasses,\n\tcolspan,\n\trowspan,\n\tattributes,\n\tresponsive,\n\trowHeader,\n}) => {\n\tconst isHeader = !!rowHeader;\n\tconst Tag: any = isHeader ? 'th' : 'td';\n\tconst cls = classNames(\n\t\tisHeader ? 'nhsuk-table__header' : 'nhsuk-table__cell',\n\t\tformat && `nhsuk-table__${isHeader ? 'header' : 'cell'}--${format}`,\n\t\tclasses\n\t);\n\tconst cellAttrs: any = {\n\t\t...(colspan && { colSpan: colspan }),\n\t\t...(rowspan && { rowSpan: rowspan }),\n\t\t...(isHeader && { scope: 'row' }),\n\t\t...(responsive && { role: isHeader ? 'rowheader' : 'cell' }),\n\t\t...attributes,\n\t};\n\tlet content: React.ReactNode;\n\tif (node != null) content = <>{node}</>;\n\telse if (html) content = <span dangerouslySetInnerHTML={{ __html: html }} />;\n\telse if (code != null) {\n\t\tconst isArray = Array.isArray(code);\n\t\tconst codeString = isArray ? (code as string[]).join('\\n') : (code as string);\n\t\tconst isMultiline = isArray || codeString.includes('\\n');\n\t\tconst codeProps = {\n\t\t\tclassName: classNames('nhsuk-table__code', codeClassName, {\n\t\t\t\t'nhsuk-table__code--block': isMultiline,\n\t\t\t\t'nhsuk-table__code--inline': !isMultiline,\n\t\t\t}),\n\t\t\t...(codeLanguage ? { 'data-language': codeLanguage } : {}),\n\t\t};\n\t\tconst highlighted = highlightCode(codeString, codeLanguage, disableHighlight);\n\t\tcontent = isMultiline ? (\n\t\t\t<pre className=\"nhsuk-table__pre\"><code {...codeProps} dangerouslySetInnerHTML={{ __html: highlighted }} /></pre>\n\t\t) : (\n\t\t\t<code {...codeProps} dangerouslySetInnerHTML={{ __html: highlighted }} />\n\t\t);\n\t} else content = text;\n\treturn <Tag className={cls} {...cellAttrs}>{content}</Tag>;\n};\n\n// Compose export with static properties for ergonomics: Table.Caption / Table.BodyRow / Table.HeaderCell / Table.Cell\nexport interface TableComposite extends React.FC<TableProps> {\n\tCaption: typeof TableCaption;\n\tBodyRow: typeof TableBodyRow;\n\tHeaderCell: typeof TableHeaderCell;\n\tCell: typeof TableCell;\n\t// Backwards compat (deprecated) aliases\n\tRow: typeof TableBodyRow;\n\tTH: typeof TableHeaderCell;\n}\n\nconst Table = TableBase as TableComposite;\nTable.Caption = TableCaption;\nTable.BodyRow = TableBodyRow;\nTable.HeaderCell = TableHeaderCell;\nTable.Cell = TableCell;\n// Legacy aliases (deprecated): expose as lazy getters so we warn only on access\nlet __warnedRow = false;\nlet __warnedTH = false;\nObject.defineProperty(Table, 'Row', {\n\tconfigurable: true,\n\tenumerable: false,\n\tget() {\n\t\tif (process.env.NODE_ENV !== 'production' && !__warnedRow) {\n\t\t\tconsole.warn('Table.Row is deprecated. Use Table.BodyRow instead.');\n\t\t\t__warnedRow = true;\n\t\t}\n\t\treturn TableBodyRow;\n\t},\n});\nObject.defineProperty(Table, 'TH', {\n\tconfigurable: true,\n\tenumerable: false,\n\tget() {\n\t\tif (process.env.NODE_ENV !== 'production' && !__warnedTH) {\n\t\t\tconsole.warn('Table.TH is deprecated. Use Table.HeaderCell instead.');\n\t\t\t__warnedTH = true;\n\t\t}\n\t\treturn TableHeaderCell;\n\t},\n});\n\nexport default Table;\n","export interface TagInputProps {\n  color?: string;\n  noBorder?: boolean;\n  closable?: boolean;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport interface NormalisedTagModel {\n  classes: string;\n  showClose: boolean;\n  disabled: boolean;\n}\n\nexport function mapTagProps(input: TagInputProps): NormalisedTagModel {\n  const { color = 'default', noBorder, closable, disabled, className } = input;\n  const classes = [\n    'nhsuk-tag',\n    color !== 'default' ? `nhsuk-tag--${color}` : '',\n    noBorder ? 'nhsuk-tag--no-border' : '',\n    closable ? 'nhsuk-tag--closable' : '',\n    disabled ? 'nhsuk-tag--disabled' : '',\n    className || ''\n  ].filter(Boolean).join(' ');\n  return { classes, showClose: !!closable, disabled: !!disabled };\n}\n","import React from \"react\";\nimport \"./Tag.scss\";\nimport { TagProps } from \"./Tag.types\";\nimport { mapTagProps } from \"../../mapping/tag\";\n\nexport const Tag: React.FC<TagProps> = ({\n\ttext,\n\thtml,\n\tchildren,\n\tcolor = \"default\",\n\tnoBorder = false,\n\tclosable = false,\n\tonClose,\n\tdisabled = false,\n\tclassName,\n\t...props\n}) => {\n\tconst model = mapTagProps({ color, noBorder, closable, disabled, className });\n\n\tconst handleClose = (e: React.MouseEvent) => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (!disabled && onClose) {\n\t\t\tonClose();\n\t\t}\n\t};\n\n\treturn (\n\t\t<strong className={model.classes} {...props}>\n\t\t\t{/* Content - children take precedence, then html, then text */}\n\t\t\t{children ? (\n\t\t\t\tchildren\n\t\t\t) : html ? (\n\t\t\t\t<span dangerouslySetInnerHTML={{ __html: html }} />\n\t\t\t) : (\n\t\t\t\ttext\n\t\t\t)}\n\n\t\t\t{/* Close button */}\n\t\t\t{closable && (\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclassName=\"nhsuk-tag__close\"\n\t\t\t\t\tonClick={handleClose}\n\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\taria-label=\"Remove\"\n\t\t\t\t\ttitle=\"Remove\"\n\t\t\t\t>\n\t\t\t\t\t×\n\t\t\t\t</button>\n\t\t\t)}\n\t\t</strong>\n\t);\n};\n","import * as React from \"react\";\nimport Table from \"../../../../../Tables/Table\";\nimport { Tag } from \"../../../../../Tag/Tag\";\nimport { SpcWarningSeverity, SpcWarningCode, SpcWarningCategory } from \"../logic_v2/types\";\n\nexport interface DiagnosticsItem {\n  code: SpcWarningCode;\n  severity: SpcWarningSeverity;\n  category: SpcWarningCategory;\n  message: string;\n  context?: Record<string, unknown>;\n}\n\nexport interface DiagnosticsFilter {\n  severities?: SpcWarningSeverity[];\n  categories?: SpcWarningCategory[];\n  codes?: SpcWarningCode[];\n}\n\nexport function DiagnosticsPanel({\n  warnings,\n  show,\n  formatWarningCategory,\n  formatWarningCode,\n}: {\n  warnings: DiagnosticsItem[];\n  show: boolean;\n  formatWarningCategory: (c: SpcWarningCategory | string) => string;\n  formatWarningCode: (c: SpcWarningCode | string) => string;\n}) {\n  const [diagnosticsMessage, setDiagnosticsMessage] = React.useState(\"\");\n  const lastDiagnosticsRef = React.useRef(\"\");\n\n  React.useEffect(() => {\n    if (!show) {\n      if (lastDiagnosticsRef.current !== \"\") {\n        lastDiagnosticsRef.current = \"\";\n        setDiagnosticsMessage(\"\");\n      }\n      return;\n    }\n    const total = warnings.length;\n    if (!total) {\n      const msg = \"Diagnostics: no warnings.\";\n      if (msg !== lastDiagnosticsRef.current) {\n        lastDiagnosticsRef.current = msg;\n        setDiagnosticsMessage(msg);\n      }\n      return;\n    }\n    const counts = {\n      error: warnings.filter((w) => w.severity === SpcWarningSeverity.Error).length,\n      warning: warnings.filter((w) => w.severity === SpcWarningSeverity.Warning).length,\n      info: warnings.filter((w) => w.severity === SpcWarningSeverity.Info).length,\n    };\n    const breakdownParts: string[] = [];\n    if (counts.error) breakdownParts.push(`${counts.error} error${counts.error === 1 ? \"\" : \"s\"}`);\n    if (counts.warning) breakdownParts.push(`${counts.warning} warning${counts.warning === 1 ? \"\" : \"s\"}`);\n    if (counts.info) breakdownParts.push(`${counts.info} info`);\n    const msg = `Diagnostics updated: ${total} warning${total === 1 ? \"\" : \"s\"} (${breakdownParts.join(\", \")}).`;\n    if (msg !== lastDiagnosticsRef.current) {\n      lastDiagnosticsRef.current = msg;\n      setDiagnosticsMessage(msg);\n    }\n  }, [show, warnings]);\n\n  if (!show) return null;\n\n  return (\n    <>\n      {diagnosticsMessage && (\n        <div\n          data-testid=\"spc-diagnostics-live\"\n          aria-live=\"polite\"\n          style={{\n            position: \"absolute\",\n            width: 1,\n            height: 1,\n            padding: 0,\n            margin: 0,\n            overflow: \"hidden\",\n            clip: \"rect(0 0 0 0)\",\n            whiteSpace: \"nowrap\",\n            border: 0,\n          }}\n        >\n          {diagnosticsMessage}\n        </div>\n      )}\n      {warnings.length > 0 && (\n        <div className=\"fdp-spc-chart__warnings\" role=\"region\" aria-label=\"SPC diagnostics\">\n          <p className=\"fdp-spc-chart__warnings-heading\">Diagnostics</p>\n          <Table\n            firstCellIsHeader={false}\n            panel={false}\n            responsive={false}\n            head={[{ text: \"Severity\" }, { text: \"Category\" }, { text: \"Code\" }, { text: \"Details\" }]}\n            rows={warnings.map((w) => {\n              let severityColor: any = \"grey\";\n              if (w.severity === SpcWarningSeverity.Error) severityColor = \"red\";\n              else if (w.severity === SpcWarningSeverity.Warning) severityColor = \"orange\";\n              else if (w.severity === SpcWarningSeverity.Info) severityColor = \"blue\";\n              return [\n                {\n                  node: <Tag color={severityColor} text={(w.severity ? String(w.severity) : \"Info\").replace(/^[a-z]/, (c) => c.toUpperCase())} />,\n                  classes: \"fdp-spc-chart__warning-cell fdp-spc-chart__warning-cell--severity\",\n                },\n                {\n                  node: w.category ? <Tag color=\"purple\" text={formatWarningCategory(w.category)} /> : (\n                    <span className=\"fdp-spc-chart__warning-empty\">–</span>\n                  ),\n                  classes: \"fdp-spc-chart__warning-cell fdp-spc-chart__warning-cell--category\",\n                },\n                {\n                  node: <Tag color=\"grey\" text={formatWarningCode(w.code)} />,\n                  classes: \"fdp-spc-chart__warning-cell fdp-spc-chart__warning-cell--code\",\n                },\n                {\n                  node: (\n                    <div className=\"fdp-spc-chart__warning-message\">\n                      <span>{w.message}</span>\n                      {w.context && Object.keys(w.context).length > 0 && (\n                        <details className=\"fdp-spc-chart__warning-context\" style={{ marginTop: 4 }}>\n                          <summary>context</summary>\n                          <pre>{JSON.stringify(w.context, null, 2)}</pre>\n                        </details>\n                      )}\n                    </div>\n                  ),\n                  classes: \"fdp-spc-chart__warning-cell fdp-spc-chart__warning-cell--message\",\n                },\n              ];\n            })}\n            classes=\"fdp-spc-chart__warnings-table-wrapper\"\n            tableClasses=\"fdp-spc-chart__warnings-table\"\n          />\n        </div>\n      )}\n    </>\n  );\n}\n","import * as React from \"react\";\n\nexport function EmbeddedIconsRow({\n  variationNode,\n  assuranceNode,\n  show,\n}: {\n  variationNode: React.ReactNode;\n  assuranceNode: React.ReactNode;\n  show: boolean;\n}) {\n  if (!show) return null;\n  return (\n    <div className=\"fdp-spc-chart__top-row\" style={{ display: \"flex\", justifyContent: \"flex-end\", marginBottom: 4 }}>\n      {variationNode}\n      {assuranceNode}\n    </div>\n  );\n}\n\n// Lightweight wrappers used by SPCChart to render the icon containers consistently\nexport function VariationIconContainer({ children, size }: { children: React.ReactNode; size: number }) {\n  return (\n    <div className=\"fdp-spc-chart__embedded-icon\" style={{ width: size, height: size }}>\n      {children}\n    </div>\n  );\n}\n\nexport function AssuranceIconContainer({ children, size }: { children: React.ReactNode; size: number }) {\n  return (\n    <div className=\"fdp-spc-chart__embedded-assurance-icon\" style={{ width: size, height: size }}>\n      {children}\n    </div>\n  );\n}\n","/**\n * Embedded SPC icon builder utilities.\n *\n * This module constructs the top‑right summary icons (Variation + Assurance)\n * used by SPCChart. It selects the last eligible data row, maps the UI‑level\n * classification to the icon engine payload, and applies consistent gating and\n * semantics for orientation and letters.\n */\nimport type React from \"react\";\nimport {\n\tSPCVariationIcon,\n\tSPCAssuranceIcon,\n\tAssuranceResult,\n\tDirection,\n} from \"../../icons\";\nimport type { EngineRowUI } from \"../SPCChart.types\";\nimport { ImprovementDirection, VariationIcon, AssuranceIcon } from \"../types\";\nimport { SpcEmbeddedIconVariant, LetterMode } from \"../SPCChart.constants\";\nimport { VariationIcon as V2VariationIcon } from \"../logic_v2/types\";\n\n/**\n * Build the embedded summary icon block for SPCChart.\n *\n * Behaviour:\n * - Applies a minimum points gate (default 13) — returns null until the chart has\n *   enough non‑ghost observations to form stable limits.\n * - Picks the last non‑ghost data row as the summary point.\n * - Chooses Variation icon geometry/orientation based on the final classification\n *   and derives a direction for special‑cause neutral cases (purple) from rule sides.\n * - Sets the letter semantics to match business polarity when available\n *   (ImprovementDirection.Up/Down ⇒ LetterMode.Polarity). When polarity is neutral\n *   (ImprovementDirection.Neither), letters reflect the signal side instead\n *   (LetterMode.Direction).\n * - Renders an Assurance icon alongside Variation; when the engine has no assurance\n *   outcome we render the neutral \"Uncertain\" placeholder to keep layout stable.\n *\n * IDE guidance:\n * - Pass `metricImprovement` from SPCChart’s effective engine props so letters (H/L)\n *   communicate business polarity when defined.\n * - Use `variant` to switch between Classic, Triangle, and TriangleWithRun; when using\n *   TriangleWithRun you can supply an optional `runLength` for the small dot series.\n * - This function is side‑effect free and can be memoized by callers. It returns a\n *   single React node or null when gated.\n *\n * Example:\n *   const node = buildEmbeddedIcon({\n *     show: true,\n *     rowsForUi,\n *     minPoints: 13,\n *     metricImprovement: ImprovementDirection.Up,\n *     variant: SpcEmbeddedIconVariant.Triangle,\n *   });\n *\n * @param args.show Controls visibility. If false, returns null immediately.\n * @param args.rowsForUi Engine rows mapped for UI (from SPCChart).\n * @param args.minPoints Optional minimum non‑ghost points gate (default 13).\n * @param args.metricImprovement Business polarity for the measure\n *   (Up = higher is better, Down = lower is better, Neither = neutral).\n * @param args.variant Icon rendering style.\n * @param args.runLength Optional run length indicator for TriangleWithRun variant (0–5 shown).\n * @returns React node containing Variation + Assurance icons, or null when gated/hidden.\n */\nexport function buildEmbeddedIcon(args: {\n\tshow: boolean;\n\trowsForUi: EngineRowUI[] | null;\n\tminPoints?: number | null;\n\tmetricImprovement: ImprovementDirection;\n\tvariant: SpcEmbeddedIconVariant;\n\trunLength?: number;\n}): React.ReactNode | null {\n\tconst { show, rowsForUi, minPoints, metricImprovement, variant, runLength } =\n\t\targs;\n\tif (!show || !rowsForUi?.length) return null;\n\n\tconst engineRows = rowsForUi as EngineRowUI[];\n\tconst min =\n\t\ttypeof minPoints === \"number\" && !isNaN(minPoints) ? minPoints : 13;\n\tconst nonGhostCount = engineRows.filter(\n\t\t(r) => !r.data.ghost && r.data.value != null\n\t).length;\n\tif (nonGhostCount < min) return null;\n\n\t// find last non-ghost data row\n\tlet lastIdx = -1;\n\tfor (let i = engineRows.length - 1; i >= 0; i--) {\n\t\tconst r = engineRows[i];\n\t\tif (r && r.data.value != null && !r.data.ghost) {\n\t\t\tlastIdx = i;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (lastIdx === -1) return null;\n\tconst lastRow = engineRows[lastIdx];\n\n\tconst variation = lastRow.classification?.variation as\n\t\t| VariationIcon\n\t\t| undefined;\n\tconst assuranceRaw = lastRow.classification?.assurance as\n\t\t| AssuranceIcon\n\t\t| undefined;\n\tconst hasNeutralSpecialCause =\n\t\tvariation === VariationIcon.Neither &&\n\t\t!!lastRow.classification?.neutralSpecialCauseValue;\n\n\tconst assuranceRenderStatus: AssuranceResult =\n\t\tassuranceRaw === AssuranceIcon.Pass\n\t\t\t? AssuranceResult.Pass\n\t\t\t: assuranceRaw === AssuranceIcon.Fail\n\t\t\t\t? AssuranceResult.Fail\n\t\t\t\t: AssuranceResult.Uncertain;\n\n\t// Determine icon orientation (trend) for special‑cause neutral and suppressed cases\n\tlet trend: Direction | undefined = undefined;\n\tif (variation === VariationIcon.Suppressed) {\n\t\tconst singleHigh = !!lastRow.rules.singlePoint.up;\n\t\tconst singleLow = !!lastRow.rules.singlePoint.down;\n\t\tif (metricImprovement === ImprovementDirection.Up) {\n\t\t\tif (singleHigh) trend = Direction.Higher;\n\t\t\telse if (singleLow) trend = Direction.Lower;\n\t\t} else if (metricImprovement === ImprovementDirection.Down) {\n\t\t\tif (singleLow) trend = Direction.Lower;\n\t\t\telse if (singleHigh) trend = Direction.Higher;\n\t\t} else {\n\t\t\ttrend = Direction.Higher;\n\t\t}\n\t} else if (variation === VariationIcon.Neither && hasNeutralSpecialCause) {\n\t\tconst anyHighSide =\n\t\t\tlastRow.rules.singlePoint.up ||\n\t\t\tlastRow.rules.twoOfThree.up ||\n\t\t\tlastRow.rules.fourOfFive.up ||\n\t\t\tlastRow.rules.shift.up ||\n\t\t\tlastRow.rules.trend.up;\n\t\tconst anyLowSide =\n\t\t\tlastRow.rules.singlePoint.down ||\n\t\t\tlastRow.rules.twoOfThree.down ||\n\t\t\tlastRow.rules.fourOfFive.down ||\n\t\t\tlastRow.rules.shift.down ||\n\t\t\tlastRow.rules.trend.down;\n\t\tif (anyHighSide && !anyLowSide) trend = Direction.Higher;\n\t\telse if (anyLowSide && !anyHighSide) trend = Direction.Lower;\n\t\telse trend = Direction.Higher;\n\t}\n\n\t// Rendering size (px). Polarity is derived implicitly by the icon component from\n\t// `improvementDirection` and only affects letter semantics, not geometry.\n\tconst iconSize = 80;\n\n\tconst highSideSignal =\n\t\tlastRow.rules.singlePoint.up ||\n\t\tlastRow.rules.twoOfThree.up ||\n\t\tlastRow.rules.fourOfFive.up ||\n\t\tlastRow.rules.shift.up ||\n\t\tlastRow.rules.trend.up;\n\tconst lowSideSignal =\n\t\tlastRow.rules.singlePoint.down ||\n\t\tlastRow.rules.twoOfThree.down ||\n\t\tlastRow.rules.fourOfFive.down ||\n\t\tlastRow.rules.shift.down ||\n\t\tlastRow.rules.trend.down;\n\n\t// Map UI variation to engine variant for SPCVariationIcon payload.\n\t// Note: High/Low is selected here only for neutral special‑cause rendering; the\n\t// Improving/Concern variants are resolved by the icon component using\n\t// improvementDirection → polarity to orient geometry appropriately.\n\tlet variationEngine: V2VariationIcon = V2VariationIcon.CommonCause;\n\tif (variation === VariationIcon.Improvement)\n\t\tvariationEngine = V2VariationIcon.ImprovementHigh;\n\telse if (variation === VariationIcon.Concern)\n\t\tvariationEngine = V2VariationIcon.ConcernHigh;\n\telse if (variation === VariationIcon.Neither) {\n\t\tif (hasNeutralSpecialCause) {\n\t\t\tif (trend === Direction.Lower || (lowSideSignal && !highSideSignal))\n\t\t\t\tvariationEngine = V2VariationIcon.NeitherLow;\n\t\t\telse variationEngine = V2VariationIcon.NeitherHigh;\n\t\t} else {\n\t\t\tvariationEngine = V2VariationIcon.CommonCause;\n\t\t}\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tkey={`embedded-icon-${lastIdx}`}\n\t\t\tstyle={{ display: \"flex\", gap: 12, marginRight: 16 }}\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName=\"fdp-spc-chart__embedded-icon\"\n\t\t\t\tdata-variation={String(variation)}\n\t\t\t\tdata-trend={trend ? String(trend) : \"none\"}\n\t\t\t\tstyle={{ width: iconSize, height: iconSize }}\n\t\t\t>\n\t\t\t\t<SPCVariationIcon\n\t\t\t\t\tdropShadow={false}\n\t\t\t\t\tdata={{\n\t\t\t\t\t\tvariationIcon: variationEngine,\n\t\t\t\t\t\timprovementDirection: metricImprovement,\n\t\t\t\t\t\tspecialCauseNeutral: hasNeutralSpecialCause,\n\t\t\t\t\t\thighSideSignal,\n\t\t\t\t\t\tlowSideSignal,\n\t\t\t\t\t\t...(trend ? { trend } : {}),\n\t\t\t\t\t}}\n\t\t\t\t\t// Letter semantics:\n\t\t\t\t\t// - When a business polarity exists (Up/Down), use LetterMode.Polarity so\n\t\t\t\t\t//   H/L communicate \"higher is better\" / \"lower is better\".\n\t\t\t\t\t// - When polarity is neutral, fall back to LetterMode.Direction so H/L\n\t\t\t\t\t//   reflect the side of the signal (high‑side vs low‑side).\n\t\t\t\t\tletterMode={\n\t\t\t\t\t\tmetricImprovement === ImprovementDirection.Neither\n\t\t\t\t\t\t\t? LetterMode.Direction\n\t\t\t\t\t\t\t: LetterMode.Polarity\n\t\t\t\t\t}\n\t\t\t\t\tsize={iconSize}\n\t\t\t\t\tvariant={variant}\n\t\t\t\t\trunLength={\n\t\t\t\t\t\tvariant === SpcEmbeddedIconVariant.TriangleWithRun\n\t\t\t\t\t\t\t? runLength\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclassName=\"fdp-spc-chart__embedded-assurance-icon\"\n\t\t\t\tdata-assurance={String(assuranceRaw)}\n\t\t\t\tstyle={{ width: iconSize, height: iconSize }}\n\t\t\t>\n\t\t\t\t<SPCAssuranceIcon\n\t\t\t\t\tstatus={assuranceRenderStatus}\n\t\t\t\t\tsize={iconSize}\n\t\t\t\t\tdropShadow={false}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","/**\n * Default visual gap for the y-axis zero break indicator (px).\n * This is the size of the slot reserved above the x-axis line for the zig-zag.\n */\nexport const AXIS_Y_ZERO_BREAK_DEFAULT_GAP_PX = 16;\n\n/** Minimum gap enforced for the break area (px). Prevents degenerate rendering. */\nexport const AXIS_Y_ZERO_BREAK_MIN_GAP_PX = 6;\n\n/**\n * Default extra clearance above the break gap reserved to keep the first tick/gridline from crowding the zig-zag (px).\n * Used when a consumer lifts the plotting range (e.g., LineScalesProvider.yBottomGapPx).\n */\nexport const AXIS_Y_ZERO_BREAK_DEFAULT_EXTRA_CLEARANCE_PX = 16;\n\n/** Default zig-zag vertical amplitude per half-step (px). */\nexport const AXIS_ZIGZAG_DEFAULT_AMPLITUDE_PX = 4;\n\n/** Default number of zig-zag cycles (each cycle consists of two diagonal segments). */\nexport const AXIS_ZIGZAG_DEFAULT_CYCLES = 6;\n\n/** Default horizontal pixel step for each zig-zag segment. */\nexport const AXIS_ZIGZAG_DEFAULT_STEP_X_PX = 3;\n\n/** Default desired height is undefined; when omitted, height is derived from cycles and amplitude. */\nexport const AXIS_ZIGZAG_DEFAULT_HEIGHT_PX: number | undefined = undefined;\n","import * as React from \"react\";\nimport { useScaleContext } from \"../../core/ScaleContext\";\nimport { useChartContext } from \"../../core/ChartRoot\";\nimport type { AxisProps as Props, AxisTickFormatPreset } from \"./Axis.types\";\nimport {\n\tAXIS_Y_ZERO_BREAK_DEFAULT_GAP_PX,\n\tAXIS_Y_ZERO_BREAK_MIN_GAP_PX,\n\tAXIS_ZIGZAG_DEFAULT_AMPLITUDE_PX,\n\tAXIS_ZIGZAG_DEFAULT_CYCLES,\n\tAXIS_ZIGZAG_DEFAULT_STEP_X_PX,\n\tAXIS_ZIGZAG_DEFAULT_HEIGHT_PX,\n} from \"./Axis.tokens\";\n\n// AxisProps moved to Axis.types.ts (semantic structure with yZeroBreak config)\n\nexport const Axis: React.FC<Props> = ({\n\ttype,\n\tscale,\n\ttickCount,\n\ttickValues,\n\tformatTick: rawFormatTick,\n\tlabel,\n\toffset,\n\tclassName,\n\tminLabelSpacing,\n\tmaxTickLabelLength,\n\tautoMinLabelSpacing = type === \"x\" ? true : false,\n\tlabelAngle = 0,\n\tallowLabelWrap = true,\n\ttickFormatPreset,\n\tyZeroBreak,\n}) => {\n\tconst scaleCtx = useScaleContext();\n\tconst dims = useChartContext();\n\tconst resolvedScale = scale || (type === \"x\" ? scaleCtx?.xScale : scaleCtx?.yScale);\n\tconst defaultCount = tickCount ?? (type === \"x\" ? 6 : 5);\n\t// Derive formatter from preset if provided and no explicit formatter\n\tconst hasUserFormatter = typeof rawFormatTick === \"function\";\n\tconst presetFormatter: ((v: any) => string) | undefined =\n\tReact.useMemo(() => {\n\t\tif (hasUserFormatter) return undefined;\n\t\tif (!tickFormatPreset) return undefined;\n\t\tconst dtf = (opts: Intl.DateTimeFormatOptions) =>\n\t\t\tnew Intl.DateTimeFormat(undefined, opts);\n\t\tswitch (tickFormatPreset as AxisTickFormatPreset) {\n\t\t\tcase \"dayShortMonth\":\n\t\t\t\treturn (v: any) => {\n\t\t\t\t\tconst d = v instanceof Date ? v : new Date(v);\n\t\t\t\t\treturn `${d.getDate()}\\n${dtf({ month: \"short\" }).format(d)}`;\n\t\t\t\t};\n\t\t\tcase \"dayShortMonthYear\":\n\t\t\t\treturn (v: any) => {\n\t\t\t\t\tconst d = v instanceof Date ? v : new Date(v);\n\t\t\t\t\treturn `${d.getDate()}\\n${dtf({ month: \"short\" }).format(d)} ${d.getFullYear()}`;\n\t\t\t\t};\n\t\t\tcase \"shortMonth\":\n\t\t\t\treturn (v: any) => {\n\t\t\t\t\tconst d = v instanceof Date ? v : new Date(v);\n\t\t\t\t\treturn dtf({ month: \"short\" }).format(d);\n\t\t\t\t};\n\t\t\tcase \"shortMonthYear\":\n\t\t\t\treturn (v: any) => {\n\t\t\t\t\tconst d = v instanceof Date ? v : new Date(v);\n\t\t\t\t\treturn `${dtf({ month: \"short\" }).format(d)} ${d.getFullYear()}`;\n\t\t\t\t};\n\t\t\tcase \"hourMinute\":\n\t\t\t\treturn (v: any) => {\n\t\t\t\t\tconst d = v instanceof Date ? v : new Date(v);\n\t\t\t\t\treturn dtf({ hour: \"2-digit\", minute: \"2-digit\" }).format(d);\n\t\t\t\t};\n\t\t\tdefault:\n\t\t\t\treturn undefined;\n\t\t}\n\t}, [hasUserFormatter, tickFormatPreset]);\n\tlet effectiveFormatTick: (v: any) => string = hasUserFormatter\n\t\t? (rawFormatTick as (v: any) => string)\n\t\t: presetFormatter || ((v: any) => String(v));\n\tconst ticks: any[] = React.useMemo(() => {\n\t\tif (tickValues && Array.isArray(tickValues)) return tickValues;\n\t\tif (!resolvedScale) return [];\n\t\tif (typeof resolvedScale.ticks === \"function\")\n\t\t\treturn resolvedScale.ticks(defaultCount);\n\t\treturn resolvedScale.domain ? resolvedScale.domain() : [];\n\t}, [resolvedScale, defaultCount, tickValues]);\n\n\t// Auto date formatting heuristic for x-axis when using time scale and no user/preset format provided\n\tif (\n\t\ttype === \"x\" &&\n\t\t!hasUserFormatter &&\n\t\t!tickFormatPreset &&\n\t\tticks.length &&\n\t\tticks.every((t) => t instanceof Date)\n\t) {\n\t\tconst first = ticks[0] as Date;\n\t\tconst last = ticks[ticks.length - 1] as Date;\n\t\tconst spanMs = last.getTime() - first.getTime();\n\t\tconst oneDay = 24 * 3600 * 1000;\n\t\tconst oneYear = 365 * oneDay;\n\t\tconst sameYear = first.getFullYear() === last.getFullYear();\n\t\tconst dtfMonth = new Intl.DateTimeFormat(undefined, { month: \"short\" });\n\t\tif (spanMs < 2 * oneDay) {\n\t\t\tconst dtfTime = new Intl.DateTimeFormat(undefined, {\n\t\t\t\thour: \"2-digit\",\n\t\t\t\tminute: \"2-digit\",\n\t\t\t});\n\t\t\teffectiveFormatTick = (v: any) => dtfTime.format(v as Date);\n\t\t} else if (spanMs < 32 * oneDay) {\n\t\t\t// Show day + short month\n\t\t\teffectiveFormatTick = (v: any) => {\n\t\t\t\tconst d = v as Date;\n\t\t\t\treturn `${d.getDate()} ${dtfMonth.format(d)}`;\n\t\t\t};\n\t\t} else if (spanMs < oneYear && sameYear) {\n\t\t\t// Show short month (year implied)\n\t\t\teffectiveFormatTick = (v: any) => dtfMonth.format(v as Date);\n\t\t} else if (spanMs < 2 * oneYear) {\n\t\t\t// Show short month + year on first month of each year maybe; keep simple: Mon YYYY\n\t\t\tconst seenMonths = new Set<number>();\n\t\t\teffectiveFormatTick = (v: any) => {\n\t\t\t\tconst d = v as Date;\n\t\t\t\tconst key = d.getMonth();\n\t\t\t\tif (!seenMonths.has(key)) {\n\t\t\t\t\tseenMonths.add(key);\n\t\t\t\t}\n\t\t\t\treturn `${dtfMonth.format(d)} ${d.getFullYear()}`;\n\t\t\t};\n\t\t} else {\n\t\t\t// Multi-year span – show year only\n\t\t\teffectiveFormatTick = (v: any) => String((v as Date).getFullYear());\n\t\t}\n\t}\n\n\tif (!resolvedScale || !dims) return null;\n\n\tif (type === \"x\") {\n\t\tconst y = offset ?? dims.innerHeight;\n\t\tconst isBandScale = typeof (resolvedScale as any).bandwidth === \"function\";\n\t\tconst bandwidth = isBandScale ? (resolvedScale as any).bandwidth() : 0;\n\t\tconst tickPos = (t: any) => {\n\t\t\tconst base = resolvedScale(t);\n\t\t\treturn isBandScale ? base + bandwidth / 2 : base;\n\t\t};\n\t\t// Determine min spacing (auto or explicit)\n\t\tlet resolvedMinSpacing = minLabelSpacing ?? 0;\n\t\tif (\n\t\t\tautoMinLabelSpacing &&\n\t\t\t(minLabelSpacing === undefined || minLabelSpacing === null)\n\t\t) {\n\t\t\t// Approximate per-label pixel width = avg length * 6 (rough chars * px). Add padding.\n\t\t\tconst labels = ticks.map((t) =>\n\t\t\t\teffectiveFormatTick(t).replace(/\\n.*/g, \"\")\n\t\t\t); // first line only for width\n\t\t\tconst avgLen = labels.length\n\t\t\t\t? labels.reduce((a, b) => a + b.length, 0) / labels.length\n\t\t\t\t: 0;\n\t\t\tresolvedMinSpacing = Math.max(12, Math.round(avgLen * 6 + 4));\n\t\t}\n\t\t// Optionally filter ticks to avoid overlap based on pixel distance\n\t\tconst filteredTicks = React.useMemo(() => {\n\t\t\t// If user supplied explicit tickValues we render them all (no auto thinning) to keep alignment with data points.\n\t\t\tif (tickValues && Array.isArray(tickValues)) return ticks;\n\t\t\tif (resolvedMinSpacing <= 0) return ticks;\n\t\t\tconst accepted: any[] = [];\n\t\t\tlet lastPos = -Infinity;\n\t\t\tfor (const t of ticks) {\n\t\t\t\tconst pos = tickPos(t);\n\t\t\t\tif (pos - lastPos >= resolvedMinSpacing) {\n\t\t\t\t\taccepted.push(t);\n\t\t\t\t\tlastPos = pos;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn accepted;\n\t\t}, [\n\t\t\tticks,\n\t\t\tresolvedScale,\n\t\t\tresolvedMinSpacing,\n\t\t\ttickValues,\n\t\t\tisBandScale,\n\t\t\tbandwidth,\n\t\t]);\n\t\treturn (\n\t\t\t<g\n\t\t\t\tclassName={[\"fdp-axis\", \"fdp-axis--x\", className]\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.join(\" \")}\n\t\t\t\ttransform={`translate(0,${y})`}\n\t\t\t\tfontFamily=\"var(--nhs-fdp-font-family-base, var(--fdp-chart-font-family))\"\n\t\t\t>\n\t\t\t\t<line x1={0} x2={dims.innerWidth} y1={0} y2={0} stroke=\"currentColor\" />\n\t\t\t\t{filteredTicks.map((t, i) => {\n\t\t\t\t\tconst rawLabel = effectiveFormatTick(t);\n\t\t\t\t\tconst displayLabel =\n\t\t\t\t\t\tmaxTickLabelLength && rawLabel.length > maxTickLabelLength\n\t\t\t\t\t\t\t? rawLabel.slice(0, Math.max(1, maxTickLabelLength - 1)) + \"…\"\n\t\t\t\t\t\t\t: rawLabel;\n\t\t\t\t\tconst lines = allowLabelWrap\n\t\t\t\t\t\t? displayLabel.split(/\\n/)\n\t\t\t\t\t\t: [displayLabel.replace(/\\n/g, \" \")];\n\t\t\t\t\tconst anchor =\n\t\t\t\t\t\tlabelAngle < 0 ? \"end\" : labelAngle > 0 ? \"start\" : \"middle\";\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<g\n\t\t\t\t\t\t\tkey={t?.toString?.() || i}\n\t\t\t\t\t\t\ttransform={`translate(${tickPos(t)},0)`}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<line y2={6} stroke=\"currentColor\" />\n\t\t\t\t\t\t\t<text\n\t\t\t\t\t\t\t\ty={9}\n\t\t\t\t\t\t\t\ttextAnchor={anchor}\n\t\t\t\t\t\t\t\tclassName=\"fdp-axis__tick\"\n\t\t\t\t\t\t\t\tdominantBaseline=\"hanging\"\n\t\t\t\t\t\t\t\ttransform={labelAngle ? `rotate(${labelAngle})` : undefined}\n\t\t\t\t\t\t\t\tfontFamily=\"inherit\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{lines.map((ln, li) => (\n\t\t\t\t\t\t\t\t\t<tspan key={li} x={0} dy={li === 0 ? 0 : \"1.1em\"}>\n\t\t\t\t\t\t\t\t\t\t{ln}\n\t\t\t\t\t\t\t\t\t</tspan>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t{displayLabel !== rawLabel && <title>{rawLabel}</title>}\n\t\t\t\t\t\t\t</text>\n\t\t\t\t\t\t</g>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</g>\n\t\t);\n\t}\n\n\treturn (\n\t\t<g\n\t\t\tclassName={[\"fdp-axis\", \"fdp-axis--y\", className]\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.join(\" \")}\n\t\t\tfontFamily=\"var(--nhs-fdp-font-family-base, var(--fdp-chart-font-family))\"\n\t\t>\n\t\t\t{/* Y-axis baseline line. With a break, leave a visual gap ABOVE the zero/x-axis line (scale unchanged). */}\n\t\t\t{(() => {\n\t\t\t\tconst showZeroAxisBreak = !!yZeroBreak?.enabled;\n\t\t\t\tconst gapPx = Math.max(AXIS_Y_ZERO_BREAK_MIN_GAP_PX, yZeroBreak?.gapPx ?? AXIS_Y_ZERO_BREAK_DEFAULT_GAP_PX);\n\t\t\t\tif (!showZeroAxisBreak) {\n\t\t\t\t\treturn <line x1={0} x2={0} y1={0} y2={dims.innerHeight} stroke=\"currentColor\" />;\n\t\t\t\t}\n\t\t\t\tconst topSolidEnd = Math.max(0, dims.innerHeight - gapPx);\n\t\t\t\treturn <line x1={0} x2={0} y1={0} y2={topSolidEnd} stroke=\"currentColor\" />;\n\t\t\t})()}\n\t\t\t{ticks.map((t, i) => {\n\t\t\t\tconst rawLabel = effectiveFormatTick(t);\n\t\t\t\tconst displayLabel =\n\t\t\t\t\tmaxTickLabelLength && rawLabel.length > maxTickLabelLength\n\t\t\t\t\t\t? rawLabel.slice(0, Math.max(1, maxTickLabelLength - 1)) + \"…\"\n\t\t\t\t\t\t: rawLabel;\n\t\t\t\tconst lines = allowLabelWrap\n\t\t\t\t\t? displayLabel.split(/\\n/)\n\t\t\t\t\t: [displayLabel.replace(/\\n/g, \" \")];\n\t\t\t\t// Skip ticks that would render inside the visual break gap\n\t\t\t\tconst showZeroAxisBreak = !!yZeroBreak?.enabled;\n\t\t\t\tif (showZeroAxisBreak) {\n\t\t\t\t\tconst gapPx = Math.max(AXIS_Y_ZERO_BREAK_MIN_GAP_PX, yZeroBreak?.gapPx ?? AXIS_Y_ZERO_BREAK_DEFAULT_GAP_PX);\n\t\t\t\t\tconst topSolidEnd = Math.max(0, dims.innerHeight - gapPx);\n\t\t\t\t\tconst yPx = resolvedScale(t);\n\t\t\t\t\tif (yPx > topSolidEnd - 1) return null;\n\t\t\t\t}\n\t\t\t\treturn (\n\t\t\t\t\t<g\n\t\t\t\t\t\tkey={t?.toString?.() || i}\n\t\t\t\t\t\ttransform={`translate(0,${resolvedScale(t)})`}\n\t\t\t\t\t>\n\t\t\t\t\t\t<line x2={-6} stroke=\"currentColor\" />\n\t\t\t\t\t\t<text\n\t\t\t\t\t\t\tx={-9}\n\t\t\t\t\t\t\tdy=\"0.32em\"\n\t\t\t\t\t\t\ttextAnchor=\"end\"\n\t\t\t\t\t\t\tclassName=\"fdp-axis__tick\"\n\t\t\t\t\t\t\tfontFamily=\"inherit\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{lines.map((ln, li) => (\n\t\t\t\t\t\t\t\t<tspan key={li} x={-9} dy={li === 0 ? 0 : \"1.1em\"}>\n\t\t\t\t\t\t\t\t\t{ln}\n\t\t\t\t\t\t\t\t</tspan>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t{displayLabel !== rawLabel && <title>{rawLabel}</title>}\n\t\t\t\t\t\t</text>\n\t\t\t\t\t</g>\n\t\t\t\t);\n\t\t\t})}\n\t\t\t{!!yZeroBreak?.enabled && (() => {\n\t\t\t\t// Visual break entirely inside the plotting area (above the x-axis). Scale and ticks unchanged.\n\t\t\t\tconst gapPx = Math.max(AXIS_Y_ZERO_BREAK_MIN_GAP_PX, yZeroBreak?.gapPx ?? AXIS_Y_ZERO_BREAK_DEFAULT_GAP_PX);\n\t\t\t\t// Define the vertical space available for the break indicator\n\t\t\t\tconst bottom = dims.innerHeight;\n\t\t\t\tconst top = 0;\n\t\t\t\tconst topSolidEnd = Math.max(top, bottom - gapPx);\n\t\t\t\t// Centered-only behaviour: slot spans entire gap\n\t\t\t\tconst slotTop = topSolidEnd;\n\t\t\t\tconst slotBottom = bottom;\n\t\t\t\tconst slotHeight = Math.max(4, slotBottom - slotTop);\n\t\t\t\t// Determine zig-zag geometry from props (fixed, do not auto-expand to fill)\n\t\t\t\tconst defaultAmp = AXIS_ZIGZAG_DEFAULT_AMPLITUDE_PX;\n\t\t\t\tconst defaultCycles = AXIS_ZIGZAG_DEFAULT_CYCLES;\n\t\t\t\tconst amp = Math.max(1, Math.round(yZeroBreak?.zigZag?.amplitudePx ?? defaultAmp));\n\t\t\t\tconst stepX = Math.max(1, Math.round(yZeroBreak?.zigZag?.stepXPx ?? AXIS_ZIGZAG_DEFAULT_STEP_X_PX));\n\t\t\t\tconst desired = yZeroBreak?.zigZag?.heightPx ?? AXIS_ZIGZAG_DEFAULT_HEIGHT_PX;\n\t\t\t\tconst heightDesired = Math.max(4, Math.round(desired ?? 0));\n\t\t\t\tlet cycles: number;\n\t\t\t\tlet zigLen: number;\n\t\t\t\tif (yZeroBreak?.zigZag?.heightPx && yZeroBreak.zigZag.heightPx > 0) {\n\t\t\t\t\t// Use desired height; compute cycles from height and amplitude\n\t\t\t\t\tconst maxHeight = Math.max(4, Math.min(slotHeight - 2, heightDesired));\n\t\t\t\t\tcycles = Math.max(1, Math.floor(maxHeight / (2 * amp)));\n\t\t\t\t\tzigLen = Math.max(0, Math.min(maxHeight, cycles * 2 * amp));\n\t\t\t\t} else if (typeof yZeroBreak?.zigZag?.cycles === \"number\" && (yZeroBreak?.zigZag?.cycles as number) > 0) {\n\t\t\t\t\tcycles = Math.max(1, Math.round(yZeroBreak.zigZag!.cycles as number));\n\t\t\t\t\tzigLen = cycles * 2 * amp;\n\t\t\t\t\t// Ensure it doesn't exceed the available slot\n\t\t\t\t\tzigLen = Math.min(zigLen, slotHeight - 2);\n\t\t\t\t\tcycles = Math.max(1, Math.floor(zigLen / (2 * amp)));\n\t\t\t\t} else {\n\t\t\t\t\t// Defaults\n\t\t\t\t\tcycles = defaultCycles;\n\t\t\t\t\tzigLen = Math.min(slotHeight - 2, cycles * 2 * amp);\n\t\t\t\t\tcycles = Math.max(1, Math.floor(zigLen / (2 * amp)));\n\t\t\t\t}\n\t\t\t\t// Always center within slot\n\t\t\t\tconst zigStart = slotTop + (slotHeight - zigLen) / 2;\n\t\t\t\tconst zigEnd = zigStart + zigLen;\n\t\t\t\t// Build path starting halfway through a wave cycle (rightwards first): half-segment, then full pairs, then half-segment (mirrored)\n\t\t\t\tlet d = `M0,0`;\n\t\t\t\tconst pairCount = zigLen > 0 ? Math.max(0, Math.floor((zigLen - amp) / (2 * amp))) : 0;\n\t\t\t\tconst halfDy = Math.max(0, (zigLen - pairCount * 2 * amp) / 2);\n\t\t\t\tconst halfDx = amp > 0 ? (stepX * (halfDy / amp)) : 0;\n\t\t\t\t// Top half (right)\n\t\t\t\tif (halfDy > 0) {\n\t\t\t\t\td += ` l${halfDx},${halfDy}`;\n\t\t\t\t}\n\t\t\t\t// Full pairs (left then right)\n\t\t\t\tfor (let i = 0; i < pairCount; i++) {\n\t\t\t\t\td += ` l-${stepX},${amp} l${stepX},${amp}`;\n\t\t\t\t}\n\t\t\t\t// Bottom half (left)\n\t\t\t\tif (halfDy > 0) {\n\t\t\t\t\td += ` l-${halfDx},${halfDy}`;\n\t\t\t\t}\n\t\t\t\treturn (\n\t\t\t\t\t<g>\n\t\t\t\t\t\t{/* Upper dotted guide from end of solid baseline down to zig-zag start */}\n\t\t\t\t\t\t<line x1={0} x2={0} y1={topSolidEnd} y2={zigStart} stroke=\"currentColor\" />\n\t\t\t\t\t\t{/* Centered (or top-padded) zig-zag */}\n\t\t\t\t\t\t<g transform={`translate(0,${zigStart})`} aria-hidden=\"true\">\n\t\t\t\t\t\t\t<path d={d} stroke=\"currentColor\" fill=\"none\" />\n\t\t\t\t\t\t</g>\n\t\t\t\t\t\t{/* Lower dotted guide from zig-zag end down to the x-axis line (0) */}\n\t\t\t\t\t\t<line x1={0} x2={0} y1={zigEnd} y2={bottom} stroke=\"currentColor\" />\n\t\t\t\t\t\t{/* Zero label aligned with the x-axis line */}\n\t\t\t\t\t\t<g transform={`translate(0,${bottom})`}>\n\t\t\t\t\t\t\t<text x={-9} dy=\"0.32em\" textAnchor=\"end\" className=\"fdp-axis__tick\" fontFamily=\"inherit\">0</text>\n\t\t\t\t\t\t</g>\n\t\t\t\t\t</g>\n\t\t\t\t);\n\t\t\t})()}\n\t\t\t{label && (\n\t\t\t\t<text\n\t\t\t\t\ttransform=\"rotate(-90)\"\n\t\t\t\t\tx={-dims.innerHeight / 2}\n\t\t\t\t\ty={-dims.margin.left + 12}\n\t\t\t\t\ttextAnchor=\"middle\"\n\t\t\t\t\tclassName=\"fdp-axis__label\"\n\t\t\t\t\tfontFamily=\"inherit\"\n\t\t\t\t>\n\t\t\t\t\t{label}\n\t\t\t\t</text>\n\t\t\t)}\n\t\t</g>\n\t);\n};\n\nexport default Axis;\n","import * as React from \"react\";\nimport { useScaleContext } from \"../../core/ScaleContext\";\nimport { useChartContext } from \"../../core/ChartRoot\";\n\nexport interface GridLinesProps {\n\taxis?: \"x\" | \"y\"; // draw lines perpendicular to specified axis ticks (default y -> horizontal lines)\n\ttickCount?: number;\n\tstroke?: string;\n\tdasharray?: string;\n\tclassName?: string;\n}\n\nexport const GridLines: React.FC<GridLinesProps> = ({\n\taxis = \"y\",\n\ttickCount,\n\tstroke = \"var(--fdp-chart-grid,#e5e5e5)\",\n\tdasharray = \"2 4\",\n\tclassName,\n}) => {\n\tconst scaleCtx = useScaleContext();\n\tconst dims = useChartContext();\n\tif (!scaleCtx || !dims) return null;\n\tconst ticks =\n\t\taxis === \"y\"\n\t\t\t? scaleCtx.getYTicks(tickCount)\n\t\t\t: scaleCtx.getXTicks(tickCount);\n\treturn (\n\t\t<g className={[\"fdp-grid\", className].filter(Boolean).join(\" \")}>\n\t\t\t{axis === \"y\" &&\n\t\t\t\tticks.map((t, i) => (\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\tx1={0}\n\t\t\t\t\t\tx2={dims.innerWidth}\n\t\t\t\t\t\ty1={scaleCtx.yScale(t)}\n\t\t\t\t\t\ty2={scaleCtx.yScale(t)}\n\t\t\t\t\t\tstroke={stroke}\n\t\t\t\t\t\tstrokeDasharray={dasharray}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t{axis === \"x\" &&\n\t\t\t\tticks.map((t, i) => (\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\ty1={0}\n\t\t\t\t\t\ty2={dims.innerHeight}\n\t\t\t\t\t\tx1={scaleCtx.xScale(t)}\n\t\t\t\t\t\tx2={scaleCtx.xScale(t)}\n\t\t\t\t\t\tstroke={stroke}\n\t\t\t\t\t\tstrokeDasharray={dasharray}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t</g>\n\t);\n};\n\nexport default GridLines;\n","// Attempt to source colours from design tokens (data-viz categorical 1..12).\n// We now use static ESM JSON imports (TS resolveJsonModule) so build will surface errors\n// instead of silently swallowing them with dynamic require.\n\nimport dataVizTokens from '../../../../packages/nhs-fdp/tokens/data-viz.json';\nimport colorTokens from '../../../../packages/nhs-fdp/tokens/colors.json';\n\n// Legacy fallback (previous implementation) – retained to avoid breaking consumers\nconst legacyCategorical = [\n  '#005eb8', '#0072ce', '#41b6e6', '#00a499',\n  '#7c2855', '#330072', '#d5281b', '#ffb81c',\n  '#fae100', '#4c6272', '#768692', '#aeb7bd'\n];\n\nlet categoricalPalette: string[] | null = null;\nlet optimizedCategoricalPalette: string[] | null = null; // reordered for maximal early distinctness\nlet extendedPaletteCache: string[] | null = null; // cache including generated variants beyond base length\n\ntype CategoricalStrategy = 'optimized' | 'raw';\nlet categoricalStrategy: CategoricalStrategy = 'optimized';\n\nexport function setCategoricalColorStrategy(strategy: CategoricalStrategy) {\n  categoricalStrategy = strategy;\n}\nexport function getCategoricalColorStrategy(): CategoricalStrategy { return categoricalStrategy; }\n\nfunction buildPalette(): string[] {\n  const root: any = { color: { ...(colorTokens as any).color, ...(dataVizTokens as any).color } };\n\n    const resolve = (path: string, seen: Set<string> = new Set()): string | undefined => {\n      if (seen.has(path)) return undefined; // circular guard\n      seen.add(path);\n      const node = path.split('.').reduce((acc: any, k) => (acc ? acc[k] : undefined), root);\n      if (!node) return undefined;\n      const value = node.$value || node.value; // support raw & built forms\n      if (typeof value === 'string' && /^\\{.+\\}$/.test(value)) {\n        return resolve(value.slice(1, -1), seen);\n      }\n      if (typeof value === 'string') return value;\n      return undefined;\n    };\n\n    const palette: string[] = [];\n    try {\n      for (let i = 1; i <= 12; i++) {\n        const tokenPath = `color.data-viz.categorical.${i}`;\n        const hex = resolve(tokenPath);\n        if (!hex) throw new Error(`Missing token ${tokenPath}`);\n        palette.push(hex);\n      }\n      return palette;\n    } catch (e) {\n      return legacyCategorical; // hard fallback if tokens unexpectedly incomplete\n    }\n}\n\nfunction getPalette(): string[] {\n  if (!categoricalPalette) categoricalPalette = buildPalette();\n  return categoricalPalette;\n}\n\n// --- Perceptual distinctness optimisation (CIE Lab farthest-point sampling) ---\n// We keep this lightweight (no external deps) with approximate conversions; sufficient for ordering.\ninterface Lab { L: number; a: number; b: number }\n\nfunction hexToRgb(hex: string): { r: number; g: number; b: number } | null {\n  const m = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex.trim());\n  if (!m) return null;\n  return { r: parseInt(m[1], 16), g: parseInt(m[2], 16), b: parseInt(m[3], 16) };\n}\n\n// sRGB -> linear\nfunction srgbToLinear(x: number): number { x /= 255; return x <= 0.04045 ? x / 12.92 : Math.pow((x + 0.055) / 1.055, 2.4); }\n\nfunction rgbToXyz(r: number, g: number, b: number): { x: number; y: number; z: number } {\n  const R = srgbToLinear(r); const G = srgbToLinear(g); const B = srgbToLinear(b);\n  // Observer = 2°, Illuminant = D65\n  const x = R * 0.4124 + G * 0.3576 + B * 0.1805;\n  const y = R * 0.2126 + G * 0.7152 + B * 0.0722;\n  const z = R * 0.0193 + G * 0.1192 + B * 0.9505;\n  return { x: x * 100, y: y * 100, z: z * 100 };\n}\n\nfunction xyzToLab(x: number, y: number, z: number): Lab {\n  // D65 reference white\n  const refX = 95.047, refY = 100.0, refZ = 108.883;\n  let X = x / refX, Y = y / refY, Z = z / refZ;\n  const f = (t: number) => (t > 0.008856 ? Math.cbrt(t) : (7.787 * t) + 16 / 116);\n  X = f(X); Y = f(Y); Z = f(Z);\n  return { L: (116 * Y) - 16, a: 500 * (X - Y), b: 200 * (Y - Z) };\n}\n\nfunction hexToLab(hex: string): Lab | null {\n  const rgb = hexToRgb(hex);\n  if (!rgb) return null;\n  const xyz = rgbToXyz(rgb.r, rgb.g, rgb.b);\n  return xyzToLab(xyz.x, xyz.y, xyz.z);\n}\n\nfunction deltaE76(c1: Lab, c2: Lab): number {\n  const dL = c1.L - c2.L; const da = c1.a - c2.a; const db = c1.b - c2.b;\n  return Math.sqrt(dL * dL + da * da + db * db);\n}\n\nfunction buildOptimizedCategoricalPalette(): string[] {\n  const base = getPalette();\n  if (base.length <= 2) return base.slice();\n  const labs = base.map(c => hexToLab(c));\n  // Farthest-point sampling: start with colour having max average distance (more central choice) to others.\n  let bestStartIdx = 0; let bestAvg = -1;\n  for (let i = 0; i < base.length; i++) {\n    const li = labs[i]; if (!li) continue;\n    let total = 0; let count = 0;\n    for (let j = 0; j < base.length; j++) if (i !== j && labs[j]) { total += deltaE76(li, labs[j]!); count++; }\n    const avg = total / Math.max(1, count);\n    if (avg > bestAvg) { bestAvg = avg; bestStartIdx = i; }\n  }\n  const remaining = new Set<number>(base.map((_, i) => i));\n  const order: number[] = [];\n  order.push(bestStartIdx); remaining.delete(bestStartIdx);\n  while (remaining.size) {\n    let nextIdx = Array.from(remaining)[0];\n    let bestMin = -1;\n    for (const idx of remaining) {\n      const l = labs[idx]; if (!l) continue;\n      // Distance to closest already-picked colour\n      let minD = Infinity;\n      for (const o of order) {\n        const lo = labs[o]; if (lo) { const d = deltaE76(l, lo); if (d < minD) minD = d; }\n      }\n      if (minD > bestMin) { bestMin = minD; nextIdx = idx; }\n    }\n    order.push(nextIdx); remaining.delete(nextIdx);\n  }\n  return order.map(i => base[i]);\n}\n\nfunction getOptimizedPalette(): string[] {\n  if (!optimizedCategoricalPalette) optimizedCategoricalPalette = buildOptimizedCategoricalPalette();\n  return optimizedCategoricalPalette;\n}\n\nfunction getRawPalette(): string[] { return getPalette(); }\n\n// --- Extended palette generation for > base length ---\n// Creates lightened/darkened variants per base colour cycle while attempting to keep DeltaE separation.\ninterface RGB { r:number; g:number; b:number }\nfunction labToXyz(L:number,a:number,b:number){\n  const y = (L + 16) / 116; const x = a / 500 + y; const z = y - b / 200;\n  const f = (t:number)=>{ const t3 = t*t*t; return t3 > 0.008856 ? t3 : (t - 16/116)/7.787; };\n  const X = f(x) * 95.047; const Y = f(y) * 100; const Z = f(z) * 108.883; return {X,Y,Z};\n}\nfunction xyzToRgb(x:number,y:number,z:number): RGB {\n  x/=100; y/=100; z/=100;\n  let R = x*3.2406 + y*-1.5372 + z*-0.4986;\n  let G = x*-0.9689 + y*1.8758 + z*0.0415;\n  let B = x*0.0557 + y*-0.2040 + z*1.0570;\n  const linToSrgb = (c:number)=> c <= 0.0031308 ? 12.92*c : 1.055*Math.pow(c,1/2.4)-0.055;\n  R = Math.min(1, Math.max(0, linToSrgb(R)));\n  G = Math.min(1, Math.max(0, linToSrgb(G)));\n  B = Math.min(1, Math.max(0, linToSrgb(B)));\n  return { r: Math.round(R*255), g: Math.round(G*255), b: Math.round(B*255) };\n}\nfunction rgbToHex(r:number,g:number,b:number){ return `#${[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('')}`; }\nfunction adjustLightness(hex:string, deltaL:number): string {\n  const lab = hexToLab(hex); if(!lab) return hex;\n  const L = Math.min(100, Math.max(0, lab.L + deltaL));\n  const {X,Y,Z} = labToXyz(L, lab.a, lab.b);\n  const rgb = xyzToRgb(X,Y,Z);\n  return rgbToHex(rgb.r,rgb.g,rgb.b);\n}\n\nfunction buildExtendedPalette(): string[] {\n  const base = categoricalStrategy === 'raw' ? getRawPalette() : getOptimizedPalette();\n  // Precompute a couple of variant rounds (lighten, darken, lighten+, darken+)\n  const deltas = [12, -12, 24, -24];\n  const variants: string[][] = deltas.map(d => base.map(c => adjustLightness(c, d)));\n  // Interleave: base first, then for each variant level append its colours in optimized order.\n  const extended: string[] = [...base];\n  variants.forEach(v => extended.push(...v));\n  return extended;\n}\n\nfunction getExtendedPalette(): string[] {\n  if (!extendedPaletteCache || extendedPaletteCacheStrategyMismatch()) {\n    extendedPaletteCache = buildExtendedPalette();\n    lastExtendedStrategy = categoricalStrategy;\n  }\n  return extendedPaletteCache;\n}\nlet lastExtendedStrategy: CategoricalStrategy | null = null;\nfunction extendedPaletteCacheStrategyMismatch() { return lastExtendedStrategy !== categoricalStrategy; }\n\nexport function pickSeriesColor(i: number) {\n  const ext = getExtendedPalette();\n  return ext[i % ext.length];\n}\n\n// Export for potential external inspection/testing\nexport function getCategoricalPalette(): string[] { return [...getPalette()]; }\nexport function getOptimizedCategoricalPalette(): string[] { return [...getOptimizedPalette()]; }\nexport function getRawCategoricalPalette(): string[] { return [...getRawPalette()]; }\nexport function getExtendedCategoricalPalette(): string[] { return [...getExtendedPalette()]; }\n\n// Stroke (contrast outline) tokens\nlet categoricalStrokeMap: string[] | null = null;\nlet regionStrokeMap: Record<string,string> | null = null;\nlet severityStrokeMap: Record<string,string> | null = null;\nlet orgLevelStrokeMap: Record<string,string> | null = null;\n\nfunction buildStrokeMaps() {\n  const stroke = (dataVizTokens as any)?.color?.['data-viz']?.stroke;\n  if (stroke) {\n    const cat = stroke.categorical || {};\n    categoricalStrokeMap = [];\n    for (let i=1;i<=12;i++) {\n      const v = cat[String(i)]?.$value || cat[String(i)]?.value;\n      categoricalStrokeMap.push(typeof v === 'string' ? v : '#212b32');\n    }\n    const reg = stroke.region || {};\n    regionStrokeMap = {};\n    Object.keys(reg).forEach(k => {\n      const v = reg[k]?.$value || reg[k]?.value;\n      if (typeof v === 'string') regionStrokeMap![k] = v;\n    });\n    const sev = stroke.severity || {};\n    const org = stroke['org-level'] || {};\n    orgLevelStrokeMap = {};\n    Object.keys(org).forEach(k => {\n      const v = org[k]?.$value || org[k]?.value;\n      if (typeof v === 'string') orgLevelStrokeMap![k] = v;\n    });\n    severityStrokeMap = {};\n    Object.keys(sev).forEach(k => {\n      const v = sev[k]?.$value || sev[k]?.value;\n      if (typeof v === 'string') severityStrokeMap![k] = v;\n    });\n  }\n}\n\nfunction ensureStrokeMaps() {\n  if (!categoricalStrokeMap || !regionStrokeMap || !severityStrokeMap || !orgLevelStrokeMap) buildStrokeMaps();\n}\n\nexport function pickSeriesStroke(i: number) {\n  ensureStrokeMaps();\n  if (!categoricalStrokeMap) return '#212b32';\n  return categoricalStrokeMap[i % categoricalStrokeMap.length];\n}\n\nexport function getRegionStroke(id: string): string | undefined {\n  ensureStrokeMaps();\n  return regionStrokeMap ? regionStrokeMap[id] : undefined;\n}\n\nexport function pickRegionStroke(id: string, fallbackIndex: number): string {\n  return getRegionStroke(id) || pickSeriesStroke(fallbackIndex);\n}\n\n// Severity colours – semantic alert levels\nexport const SEVERITY_IDS = [ 'low', 'moderate', 'high', 'critical' ] as const;\nexport type SeverityId = typeof SEVERITY_IDS[number];\nlet severityMap: Record<string,string> | null = null;\n\nfunction buildSeverityMap(): Record<string,string> {\n  const root: any = { color: { ...(colorTokens as any).color, ...(dataVizTokens as any).color } };\n  const resolve = (path: string, seen: Set<string> = new Set()): string | undefined => {\n    if (seen.has(path)) return undefined;\n    seen.add(path);\n    const node = path.split('.').reduce((acc: any, k) => (acc ? acc[k] : undefined), root);\n    if (!node) return undefined;\n    const value = node.$value || node.value;\n    if (typeof value === 'string' && /^\\{.+\\}$/.test(value)) return resolve(value.slice(1,-1), seen);\n    return typeof value === 'string' ? value : undefined;\n  };\n  const map: Record<string,string> = {};\n  SEVERITY_IDS.forEach(id => {\n    const hex = resolve(`color.data-viz.severity.${id}`);\n    if (hex) map[id] = hex;\n  });\n  return map;\n}\n\nfunction getSeverityMap(): Record<string,string> { if (!severityMap) severityMap = buildSeverityMap(); return severityMap; }\nexport function getSeverityColor(id: string): string | undefined { return getSeverityMap()[id.toLowerCase()]; }\nexport function pickSeverityColor(id: string, fallbackIndex: number): string {\n  return getSeverityColor(id) || getSeverityMap()[SEVERITY_IDS[fallbackIndex % SEVERITY_IDS.length]] || pickSeriesColor(fallbackIndex);\n}\nexport function getSeverityStroke(id: string): string | undefined { ensureStrokeMaps(); return severityStrokeMap ? severityStrokeMap[id] : undefined; }\nexport function pickSeverityStroke(id: string, fallbackIndex: number): string {\n  return getSeverityStroke(id) || pickSeriesStroke(fallbackIndex);\n}\n\n// Org-level colours (trust, ambulance, icb, region)\nexport const ORG_LEVEL_IDS = [ 'trust', 'ambulance', 'icb', 'region' ] as const;\nexport type OrgLevelId = typeof ORG_LEVEL_IDS[number];\nlet orgLevelMap: Record<string,string> | null = null;\n\nfunction buildOrgLevelMap(): Record<string,string> {\n  const root: any = { color: { ...(colorTokens as any).color, ...(dataVizTokens as any).color } };\n  const resolve = (path: string, seen: Set<string> = new Set()): string | undefined => {\n    if (seen.has(path)) return undefined;\n    seen.add(path);\n    const node = path.split('.').reduce((acc: any, k) => (acc ? acc[k] : undefined), root);\n    if (!node) return undefined;\n    const value = node.$value || node.value;\n    if (typeof value === 'string' && /^\\{.+\\}$/.test(value)) return resolve(value.slice(1,-1), seen);\n    return typeof value === 'string' ? value : undefined;\n  };\n  const map: Record<string,string> = {};\n  ORG_LEVEL_IDS.forEach(id => {\n    const hex = resolve(`color.data-viz.org-level.${id}`);\n    if (hex) map[id] = hex;\n  });\n  return map;\n}\n\nfunction getOrgLevelMap(): Record<string,string> { if (!orgLevelMap) orgLevelMap = buildOrgLevelMap(); return orgLevelMap; }\nexport function getOrgLevelColor(id: string): string | undefined { return getOrgLevelMap()[id.toLowerCase()]; }\nexport function pickOrgLevelColor(id: string, fallbackIndex: number): string {\n  return getOrgLevelColor(id) || getOrgLevelMap()[ORG_LEVEL_IDS[fallbackIndex % ORG_LEVEL_IDS.length]] || pickSeriesColor(fallbackIndex);\n}\nexport function getOrgLevelStroke(id: string): string | undefined { ensureStrokeMaps(); return orgLevelStrokeMap ? orgLevelStrokeMap[id] : undefined; }\nexport function pickOrgLevelStroke(id: string, fallbackIndex: number): string {\n  return getOrgLevelStroke(id) || pickSeriesStroke(fallbackIndex);\n}\n\n// Region colours – resolved from tokens; key by region token id (kebab-case)\nlet regionMap: Record<string,string> | null = null;\n\n// Canonical list of region token ids we currently support (order stable)\nexport const REGION_IDS = [\n  'north-east',\n  'north-west',\n  'east-of-england',\n  'midlands',\n  'london',\n  'south-west',\n  'south-east'\n] as const;\nexport type RegionId = typeof REGION_IDS[number];\n\n// Normalise user supplied id variants (e.g. \"North East\", \"north_east\", \"NORTH-EAST\") to kebab-case token id.\nexport function normalizeRegionId(id: string): string {\n  return id\n    .trim()\n    .toLowerCase()\n    .replace(/&/g, 'and')\n    .replace(/[^a-z0-9]+/g, '-') // collapse any separator chars/spaces/underscores\n    .replace(/^-+|-+$/g, '');\n}\n\nfunction buildRegionMap(): Record<string,string> {\n  const root: any = { color: { ...(colorTokens as any).color, ...(dataVizTokens as any).color } };\n  const resolve = (path: string, seen: Set<string> = new Set()): string | undefined => {\n    if (seen.has(path)) return undefined;\n    seen.add(path);\n    const node = path.split('.').reduce((acc: any, k) => (acc ? acc[k] : undefined), root);\n    if (!node) return undefined;\n    const value = node.$value || node.value;\n    if (typeof value === 'string' && /^\\{.+\\}$/.test(value)) return resolve(value.slice(1,-1), seen);\n    return typeof value === 'string' ? value : undefined;\n  };\n  const map: Record<string,string> = {};\n  const missing: string[] = [];\n  REGION_IDS.forEach(id => {\n    const hex = resolve(`color.data-viz.region.${id}`);\n    if (hex) map[id] = hex; else missing.push(id);\n  });\n  if (process.env.NODE_ENV !== 'production') {\n    if (Object.keys(map).length === 0) {\n      console.warn('[DataViz] Region colour tokens unresolved \u0013 falling back to categorical colours.');\n    } else if (missing.length) {\n      console.warn(`[DataViz] Missing region colour tokens: ${missing.join(', ')}.`);\n    }\n  }\n  return map;\n}\n\nfunction getRegionMap(): Record<string,string> {\n  if (!regionMap) regionMap = buildRegionMap();\n  return regionMap;\n}\n\nexport function getRegionColor(id: string): string | undefined {\n  return getRegionMap()[normalizeRegionId(id)];\n}\n\n// Convenience: if consumer passes a region-like id we can attempt to auto-map (normalising first).\nexport function pickRegionColor(id: string, fallbackIndex: number): string {\n  return getRegionColor(id) || pickSeriesColor(fallbackIndex);\n}\n\n// Access / maintenance helpers\nexport function getAvailableRegionIds(): string[] { return [...REGION_IDS]; }\n\n// Allow consumers (e.g. during HMR in Storybook) to clear caches if token file changes at runtime.\nexport function invalidateColorCaches(options: { regions?: boolean; categorical?: boolean; strokes?: boolean } = {}) {\n  const { regions = true, categorical = false, strokes = false } = options;\n  if (regions) regionMap = null;\n  if (categorical) {\n    categoricalPalette = null;\n    optimizedCategoricalPalette = null;\n    extendedPaletteCache = null;\n  }\n  if (strokes) {\n    categoricalStrokeMap = null;\n    regionStrokeMap = null;\n  severityStrokeMap = null;\n  orgLevelStrokeMap = null;\n  }\n}\n\nexport interface AssignColorOptions {\n  palette?: 'categorical' | 'region' | 'severity' | 'org-level';\n  random?: boolean; // if true, shuffle palette order before assignment (stable per call)\n}\n\n// Assign colours to a mutable copy of the provided series objects; existing explicit s.color is preserved.\nexport function assignSeriesColors<T extends { id: string; color?: string }>(\n  series: T[],\n  { palette = 'categorical', random = false }: AssignColorOptions = {}\n): T[] {\n  const copy = series.map(s => ({ ...s }));\n  const paletteValues = palette === 'region'\n    ? copy.map((s, i) => pickRegionColor(s.id, i))\n    : palette === 'severity'\n      ? copy.map((s,i)=> pickSeverityColor(s.id, i))\n      : palette === 'org-level'\n        ? copy.map((s,i)=> pickOrgLevelColor(s.id, i))\n    : (series.length > getOptimizedCategoricalPalette().length\n        ? getExtendedCategoricalPalette()\n        : (categoricalStrategy === 'optimized'\n            ? getOptimizedCategoricalPalette()\n            : getRawCategoricalPalette()));\n\n  let order: number[] = palette === 'region'\n    ? copy.map((_, i) => i) // region colours already derived per id position\n    : palette === 'severity'\n      ? copy.map((_, i) => i)\n      : palette === 'org-level'\n        ? copy.map((_, i) => i)\n    : [...Array(paletteValues.length).keys()];\n  if (random) {\n    // Fisher–Yates\n    for (let i = order.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [order[i], order[j]] = [order[j], order[i]];\n    }\n  }\n  let cursor = 0;\n  copy.forEach((s, si) => {\n    if (!s.color) {\n      if (palette === 'region') {\n        s.color = paletteValues[si];\n      } else {\n        const idx = order[cursor % order.length];\n        s.color = paletteValues[idx];\n        cursor++;\n      }\n    }\n  });\n  return copy;\n}\n\n// ---------------------------------------------------------------------------\n// Sequential & Diverging Colour Scale Utilities (token‑agnostic helpers)\n// ---------------------------------------------------------------------------\n\n// We intentionally keep these lightweight (no d3 dependency) by reusing the\n// CIE Lab helpers above for perceptual interpolation between arbitrary hexes.\n\nfunction labToHex(L: number, a: number, b: number): string {\n  const {X,Y,Z} = labToXyz(L,a,b);\n  const { r, g, b: bb } = xyzToRgb(X,Y,Z);\n  return rgbToHex(r,g,bb);\n}\n\nfunction interpolateLab(hexA: string, hexB: string, t: number): string {\n  const la = hexToLab(hexA); const lb = hexToLab(hexB);\n  if (!la || !lb) return t < 0.5 ? hexA : hexB;\n  const L = la.L + (lb.L - la.L) * t;\n  const a = la.a + (lb.a - la.a) * t;\n  const b = la.b + (lb.b - la.b) * t;\n  return labToHex(L, a, b);\n}\n\n// Piecewise interpolate across an ordered colour array. t in [0,1].\nfunction interpolateMulti(colors: string[], t: number): string {\n  if (colors.length === 0) return '#000000';\n  if (colors.length === 1) return colors[0];\n  const n = colors.length - 1;\n  const scaled = t * n;\n  const i = Math.min(n - 1, Math.max(0, Math.floor(scaled)));\n  const localT = scaled - i;\n  return interpolateLab(colors[i], colors[i + 1], localT);\n}\n\nexport interface SequentialScaleOptions {\n  domain: [number, number];\n  colors?: string[]; // ordered light -> dark (or vice versa; interpolation is linear across array)\n  steps?: number; // if provided with base colours length === 1 generate light/dark variants\n  clamp?: boolean;\n  baseColor?: string; // fallback single colour (default brand blue)\n  lightnessSpan?: number; // total L* delta to distribute either side when auto‑generating\n}\n\n/** Create a sequential colour scale (continuous). */\nexport function createSequentialColorScale({\n  domain,\n  colors,\n  steps = 7,\n  clamp = true,\n  baseColor = '#005eb8',\n  lightnessSpan = 60\n}: SequentialScaleOptions) {\n  let [d0, d1] = domain;\n  if (d0 === d1) { d1 = d0 + 1; } // guard zero range\n  if (d1 < d0) { const tmp = d0; d0 = d1; d1 = tmp; }\n\n  let palette: string[] = [];\n  if (colors && colors.length > 1) palette = colors.slice();\n  else if (colors && colors.length === 1) { baseColor = colors[0]; }\n  if (!palette.length) {\n    // Auto‑generate by sampling lightness around the base colour.\n    const lab = hexToLab(baseColor) || { L: 50, a: 0, b: 0 };\n    const half = lightnessSpan / 2;\n    // Distribute steps from light (higher L) to dark (lower L)\n    const minL = Math.max(2, lab.L - half);\n    const maxL = Math.min(98, lab.L + half);\n    palette = Array.from({ length: steps }).map((_, i) => {\n      const t = i / Math.max(1, steps - 1); // 0..1\n      const L = maxL - (maxL - minL) * t; // descending light->dark\n      return labToHex(L, lab.a, lab.b);\n    });\n  }\n\n  const range = d1 - d0;\n  return (value: number) => {\n    let t = (value - d0) / range; // may be <0 or >1\n    if (clamp) t = Math.min(1, Math.max(0, t));\n    return interpolateMulti(palette, t);\n  };\n}\n\nexport interface DivergingScaleOptions {\n  domain: [number, number, number]; // [min, mid, max]; mid acts as neutral pivot\n  colors?: string[]; // >=3 colours; if exactly 3 => [negative, neutral, positive]\n  negativeColor?: string; // used if no explicit colours\n  positiveColor?: string;\n  neutralColor?: string;\n  stepsPerSide?: number; // used when auto‑generating from neg/pos + neutral\n  clamp?: boolean;\n}\n\n/** Create a diverging colour scale. */\nexport function createDivergingColorScale({\n  domain,\n  colors,\n  negativeColor = '#d5281b', // NHS error/red\n  positiveColor = '#007f3b', // NHS green\n  neutralColor = '#f2f2f2',\n  stepsPerSide = 3,\n  clamp = true\n}: DivergingScaleOptions) {\n  let [d0, dm, d1] = domain;\n  // Ensure ordering\n  if (!(d0 <= dm && dm <= d1)) {\n    const sorted = [d0, dm, d1].sort((a,b)=>a-b);\n    [d0, dm, d1] = sorted as [number, number, number];\n  }\n  if (d0 === d1) { d1 = d0 + 1; dm = d0 + 0.5; }\n  if (dm === d0) dm = d0 + (d1 - d0) / 2;\n  if (dm === d1) dm = d0 + (d1 - d0) / 2;\n\n  let palette: string[] = [];\n  if (colors && colors.length >= 3) palette = colors.slice();\n  if (!palette.length) {\n    // Auto‑generate side ramps from neg/pos towards neutral (lightening each side)\n    const negLab = hexToLab(negativeColor) || { L: 40, a: 60, b: 40 } as any;\n    const posLab = hexToLab(positiveColor) || { L: 40, a: -60, b: 40 } as any;\n    const neuLab = hexToLab(neutralColor) || { L: 96, a: 0, b: 0 } as any;\n    const negRamp = Array.from({ length: stepsPerSide }).map((_, i) => {\n      const t = i / Math.max(1, stepsPerSide - 1); // 0..1 towards neutral\n      return labToHex(\n        negLab.L + (neuLab.L - negLab.L) * t,\n        negLab.a + (neuLab.a - negLab.a) * t,\n        negLab.b + (neuLab.b - negLab.b) * t\n      );\n    });\n    const posRamp = Array.from({ length: stepsPerSide }).map((_, i) => {\n      const t = i / Math.max(1, stepsPerSide - 1);\n      return labToHex(\n        neuLab.L + (posLab.L - neuLab.L) * t,\n        neuLab.a + (posLab.a - neuLab.a) * t,\n        neuLab.b + (posLab.b - neuLab.b) * t\n      );\n    });\n    // Combine, ensuring single neutral duplicate removal\n    palette = [...negRamp.slice(0, -1), ...posRamp];\n  }\n\n  // Build two segments: [d0..dm] and [dm..d1]. We normalise t separately for each half.\n  const left = palette.slice(0, Math.ceil(palette.length / 2));\n  const right = palette.slice(Math.floor(palette.length / 2));\n  return (value: number) => {\n    if (clamp) value = Math.min(d1, Math.max(d0, value));\n    if (value <= dm) {\n      const t = (value - d0) / (dm - d0 || 1);\n      return interpolateMulti(left, t);\n    }\n    const t = (value - dm) / (d1 - dm || 1);\n    return interpolateMulti(right, t);\n  };\n}\n\n// Convenience categorical wrapper that selects between scale factories based on config.\nexport type ColorScale = (value: number) => string;\nexport type ColorScaleConfig =\n  | ({ type: 'sequential' } & SequentialScaleOptions)\n  | ({ type: 'diverging' } & DivergingScaleOptions);\n\nexport function createColorScale(config: ColorScaleConfig): ColorScale {\n  if (config.type === 'sequential') return createSequentialColorScale(config);\n  return createDivergingColorScale(config);\n}\n\n","import * as React from 'react';\n\nexport interface VisibilityContextValue {\n  hiddenIds: Set<string>;\n  isHidden: (id: string) => boolean;\n  toggle: (id: string) => void;\n  showOnly: (id: string) => void;\n  showAll: () => void;\n  setHidden: (ids: string[] | Set<string>) => void;\n}\n\nconst VisibilityContext = React.createContext<VisibilityContextValue | null>(null);\nexport const useVisibility = () => React.useContext(VisibilityContext);\n\nexport interface VisibilityProviderProps {\n  initialHiddenIds?: string[];\n  children: React.ReactNode;\n  /** Optional controlled hidden set (if provided, component becomes controlled) */\n  hiddenIds?: string[];\n  onChange?: (hidden: string[]) => void;\n}\n\nexport const VisibilityProvider: React.FC<VisibilityProviderProps> = ({\n  initialHiddenIds = [],\n  children,\n  hiddenIds: controlledHidden,\n  onChange\n}) => {\n  const [uncontrolled, setUncontrolled] = React.useState<Set<string>>(() => new Set(initialHiddenIds));\n  const isControlled = controlledHidden !== undefined;\n  const hiddenSet = React.useMemo(() => isControlled ? new Set(controlledHidden) : uncontrolled, [isControlled, controlledHidden, uncontrolled]);\n\n  const update = React.useCallback((next: Set<string>) => {\n    if (!isControlled) setUncontrolled(new Set(next));\n    onChange?.(Array.from(next));\n  }, [isControlled, onChange]);\n\n  const api: VisibilityContextValue = React.useMemo(() => ({\n    hiddenIds: hiddenSet,\n    isHidden: (id: string) => hiddenSet.has(id),\n    toggle: (id: string) => {\n      const next = new Set(hiddenSet);\n      next.has(id) ? next.delete(id) : next.add(id);\n      update(next);\n    },\n  showOnly: (_id: string) => {\n      // Future: require full ids set to hide others. For now just clear hidden set making all visible.\n      update(new Set());\n    },\n    showAll: () => update(new Set()),\n    setHidden: (ids) => update(new Set(Array.isArray(ids) ? ids : Array.from(ids)))\n  }), [hiddenSet, update]);\n\n  return <VisibilityContext.Provider value={api}>{children}</VisibilityContext.Provider>;\n};\n\nexport default VisibilityContext;\n","import * as React from \"react\";\nimport { useScaleContext } from \"./ScaleContext\";\nimport { useVisibility } from \"./VisibilityContext\";\n\nexport interface TooltipDatum {\n\tseriesId: string;\n\tindex: number; // index within series\n\tx: Date | string | number; // allow categorical values\n\ty: number;\n\tclientX: number; // scaled x position within plot area\n\tclientY: number; // scaled y position within plot area\n}\n\nexport interface TooltipContextValue {\n\tfocused: TooltipDatum | null;\n\tsetFocused: (d: TooltipDatum | null) => void;\n\t/** All series points sharing the focused x (including focused point) when multiple series align. Length 0 when no focus, 1 when single. */\n\taggregated: TooltipDatum[];\n\t/** Programmatic focus of nearest datum to given SVG plot coordinates (already in inner coordinate space). */\n\tfocusNearest: (plotX: number, plotY: number) => void;\n\t/** Clear current focus */\n\tclear: () => void;\n\t/** Register series data for nearest-point lookup */\n\tregisterSeries: (\n\t\tseriesId: string,\n\t\tdata: { x: Date | string | number; y: number }[]\n\t) => void;\n\tunregisterSeries: (seriesId: string) => void;\n\t/** Move focus to next point in same series */\n\tfocusNextPoint: () => void;\n\t/** Move focus to previous point in same series */\n\tfocusPrevPoint: () => void;\n\t/** Cycle to next series at same index (if exists) */\n\tfocusNextSeries: () => void;\n\t/** Cycle to previous series at same index (if exists) */\n\tfocusPrevSeries: () => void;\n\t/** Jump to first point in current (or first) series */\n\tfocusFirstPoint: () => void;\n\t/** Jump to last point in current (or first) series */\n\tfocusLastPoint: () => void;\n}\n\nconst TooltipContext = React.createContext<TooltipContextValue | null>(null);\nexport const useTooltipContext = () => React.useContext(TooltipContext);\n\ninterface TooltipProviderProps {\n\tchildren: React.ReactNode;\n\t/** Maximum pixel distance to accept a nearest match (otherwise focus cleared) */\n\tmaxDistance?: number;\n\t/** Allow wrap-around when navigating past start/end of points or series */\n\twrapAround?: boolean;\n}\n\n/** Shared tooltip / focus context: unifies pointer & keyboard focus of a single datum across chart primitives. */\nexport const TooltipProvider: React.FC<TooltipProviderProps> = ({\n\tchildren,\n\tmaxDistance = 40,\n\twrapAround = false,\n}) => {\n\tconst scaleCtx = useScaleContext();\n\tconst visibility = useVisibility();\n\tconst [focused, setFocused] = React.useState<TooltipDatum | null>(null);\n\tconst seriesRef = React.useRef<\n\t\tMap<string, { x: Date | string | number; y: number }[]>\n\t>(new Map());\n\tconst [aggregated, setAggregated] = React.useState<TooltipDatum[]>([]);\n\n\tconst registerSeries = React.useCallback(\n\t\t(seriesId: string, data: { x: Date | string | number; y: number }[]) => {\n\t\t\tseriesRef.current.set(seriesId, data);\n\t\t},\n\t\t[]\n\t);\n\tconst unregisterSeries = React.useCallback((seriesId: string) => {\n\t\tseriesRef.current.delete(seriesId);\n\t}, []);\n\n\tconst focusNearest = React.useCallback(\n\t\t(plotX: number, plotY: number) => {\n\t\t\tif (!scaleCtx) return;\n\t\t\tconst { xScale, yScale } = scaleCtx;\n\t\t\tlet best: TooltipDatum | null = null;\n\t\t\tlet bestDist = Infinity;\n\t\t\tseriesRef.current.forEach((data, sid) => {\n\t\t\t\tdata.forEach((d, i) => {\n\t\t\t\t\tconst px = xScale(d.x);\n\t\t\t\t\tconst py = yScale(d.y);\n\t\t\t\t\tconst dx = px - plotX;\n\t\t\t\t\tconst dy = py - plotY;\n\t\t\t\t\tconst dist = Math.sqrt(dx * dx + dy * dy);\n\t\t\t\t\tif (dist < bestDist) {\n\t\t\t\t\t\tbestDist = dist;\n\t\t\t\t\t\tbest = {\n\t\t\t\t\t\t\tseriesId: sid,\n\t\t\t\t\t\t\tindex: i,\n\t\t\t\t\t\t\tx: d.x,\n\t\t\t\t\t\t\ty: d.y,\n\t\t\t\t\t\t\tclientX: px,\n\t\t\t\t\t\t\tclientY: py,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tif (best && bestDist <= maxDistance) setFocused(best);\n\t\t\telse setFocused(null);\n\t\t},\n\t\t[scaleCtx, maxDistance]\n\t);\n\n\tconst clear = React.useCallback(() => setFocused(null), []);\n\n\t// Recompute aggregated aligned points whenever focused changes\n\tReact.useEffect(() => {\n\t\tif (!focused) {\n\t\t\tsetAggregated([]);\n\t\t\treturn;\n\t\t}\n\t\t// Collect all points with identical x timestamp (exact match) across visible (registered) series\n\t\tif (!scaleCtx) return;\n\t\tconst { xScale, yScale } = scaleCtx;\n\t\tconst agg: TooltipDatum[] = [];\n\t\tseriesRef.current.forEach((data, sid) => {\n\t\t\tdata.forEach((d, i) => {\n\t\t\t\tconst match = ((): boolean => {\n\t\t\t\t\tif (focused.x instanceof Date && d.x instanceof Date)\n\t\t\t\t\t\treturn d.x.getTime() === focused.x.getTime();\n\t\t\t\t\treturn d.x === focused.x; // strict equality for non-dates\n\t\t\t\t})();\n\t\t\t\tif (match) {\n\t\t\t\t\tagg.push({\n\t\t\t\t\t\tseriesId: sid,\n\t\t\t\t\t\tindex: i,\n\t\t\t\t\t\tx: d.x,\n\t\t\t\t\t\ty: d.y,\n\t\t\t\t\t\tclientX: xScale(d.x as any),\n\t\t\t\t\t\tclientY: yScale(d.y),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t// Sort by seriesId for stable output\n\t\tagg.sort((a, b) => a.seriesId.localeCompare(b.seriesId));\n\t\tsetAggregated(agg);\n\t}, [focused, scaleCtx]);\n\n\tconst focusRelativePoint = React.useCallback(\n\t\t(delta: 1 | -1) => {\n\t\t\tif (!focused) return;\n\t\t\tconst data = seriesRef.current.get(focused.seriesId);\n\t\t\tif (!data) return;\n\t\t\tlet nextIndex = focused.index + delta;\n\t\t\tif (nextIndex < 0 || nextIndex >= data.length) {\n\t\t\t\tif (!wrapAround) return;\n\t\t\t\t// wrap\n\t\t\t\tnextIndex = (nextIndex + data.length) % data.length;\n\t\t\t}\n\t\t\tconst d = data[nextIndex];\n\t\t\tif (!scaleCtx) return;\n\t\t\tconst { xScale, yScale } = scaleCtx;\n\t\t\tsetFocused({\n\t\t\t\tseriesId: focused.seriesId,\n\t\t\t\tindex: nextIndex,\n\t\t\t\tx: d.x,\n\t\t\t\ty: d.y,\n\t\t\t\tclientX: xScale(d.x),\n\t\t\t\tclientY: yScale(d.y),\n\t\t\t});\n\t\t},\n\t\t[focused, scaleCtx, wrapAround]\n\t);\n\n\tconst focusSeriesAtIndex = React.useCallback( (seriesDelta: 1 | -1) => {\n\t\t\tlet ids = Array.from(seriesRef.current.keys());\n\t\t\t// Skip hidden series (if visibility context present)\n\t\t\tif (visibility) ids = ids.filter((id) => !visibility.isHidden(id));\n\t\t\tif (ids.length === 0) return;\n\t\t\tif (!focused) {\n\t\t\t\t// pick first series first point\n\t\t\t\tconst first = ids[0];\n\t\t\t\tconst data = seriesRef.current.get(first);\n\t\t\t\tif (!data || !scaleCtx) return;\n\t\t\t\tconst { xScale, yScale } = scaleCtx;\n\t\t\t\tconst d = data[0];\n\t\t\t\tsetFocused({\n\t\t\t\t\tseriesId: first,\n\t\t\t\t\tindex: 0,\n\t\t\t\t\tx: d.x,\n\t\t\t\t\ty: d.y,\n\t\t\t\t\tclientX: xScale(d.x),\n\t\t\t\t\tclientY: yScale(d.y),\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst currentSeriesIdx = ids.indexOf(focused.seriesId);\n\t\t\tif (currentSeriesIdx === -1) return;\n\t\t\tlet nextSeriesIdx = currentSeriesIdx + seriesDelta;\n\t\t\tif (nextSeriesIdx < 0 || nextSeriesIdx >= ids.length) {\n\t\t\t\tif (!wrapAround) return; // clamp\n\t\t\t\tnextSeriesIdx = (nextSeriesIdx + ids.length) % ids.length;\n\t\t\t}\n\t\t\tconst nextSeriesId = ids[nextSeriesIdx];\n\t\t\tconst nextData = seriesRef.current.get(nextSeriesId);\n\t\t\tif (!nextData || !scaleCtx) return;\n\t\t\tconst idx = Math.min(focused.index, nextData.length - 1);\n\t\t\tconst d = nextData[idx];\n\t\t\tconst { xScale, yScale } = scaleCtx;\n\t\t\tsetFocused({\n\t\t\t\tseriesId: nextSeriesId,\n\t\t\t\tindex: idx,\n\t\t\t\tx: d.x,\n\t\t\t\ty: d.y,\n\t\t\t\tclientX: xScale(d.x),\n\t\t\t\tclientY: yScale(d.y),\n\t\t\t});\n\t\t},\n\t\t[focused, scaleCtx, wrapAround, visibility]\n\t);\n\tconst focusFirstPoint = React.useCallback(() => {\n\t\t// Within current focused series; if none, pick first visible series\n\t\tlet ids = Array.from(seriesRef.current.keys());\n\t\tif (visibility) ids = ids.filter((id) => !visibility.isHidden(id));\n\t\tif (ids.length === 0) return;\n\t\tconst targetSeriesId = focused ? focused.seriesId : ids[0];\n\t\tconst data = seriesRef.current.get(targetSeriesId);\n\t\tif (!data || data.length === 0 || !scaleCtx) return;\n\t\tconst d = data[0];\n\t\tconst { xScale, yScale } = scaleCtx;\n\t\tsetFocused({\n\t\t\tseriesId: targetSeriesId,\n\t\t\tindex: 0,\n\t\t\tx: d.x,\n\t\t\ty: d.y,\n\t\t\tclientX: xScale(d.x),\n\t\t\tclientY: yScale(d.y),\n\t\t});\n\t}, [focused, scaleCtx, visibility]);\n\n\tconst focusLastPoint = React.useCallback(() => {\n\t\tlet ids = Array.from(seriesRef.current.keys());\n\t\tif (visibility) ids = ids.filter((id) => !visibility.isHidden(id));\n\t\tif (ids.length === 0) return;\n\t\tconst targetSeriesId = focused ? focused.seriesId : ids[0];\n\t\tconst data = seriesRef.current.get(targetSeriesId);\n\t\tif (!data || data.length === 0 || !scaleCtx) return;\n\t\tconst lastIndex = data.length - 1;\n\t\tconst d = data[lastIndex];\n\t\tconst { xScale, yScale } = scaleCtx;\n\t\tsetFocused({\n\t\t\tseriesId: targetSeriesId,\n\t\t\tindex: lastIndex,\n\t\t\tx: d.x,\n\t\t\ty: d.y,\n\t\t\tclientX: xScale(d.x),\n\t\t\tclientY: yScale(d.y),\n\t\t});\n\t}, [focused, scaleCtx, visibility]);\n\n\tconst focusNextPoint = React.useCallback(\n\t\t() => focusRelativePoint(1),\n\t\t[focusRelativePoint]\n\t);\n\tconst focusPrevPoint = React.useCallback(\n\t\t() => focusRelativePoint(-1),\n\t\t[focusRelativePoint]\n\t);\n\tconst focusNextSeries = React.useCallback(\n\t\t() => focusSeriesAtIndex(1),\n\t\t[focusSeriesAtIndex]\n\t);\n\tconst focusPrevSeries = React.useCallback(\n\t\t() => focusSeriesAtIndex(-1),\n\t\t[focusSeriesAtIndex]\n\t);\n\n\tconst value: TooltipContextValue = React.useMemo(\n\t\t() => ({\n\t\t\tfocused,\n\t\t\tsetFocused,\n\t\t\taggregated,\n\t\t\tfocusNearest,\n\t\t\tclear,\n\t\t\tregisterSeries,\n\t\t\tunregisterSeries,\n\t\t\tfocusNextPoint,\n\t\t\tfocusPrevPoint,\n\t\t\tfocusNextSeries,\n\t\t\tfocusPrevSeries,\n\t\t\tfocusFirstPoint,\n\t\t\tfocusLastPoint,\n\t\t}),\n\t\t[\n\t\t\tfocused,\n\t\t\taggregated,\n\t\t\tfocusNearest,\n\t\t\tclear,\n\t\t\tregisterSeries,\n\t\t\tunregisterSeries,\n\t\t\tfocusNextPoint,\n\t\t\tfocusPrevPoint,\n\t\t\tfocusNextSeries,\n\t\t\tfocusPrevSeries,\n\t\t\tfocusFirstPoint,\n\t\t\tfocusLastPoint,\n\t\t]\n\t);\n\n\treturn (\n\t\t<TooltipContext.Provider value={value}>{children}</TooltipContext.Provider>\n\t);\n};\n\nexport default TooltipContext;\n","import * as React from \"react\";\nimport { createLinePath } from \"../utils/scales\";\nimport { area as d3Area, curveMonotoneX } from \"d3-shape\";\nimport {\n\tpickSeriesColor,\n\tpickRegionColor,\n\tpickSeriesStroke,\n\tpickRegionStroke,\n} from \"../utils/colors\";\nimport { useScaleContext } from \"../core/ScaleContext\";\nimport { useVisibility } from \"../core/VisibilityContext\";\nimport { useTooltipContext } from \"../core/TooltipContext\";\n\nexport interface LineDatum {\n\tx: Date | string | number;\n\ty: number;\n}\nexport interface LineSeries {\n\tid: string;\n\tdata: LineDatum[];\n\tcolor?: string;\n\tlabel?: string;\n}\n\nexport interface LineSeriesPrimitiveProps {\n\tseries: LineSeries;\n\tseriesIndex: number;\n\tpalette: \"categorical\" | \"region\";\n\tshowPoints: boolean;\n\tfocusablePoints: boolean;\n\tfocusIndex: number;\n\t/** Provide parseX to avoid reallocation across series */\n\tparseX: (d: LineDatum) => Date;\n\t/** Presentation for hidden series (inherited via LineChart). */\n\tvisibilityMode?: \"remove\" | \"fade\";\n\t/** Custom stroke width for the series line (defaults to 1). */\n\tstrokeWidth?: number;\n\t/** Enable curve smoothing (monotoneX). Defaults to true. */\n\tsmooth?: boolean;\n\t/** Optional gradient fill id (linearGradient) for subtle wash under line. */\n\tgradientFillId?: string;\n\t/** Optional explicit colour palette overriding default pickSeriesColor / pickRegionColor logic.\n\t *  Precedence: series.color > colors[seriesIndex] > internal palette pickers. */\n\tcolors?: string[];\n}\n\n/** Low-level renderer for a single line series (no axes, assumes ScaleContext present). */\nexport const LineSeriesPrimitive: React.FC<LineSeriesPrimitiveProps> = ({\n\tseries,\n\tseriesIndex,\n\tpalette,\n\tshowPoints,\n\tfocusablePoints,\n\tfocusIndex,\n\tparseX,\n\tvisibilityMode = \"remove\",\n\tstrokeWidth = 1,\n\tsmooth = true,\n\tgradientFillId,\n\tcolors,\n}) => {\n\tconst scaleCtx = useScaleContext();\n\tif (!scaleCtx) return null; // safeguard\n\tconst { xScale, yScale } = scaleCtx;\n\tconst visibility = useVisibility();\n\tconst isHidden = visibility?.isHidden(series.id) ?? false;\n\tconst faded = isHidden && visibilityMode === \"fade\";\n\tif (isHidden && visibilityMode === \"remove\") {\n\t\treturn null;\n\t}\n\tconst tooltip = useTooltipContext();\n\n\t// Register series with tooltip context for nearest-point computation\n\tReact.useEffect(() => {\n\t\tif (!tooltip) return;\n\t\tconst normalized = series.data.map((d) => ({ x: parseX(d), y: d.y }));\n\t\ttooltip.registerSeries(series.id, normalized);\n\t\treturn () => tooltip.unregisterSeries(series.id);\n\t}, [tooltip, series.id, series.data, parseX]);\n\tconst path = React.useMemo(\n\t\t() =>\n\t\t\tcreateLinePath(\n\t\t\t\tseries.data,\n\t\t\t\t(d) => xScale(parseX(d)),\n\t\t\t\t(d) => yScale(d.y),\n\t\t\t\t{ smooth }\n\t\t\t),\n\t\t[series.data, xScale, yScale, parseX, smooth]\n\t);\n\t// Build an area path from the scale's lower domain bound (visual baseline) up to the series line so the gradient wash fills \"down\" fully.\n\tconst areaPath = React.useMemo(() => {\n\t\tif (!series.data.length) return \"\";\n\t\tconst [domainMin] = yScale.domain();\n\t\tconst gen = d3Area<LineDatum>()\n\t\t\t.x((d) => xScale(parseX(d)))\n\t\t\t.y0(() => yScale(domainMin))\n\t\t\t.y1((d) => yScale(d.y));\n\t\tif (smooth) gen.curve(curveMonotoneX);\n\t\treturn gen(series.data) || \"\";\n\t}, [series.data, xScale, yScale, parseX, smooth]);\n\tconst paletteOverride = colors && colors[seriesIndex];\n\tconst color =\n\t\tseries.color ||\n\t\tpaletteOverride ||\n\t\t(palette === \"region\"\n\t\t\t? pickRegionColor(series.id, seriesIndex)\n\t\t\t: pickSeriesColor(seriesIndex));\n\tconst stroke =\n\t\tpalette === \"region\"\n\t\t\t? pickRegionStroke(series.id, seriesIndex)\n\t\t\t: pickSeriesStroke(seriesIndex);\n\n\treturn (\n\t\t<g\n\t\t\tclassName=\"fdp-line-series\"\n\t\t\tdata-series={series.id}\n\t\t\topacity={faded ? 0.25 : 1}\n\t\t\taria-hidden={faded ? true : undefined}\n\t\t>\n\t\t\t{gradientFillId && (\n\t\t\t\t<path\n\t\t\t\t\td={areaPath}\n\t\t\t\t\tfill={`url(#${gradientFillId})`}\n\t\t\t\t\tstroke=\"none\"\n\t\t\t\t\trole=\"presentation\"\n\t\t\t\t\tclassName=\"fdp-line-series__gradient\"\n\t\t\t\t/>\n\t\t\t)}\n\t\t\t<path\n\t\t\t\td={path}\n\t\t\t\tfill=\"none\"\n\t\t\t\tstroke={color}\n\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\trole=\"presentation\"\n\t\t\t/>\n\t\t\t{showPoints &&\n\t\t\t\tseries.data.map((d, di) => {\n\t\t\t\t\tconst cx = xScale(parseX(d));\n\t\t\t\t\tconst cy = yScale(d.y);\n\t\t\t\t\tconst tabIndex = focusablePoints ? 0 : -1;\n\t\t\t\t\tconst isFocusedPoint =\n\t\t\t\t\t\t!faded &&\n\t\t\t\t\t\t((focusablePoints && di === focusIndex) ||\n\t\t\t\t\t\t\t(tooltip?.focused?.seriesId === series.id &&\n\t\t\t\t\t\t\t\ttooltip.focused.index === di));\n\t\t\t\t\tconst handleEnter = () => {\n\t\t\t\t\t\tif (tooltip && !faded) {\n\t\t\t\t\t\t\ttooltip.setFocused({\n\t\t\t\t\t\t\t\tseriesId: series.id,\n\t\t\t\t\t\t\t\tindex: di,\n\t\t\t\t\t\t\t\tx: parseX(d),\n\t\t\t\t\t\t\t\ty: d.y,\n\t\t\t\t\t\t\t\tclientX: cx,\n\t\t\t\t\t\t\t\tclientY: cy,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tconst handleLeave = () => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\ttooltip &&\n\t\t\t\t\t\t\ttooltip.focused?.seriesId === series.id &&\n\t\t\t\t\t\t\ttooltip.focused.index === di\n\t\t\t\t\t\t)\n\t\t\t\t\t\t\ttooltip.clear();\n\t\t\t\t\t};\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\tkey={di}\n\t\t\t\t\t\t\tcx={cx}\n\t\t\t\t\t\t\tcy={cy}\n\t\t\t\t\t\t\tr={isFocusedPoint ? 5 : 3.5}\n\t\t\t\t\t\t\tstroke={\n\t\t\t\t\t\t\t\tisFocusedPoint ? \"var(--nhs-fdp-color-primary-yellow, #ffeb3b)\" : stroke\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tstrokeWidth={isFocusedPoint ? 2 : 1}\n\t\t\t\t\t\t\tfill={\n\t\t\t\t\t\t\t\tisFocusedPoint ? \"var(--nhs-fdp-color-grey-3, #aeb7bd)\" : color\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tclassName=\"fdp-line-point\"\n\t\t\t\t\t\t\ttabIndex={faded ? -1 : tabIndex}\n\t\t\t\t\t\t\taria-label={`${series.label || series.id} ${parseX(d).toDateString()} value ${d.y}`}\n\t\t\t\t\t\t\tdata-series={series.id}\n\t\t\t\t\t\t\tdata-index={di}\n\t\t\t\t\t\t\tonMouseEnter={handleEnter}\n\t\t\t\t\t\t\tonFocus={handleEnter}\n\t\t\t\t\t\t\tonMouseLeave={handleLeave}\n\t\t\t\t\t\t\tonBlur={handleLeave}\n\t\t\t\t\t\t/>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t</g>\n\t);\n};\n\nexport default LineSeriesPrimitive;\n","import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { useTooltipContext } from \"../../../core/TooltipContext\";\nimport { useChartContext } from \"../../../core/ChartRoot\";\n// pickSeriesColor intentionally not used in SPC tooltip overlay; keep import commented for future use\n// import { pickSeriesColor } from \"../../utils/colors\";\n// AssuranceIcon import removed (utility based)\nimport {\n\textractRuleIds,\n\truleGlossary,\n\tvariationLabel,\n\tassuranceLabel,\n\tzoneLabel,\n} from \"./descriptors\";\nimport { VariationIcon, SpcRuleId, SpcRawRuleTag } from './logic/spcConstants';\nimport { getVariationColorToken } from \"./descriptors\";\nimport { Tag } from \"../../../../Tag\";\n\nimport type { EngineRowUI } from \"./SPCChart.types\";\n\ninterface SPCTooltipOverlayProps {\n\tengineRows: EngineRowUI[] | null;\n\tlimits: { mean?: number | null; sigma: number };\n\t/** Optional callback to produce rich aria / tooltip narrative for a point (index, SPCDatum-like) */\n\tpointDescriber?: (\n\t\tindex: number,\n\t\td: { x: Date | string | number; y: number }\n\t) => string | undefined;\n\t/** Optional measure name for richer value line e.g. \"85 % Hand Washing Compliance\" */\n\tmeasureName?: string;\n\t/** Optional unit e.g. '%', 'ms' */\n\tmeasureUnit?: string;\n\t/** Optional date formatter (defaults to toDateString) */\n\tdateFormatter?: (d: Date) => string;\n\t/** Show neutral special-cause (no-judgement) purple styling in tooltip. Defaults to true. */\n\tenableNeutralNoJudgement?: boolean;\n\t/** Show trend side-gating explanation text. Defaults to true. */\n\tshowTrendGatingExplanation?: boolean;\n}\n\n/**\n * SPC specific tooltip overlay enriching the basic overlay with:\n *  - Variation / assurance interpretation (improvement vs concern)\n *  - Specific special-cause rule(s) that triggered for the point\n *  - Zone classification relative to mean (inside 1σ, 1–2σ, 2–3σ, >3σ)\n */\nconst SPCTooltipOverlay: React.FC<SPCTooltipOverlayProps> = ({\n\tengineRows,\n\tlimits,\n\tpointDescriber,\n\tmeasureName,\n\tmeasureUnit,\n\tdateFormatter,\n\tenableNeutralNoJudgement = true,\n\tshowTrendGatingExplanation = true,\n}) => {\n\tconst tooltip = useTooltipContext();\n\tconst chart = useChartContext();\n\n\t// Sticky tooltip behaviour: retain last focused point while user hovers tooltip surface.\n\t// Hooks must run every render (even when no point focused) to keep order stable.\n\tconst [cachedFocus, setCachedFocus] = React.useState<any | null>(null);\n\tconst [hoveringTooltip, setHoveringTooltip] = React.useState(false);\n\tconst hideTimeoutRef = React.useRef<number | null>(null);\n\n\t// When context focus changes to a real point, cache it\n\tReact.useEffect(() => {\n\t\tif (!tooltip) return; // no context yet\n\t\tif (tooltip.focused) {\n\t\t\tsetCachedFocus(tooltip.focused);\n\t\t\tif (hideTimeoutRef.current) {\n\t\t\t\tcancelAnimationFrame(hideTimeoutRef.current);\n\t\t\t\thideTimeoutRef.current = null;\n\t\t\t}\n\t\t}\n\t\tif (!tooltip.focused && !hoveringTooltip) {\n\t\t\tconst id = requestAnimationFrame(() => {\n\t\t\t\tsetCachedFocus(null);\n\t\t\t\thideTimeoutRef.current = null;\n\t\t\t});\n\t\t\thideTimeoutRef.current = id;\n\t\t}\n\t\treturn () => {\n\t\t\tif (hideTimeoutRef.current) {\n\t\t\t\tcancelAnimationFrame(hideTimeoutRef.current);\n\t\t\t\thideTimeoutRef.current = null;\n\t\t\t}\n\t\t};\n\t}, [tooltip, tooltip?.focused, hoveringTooltip]);\n\n\t// Determine current focused point (may be null). No early returns until AFTER all hooks declared.\n\tconst focused =\n\t\ttooltip &&\n\t\t(tooltip.focused || (hoveringTooltip ? cachedFocus : null) || cachedFocus);\n\n\t// Visibility animation hooks MUST run every render to keep ordering stable.\n\tconst [visible, setVisible] = React.useState(false);\n\tReact.useEffect(() => {\n\t\tconst id = requestAnimationFrame(() => setVisible(true));\n\t\treturn () => cancelAnimationFrame(id);\n\t}, [focused?.index]);\n\n\t// Safe metrics (fallback to 0 if chart not ready so calculations still defined)\n\tconst innerWidth = chart?.innerWidth ?? 0;\n\tconst innerHeight = chart?.innerHeight ?? 0;\n\tconst clampX = focused\n\t\t? Math.min(Math.max(focused.clientX, 0), innerWidth)\n\t\t: 0;\n\tconst clampY = focused\n\t\t? Math.min(Math.max(focused.clientY, 0), innerHeight)\n\t\t: 0;\n\n\t\t// We'll render marker in SVG but move rich text into an absolutely positioned HTML portal so it can overflow chart.\n\t\t// ChartRoot provides a ref to the positioned container; narrow type for host element safely.\n\t\tconst host: HTMLElement | undefined =\n\t\t\t(chart?.ref?.current as HTMLElement | null | undefined) || undefined;\n\n\t// If no focused point yet, don't attempt to derive tooltip content.\n\tif (!focused) {\n\t\treturn null;\n\t}\n\n\t// Single series assumption for SPCChart; index aligns with engineRows order used earlier.\n\t\tconst row = engineRows?.[focused.index];\n\t\t// Keep rule ids and labels so we can apply colour logic per rule (e.g. trend always purple)\n\t\tconst ruleIds = extractRuleIds(\n\t\t\trow\n\t\t\t\t? {\n\t\t\t\t\t\tspecialCauseSinglePointUp: !!row.rules.singlePoint.up,\n\t\t\t\t\t\tspecialCauseSinglePointDown: !!row.rules.singlePoint.down,\n\t\t\t\t\t\tspecialCauseTwoOfThreeUp: !!row.rules.twoOfThree.up,\n\t\t\t\t\t\tspecialCauseTwoOfThreeDown: !!row.rules.twoOfThree.down,\n\t\t\t\t\t\tspecialCauseFourOfFiveUp: !!row.rules.fourOfFive.up,\n\t\t\t\t\t\tspecialCauseFourOfFiveDown: !!row.rules.fourOfFive.down,\n\t\t\t\t\t\tspecialCauseShiftUp: !!row.rules.shift.up,\n\t\t\t\t\t\tspecialCauseShiftDown: !!row.rules.shift.down,\n\t\t\t\t\t\tspecialCauseTrendUp: !!row.rules.trend.up,\n\t\t\t\t\t\tspecialCauseTrendDown: !!row.rules.trend.down,\n\t\t\t\t\t}\n\t\t\t\t: null\n\t\t);\n\tconst rules = ruleIds.map((r) => ({ id: r, label: ruleGlossary[r].tooltip })); // structured for per-rule styling\n\tconst dateObj = focused.x instanceof Date ? focused.x : new Date(focused.x);\n\tconst dateLabel = dateFormatter\n\t\t? dateFormatter(dateObj)\n\t\t: dateObj.toDateString();\n\tconst unit = measureUnit ? `${measureUnit}` : \"\";\n\tconst valueLabel =\n\t\tmeasureName || unit\n\t\t\t? `${focused.y}${unit ? \"\" + unit : \" \"}${measureName ? \" \" + measureName : \"\"}`\n\t\t\t: `${focused.y}`;\n\n\t// Variation / assurance descriptors\n\tconst variationDesc: string | null = variationLabel(row?.classification?.variation);\n\t// Assurance descriptor\n\tconst assuranceDesc: string | null = assuranceLabel(row?.classification?.assurance);\n\n\t// Zone classification relative to mean & sigma\n\tconst zone: string | null = zoneLabel(\n\t\tlimits.mean ?? null,\n\t\tlimits.sigma,\n\t\tfocused.y\n\t);\n\n\t// Build structured content blocks for NHS styled tooltip\n\tconst narrative = pointDescriber\n\t\t? pointDescriber(focused.index, { x: focused.x, y: focused.y })\n\t\t: undefined;\n\tconst showBadges = variationDesc || assuranceDesc || zone;\n\n\t// Determine if trend side-gating applies (trend flag present but variation neutral)\n\tconst trendFlag = row?.rules.trend.up || row?.rules.trend.down;\n\tconst variationNeutral = row?.classification?.variation === VariationIcon.Neither && trendFlag;\n\t// Side-gating explanatory line (only when neutrality due to being on unfavourable side)\n\tconst gatingExplanation = showTrendGatingExplanation && variationNeutral\n\t\t? 'Trend detected (monotonic run) – held neutral until values cross onto the favourable side of the mean.'\n\t\t: null;\n\tconst hasRules = rules.length > 0;\n\t// SQL compatibility metadata (present only when wrapper used). We defensively gate on property existence.\n\t// SQL compatibility metadata (present only when wrapper used). Defensively access via loose cast.\n\t\t// Optional SQL-compat metadata (if present on EngineRowUI via wrapper). Access via in-operator guards.\n\t\tconst primeDirection: string | undefined =\n\t\t\trow && \"primeDirection\" in row ? (row as Record<string, any>).primeDirection : undefined;\n\t\tconst primeRuleId: SpcRuleId | undefined =\n\t\t\trow && \"primeRuleId\" in row ? (row as Record<string, any>).primeRuleId : undefined;\n\t// \"No judgement\" (neutral special cause) state: underlying variation classified as Neither but special cause rules fired\n\tconst isNoJudgement = enableNeutralNoJudgement && row?.classification?.variation === VariationIcon.Neither && hasRules;\n\t// Provenance (ruleTags) removed from tooltip to avoid duplication with Special cause section.\n\n\t// focus ring colour\n\tconst focusYellow = \"var(--nhs-fdp-color-primary-yellow, #ffeb3b)\";\n\t// Tooltip inner dot colour: use canonical token exported from spcDescriptors\n\tconst spcDotColor = getVariationColorToken(row?.classification?.variation);\n\n\t// lineHeight constant removed (was only used for height calculation)\n\t// Height no longer needed for positioning (always placed below point)\n\n\t// Compute absolute positioning relative to chart container for portal.\n\t// Determine desired width from content (approximate character width heuristic) within bounds.\n\tconst charPx = 6.2;\n\t// Estimate width using primary textual lines (narrative / date-value) – badges and list wrap naturally\n\tconst baseLinesForMeasure = [\n\t\tnarrative || \"\",\n\t\t`${dateLabel} • ${valueLabel}`,\n\t].filter(Boolean);\n\tconst contentWidthEstimate = baseLinesForMeasure.reduce(\n\t\t(m, s) => Math.max(m, s.length * charPx + 32),\n\t\t0\n\t); // padding allowance\n\tconst minWidth = 200;\n\tconst maxWidth = 440;\n\tconst boxWidth = Math.min(maxWidth, Math.max(minWidth, contentWidthEstimate));\n\n\tlet left = clampX + 12; // initial: to the right of point\n\t// Account for chart margin.top (group translate) so portal top matches visual point position.\n\tconst marginTop = (chart as any).margin?.top ?? 0;\n\t// Position tooltip below the point: top edge exactly 10px beneath the data point\n\tlet top = marginTop + clampY + 16;\n\t// If overflowing right edge, flip to left side of point\n\tif (left + boxWidth > innerWidth) {\n\t\tconst flipGap = -60; // smaller gap when flipped to sit closer to point\n\t\tleft = clampX - flipGap - boxWidth;\n\t}\n\t// Final clamp to container bounds\n\tif (left < 0) left = Math.max(0, innerWidth - boxWidth);\n\n\t// Fade-in: mount flag already handled earlier; reuse existing visible state.\n\tconst tooltipId = focused ? `spc-tooltip-${focused.index}` : \"spc-tooltip\";\n\tconst pointIndex: number = typeof focused.index === \"number\" ? focused.index : NaN;\n\tconst portal = host\n\t\t? createPortal(\n\t\t\t\t<div\n\t\t\t\t\tid={tooltipId}\n\t\t\t\t\tclassName={\n\t\t\t\t\t\t\"fdp-spc-tooltip fdp-spc-tooltip-portal\" +\n\t\t\t\t\t\t(visible ? \" is-visible\" : \"\")\n\t\t\t\t\t}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tposition: \"absolute\",\n\t\t\t\t\t\tleft,\n\t\t\t\t\t\ttop,\n\t\t\t\t\t\twidth: boxWidth,\n\t\t\t\t\t\tmaxWidth: maxWidth,\n\t\t\t\t\t\tzIndex: 10,\n\t\t\t\t\t\tpointerEvents: \"auto\",\n\t\t\t\t\t\tuserSelect: \"none\",\n\t\t\t\t\t}}\n\t\t\t\t\trole=\"tooltip\"\n\t\t\t\t\taria-live=\"polite\"\n\t\t\t\t\taria-hidden={visible ? \"false\" : \"true\"}\n\t\t\t\t\tdata-floating\n\t\t\t\t\tdata-placement={left + boxWidth + 12 > innerWidth ? \"left\" : \"right\"}\n\t\t\t\t\tonPointerEnter={() => {\n\t\t\t\t\t\tsetHoveringTooltip(true);\n\t\t\t\t\t\tif (hideTimeoutRef.current) {\n\t\t\t\t\t\t\tcancelAnimationFrame(hideTimeoutRef.current);\n\t\t\t\t\t\t\thideTimeoutRef.current = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tonPointerLeave={() => {\n\t\t\t\t\t\tsetHoveringTooltip(false);\n\t\t\t\t\t\t// if context no longer focused, clear cached after a short animation frame\n\t\t\t\t\t\tif (!tooltip?.focused) {\n\t\t\t\t\t\t\tconst id = requestAnimationFrame(() => {\n\t\t\t\t\t\t\t\tsetCachedFocus(null);\n\t\t\t\t\t\t\t\thideTimeoutRef.current = null;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\thideTimeoutRef.current = id;\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"fdp-spc-tooltip__body\">\n\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section fdp-spc-tooltip__section--point\">\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section-label\">\n\t\t\t\t\t\t\t\t<strong>Point</strong>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__primary-line\">Index: {pointIndex}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section fdp-spc-tooltip__section--date\">\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section-label\">\n\t\t\t\t\t\t\t\t<strong>Date</strong>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__primary-line\">{dateLabel}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section fdp-spc-tooltip__section--value\">\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section-label\">\n\t\t\t\t\t\t\t\t<strong>Value</strong>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__primary-line\">{valueLabel}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/* {narrative && (\n\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section fdp-spc-tooltip__section--narrative\">\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__narrative\">{narrative}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)} */}\n\t\t\t\t\t\t{showBadges && (\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section fdp-spc-tooltip__section--signals\">\n\t\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section-label\">\n\t\t\t\t\t\t\t\t\t<strong>Signals</strong>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__badges\" aria-label=\"Signals\">\n\t\t\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t\t\t// Prefer explicit improvement/concern wording; override with purple no-judgement if neutral + special cause\n\t\t\t\t\t\t\t\t\t\tif (variationDesc?.toLowerCase().includes(\"concern\")) {\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext={variationDesc}\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc-tooltip__tag fdp-spc-tag fdp-spc-tag--concern\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (variationDesc?.toLowerCase().includes(\"improvement\")) {\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext={variationDesc}\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc-tooltip__tag fdp-spc-tag fdp-spc-tag--improvement\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (isNoJudgement) {\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext={\"No judgement\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc-tooltip__tag fdp-spc-tag fdp-spc-tag--no-judgement\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Neutral special cause (no directional judgement)\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (variationDesc) {\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext={variationDesc}\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc-tooltip__tag fdp-spc-tag fdp-spc-tag--common\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{assuranceDesc && (\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section fdp-spc-tooltip__section--assurance\">\n\t\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section-label\">\n\t\t\t\t\t\t\t\t\t<strong>Assurance</strong>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__badges\" aria-label=\"Limits\">\n\t\t\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t\t\tconst lower = assuranceDesc.toLowerCase();\n\t\t\t\t\t\t\t\t\t\t// Treat explicit 'not met' (or 'not achieved') as fail; require standalone 'met' / 'achieved' for pass.\n\t\t\t\t\t\t\t\t\t\tconst isFail = lower.includes(\"not met\") || lower.includes(\"not achieved\");\n\t\t\t\t\t\t\t\t\t\t// Pass if contains 'met' or 'achieved' and not a fail phrase.\n\t\t\t\t\t\t\t\t\t\tconst isPass = !isFail && (/(^|\\b)(met|achieved)(\\b|$)/).test(lower);\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\ttext={assuranceDesc}\n\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t// Pass -> improvement (blue), Fail -> concern (orange)\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`fdp-spc-tooltip__tag fdp-spc-tag fdp-spc-tag--assurance ${isPass ? \"fdp-spc-tag--improvement\" : \"fdp-spc-tag--concern\"}`}\n\t\t\t\t\t\t\t\t\t\t\t\taria-label={`Assurance: ${assuranceDesc}`}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{zone && (\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section fdp-spc-tooltip__section--limits\">\n\t\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section-label\">\n\t\t\t\t\t\t\t\t\t<strong>Control Limits & Sigma</strong>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__badges\" aria-label=\"Limits\">\n\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\ttext={(() => {\n\t\t\t\t\t\t\t\t\t\t\tconst z = zone.toLowerCase();\n\t\t\t\t\t\t\t\t\t\t\tif (z.startsWith(\"within 1\")) return \"≤1σ\";\n\t\t\t\t\t\t\t\t\t\t\tif (z.startsWith(\"1–2\")) return \"1–2σ\";\n\t\t\t\t\t\t\t\t\t\t\tif (z.startsWith(\"2–3\")) return \"2–3σ\";\n\t\t\t\t\t\t\t\t\t\t\tif (z.startsWith(\">3\")) return \">3σ\";\n\t\t\t\t\t\t\t\t\t\t\treturn zone;\n\t\t\t\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t\t\t\t\tcolor={\n\t\t\t\t\t\t\t\t\t\t\tzone.includes(\">3\")\n\t\t\t\t\t\t\t\t\t\t\t\t? \"orange\"\n\t\t\t\t\t\t\t\t\t\t\t\t: zone.includes(\"2–3\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"yellow\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"grey\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\taria-label={`Sigma zone: ${zone}`}\n\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc-tooltip__tag fdp-spc-tag fdp-spc-tag--zone\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{gatingExplanation && (\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section fdp-spc-tooltip__section--gating\" data-gating>\n\t\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section-label\"><strong>Trend gating</strong></div>\n\t\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__explanation\" aria-live=\"off\">{gatingExplanation}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{hasRules && (\n\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section fdp-spc-tooltip__section--rules\">\n\t\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section-label\">\n\t\t\t\t\t\t\t\t\t<strong>Special cause</strong>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc-tooltip__rule-tags\"\n\t\t\t\t\t\t\t\t\taria-label=\"Special cause rules\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{rules.map(({ id, label }) => {\n\t\t\t\t\t\t\t\t\t\tconst idStr = String(id);\n\t\t\t\t\t\t\t\t\t\tconst isTrend = idStr === SpcRawRuleTag.TrendIncreasing || idStr === SpcRawRuleTag.TrendDecreasing;\n\t\t\t\t\t\t\t\t\t\t// Trend special cause stays purple (common) even if overall variation is improvement/concern (side-gated neutrality visual cue)\n\t\t\t\t\t\t\t\t\t\tconst ruleColorClass = isTrend\n\t\t\t\t\t\t\t\t\t\t\t? 'fdp-spc-tag--trend'\n\t\t\t\t\t\t\t\t\t\t\t: isNoJudgement\n\t\t\t\t\t\t\t\t\t\t\t\t? 'fdp-spc-tag--no-judgement'\n\t\t\t\t\t\t\t\t\t\t\t\t: variationDesc\n\t\t\t\t\t\t\t\t\t\t\t\t\t? variationDesc.toLowerCase().includes('concern')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'fdp-spc-tag--concern'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: variationDesc.toLowerCase().includes('improvement')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'fdp-spc-tag--improvement'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'fdp-spc-tag--common'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'fdp-spc-tag--common';\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\tkey={idStr}\n\t\t\t\t\t\t\t\t\t\t\t\ttext={label}\n\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`fdp-spc-tooltip__tag fdp-spc-tag ${ruleColorClass}`}\n\t\t\t\t\t\t\t\t\t\t\t\tdata-rule-id={idStr}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{ primeDirection && (\n\t\t\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section fdp-spc-tooltip__section--rules\" style={{ marginTop: 16 }}>\n\t\t\t\t\t\t\t\t\t\t<div className=\"fdp-spc-tooltip__section-label\" style={{ marginBottom: 6 }}>\n\t\t\t\t\t\t\t\t\t\t\t<strong>Prime Direction</strong>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t\t\t\tconst primeColorClass = isNoJudgement\n\t\t\t\t\t\t\t\t\t\t\t\t? 'fdp-spc-tag--no-judgement'\n\t\t\t\t\t\t\t\t\t\t\t\t: variationDesc\n\t\t\t\t\t\t\t\t\t\t\t\t\t? variationDesc.toLowerCase().includes('concern')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'fdp-spc-tag--concern'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: variationDesc.toLowerCase().includes('improvement')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'fdp-spc-tag--improvement'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'fdp-spc-tag--common'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'fdp-spc-tag--common';\n\t\t\t\t\t\t\t\t\t\t\tconst primeLabel = `${primeDirection}${primeRuleId ? ` (${primeRuleId})` : ''}`;\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext={primeLabel}\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={`fdp-spc-tooltip__tag fdp-spc-tag ${primeColorClass}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={`Prime direction ${primeDirection}${primeRuleId ? ` via ${primeRuleId}` : ''}`}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>,\n\t\t\t\thost\n\t\t\t)\n\t\t: null;\n\n\treturn (\n\t\t<g\n\t\t\tclassName=\"fdp-tooltip-layer fdp-spc-tooltip\"\n\t\t\tpointerEvents=\"none\"\n\t\t\taria-hidden=\"true\"\n\t\t>\n\t\t\t<circle\n\t\t\t\tcx={clampX}\n\t\t\t\tcy={clampY}\n\t\t\t\tr={7}\n\t\t\t\tfill=\"none\"\n\t\t\t\tstroke={focusYellow}\n\t\t\t\tstrokeWidth={3}\n\t\t\t/>\n\t\t\t<circle\n\t\t\t\tcx={clampX}\n\t\t\t\tcy={clampY}\n\t\t\t\tr={5}\n\t\t\t\tfill=\"#000\"\n\t\t\t\tstroke={focusYellow}\n\t\t\t\tstrokeWidth={1.5}\n\t\t\t/>\n\t\t\t<circle\n\t\t\t\tcx={clampX}\n\t\t\t\tcy={clampY}\n\t\t\t\tr={2.5}\n\t\t\t\tfill={spcDotColor}\n\t\t\t\tstroke=\"#fff\"\n\t\t\t\tstrokeWidth={0.5}\n\t\t\t/>\n\t\t\t{portal}\n\t\t</g>\n\t);\n};\n\nexport default SPCTooltipOverlay;\n","import * as React from 'react';\nimport { useTooltipContext } from '../core/TooltipContext';\n\n/**\n * ARIA live region announcing the currently focused data point for screen reader users.\n * Mount inside TooltipProvider scope (e.g. within LineChart). Hidden visually.\n */\nconst VisuallyHiddenLiveRegion: React.FC<{ polite?: boolean; format?: (d: { seriesId: string; x: Date | string | number; y: number; index: number }) => string }>\n  = ({ polite = true, format }) => {\n  const tooltip = useTooltipContext();\n  const [message, setMessage] = React.useState('');\n  const lastRef = React.useRef<string>('');\n\n  React.useEffect(() => {\n    if (!tooltip?.focused) return;\n    const { focused, aggregated } = tooltip;\n    let msg: string;\n    if (aggregated && aggregated.length > 1) {\n      // Aggregate announcement\n      const parts = aggregated.map(a => `${a.seriesId} ${a.y}`).join('; ');\n  const xLabel = focused.x instanceof Date ? focused.x.toDateString() : String(focused.x);\n  msg = `${xLabel} – ${parts}`;\n    } else {\n      msg = format ? format({ seriesId: focused.seriesId, x: focused.x, y: focused.y, index: focused.index })\n        : defaultFormatter(focused.seriesId, focused.x, focused.y, focused.index);\n    }\n    if (msg !== lastRef.current) {\n      lastRef.current = msg;\n      // Force screen reader to re-announce by clearing then setting (some AT benefit from refresh)\n      setMessage('');\n      const timeout = setTimeout(() => setMessage(msg), 10);\n      return () => clearTimeout(timeout);\n    }\n  }, [tooltip?.focused, format]);\n\n  return (\n    <div\n      aria-live={polite ? 'polite' : 'assertive'}\n      aria-atomic=\"true\"\n      style={{ position: 'absolute', width: 1, height: 1, margin: -1, padding: 0, overflow: 'hidden', clip: 'rect(0 0 0 0)', border: 0 }}\n    >\n      {message}\n    </div>\n  );\n};\n\nfunction defaultFormatter(seriesId: string, x: Date | string | number, y: number, index: number) {\n  const xLabel = x instanceof Date ? x.toDateString() : String(x);\n  return `Series ${seriesId}, point ${index + 1}, ${xLabel}, value ${y}`;\n}\n\nexport default VisuallyHiddenLiveRegion;\n","import type { SPCSignalFocusInfo, EngineRowUI } from \"./SPCChart.types\";\nimport * as React from \"react\";\nimport { useTooltipContext } from \"../../../core/TooltipContext\";\nimport { VariationIcon, SpcRawRuleTag } from \"./logic/spcConstants\";\nimport {\n\textractRuleIds,\n\truleGlossary,\n\tvariationLabel,\n\tassuranceLabel,\n} from \"./descriptors\";\nimport { Tag } from \"../../../../Tag\";\n\nexport interface SPCSignalsInspectorProps {\n\t/** Engine rows from buildSpc; used to read variation/assurance and rule flags */\n\tengineRows: EngineRowUI[] | null;\n\t/** Optional measure name/unit for labels */\n\tmeasureName?: string;\n\tmeasureUnit?: string;\n\t/** Optional callback fired whenever the focused point changes (via keyboard or nav buttons). */\n\tonSignalFocus?: (info: SPCSignalFocusInfo) => void;\n}\n\n/**\n * Minimal, additive Signals Inspector.\n * - Listens to TooltipContext focus and renders details for the focused point.\n * - Shows value, variation classification, assurance, and triggered rules (with narration).\n * - Keyboard arrows via InteractionLayer already drive focus; this panel mirrors that state.\n */\nconst SPCSignalsInspector: React.FC<SPCSignalsInspectorProps> = ({\n\tengineRows,\n\tmeasureName,\n\tmeasureUnit,\n\tonSignalFocus,\n}) => {\n\tconst t = useTooltipContext();\n\tconst focused = t?.focused ?? null;\n\tconst index = focused?.index ?? null;\n\tconst row =\n\t\ttypeof index === \"number\" && engineRows ? engineRows[index] : null;\n\n\tconst rules = React.useMemo(\n\t\t() =>\n\t\t\trow\n\t\t\t\t? extractRuleIds({\n\t\t\t\t\tspecialCauseSinglePointUp: !!row.rules.singlePoint.up,\n\t\t\t\t\tspecialCauseSinglePointDown: !!row.rules.singlePoint.down,\n\t\t\t\t\tspecialCauseTwoOfThreeUp: !!row.rules.twoOfThree.up,\n\t\t\t\t\tspecialCauseTwoOfThreeDown: !!row.rules.twoOfThree.down,\n\t\t\t\t\tspecialCauseFourOfFiveUp: !!row.rules.fourOfFive.up,\n\t\t\t\t\tspecialCauseFourOfFiveDown: !!row.rules.fourOfFive.down,\n\t\t\t\t\tspecialCauseShiftUp: !!row.rules.shift.up,\n\t\t\t\t\tspecialCauseShiftDown: !!row.rules.shift.down,\n\t\t\t\t\tspecialCauseTrendUp: !!row.rules.trend.up,\n\t\t\t\t\tspecialCauseTrendDown: !!row.rules.trend.down,\n\t\t\t\t  })\n\t\t\t\t: [],\n\t\t[row]\n\t);\n\tconst uniqueRuleNarr = React.useMemo(\n\t\t() =>\n\t\t\tArray.from(\n\t\t\t\tnew Set(rules.map((r) => ruleGlossary[r]?.narration).filter(Boolean))\n\t\t\t),\n\t\t[rules]\n\t);\n\n\t// Derived descriptors (reuse tooltip overlay phrasing & colour classes)\n\tconst variationDesc: string | null = row\n\t\t? variationLabel(row.classification?.variation)\n\t\t: null;\n\tconst assuranceDesc: string | null = row\n\t\t? assuranceLabel(row.classification?.assurance)\n\t\t: null;\n\tconst hasRules = rules.length > 0;\n\tconst isNoJudgement = row\n\t\t? row.classification?.variation === VariationIcon.Neither && hasRules\n\t\t: false;\n\n\t// Fire onSignalFocus when the focused point changes (debounced to index change)\n\tconst lastKeyRef = React.useRef<string | null>(null);\n\tReact.useEffect(() => {\n\t\tif (!onSignalFocus) return;\n\t\tif (!focused || row == null) return;\n\t\tconst key = `${focused.seriesId}:${focused.index}`;\n\t\tif (lastKeyRef.current === key) return;\n\t\tlastKeyRef.current = key;\n\t\ttry {\n\t\t\tonSignalFocus({\n\t\t\t\tindex: focused.index,\n\t\t\t\tx: focused.x,\n\t\t\t\ty: focused.y,\n\t\t\t\trow,\n\t\t\t\trules,\n\t\t\t});\n\t\t} catch {\n\t\t\t// no-op: avoid throwing from effects\n\t\t}\n\t}, [focused?.seriesId, focused?.index, focused?.x, focused?.y, row, rules, onSignalFocus]);\n\n\treturn (\n\t\t<div\n\t\t\tclassName=\"fdp-spc-inspector\"\n\t\t\trole=\"region\"\n\t\t\taria-label=\"Signals inspector\"\n\t\t\tdata-testid=\"spc-signals-inspector\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName=\"fdp-spc-inspector__header\"\n\t\t\t\tstyle={{\n\t\t\t\t\tdisplay: \"flex\",\n\t\t\t\t\talignItems: \"center\",\n\t\t\t\t\tjustifyContent: \"space-between\",\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<strong>Signals inspector</strong>\n\t\t\t\t<div className=\"fdp-spc-inspector__nav\" aria-hidden={!t}>\n\t\t\t\t\t{/* Optional quick nav when tooltip context present */}\n\t\t\t\t\t{t && (\n\t\t\t\t\t\t<div style={{ display: \"flex\", gap: 8 }}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclassName=\"fdp-button fdp-button--secondary\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tif (!t.focused) t.focusFirstPoint();\n\t\t\t\t\t\t\t\t\telse t.focusPrevPoint();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"Previous point\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t◀\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclassName=\"fdp-button fdp-button--secondary\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tif (!t.focused) t.focusFirstPoint();\n\t\t\t\t\t\t\t\t\telse t.focusNextPoint();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"Next point\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t▶\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t{!row || !focused ? (\n\t\t\t\t<p className=\"fdp-spc-inspector__empty\">No point selected.</p>\n\t\t\t) : (\n\t\t\t\t<div className=\"fdp-spc-inspector__body\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"fdp-spc-inspector__summary\"\n\t\t\t\t\t\tstyle={{ display: \"flex\", gap: 16, flexWrap: \"wrap\" }}\n\t\t\t\t\t>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<strong>Point:</strong> {focused.index + 1}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<strong>Value:</strong> {focused.y}\n\t\t\t\t\t\t\t{measureUnit ? ` ${measureUnit}` : \"\"}\n\t\t\t\t\t\t\t{measureName ? ` ${measureName}` : \"\"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Signals badges mirroring tooltip overlay styling */}\n\t\t\t\t\t{(variationDesc || isNoJudgement || assuranceDesc) && (\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"fdp-spc-inspector__signals\"\n\t\t\t\t\t\t\tstyle={{ marginTop: 8 }}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tdisplay: \"flex\",\n\t\t\t\t\t\t\t\t\tgap: 8,\n\t\t\t\t\t\t\t\t\tflexWrap: \"wrap\",\n\t\t\t\t\t\t\t\t\talignItems: \"center\",\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t\tif (variationDesc?.toLowerCase().includes(\"concern\")) {\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\ttext={variationDesc}\n\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc-tooltip__tag fdp-spc-tag fdp-spc-tag--concern\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (variationDesc?.toLowerCase().includes(\"improvement\")) {\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\ttext={variationDesc}\n\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc-tooltip__tag fdp-spc-tag fdp-spc-tag--improvement\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (isNoJudgement) {\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\ttext=\"No judgement\"\n\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc-tooltip__tag fdp-spc-tag fdp-spc-tag--no-judgement\"\n\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Neutral special cause (no directional judgement)\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (variationDesc) {\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\ttext={variationDesc}\n\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc-tooltip__tag fdp-spc-tag fdp-spc-tag--common\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t\t\t{assuranceDesc &&\n\t\t\t\t\t\t\t\t\t(() => {\n\t\t\t\t\t\t\t\t\t\tconst lower = assuranceDesc.toLowerCase();\n\t\t\t\t\t\t\t\t\t\tconst isFail =\n\t\t\t\t\t\t\t\t\t\t\tlower.includes(\"not met\") ||\n\t\t\t\t\t\t\t\t\t\t\tlower.includes(\"not achieved\");\n\t\t\t\t\t\t\t\t\t\tconst isPass =\n\t\t\t\t\t\t\t\t\t\t\t!isFail && (/(^|\\b)(met|achieved)(\\b|$)/).test(lower);\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\t\ttext={assuranceDesc}\n\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`fdp-spc-tooltip__tag fdp-spc-tag fdp-spc-tag--assurance ${isPass ? \"fdp-spc-tag--improvement\" : \"fdp-spc-tag--concern\"}`}\n\t\t\t\t\t\t\t\t\t\t\t\taria-label={`Assurance: ${assuranceDesc}`}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Special cause rule tags with same colour logic as tooltip (trend stays purple) */}\n\t\t\t\t\t<div className=\"fdp-spc-inspector__rules\" style={{ marginTop: 8 }}>\n\t\t\t\t\t\t<strong>Special cause:</strong>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"fdp-spc-tooltip__rule-tags\"\n\t\t\t\t\t\t\taria-label=\"Special cause rules\"\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tdisplay: \"flex\",\n\t\t\t\t\t\t\t\tgap: 6,\n\t\t\t\t\t\t\t\tflexWrap: \"wrap\",\n\t\t\t\t\t\t\t\tmarginTop: 4,\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{rules.length === 0 ? (\n\t\t\t\t\t\t\t\t<span> None</span>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\trules.map((r) => {\n\t\t\t\t\t\t\t\t\tconst idStr = String(r);\n\t\t\t\t\t\t\t\t\tconst isTrend =\n\t\t\t\t\t\t\t\t\t\tidStr === SpcRawRuleTag.TrendIncreasing ||\n\t\t\t\t\t\t\t\t\t\tidStr === SpcRawRuleTag.TrendDecreasing;\n\t\t\t\t\t\t\t\t\tconst ruleColorClass = isTrend\n\t\t\t\t\t\t\t\t\t\t? \"fdp-spc-tag--trend\"\n\t\t\t\t\t\t\t\t\t\t: isNoJudgement\n\t\t\t\t\t\t\t\t\t\t\t? \"fdp-spc-tag--no-judgement\"\n\t\t\t\t\t\t\t\t\t\t\t: variationDesc\n\t\t\t\t\t\t\t\t\t\t\t\t? variationDesc.toLowerCase().includes(\"concern\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fdp-spc-tag--concern\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: variationDesc.toLowerCase().includes(\"improvement\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fdp-spc-tag--improvement\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"fdp-spc-tag--common\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"fdp-spc-tag--common\";\n\t\t\t\t\t\t\t\t\tconst label = ruleGlossary[r]?.tooltip || idStr;\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<Tag\n\t\t\t\t\t\t\t\t\t\t\tkey={idStr}\n\t\t\t\t\t\t\t\t\t\t\ttext={label}\n\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\n\t\t\t\t\t\t\t\t\t\t\tclassName={`fdp-spc-tooltip__tag fdp-spc-tag ${ruleColorClass}`}\n\t\t\t\t\t\t\t\t\t\t\tdata-rule-id={idStr}\n\t\t\t\t\t\t\t\t\t\t\ttitle={ruleGlossary[r]?.tooltip}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{uniqueRuleNarr.length > 0 && (\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"fdp-spc-inspector__narration\"\n\t\t\t\t\t\t\tstyle={{ marginTop: 8 }}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<strong>Summary:</strong> {uniqueRuleNarr.join(\"; \")}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nexport default SPCSignalsInspector;\n","// Gradient sequence utilities extracted from SPCChart.tsx for reuse and testing\n// Builds contiguous sequences of categories with optional absorption of single-length coloured runs.\n\nimport SpcGradientCategory from \"./SPCChart.constants\";\n\nexport type GradientSequence = {\n\tstart: number;\n\tend: number;\n\tcategory: SpcGradientCategory;\n};\n\n/**\n * Compute contiguous sequences from per-point gradient categories.\n *\n * Behaviour:\n * - If absorbSingles is true (default), any single-length coloured run (Concern/Improvement/NoJudgement)\n *   is converted to Common to avoid tiny slivers in the background bands.\n * - Only sequences of length >= 2 are emitted for coloured categories; Common sequences are emitted regardless.\n */\nexport function computeGradientSequences(\n\tcategories: SpcGradientCategory[],\n\tabsorbSingles: boolean = true\n): GradientSequence[] {\n\tif (!categories?.length) return [];\n\n\t// Optionally absorb any single coloured point into Common\n\tconst cats = [...categories];\n\tif (absorbSingles) {\n\t\t// Pass A: absorb a single Common bridging two identical coloured runs\n\t\t// e.g., [Imp, Imp, Common, Imp, Imp] -> [Imp, Imp, Imp, Imp, Imp]\n\t\tfor (let i = 1; i < cats.length - 1; i++) {\n\t\t\tif (\n\t\t\t\tcats[i] === SpcGradientCategory.Common &&\n\t\t\t\tcats[i - 1] === cats[i + 1] &&\n\t\t\t\tcats[i - 1] !== SpcGradientCategory.Common\n\t\t\t) {\n\t\t\t\tcats[i] = cats[i - 1];\n\t\t\t}\n\t\t}\n\n\t\t// Pass B: absorb any single-length coloured run into Common to avoid tiny slivers\n\t\tlet i = 0;\n\t\twhile (i < cats.length) {\n\t\t\tconst cat = cats[i];\n\t\t\tlet j = i + 1;\n\t\t\twhile (j < cats.length && cats[j] === cat) j++;\n\t\t\tconst runLen = j - i;\n\t\t\tif (runLen === 1 && cat !== SpcGradientCategory.Common) {\n\t\t\t\tcats[i] = SpcGradientCategory.Common;\n\t\t\t}\n\t\t\ti = j;\n\t\t}\n\t}\n\n\t// Build sequences (coloured runs must be length >= 2 after absorption)\n\tconst out: GradientSequence[] = [];\n\tif (cats.length) {\n\t\tlet start = 0;\n\t\tfor (let k = 1; k <= cats.length; k++) {\n\t\t\tif (k === cats.length || cats[k] !== cats[start]) {\n\t\t\t\tconst runCat = cats[start];\n\t\t\t\tconst end = k - 1;\n\t\t\t\tconst len = end - start + 1;\n\t\t\t\tif (runCat === SpcGradientCategory.Common || len >= 2)\n\t\t\t\t\tout.push({ start, end, category: runCat });\n\t\t\t\tstart = k;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn out;\n}\n\nexport default { computeGradientSequences };\n","import * as React from \"react\";\nimport {\n\tSpcWarningSeverity,\n\tSpcWarningCategory,\n\tSpcWarningCode,\n} from \"./logic_v2/types\";\nimport type { SPCSignalFocusInfo } from \"./SPCChart.types\";\nimport { SpcEmbeddedIconVariant } from \"./SPCChart.constants\";\nimport type { VisualsScenario as V2VisualsScenario } from \"./logic_v2/presets\";\nimport type { SpcSettingsV26a as V2Settings, SpcRowV2 as V2Row } from \"./logic_v2/types\";\nimport type { SpcVisualCategory } from \"./logic_v2\";\nimport { ImprovementDirection, ChartType } from \"./types\";\n\nexport interface SPCDatum {\n\tx: Date | string | number;\n\ty: number;\n}\n\n// Gradient transition strategy between adjacent coloured sequences\nexport enum SequenceTransition {\n\tSlope = \"slope\", // attribute join to rising (next) or falling/flat (prev) based on delta\n\tNeutral = \"neutral\", // draw a neutral (grey) wedge between coloured runs\n\tExtend = \"extend\", // always extend previous coloured run to the next first point\n}\n\n// Visual-only mode for trend colouring\nexport enum TrendVisualMode {\n\tUngated = \"ungated\",\n\tGated = \"gated\",\n}\n\n// Optional hierarchical options to make props easier to use (non-breaking; flat props still supported)\nexport type SPCChartUIOptions = {\n\taxes?: {\n\t\talwaysShowZeroY?: boolean;\n\t\talwaysShowHundredY?: boolean;\n\t\tpercentScale?: boolean;\n\t};\n\tvisuals?: {\n\t\t// Basic visibility toggles\n\t\tshowZones?: boolean;\n\t\tshowPoints?: boolean;\n\t\tgradientSequences?: boolean;\n\t\tsequenceTransition?: SequenceTransition;\n\t\tprocessLineWidth?: number;\n\t\ttrend?: {\n\t\t\tvisualMode?: TrendVisualMode;\n\t\t\tshowGatingExplanation?: boolean;\n\t\t};\n\t\trules?: {\n\t\t\tenableNeutralNoJudgement?: boolean;\n\t\t\tenableRules?: boolean;\n\t\t\t// Prefer grouped: ui={{ visuals: { rules: { highlightOutOfControl } } }}\n\t\t\thighlightOutOfControl?: boolean;\n\t\t};\n\t};\n\toverlays?: {\n\t\tpartitionMarkers?: boolean;\n\t\ttrendStartMarkers?: boolean;\n\t\tfirstFavourableCrossMarkers?: boolean;\n\t\ttrendBridge?: boolean;\n\t\tfocusIndicator?: boolean;\n\t};\n\tinspector?: {\n\t\tshow?: boolean;\n\t\tonFocus?: (info: SPCSignalFocusInfo) => void;\n\t};\n\twarnings?: {\n\t\tshow?: boolean;\n\t\tfilter?: {\n\t\t\tseverities?: SpcWarningSeverity[];\n\t\t\tcategories?: SpcWarningCategory[];\n\t\t\tcodes?: SpcWarningCode[];\n\t\t};\n\t};\n\ticons?: {\n\t\tshow?: boolean;\n\t\tembedded?: {\n\t\t\tshow?: boolean;\n\t\t\tvariant?: SpcEmbeddedIconVariant;\n\t\t\trunLength?: number;\n\t\t};\n\t};\n};\n\nexport interface SPCChartProps {\n\t/**\n\t * @deprecated Prefer grouped form: input={{ data, targets, baselines, ghosts }}\n\t */\n\tdata?: SPCDatum[];\n\t/** Prefer grouped: a11y={{ label }} */\n\tariaLabel?: string;\n\t/** Prefer grouped: container={{ height }} */\n\theight?: number;\n\t/** Prefer grouped UI: ui={{ visuals: { showZones } }} */\n\tshowZones?: boolean;\n\t/** Prefer grouped UI: ui={{ visuals: { showPoints } }} */\n\tshowPoints?: boolean;\n\t/** Prefer grouped: a11y={{ announceFocus }} */\n\tannounceFocus?: boolean;\n\t/** Prefer grouped: container={{ className }} */\n\tclassName?: string;\n\t/** Convenience unit alias (overrides narrationContext.measureUnit). Auto-detected as '%' when all y in [0,1] if not provided */\n\t/** Prefer grouped: a11y={{ unit }} */\n\tunit?: string;\n\t/** Highlight points outside 3-sigma */\n\t/** Prefer grouped UI: ui={{ visuals: { rules: { highlightOutOfControl } } }} */\n\thighlightOutOfControl?: boolean;\n\t/** @deprecated Prefer grouped engine: engine={{ chartType }} */\n\tchartType?: ChartType;\n\t/** @deprecated Prefer grouped engine: engine={{ metricImprovement }} */\n\tmetricImprovement?: ImprovementDirection;\n\t/** Show special-cause coloured point classes */\n\tenableRules?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ icons: { show } }} */\n\tshowIcons?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ icons: { embedded: { show } } }} */\n\tshowEmbeddedIcon?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ icons: { embedded: { variant } } }} */\n\tembeddedIconVariant?: SpcEmbeddedIconVariant;\n\t/** @deprecated Prefer grouped UI: ui={{ icons: { embedded: { runLength } } }} */\n\tembeddedIconRunLength?: number;\n\t/** @deprecated Prefer grouped: input={{ targets }} */\n\ttargets?: (number | null | undefined)[];\n\t/** @deprecated Prefer grouped: input={{ baselines }} */\n\tbaselines?: (boolean | null | undefined)[];\n\t/** @deprecated Prefer grouped: input={{ ghosts }} */\n\tghosts?: (boolean | null | undefined)[];\n\t/** @deprecated Prefer grouped engine: engine={{ settings }} (SpcSettingsV26a) */\n\tsettings?: V2Settings;\n\t/** Optional contextual metadata used to enrich accessible narration. Prefer grouped: a11y={{ narrationContext }} */\n\tnarrationContext?: {\n\t\tmeasureName?: string;\n\t\tmeasureUnit?: string; // e.g. '%', 'ms', 'patients'\n\t\tdatasetContext?: string; // e.g. \"Monthly trust-wide data\"\n\t\torganisation?: string;\n\t\ttimeframe?: string; // free text timeframe summary\n\t\tadditionalNote?: string; // intervention or caveat\n\t};\n\t/** @deprecated Prefer grouped UI: ui={{ visuals: { gradientSequences } }} */\n\tgradientSequences?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ visuals: { sequenceTransition } }} */\n\tsequenceTransition?: SequenceTransition;\n\t/** @deprecated Prefer grouped UI: ui={{ visuals: { processLineWidth } }} */\n\tprocessLineWidth?: number;\n\t/** @deprecated Prefer grouped UI: ui={{ overlays: { partitionMarkers } }} */\n\tshowPartitionMarkers?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ warnings: { show } }} */\n\tshowWarningsPanel?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ warnings: { filter } }} */\n\twarningsFilter?: {\n\t\tseverities?: SpcWarningSeverity[];\n\t\tcategories?: SpcWarningCategory[];\n\t\tcodes?: SpcWarningCode[];\n\t};\n\t/** @deprecated Prefer grouped UI: ui={{ visuals: { rules: { enableNeutralNoJudgement } } }} */\n\tenableNeutralNoJudgement?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ visuals: { trend: { showGatingExplanation } } }} */\n\tshowTrendGatingExplanation?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ visuals: { trend: { visualMode } } }} */\n\ttrendVisualMode?: TrendVisualMode;\n\t/**\n\t * @deprecated This prop is now ignored; trend side gating always on\n\t */\n\tdisableTrendSideGating?: boolean;\n\t/** Optional source / citation text rendered below the chart outside the SVG for reliable layout. Prefer grouped: meta={{ source }} */\n\tsource?: React.ReactNode;\n\t/** @deprecated Prefer grouped UI: ui={{ axes: { alwaysShowZeroY } }} */\n\talwaysShowZeroY?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ axes: { alwaysShowHundredY } }} */\n\talwaysShowHundredY?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ axes: { percentScale } }} */\n\tpercentScale?: boolean;\n\t/** UI-only: show a hollow marker at the first index where a trend is detected (run reaches N). Default false. */\n\t/** @deprecated Prefer grouped UI: ui={{ overlays: { trendStartMarkers } }} */\n\tshowTrendStartMarkers?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ overlays: { firstFavourableCrossMarkers } }} */\n\tshowFirstFavourableCrossMarkers?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ overlays: { trendBridge } }} */\n\tshowTrendBridgeOverlay?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ inspector: { show } }} */\n\tshowSignalsInspector?: boolean;\n\t/** @deprecated Prefer grouped UI: ui={{ inspector: { onFocus } }} */\n\tonSignalFocus?: (info: SPCSignalFocusInfo) => void;\n\t/** Visuals preset: opt-in dataset-specific boundary window behaviour without relying on ariaLabel. Prefer grouped: visualsEngine={{ scenario }} */\n\tvisualsScenario?: V2VisualsScenario;\n\t/** When using Signals Inspector, also render a focus marker on the chart at the focused point. Default true. */\n\tshowFocusIndicator?: boolean;\n\t/** Optional v2 visuals engine settings. Prefer grouped: visualsEngine={{ settings }} */\n\tvisualsEngineSettings?: Partial<V2Settings>;\n\t/** Optional hierarchical UI options. */\n\tui?: SPCChartUIOptions;\n\t/** Optional grouped container props. Preferred over flat props when provided. */\n\tcontainer?: {\n\t\theight?: number;\n\t\tclassName?: string;\n\t};\n\t/** Optional grouped accessibility props. Preferred over flat props when provided. */\n\ta11y?: {\n\t\tlabel?: string;\n\t\tannounceFocus?: boolean;\n\t\tnarrationContext?: {\n\t\t\tmeasureName?: string;\n\t\t\tmeasureUnit?: string;\n\t\t\tdatasetContext?: string;\n\t\t\torganisation?: string;\n\t\t\ttimeframe?: string;\n\t\t\tadditionalNote?: string;\n\t\t};\n\t\tunit?: string;\n\t};\n\t/** Optional grouped input props. Preferred over flat props when provided. */\n\tinput?: {\n\t\tdata: SPCDatum[];\n\t\ttargets?: (number | null | undefined)[];\n\t\tbaselines?: (boolean | null | undefined)[];\n\t\tghosts?: (boolean | null | undefined)[];\n\t};\n\t/** Optional grouped engine props. Preferred over flat props when provided. */\n\tengine?: {\n\t\tchartType?: ChartType;\n\t\tmetricImprovement?: ImprovementDirection;\n\t\tsettings?: V2Settings;\n\t\t/** Optional UI pre-processor: auto-insert a baseline after a sustained favourable shift (XmR only). */\n\t\tautoRecalc?: {\n\t\t\tenabled?: boolean;\n\t\t\tshiftLength?: number;\n\t\t\tdeltaSigma?: number;\n\t\t\tminGap?: number;\n\t\t\t/** Optional: insert up to N baselines instead of just one. */\n\t\t\tmaxInsertions?: number;\n\t\t};\n\t};\n\t/** Optional grouped visuals engine props. Preferred over flat props when provided. */\n\tvisualsEngine?: {\n\t\tscenario?: V2VisualsScenario;\n\t\tsettings?: Partial<V2Settings>;\n\t};\n\t/** Optional: supply precomputed v2 engine rows and visuals to avoid recomputation and guarantee parity across components. */\n\tprecomputed?: {\n\t\trows: V2Row[];\n\t\tvisuals: SpcVisualCategory[];\n\t};\n\t/** Optional grouped meta props. Preferred over flat props when provided. */\n\tmeta?: {\n\t\tsource?: React.ReactNode;\n\t};\n}\n\nexport type NormalisedSpcProps = {\n\teffData: SPCDatum[];\n\teffTargets?: (number | null | undefined)[];\n\teffBaselines?: (boolean | null | undefined)[];\n\teffGhosts?: (boolean | null | undefined)[];\n\teffChartTypeCore: ChartType;\n\teffMetricImprovementCore: ImprovementDirection;\n\teffEngineSettings?: V2Settings;\n\t/** Optional UI pre-processor config resolved from engine.autoRecalc */\n\teffEngineAutoRecalc?: {\n\t\tenabled?: boolean;\n\t\tshiftLength?: number;\n\t\tdeltaSigma?: number;\n\t\tminGap?: number;\n\t\tmaxInsertions?: number;\n\t};\n\t// Optional grouped aliases precedence outputs (undefined means fall back to flat/defaults)\n\teffHeight?: number;\n\teffClassName?: string;\n\teffAriaLabel?: string;\n\teffUnit?: string;\n\teffNarrationContext?: {\n\t\tmeasureName?: string;\n\t\tmeasureUnit?: string;\n\t\tdatasetContext?: string;\n\t\torganisation?: string;\n\t\ttimeframe?: string;\n\t\tadditionalNote?: string;\n\t};\n\teffShowZones?: boolean;\n\teffShowPoints?: boolean;\n\teffHighlightOutOfControl?: boolean;\n\teffVisualsScenario?: V2VisualsScenario;\n\teffVisualsEngineSettings?: Partial<V2Settings>;\n\teffPrecomputedVisuals?: { rows: V2Row[]; visuals: SpcVisualCategory[] };\n\teffSource?: React.ReactNode;\n\teffAlwaysShowZeroY: boolean;\n\teffAlwaysShowHundredY: boolean;\n\teffPercentScale: boolean;\n\teffGradientSequences: boolean;\n\teffSequenceTransition: SequenceTransition;\n\teffProcessLineWidth: number;\n\teffTrendVisualMode: TrendVisualMode;\n\teffShowTrendGatingExplanation: boolean;\n\teffEnableNeutralNoJudgement: boolean;\n\teffEnableRules: boolean;\n\teffShowPartitionMarkers: boolean;\n\teffShowTrendStartMarkers: boolean;\n\teffShowFirstFavourableCrossMarkers: boolean;\n\teffShowTrendBridgeOverlay: boolean;\n\teffShowSignalsInspector: boolean;\n\teffOnSignalFocus?: (info: SPCSignalFocusInfo) => void;\n\teffShowWarningsPanel: boolean;\n\teffWarningsFilter?: {\n\t\tseverities?: SpcWarningSeverity[];\n\t\tcategories?: SpcWarningCategory[];\n\t\tcodes?: SpcWarningCode[];\n\t};\n\teffShowIcons: boolean;\n\teffShowEmbeddedIcon: boolean;\n\teffEmbeddedIconVariant: SpcEmbeddedIconVariant;\n\teffEmbeddedIconRunLength?: number;\n\teffShowFocusIndicator: boolean;\n};\n\nexport function normalizeSpcProps(props: SPCChartProps): NormalisedSpcProps {\n\tconst {\n\t\tui,\n\t\tinput,\n\t\tengine,\n\t\tcontainer,\n\t\ta11y,\n\t\tvisualsEngine,\n\t\tmeta,\n\t\tdata,\n\t\tariaLabel,\n\t\theight,\n\t\tshowZones,\n\t\tshowPoints,\n\t\tannounceFocus,\n\t\tclassName,\n\t\tunit,\n\t\ttargets,\n\t\tbaselines,\n\t\tghosts,\n\t\tsettings,\n\t\tchartType,\n\t\tmetricImprovement,\n\t\tgradientSequences,\n\t\tsequenceTransition,\n\t\tprocessLineWidth,\n\t\tshowPartitionMarkers,\n\t\tshowWarningsPanel,\n\t\twarningsFilter,\n\t\tenableNeutralNoJudgement,\n\t\tshowTrendGatingExplanation,\n\t\ttrendVisualMode,\n\t\talwaysShowZeroY,\n\t\talwaysShowHundredY,\n\t\tpercentScale,\n\t\tshowTrendStartMarkers,\n\t\tshowFirstFavourableCrossMarkers,\n\t\tshowTrendBridgeOverlay,\n\t\tshowSignalsInspector,\n\t\tonSignalFocus,\n\t\tshowIcons,\n\t\tshowEmbeddedIcon,\n\t\tembeddedIconVariant,\n\t\tembeddedIconRunLength,\n\t\tshowFocusIndicator,\n\t\tvisualsScenario,\n\t\tvisualsEngineSettings,\n\t\tsource,\n\t\tnarrationContext,\n\t\thighlightOutOfControl,\n\t\tprecomputed,\n\t} = props;\n\n\t// Dev-time migration guidance\n\tif (process.env.NODE_ENV !== \"production\") {\n\t\tif (\n\t\t\t!input &&\n\t\t\t(targets !== undefined || baselines !== undefined || ghosts !== undefined)\n\t\t) {\n\t\t\tconsole.warn(\n\t\t\t\t\"SPCChart: Flat input props (targets/baselines/ghosts) are deprecated. Use input={{ data, targets, baselines, ghosts }} instead.\"\n\t\t\t);\n\t\t}\n\t\tif (!engine && settings !== undefined) {\n\t\t\tconsole.warn(\n\t\t\t\t\"SPCChart: Flat engine prop 'settings' is deprecated. Use engine={{ chartType, metricImprovement, settings }}.\"\n\t\t\t);\n\t\t}\n\t\tif (\n\t\t\t!container &&\n\t\t\t(height !== undefined || className !== undefined)\n\t\t) {\n\t\t\tconsole.warn(\n\t\t\t\t\"SPCChart: Consider grouped container props. Use container={{ height, className }}.\"\n\t\t\t);\n\t\t}\n\t\tif (\n\t\t\t!a11y &&\n\t\t\t(\n\t\t\t\tariaLabel !== undefined ||\n\t\t\t\tannounceFocus !== undefined ||\n\t\t\t\tnarrationContext !== undefined ||\n\t\t\t\tunit !== undefined\n\t\t\t)\n\t\t) {\n\t\t\tconsole.warn(\n\t\t\t\t\"SPCChart: Consider grouped accessibility props. Use a11y={{ label, announceFocus, narrationContext, unit }}.\"\n\t\t\t);\n\t\t}\n\t\tif (\n\t\t\t!visualsEngine &&\n\t\t\t(visualsScenario !== undefined || visualsEngineSettings !== undefined)\n\t\t) {\n\t\t\tconsole.warn(\n\t\t\t\t\"SPCChart: Consider grouped visuals engine props. Use visualsEngine={{ scenario, settings }}.\"\n\t\t\t);\n\t\t}\n\t\tif (\n\t\t\tui?.visuals === undefined &&\n\t\t\t(showZones !== undefined || showPoints !== undefined)\n\t\t) {\n\t\t\tconsole.warn(\n\t\t\t\t\"SPCChart: Visual toggles should be grouped. Use ui={{ visuals: { showZones, showPoints } }}.\"\n\t\t\t);\n\t\t}\n\t\tif (\n\t\t\tui?.visuals?.rules === undefined &&\n\t\t\thighlightOutOfControl !== undefined\n\t\t) {\n\t\t\tconsole.warn(\n\t\t\t\t\"SPCChart: Prefer grouped rules toggle. Use ui={{ visuals: { rules: { highlightOutOfControl } } }}.\"\n\t\t\t);\n\t\t}\n\t\tif (!meta && source !== undefined) {\n\t\t\tconsole.warn(\n\t\t\t\t\"SPCChart: Consider grouped meta. Use meta={{ source }}.\"\n\t\t\t);\n\t\t}\n\t}\n\n\t// This is where the SPCChartProps are finally normalised to a single value for each prop and defaults applied.\n\t// Grouped over flat, with sensible defaults\n\tconst effData = input?.data ?? data ?? [];\n\tconst effTargets = input?.targets ?? targets;\n\tconst effBaselines = input?.baselines ?? baselines;\n\tconst effGhosts = input?.ghosts ?? ghosts;\n\tconst effChartTypeCore = engine?.chartType ?? chartType ?? ChartType.XmR;\n\tconst effMetricImprovementCore = engine?.metricImprovement ?? metricImprovement ?? ImprovementDirection.Neither;\n\tconst effEngineSettings = engine?.settings ?? settings;\n\tconst effEngineAutoRecalc = engine?.autoRecalc;\n\tconst effAlwaysShowZeroY = ui?.axes?.alwaysShowZeroY ?? alwaysShowZeroY ?? false;\n\tconst effAlwaysShowHundredY = ui?.axes?.alwaysShowHundredY ?? alwaysShowHundredY ?? false;\n\tconst effPercentScale = ui?.axes?.percentScale ?? percentScale ?? false;\n\tconst effGradientSequences = ui?.visuals?.gradientSequences ?? gradientSequences ?? true;\n\tconst effSequenceTransition = ui?.visuals?.sequenceTransition ?? sequenceTransition ?? SequenceTransition.Slope;\n\tconst effProcessLineWidth = ui?.visuals?.processLineWidth ?? processLineWidth ?? 2;\n\tconst effTrendVisualMode = ui?.visuals?.trend?.visualMode ?? trendVisualMode ?? TrendVisualMode.Ungated;\n\tconst effShowTrendGatingExplanation = ui?.visuals?.trend?.showGatingExplanation ?? showTrendGatingExplanation ?? true;\n\tconst effEnableNeutralNoJudgement = ui?.visuals?.rules?.enableNeutralNoJudgement ?? enableNeutralNoJudgement ?? true;\n\tconst effEnableRules = ui?.visuals?.rules?.enableRules ?? props.enableRules ?? true;\n\n\t// Grouped alias values (undefined means use flat/defaults in component)\n\tconst effShowZones = ui?.visuals?.showZones;\n\tconst effShowPoints = ui?.visuals?.showPoints;\n\tconst effHighlightOutOfControl = ui?.visuals?.rules?.highlightOutOfControl;\n\tconst effHeight = container?.height;\n\tconst effClassName = container?.className;\n\tconst effAriaLabel = a11y?.label;\n\tconst effUnit = a11y?.unit;\n\tconst effNarrationContext = a11y?.narrationContext;\n\tconst effVisualsScenario = visualsEngine?.scenario;\n\tconst effVisualsEngineSettings = visualsEngine?.settings;\n\tconst effSource = meta?.source;\n\tconst effShowPartitionMarkers = ui?.overlays?.partitionMarkers ?? showPartitionMarkers ?? false;\n\tconst effShowTrendStartMarkers = ui?.overlays?.trendStartMarkers ?? showTrendStartMarkers ?? false;\n\tconst effShowFirstFavourableCrossMarkers = ui?.overlays?.firstFavourableCrossMarkers ?? showFirstFavourableCrossMarkers ?? false;\n\tconst effShowTrendBridgeOverlay = ui?.overlays?.trendBridge ?? showTrendBridgeOverlay ?? false;\n\tconst effShowSignalsInspector = ui?.inspector?.show ?? showSignalsInspector ?? false;\n\tconst effOnSignalFocus = ui?.inspector?.onFocus ?? onSignalFocus;\n\tconst effShowWarningsPanel = ui?.warnings?.show ?? showWarningsPanel ?? false;\n\tconst effWarningsFilter = ui?.warnings?.filter ?? warningsFilter;\n\tconst effShowIcons = ui?.icons?.show ?? showIcons ?? false;\n\tconst effShowEmbeddedIcon = ui?.icons?.embedded?.show ?? showEmbeddedIcon ?? true;\n\tconst effEmbeddedIconVariant = ui?.icons?.embedded?.variant ?? embeddedIconVariant ?? SpcEmbeddedIconVariant.Classic;\n\tconst effEmbeddedIconRunLength = ui?.icons?.embedded?.runLength ?? embeddedIconRunLength;\n\tconst effShowFocusIndicator = ui?.overlays?.focusIndicator ?? showFocusIndicator ?? true;\n\n\treturn {\n\t\teffData,\n\t\teffTargets,\n\t\teffBaselines,\n\t\teffGhosts,\n\t\teffChartTypeCore,\n\t\teffMetricImprovementCore,\n\t\teffEngineSettings,\n\t\teffEngineAutoRecalc,\n\t\teffHeight,\n\t\teffClassName,\n\t\teffAriaLabel,\n\t\teffUnit,\n\t\teffNarrationContext,\n\t\teffShowZones,\n\t\teffShowPoints,\n\t\teffHighlightOutOfControl,\n\t\teffVisualsScenario,\n\t\teffVisualsEngineSettings,\n\t\teffPrecomputedVisuals: precomputed,\n\t\teffSource,\n\t\teffAlwaysShowZeroY,\n\t\teffAlwaysShowHundredY,\n\t\teffPercentScale,\n\t\teffGradientSequences,\n\t\teffSequenceTransition,\n\t\teffProcessLineWidth,\n\t\teffTrendVisualMode,\n\t\teffShowTrendGatingExplanation,\n\t\teffEnableNeutralNoJudgement,\n\t\teffEnableRules,\n\t\teffShowPartitionMarkers,\n\t\teffShowTrendStartMarkers,\n\t\teffShowFirstFavourableCrossMarkers,\n\t\teffShowTrendBridgeOverlay,\n\t\teffShowSignalsInspector,\n\t\teffOnSignalFocus,\n\t\teffShowWarningsPanel,\n\t\teffWarningsFilter,\n\t\teffShowIcons,\n\t\teffShowEmbeddedIcon,\n\t\teffEmbeddedIconVariant,\n\t\teffEmbeddedIconRunLength,\n\t\teffShowFocusIndicator,\n\t};\n}\n","import * as React from \"react\";\nimport Axis from \"../../Axis/Axis\";\nimport GridLines from \"../../GridLines/GridLines\";\nimport LineSeriesPrimitive from \"../../../series/LineSeriesPrimitive\";\nimport { useChartContext } from \"../../../core/ChartRoot\";\nimport { useScaleContext } from \"../../../core/ScaleContext\";\nimport {\n\tTooltipProvider,\n\tuseTooltipContext,\n} from \"../../../core/TooltipContext\";\nimport SPCTooltipOverlay from \"./SPCTooltipOverlay\";\nimport VisuallyHiddenLiveRegion from \"../../../primitives/VisuallyHiddenLiveRegion\";\nimport SPCSignalsInspector from \"./SPCSignalsInspector\";\nimport { extractRuleIds, ruleGlossary, variationLabel } from \"./descriptors\";\nimport SpcGradientCategory from \"./SPCChart.constants\";\nimport { computeGradientSequences } from \"./gradientSequences\";\nimport { SpcVisualCategory } from \"./logic_v2\";\nimport { SequenceTransition, type SPCDatum } from \"./SPCChart.props\";\nimport type { EngineRowUI } from \"./SPCChart.types\";\nimport { ImprovementDirection, VariationIcon, AssuranceIcon } from \"./types\";\nimport { Side } from \"../engine\";\n\nlet spcSequenceInstanceCounter = 0;\n\nimport type { InternalSPCProps } from \"./InternalSPC.types\";\n\nconst InternalSPC: React.FC<InternalSPCProps> = ({ data, targets, visuals, a11y, axis, compute }) => {\n\tconst {\n\t\tseries,\n\t\tengineRows,\n\t\tvisualCategories,\n\t\tpartitionMarkers,\n\t} = data;\n\tconst { limits, uniformTarget } = targets;\n\tconst {\n\t\tshowPoints,\n\t\tshowZones,\n\t\thighlightOutOfControl,\n\t\tgradientSequences,\n\t\tsequenceTransition,\n\t\tprocessLineWidth,\n\t\tshowFocusIndicator = false,\n\t\tenableRules,\n\t\tenableNeutralNoJudgement = true,\n\t\tshowTrendStartMarkers = false,\n\t\tshowFirstFavourableCrossMarkers = false,\n\t\tshowTrendBridgeOverlay = false,\n\t} = visuals;\n\tconst {\n\t\tannounceFocus,\n\t\tariaLabel,\n\t\tnarrationContext,\n\t\tshowSignalsInspector = false,\n\t\tonSignalFocus,\n\t\tshowTrendGatingExplanation = true,\n\t} = a11y;\n\tconst { zeroBreakSlotGapPx } = axis;\n\tconst { metricImprovement, effectiveUnit } = compute;\n\tconst scaleCtx = useScaleContext();\n\tconst chartCtx = useChartContext();\n\tif (!scaleCtx) return null;\n\tconst { xScale, yScale } = scaleCtx;\n\tconst gradientIdBaseRef = React.useRef<string>(\n\t\t\"spc-seq-\" + ++spcSequenceInstanceCounter\n\t);\n\tconst tooltipCtx = useTooltipContext();\n\tconst all = series[0]?.data || [];\n\tconst outOfControl = React.useMemo(() => {\n\t\tif (!limits.ucl && !limits.lcl) return new Set<number>();\n\t\tconst set = new Set<number>();\n\t\tall.forEach((d, i) => {\n\t\t\tif (typeof limits.ucl === \"number\" && d.y > limits.ucl) set.add(i);\n\t\t\tif (typeof limits.lcl === \"number\" && d.y < limits.lcl) set.add(i);\n\t\t});\n\t\treturn set;\n\t}, [limits.ucl, limits.lcl, all]);\n\n\tconst engineSignals = React.useMemo(() => {\n\t\tif (!engineRows || !engineRows.length) return null as null | any[];\n\t\tconst map: any[] = [];\n\t\tengineRows.forEach((r: EngineRowUI, idx: number) => {\n\t\t\tconst anySpecial =\n\t\t\t\tr.classification.variation === VariationIcon.Concern ||\n\t\t\t\tr.classification.variation === VariationIcon.Improvement ||\n\t\t\t\t!!r.classification.neutralSpecialCauseValue;\n\t\t\tconst upAny =\n\t\t\t\t!!r.rules.singlePoint.up ||\n\t\t\t\t!!r.rules.twoOfThree.up ||\n\t\t\t\t!!r.rules.fourOfFive.up ||\n\t\t\t\t!!r.rules.shift.up ||\n\t\t\t\t!!r.rules.trend.up;\n\t\t\tconst downAny =\n\t\t\t\t!!r.rules.singlePoint.down ||\n\t\t\t\t!!r.rules.twoOfThree.down ||\n\t\t\t\t!!r.rules.fourOfFive.down ||\n\t\t\t\t!!r.rules.shift.down ||\n\t\t\t\t!!r.rules.trend.down;\n\t\t\tmap[idx] = {\n\t\t\t\tvariation: r.classification.variation,\n\t\t\t\tassurance: r.classification.assurance,\n\t\t\t\tspecial: anySpecial,\n\t\t\t\tconcern: r.classification.variation === VariationIcon.Concern,\n\t\t\t\timprovement: r.classification.variation === VariationIcon.Improvement,\n\t\t\t\ttrendUp: !!r.rules.trend.up,\n\t\t\t\ttrendDown: !!r.rules.trend.down,\n\t\t\t\tupAny,\n\t\t\t\tdownAny,\n\t\t\t\tneutralSpecial: !!r.classification.neutralSpecialCauseValue,\n\t\t\t\tshiftUp: !!r.rules.shift.up,\n\t\t\t\tshiftDown: !!r.rules.shift.down,\n\t\t\t\ttwoOfThreeUp: !!r.rules.twoOfThree.up,\n\t\t\t\ttwoOfThreeDown: !!r.rules.twoOfThree.down,\n\t\t\t\tfourOfFiveUp: !!r.rules.fourOfFive.up,\n\t\t\t\tfourOfFiveDown: !!r.rules.fourOfFive.down,\n\t\t\t\tpartitionId: r.partition.id ?? null,\n\t\t\t};\n\t\t});\n\t\treturn map;\n\t}, [engineRows]);\n\n\tconst categories = React.useMemo(() => {\n\t\treturn (visualCategories || []).map((c) => {\n\t\t\tif (c === SpcVisualCategory.Improvement)\n\t\t\t\treturn SpcGradientCategory.Improvement;\n\t\t\tif (c === SpcVisualCategory.Concern) return SpcGradientCategory.Concern;\n\t\t\tif (c === SpcVisualCategory.NoJudgement)\n\t\t\t\treturn SpcGradientCategory.NoJudgement;\n\t\t\treturn SpcGradientCategory.Common;\n\t\t});\n\t}, [visualCategories]);\n\n\tconst sequences = React.useMemo(() => {\n\t\tif (!gradientSequences || !categories.length)\n\t\t\treturn [] as {\n\t\t\t\tstart: number;\n\t\t\t\tend: number;\n\t\t\t\tcategory: SpcGradientCategory;\n\t\t\t}[];\n\t\treturn computeGradientSequences(categories, true);\n\t}, [gradientSequences, categories, ariaLabel]);\n\n\tconst xPositions = React.useMemo(\n\t\t() => all.map((d) => xScale(d.x instanceof Date ? d.x : new Date(d.x))),\n\t\t[all, xScale]\n\t);\n\tconst plotWidth = xScale.range()[1];\n\tconst plotLeft = xScale.range()[0];\n\n\tconst trendInsights = React.useMemo(() => {\n\t\tif (!engineRows || !engineRows.length)\n\t\t\treturn null as null | {\n\t\t\t\tdirection: Side;\n\t\t\t\tdetectedAt: number;\n\t\t\t\tfirstFavourableCrossAt: number | null;\n\t\t\t\tpersistedAcrossMean: boolean;\n\t\t\t};\n\t\tlet earliestUp = Number.POSITIVE_INFINITY;\n\t\tlet earliestDown = Number.POSITIVE_INFINITY;\n\t\tengineRows.forEach((r, i) => {\n\t\t\tif (r.rules.trend.up) earliestUp = Math.min(earliestUp, i);\n\t\t\tif (r.rules.trend.down) earliestDown = Math.min(earliestDown, i);\n\t\t});\n\t\tif (!Number.isFinite(earliestUp) && !Number.isFinite(earliestDown))\n\t\t\treturn null;\n\t\tconst useUp = earliestUp <= earliestDown;\n\t\tconst direction: Side = useUp ? Side.Up : Side.Down;\n\t\tconst detectedAt = useUp ? earliestUp : earliestDown;\n\t\tconst isFavourable = (row: EngineRowUI | null | undefined): boolean => {\n\t\t\tif (\n\t\t\t\tmetricImprovement == null ||\n\t\t\t\tmetricImprovement === ImprovementDirection.Neither\n\t\t\t)\n\t\t\t\treturn false;\n\t\t\tif (\n\t\t\t\trow == null ||\n\t\t\t\ttypeof row.data.value !== \"number\" ||\n\t\t\t\ttypeof row.limits.mean !== \"number\"\n\t\t\t)\n\t\t\t\treturn false;\n\t\t\tif (direction === Side.Up) {\n\t\t\t\treturn metricImprovement === ImprovementDirection.Up\n\t\t\t\t\t? row.data.value > (row.limits.mean as number)\n\t\t\t\t\t: row.data.value < (row.limits.mean as number);\n\t\t\t}\n\t\t\treturn metricImprovement === ImprovementDirection.Down\n\t\t\t\t? row.data.value < (row.limits.mean as number)\n\t\t\t\t: row.data.value > (row.limits.mean as number);\n\t\t};\n\t\tlet firstFavourableCrossAt: number | null = null;\n\t\tfor (let i = detectedAt; i < engineRows.length; i++) {\n\t\t\tconst r = engineRows[i];\n\t\t\tconst flagged = useUp ? !!r.rules.trend.up : !!r.rules.trend.down;\n\t\t\tif (!flagged) break;\n\t\t\tif (isFavourable(r)) {\n\t\t\t\tfirstFavourableCrossAt = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tlet persistedAcrossMean = false;\n\t\tif (firstFavourableCrossAt != null) {\n\t\t\tlet favourableCount = 0;\n\t\t\tfor (let i = firstFavourableCrossAt; i < engineRows.length; i++) {\n\t\t\t\tconst r = engineRows[i];\n\t\t\t\tconst flagged = useUp ? !!r.rules.trend.up : !!r.rules.trend.down;\n\t\t\t\tif (!flagged) break;\n\t\t\t\tif (isFavourable(r)) favourableCount++;\n\t\t\t}\n\t\t\tpersistedAcrossMean = favourableCount >= 2;\n\t\t}\n\t\treturn {\n\t\t\tdirection,\n\t\t\tdetectedAt,\n\t\t\tfirstFavourableCrossAt,\n\t\t\tpersistedAcrossMean,\n\t\t};\n\t}, [engineRows, metricImprovement]);\n\n\tconst limitSegments = React.useMemo(() => {\n\t\tif (!engineRows || !engineRows.length) return null;\n\t\tconst buildFrom = (\n\t\t\textractor: (row: EngineRowUI) => number | null | undefined\n\t\t) => {\n\t\t\tconst segs: { x1: number; x2: number; y: number }[] = [];\n\t\t\tlet start: number | null = null;\n\t\t\tlet current: number | null = null;\n\t\t\tfor (let i = 0; i < engineRows.length; i++) {\n\t\t\t\tconst row = engineRows[i];\n\t\t\t\tconst raw = extractor(row);\n\t\t\t\tconst v =\n\t\t\t\t\ttypeof raw === \"number\" && !isNaN(raw) ? (raw as number) : null;\n\t\t\t\tif (v == null) {\n\t\t\t\t\tif (start !== null && current != null) {\n\t\t\t\t\t\tsegs.push({\n\t\t\t\t\t\t\tx1: xPositions[start],\n\t\t\t\t\t\t\tx2: xPositions[i - 1],\n\t\t\t\t\t\t\ty: yScale(current),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tstart = null;\n\t\t\t\t\t\tcurrent = null;\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (start === null) {\n\t\t\t\t\tstart = i;\n\t\t\t\t\tcurrent = v;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst EPS = 1e-9;\n\t\t\t\tif (current != null && Math.abs(v - current) <= EPS) {\n\t\t\t\t\t// same segment\n\t\t\t\t} else {\n\t\t\t\t\tif (current != null) {\n\t\t\t\t\t\tsegs.push({\n\t\t\t\t\t\t\tx1: xPositions[start],\n\t\t\t\t\t\t\tx2: xPositions[i - 1],\n\t\t\t\t\t\t\ty: yScale(current),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tstart = i;\n\t\t\t\t\tcurrent = v;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (start !== null && current != null) {\n\t\t\t\tsegs.push({\n\t\t\t\t\tx1: xPositions[start],\n\t\t\t\t\tx2: xPositions[engineRows.length - 1],\n\t\t\t\t\ty: yScale(current),\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn segs;\n\t\t};\n\t\treturn {\n\t\t\tmean: buildFrom((r) => r.limits.mean ?? null),\n\t\t\tucl: buildFrom((r) => r.limits.ucl ?? null),\n\t\t\tlcl: buildFrom((r) => r.limits.lcl ?? null),\n\t\t\tonePos: buildFrom((r) => r.limits.oneSigma.upper ?? null),\n\t\t\toneNeg: buildFrom((r) => r.limits.oneSigma.lower ?? null),\n\t\t\ttwoPos: buildFrom((r) => r.limits.twoSigma.upper ?? null),\n\t\t\ttwoNeg: buildFrom((r) => r.limits.twoSigma.lower ?? null),\n\t\t};\n\t}, [engineRows, xPositions, yScale]);\n\n\tconst sequenceDefs = React.useMemo(() => {\n\t\tif (!sequences.length) return null;\n\t\treturn (\n\t\t\t<defs>\n\t\t\t\t<linearGradient\n\t\t\t\t\tid={`${gradientIdBaseRef.current}-grad-common`}\n\t\t\t\t\tx1=\"0%\"\n\t\t\t\t\ty1=\"0%\"\n\t\t\t\t\tx2=\"0%\"\n\t\t\t\t\ty2=\"100%\"\n\t\t\t\t>\n\t\t\t\t\t<stop\n\t\t\t\t\t\toffset=\"0%\"\n\t\t\t\t\t\tstopColor={\n\t\t\t\t\t\t\t\"var(--nhs-fdp-color-data-viz-spc-common-cause, #A6A6A6)\"\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstopOpacity={0.28}\n\t\t\t\t\t/>\n\t\t\t\t\t<stop\n\t\t\t\t\t\toffset=\"70%\"\n\t\t\t\t\t\tstopColor={\n\t\t\t\t\t\t\t\"var(--nhs-fdp-color-data-viz-spc-common-cause, #A6A6A6)\"\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstopOpacity={0.12}\n\t\t\t\t\t/>\n\t\t\t\t\t<stop\n\t\t\t\t\t\toffset=\"100%\"\n\t\t\t\t\t\tstopColor={\n\t\t\t\t\t\t\t\"var(--nhs-fdp-color-data-viz-spc-common-cause, #A6A6A6)\"\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstopOpacity={0.045}\n\t\t\t\t\t/>\n\t\t\t\t</linearGradient>\n\t\t\t\t{sequences.map((seq, idx) => {\n\t\t\t\t\tconst id = `${gradientIdBaseRef.current}-grad-${idx}`;\n\t\t\t\t\tlet baseVar: string;\n\t\t\t\t\tlet top = 0.28,\n\t\t\t\t\t\tmid = 0.12,\n\t\t\t\t\t\tend = 0.045;\n\t\t\t\t\tswitch (seq.category) {\n\t\t\t\t\t\tcase SpcGradientCategory.Concern:\n\t\t\t\t\t\t\tbaseVar = \"var(--nhs-fdp-color-data-viz-spc-concern, #E46C0A)\";\n\t\t\t\t\t\t\ttop = 0.28;\n\t\t\t\t\t\t\tmid = 0.12;\n\t\t\t\t\t\t\tend = 0.045;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase SpcGradientCategory.Improvement:\n\t\t\t\t\t\t\tbaseVar =\n\t\t\t\t\t\t\t\t\"var(--nhs-fdp-color-data-viz-spc-improvement, #00B0F0)\";\n\t\t\t\t\t\t\ttop = 0.26;\n\t\t\t\t\t\t\tmid = 0.11;\n\t\t\t\t\t\t\tend = 0.045;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase SpcGradientCategory.NoJudgement:\n\t\t\t\t\t\t\tbaseVar =\n\t\t\t\t\t\t\t\t\"var(--nhs-fdp-color-data-viz-spc-no-judgement, #490092)\";\n\t\t\t\t\t\t\ttop = 0.26;\n\t\t\t\t\t\t\tmid = 0.11;\n\t\t\t\t\t\t\tend = 0.045;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbaseVar =\n\t\t\t\t\t\t\t\t\"var(--nhs-fdp-color-data-viz-spc-common-cause, #A6A6A6)\";\n\t\t\t\t\t}\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<linearGradient key={id} id={id} x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n\t\t\t\t\t\t\t<stop offset=\"0%\" stopColor={baseVar} stopOpacity={top} />\n\t\t\t\t\t\t\t<stop offset=\"70%\" stopColor={baseVar} stopOpacity={mid} />\n\t\t\t\t\t\t\t<stop offset=\"100%\" stopColor={baseVar} stopOpacity={end} />\n\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</defs>\n\t\t);\n\t}, [sequences]);\n\n\tconst sequenceAreas = React.useMemo(() => {\n\t\tif (!sequences.length) return null;\n\n\t\tconst [domainMin] = yScale.domain();\n\t\tconst baseY = yScale(domainMin);\n\n\t\tconst areas = sequences\n\t\t\t.map((seq, idx) => {\n\t\t\t\tconst { start: firstIdx, end: lastIdx, category } = seq;\n\n\t\t\t\tif (firstIdx < 0 || lastIdx >= xPositions.length || firstIdx > lastIdx)\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst firstX = xPositions[firstIdx];\n\t\t\t\tconst lastX = xPositions[lastIdx];\n\n\t\t\t\tlet d = \"\";\n\n\t\t\t\tif (category === SpcGradientCategory.Common) {\n\t\t\t\t\t\tconst prevSeq = idx > 0 ? sequences[idx - 1] : null;\n\t\t\t\t\tconst nextSeq =\n\t\t\t\t\t\tidx < sequences.length - 1 ? sequences[idx + 1] : null;\n\n\t\t\t\t\tconst leftX = prevSeq ? xPositions[prevSeq.end] : plotLeft;\n\t\t\t\t\tconst leftY = prevSeq ? yScale(all[prevSeq.end].y) : baseY;\n\n\t\t\t\t\tconst rightX = nextSeq ? xPositions[nextSeq.start] : plotWidth;\n\t\t\t\t\tconst rightY = nextSeq ? yScale(all[nextSeq.start].y) : baseY;\n\n\t\t\t\t\td = `M ${leftX} ${baseY}`;\n\t\t\t\t\td += ` L ${leftX} ${leftY}`;\n\n\t\t\t\t\tfor (let i = firstIdx; i <= lastIdx; i++) {\n\t\t\t\t\t\td += ` L ${xPositions[i]} ${yScale(all[i].y)}`;\n\t\t\t\t\t}\n\n\t\t\t\t\td += ` L ${rightX} ${rightY}`;\n\t\t\t\t\td += ` L ${rightX} ${baseY} Z`;\n\t\t\t\t} else {\n\t\t\t\t\tconst prevSeq = idx > 0 ? sequences[idx - 1] : null;\n\t\t\t\t\tconst nextSeq =\n\t\t\t\t\t\tidx < sequences.length - 1 ? sequences[idx + 1] : null;\n\t\t\t\t\tconst prevColoured =\n\t\t\t\t\t\tprevSeq && prevSeq.category !== SpcGradientCategory.Common;\n\t\t\t\t\tconst nextColoured =\n\t\t\t\t\t\tnextSeq && nextSeq.category !== SpcGradientCategory.Common;\n\t\t\t\t\tconst firstY = yScale(all[firstIdx].y);\n\t\t\t\t\tconst lastY = yScale(all[lastIdx].y);\n\t\t\t\t\tlet startBaselineX = firstX;\n\t\t\t\t\tlet endBaselineX = lastX;\n\n\t\t\t\t\tif (prevColoured) {\n\t\t\t\t\t\tconst prevX = xPositions[prevSeq!.end];\n\t\t\t\t\t\tconst prevY = yScale(all[prevSeq!.end].y);\n\t\t\t\t\t\tconst deltaPrev = all[firstIdx].y - all[prevSeq!.end].y;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tsequenceTransition === SequenceTransition.Slope &&\n\t\t\t\t\t\t\tdeltaPrev > 0\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\td = `M ${prevX} ${prevY} L ${firstX} ${firstY}`;\n\t\t\t\t\t\t\tstartBaselineX = prevX;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\td = `M ${firstX} ${baseY} L ${firstX} ${firstY}`;\n\t\t\t\t\t\t\tstartBaselineX = firstX;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\td = `M ${firstX} ${baseY} L ${firstX} ${firstY}`;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (let i = firstIdx + 1; i <= lastIdx; i++) {\n\t\t\t\t\t\td += ` L ${xPositions[i]} ${yScale(all[i].y)}`;\n\t\t\t\t\t}\n\t\t\t\t\td += ` L ${lastX} ${lastY}`;\n\n\t\t\t\t\tif (nextColoured) {\n\t\t\t\t\t\tconst nextFirstX = xPositions[nextSeq!.start];\n\t\t\t\t\t\tconst nextFirstY = yScale(all[nextSeq!.start].y);\n\t\t\t\t\t\tconst deltaNext = all[nextSeq!.start].y - all[lastIdx].y;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(sequenceTransition === SequenceTransition.Slope &&\n\t\t\t\t\t\t\t\tdeltaNext <= 0) ||\n\t\t\t\t\t\t\tsequenceTransition === SequenceTransition.Extend\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\td += ` L ${nextFirstX} ${nextFirstY}`;\n\t\t\t\t\t\t\tendBaselineX = nextFirstX;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t\td += ` L ${endBaselineX} ${baseY}`;\n\t\t\t\t\t\td += ` L ${startBaselineX} ${baseY} Z`;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tsequenceTransition === SequenceTransition.Neutral &&\n\t\t\t\t\t\tprevColoured\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst prevX = xPositions[prevSeq!.end];\n\t\t\t\t\t\tconst prevY = yScale(all[prevSeq!.end].y);\n\t\t\t\t\t\t\tconst wedge = (\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tkey={`seq-wedge-${idx}`}\n\t\t\t\t\t\t\t\t\td={`M ${prevX} ${baseY} L ${prevX} ${prevY} L ${firstX} ${firstY} L ${firstX} ${baseY} Z`}\n\t\t\t\t\t\t\t\tfill={`url(#${gradientIdBaseRef.current}-grad-common)`}\n\t\t\t\t\t\t\t\tstroke=\"none\"\n\t\t\t\t\t\t\t\tclassName=\"fdp-spc__sequence-bg\"\n\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<g key={`seq-group-${idx}`}>\n\t\t\t\t\t\t\t\t{wedge}\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tkey={`seq-area-${idx}`}\n\t\t\t\t\t\t\t\t\td={d}\n\t\t\t\t\t\t\t\t\tfill={`url(#${gradientIdBaseRef.current}-grad-${idx})`}\n\t\t\t\t\t\t\t\t\tstroke=\"none\"\n\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__sequence-bg\"\n\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn (\n\t\t\t\t\t<path\n\t\t\t\t\t\tkey={`seq-area-${idx}`}\n\t\t\t\t\t\td={d}\n\t\t\t\t\t\tfill={`url(#${gradientIdBaseRef.current}-grad-${idx})`}\n\t\t\t\t\t\tstroke=\"none\"\n\t\t\t\t\t\tclassName=\"fdp-spc__sequence-bg\"\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t})\n\t\t\t.filter(Boolean);\n\n\t\treturn <g className=\"fdp-spc__sequence-bgs\">{areas}</g>;\n\t}, [sequences, xPositions, plotWidth, yScale, all, sequenceTransition]);\n\n\tconst computedTimeframe = React.useMemo(() => {\n\t\tif (!narrationContext?.timeframe && all.length >= 2) {\n\t\t\tconst xs = all.map((d) => (d.x instanceof Date ? d.x : new Date(d.x)));\n\t\t\tconst min = new Date(Math.min(...xs.map((d) => d.getTime())));\n\t\t\tconst max = new Date(Math.max(...xs.map((d) => d.getTime())));\n\t\t\tconst diffDays =\n\t\t\t\tMath.round((max.getTime() - min.getTime()) / 86400000) || 0;\n\t\t\tif (diffDays < 14)\n\t\t\t\treturn `The chart shows a timeframe of ${diffDays + 1} days`;\n\t\t\tconst weeks = Math.round(diffDays / 7);\n\t\t\tif (weeks < 20) return `The chart shows a timeframe of ${weeks} weeks`;\n\t\t\tconst months =\n\t\t\t\t(max.getFullYear() - min.getFullYear()) * 12 +\n\t\t\t\t(max.getMonth() - min.getMonth()) +\n\t\t\t\t1;\n\t\t\treturn `The chart shows a timeframe of ${months} months`;\n\t\t}\n\t\tif (narrationContext?.timeframe) {\n\t\t\treturn `The chart shows a timeframe of ${narrationContext.timeframe}`;\n\t\t}\n\t\treturn undefined;\n\t}, [narrationContext?.timeframe, all]);\n\n\tconst ordinal = (n: number) => {\n\t\tconst mod10 = n % 10,\n\t\t\tmod100 = n % 100;\n\t\tif (mod10 === 1 && mod100 !== 11) return `${n}st`;\n\t\tif (mod10 === 2 && mod100 !== 12) return `${n}nd`;\n\t\tif (mod10 === 3 && mod100 !== 13) return `${n}rd`;\n\t\treturn `${n}th`;\n\t};\n\t\n\tconst formatDateLong = (d: Date) => `${ordinal(d.getDate())} ${d.toLocaleString(\"en-GB\", { month: \"long\" })}, ${d.getFullYear()}`;\n\n\tconst toRuleFlags = (row: EngineRowUI | null | undefined) => ({\n\t\tspecialCauseSinglePointUp: !!row?.rules.singlePoint.up,\n\t\tspecialCauseSinglePointDown: !!row?.rules.singlePoint.down,\n\t\tspecialCauseTwoOfThreeUp: !!row?.rules.twoOfThree.up,\n\t\tspecialCauseTwoOfThreeDown: !!row?.rules.twoOfThree.down,\n\t\tspecialCauseFourOfFiveUp: !!row?.rules.fourOfFive.up,\n\t\tspecialCauseFourOfFiveDown: !!row?.rules.fourOfFive.down,\n\t\tspecialCauseShiftUp: !!row?.rules.shift.up,\n\t\tspecialCauseShiftDown: !!row?.rules.shift.down,\n\t\tspecialCauseTrendUp: !!row?.rules.trend.up,\n\t\tspecialCauseTrendDown: !!row?.rules.trend.down,\n\t});\n\n\tconst formatLive = React.useCallback(\n\t\t({\n\t\t\tindex,\n\t\t\tx,\n\t\t\ty,\n\t\t}: {\n\t\t\tseriesId: string;\n\t\t\tx: Date;\n\t\t\ty: number;\n\t\t\tindex: number;\n\t\t}) => {\n\t\t\tconst row = engineRows?.[index];\n\t\t\tconst dateObj = x instanceof Date ? x : new Date(x);\n\t\t\tconst dateLabel = formatDateLong(dateObj);\n\t\t\tconst unit = narrationContext?.measureUnit\n\t\t\t\t? ` ${narrationContext.measureUnit}`\n\t\t\t\t: \"\";\n\t\t\tconst measure = narrationContext?.measureName\n\t\t\t\t? ` ${narrationContext.measureName}`\n\t\t\t\t: \"\";\n\t\t\tif (!row) {\n\t\t\t\treturn `General summary is: ${computedTimeframe ? computedTimeframe + \". \" : \"\"}Point ${index + 1}, ${dateLabel}, ${y}${unit}${measure}`;\n\t\t\t}\n\t\t\tconst varLabel =\n\t\t\t\tvariationLabel(row.classification?.variation) || \"Variation\";\n\t\t\tconst ruleIds = extractRuleIds(toRuleFlags(row));\n\t\t\tconst ruleNarr = ruleIds.length\n\t\t\t\t? ` Rules: ${[...new Set(ruleIds.map((r) => ruleGlossary[r].narration))].join(\"; \")}.`\n\t\t\t\t: \" No special cause rules.\";\n\t\t\tconst ctxParts: string[] = [];\n\t\t\tif (narrationContext?.measureName)\n\t\t\t\tctxParts.push(`Measure: ${narrationContext.measureName}.`);\n\t\t\tif (narrationContext?.datasetContext)\n\t\t\t\tctxParts.push(`${narrationContext.datasetContext}.`);\n\t\t\tif (narrationContext?.organisation)\n\t\t\t\tctxParts.push(`Organisation: ${narrationContext.organisation}.`);\n\t\t\tif (narrationContext?.additionalNote)\n\t\t\t\tctxParts.push(narrationContext.additionalNote);\n\t\t\treturn [\n\t\t\t\t`General summary is:`,\n\t\t\t\t...ctxParts,\n\t\t\t\t`Point ${index + 1} recorded on `,\n\t\t\t\tdateLabel + \",\",\n\t\t\t\t`with a value of ${y} ${unit}${measure}`,\n\t\t\t\tvarLabel + \".\",\n\t\t\t\truleNarr,\n\t\t\t]\n\t\t\t\t.join(\" \")\n\t\t\t\t.replace(/\\s+/g, \" \")\n\t\t\t\t.trim();\n\t\t},\n\t\t[engineRows, narrationContext, computedTimeframe]\n\t);\n\n\tconst describePoint = React.useCallback(\n\t\t(index: number, d: SPCDatum): string | undefined => {\n\t\t\tconst row = engineRows?.[index];\n\t\t\tif (!row) return undefined;\n\t\t\tconst base = formatLive({\n\t\t\t\tindex,\n\t\t\t\tseriesId: \"process\",\n\t\t\t\tx: d.x instanceof Date ? d.x : new Date(d.x),\n\t\t\t\ty: d.y,\n\t\t\t});\n\t\t\treturn base\n\t\t\t\t.replace(/^General summary is:\\s*/, \"\")\n\t\t\t\t.replace(/^Point \\d+\\s*/, \"\");\n\t\t},\n\t\t[engineRows, formatLive]\n\t);\n\n\tconst showZeroBreak = React.useMemo(() => {\n\t\ttry {\n\t\t\tconst dom =\n\t\t\t\ttypeof yScale?.domain === \"function\" ? yScale.domain() : undefined;\n\t\t\tif (!dom || !Array.isArray(dom) || dom.length < 2) return false;\n\t\t\tconst min = Math.min(dom[0], dom[1]);\n\t\t\tconst max = Math.max(dom[0], dom[1]);\n\t\t\treturn !(0 >= min && 0 <= max);\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t}, [yScale]);\n\n\treturn (\n\t\t<TooltipProvider>\n\t\t\t<div\n\t\t\t\tclassName=\"fdp-spc-chart\"\n\t\t\t\trole=\"group\"\n\t\t\t\taria-label=\"Statistical process control chart\"\n\t\t\t\taria-roledescription=\"chart\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\twidth={scaleCtx.xScale.range()[1] + 56 + 16}\n\t\t\t\t\theight={\n\t\t\t\t\t\t(chartCtx?.innerHeight ?? scaleCtx.yScale.range()[0]) + 12 + 48\n\t\t\t\t\t}\n\t\t\t\t\trole=\"img\"\n\t\t\t\t>\n\t\t\t\t\t<g transform={`translate(56,12)`}>\n\t\t\t\t\t\t<Axis type=\"x\" />\n\t\t\t\t\t\t<Axis\n\t\t\t\t\t\t\ttype=\"y\"\n\t\t\t\t\t\t\tyZeroBreak={{\n\t\t\t\t\t\t\t\tenabled: showZeroBreak,\n\t\t\t\t\t\t\t\tgapPx: zeroBreakSlotGapPx,\n\t\t\t\t\t\t\t\tzigZag: { heightPx: 64, amplitudePx: 4, cycles: 6, stepXPx: 3 },\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<GridLines axis=\"y\" />\n\t\t\t\t\t\t{sequenceDefs}\n\t\t\t\t\t\t{sequenceAreas}\n\t\t\t\t\t\t{partitionMarkers.map((idx: number, i: number) => {\n\t\t\t\t\t\t\tconst d = all[idx];\n\t\t\t\t\t\t\tif (!d) return null;\n\t\t\t\t\t\t\tconst x = xScale(d.x instanceof Date ? d.x : new Date(d.x));\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\tkey={`partition-marker-${i}`}\n\t\t\t\t\t\t\t\t\tx1={x}\n\t\t\t\t\t\t\t\t\tx2={x}\n\t\t\t\t\t\t\t\t\ty1={0}\n\t\t\t\t\t\t\t\t\ty2={yScale.range()[0]}\n\t\t\t\t\t\t\t\t\tstroke=\"#555\"\n\t\t\t\t\t\t\t\t\tstrokeDasharray=\"4 4\"\n\t\t\t\t\t\t\t\t\tstrokeWidth={1}\n\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__partition-marker\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t\t{limitSegments?.mean.length ? (() => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<g aria-hidden=\"true\" className=\"fdp-spc__cl-group\">\n\t\t\t\t\t\t\t\t{limitSegments.mean.map((s, i) => (\n\t\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\t\tkey={`mean-${i}`}\n\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__cl\"\n\t\t\t\t\t\t\t\t\t\tx1={s.x1}\n\t\t\t\t\t\t\t\t\t\tx2={s.x2}\n\t\t\t\t\t\t\t\t\t\ty1={s.y}\n\t\t\t\t\t\t\t\t\t\ty2={s.y}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t{limitSegments.mean.map((s, i) => {\n\t\t\t\t\t\t\t\t\tif (i === limitSegments.mean.length - 1) return null;\n\t\t\t\t\t\t\t\t\tconst next = limitSegments.mean[i + 1];\n\t\t\t\t\t\t\t\t\tif (!next) return null;\n\t\t\t\t\t\t\t\t\tif (s.y === next.y) return null;\n\t\t\t\t\t\t\t\t\tconst gap = Math.max(4, next.x1 - s.x2 || 0);\n\t\t\t\t\t\t\t\t\tconst k = gap * 0.5;\n\t\t\t\t\t\t\t\t\tconst d = `M ${s.x2},${s.y} C ${s.x2 + k},${s.y} ${next.x1 - k},${next.y} ${next.x1},${next.y}`;\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tkey={`mean-join-${i}`}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__cl fdp-spc__cl-join\"\n\t\t\t\t\t\t\t\t\t\t\td={d}\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})() : null}\n\t\t\t\t\t\t{uniformTarget != null && <></>}\n\t\t\t\t\t\t{limitSegments?.ucl.length\n\t\t\t\t\t\t\t? (() => (\n\t\t\t\t\t\t\t\t\t<g\n\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__limit-group fdp-spc__limit-group--ucl\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{limitSegments.ucl.map((s, i) => (\n\t\t\t\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\t\t\t\tkey={`ucl-${i}`}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__limit fdp-spc__limit--ucl\"\n\t\t\t\t\t\t\t\t\t\t\t\tx1={s.x1}\n\t\t\t\t\t\t\t\t\t\t\t\tx2={s.x2}\n\t\t\t\t\t\t\t\t\t\t\t\ty1={s.y}\n\t\t\t\t\t\t\t\t\t\t\t\ty2={s.y}\n\t\t\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t{limitSegments.ucl.map((s, i) => {\n\t\t\t\t\t\t\t\t\t\t\tif (i === limitSegments.ucl.length - 1) return null;\n\t\t\t\t\t\t\t\t\t\t\tconst next = limitSegments.ucl[i + 1];\n\t\t\t\t\t\t\t\t\t\t\tif (!next) return null;\n\t\t\t\t\t\t\t\t\t\t\tif (s.y === next.y) return null;\n\t\t\t\t\t\t\t\t\t\t\tconst gap = Math.max(4, next.x1 - s.x2 || 0);\n\t\t\t\t\t\t\t\t\t\t\tconst k = gap * 0.5;\n\t\t\t\t\t\t\t\t\t\t\tconst d = `M ${s.x2},${s.y} C ${s.x2 + k},${s.y} ${next.x1 - k},${next.y} ${next.x1},${next.y}`;\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={`ucl-join-${i}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__limit fdp-spc__limit--ucl fdp-spc__limit-join\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td={d}\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t))()\n\t\t\t\t\t\t\t: null}\n\t\t\t\t\t\t{limitSegments?.lcl.length\n\t\t\t\t\t\t\t? (() => (\n\t\t\t\t\t\t\t\t\t<g\n\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__limit-group fdp-spc__limit-group--lcl\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{limitSegments.lcl.map((s, i) => (\n\t\t\t\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\t\t\t\tkey={`lcl-${i}`}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__limit fdp-spc__limit--lcl\"\n\t\t\t\t\t\t\t\t\t\t\t\tx1={s.x1}\n\t\t\t\t\t\t\t\t\t\t\t\tx2={s.x2}\n\t\t\t\t\t\t\t\t\t\t\t\ty1={s.y}\n\t\t\t\t\t\t\t\t\t\t\t\ty2={s.y}\n\t\t\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t{limitSegments.lcl.map((s, i) => {\n\t\t\t\t\t\t\t\t\t\t\tif (i === limitSegments.lcl.length - 1) return null;\n\t\t\t\t\t\t\t\t\t\t\tconst next = limitSegments.lcl[i + 1];\n\t\t\t\t\t\t\t\t\t\t\tif (!next) return null;\n\t\t\t\t\t\t\t\t\t\t\tif (s.y === next.y) return null;\n\t\t\t\t\t\t\t\t\t\t\tconst gap = Math.max(4, next.x1 - s.x2 || 0);\n\t\t\t\t\t\t\t\t\t\t\tconst k = gap * 0.5;\n\t\t\t\t\t\t\t\t\t\t\tconst d = `M ${s.x2},${s.y} C ${s.x2 + k},${s.y} ${next.x1 - k},${next.y} ${next.x1},${next.y}`;\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={`lcl-join-${i}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__limit fdp-spc__limit--lcl fdp-spc__limit-join\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td={d}\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t))()\n\t\t\t\t\t\t\t: null}\n\t\t\t\t\t\t{uniformTarget != null && (\n\t\t\t\t\t\t\t<g aria-hidden=\"true\" className=\"fdp-spc__target-group\">\n\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__target\"\n\t\t\t\t\t\t\t\t\tdata-testid=\"spc-target-line\"\n\t\t\t\t\t\t\t\t\tx1={0}\n\t\t\t\t\t\t\t\t\tx2={xScale.range()[1]}\n\t\t\t\t\t\t\t\t\ty1={yScale(uniformTarget)}\n\t\t\t\t\t\t\t\t\ty2={yScale(uniformTarget)}\n\t\t\t\t\t\t\t\t\tstrokeWidth={2.5}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<text\n\t\t\t\t\t\t\t\t\tdata-testid=\"spc-target-label\"\n\t\t\t\t\t\t\t\t\tx={xScale.range()[0] - 7}\n\t\t\t\t\t\t\t\t\ty={yScale(uniformTarget) - 5}\n\t\t\t\t\t\t\t\t\ttextAnchor=\"start\"\n\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__target-label\"\n\t\t\t\t\t\t\t\t\tfontSize={12}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tTarget {uniformTarget}{\" \"}\n\t\t\t\t\t\t\t\t\t{effectiveUnit || narrationContext?.measureUnit || \"\"}\n\t\t\t\t\t\t\t\t</text>\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{showZones && limitSegments && limitSegments.mean.length > 0 && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t{limitSegments.onePos.map((s, i) => (\n\t\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\t\tkey={`onePos-${i}`}\n\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__zone fdp-spc__zone--pos1\"\n\t\t\t\t\t\t\t\t\t\tx1={s.x1}\n\t\t\t\t\t\t\t\t\t\tx2={s.x2}\n\t\t\t\t\t\t\t\t\t\ty1={s.y}\n\t\t\t\t\t\t\t\t\t\ty2={s.y}\n\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t{limitSegments.oneNeg.map((s, i) => (\n\t\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\t\tkey={`oneNeg-${i}`}\n\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__zone fdp-spc__zone--neg1\"\n\t\t\t\t\t\t\t\t\t\tx1={s.x1}\n\t\t\t\t\t\t\t\t\t\tx2={s.x2}\n\t\t\t\t\t\t\t\t\t\ty1={s.y}\n\t\t\t\t\t\t\t\t\t\ty2={s.y}\n\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t{limitSegments.twoPos.map((s, i) => (\n\t\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\t\tkey={`twoPos-${i}`}\n\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__zone fdp-spc__zone--pos2\"\n\t\t\t\t\t\t\t\t\t\tx1={s.x1}\n\t\t\t\t\t\t\t\t\t\tx2={s.x2}\n\t\t\t\t\t\t\t\t\t\ty1={s.y}\n\t\t\t\t\t\t\t\t\t\ty2={s.y}\n\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t{limitSegments.twoNeg.map((s, i) => (\n\t\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\t\tkey={`twoNeg-${i}`}\n\t\t\t\t\t\t\t\t\t\tclassName=\"fdp-spc__zone fdp-spc__zone--neg2\"\n\t\t\t\t\t\t\t\t\t\tx1={s.x1}\n\t\t\t\t\t\t\t\t\t\tx2={s.x2}\n\t\t\t\t\t\t\t\t\t\ty1={s.y}\n\t\t\t\t\t\t\t\t\t\ty2={s.y}\n\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{trendInsights &&\n\t\t\t\t\t\t\t(showTrendStartMarkers ||\n\t\t\t\t\t\t\t\tshowFirstFavourableCrossMarkers ||\n\t\t\t\t\t\t\t\tshowTrendBridgeOverlay) &&\n\t\t\t\t\t\t\t(() => {\n\t\t\t\t\t\t\t\tconst startIdx = trendInsights.detectedAt;\n\t\t\t\t\t\t\t\tconst crossIdx = trendInsights.firstFavourableCrossAt;\n\t\t\t\t\t\t\t\tconst sx = all[startIdx]\n\t\t\t\t\t\t\t\t\t? xScale(\n\t\t\t\t\t\t\t\t\t\t\tall[startIdx].x instanceof Date\n\t\t\t\t\t\t\t\t\t\t\t\t? (all[startIdx].x as Date)\n\t\t\t\t\t\t\t\t\t\t\t\t: new Date(all[startIdx].x)\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t: null;\n\t\t\t\t\t\t\t\tconst sy = all[startIdx] ? yScale(all[startIdx].y) : null;\n\t\t\t\t\t\t\t\tconst cx =\n\t\t\t\t\t\t\t\t\tcrossIdx != null && all[crossIdx]\n\t\t\t\t\t\t\t\t\t\t? xScale(\n\t\t\t\t\t\t\t\t\t\t\t\tall[crossIdx].x instanceof Date\n\t\t\t\t\t\t\t\t\t\t\t\t\t? (all[crossIdx].x as Date)\n\t\t\t\t\t\t\t\t\t\t\t\t\t: new Date(all[crossIdx].x)\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t: null;\n\t\t\t\t\t\t\t\tconst cy =\n\t\t\t\t\t\t\t\t\tcrossIdx != null && all[crossIdx]\n\t\t\t\t\t\t\t\t\t\t? yScale(all[crossIdx].y)\n\t\t\t\t\t\t\t\t\t\t: null;\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<g aria-hidden=\"true\" className=\"fdp-spc__trend-overlays\">\n\t\t\t\t\t\t\t\t\t\t{showTrendBridgeOverlay &&\n\t\t\t\t\t\t\t\t\t\t\tsx != null &&\n\t\t\t\t\t\t\t\t\t\t\tsy != null &&\n\t\t\t\t\t\t\t\t\t\t\tcx != null &&\n\t\t\t\t\t\t\t\t\t\t\tcy != null && (\n\t\t\t\t\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\t\t\t\t\tx1={sx}\n\t\t\t\t\t\t\t\t\t\t\t\t\ty1={sy}\n\t\t\t\t\t\t\t\t\t\t\t\t\tx2={cx}\n\t\t\t\t\t\t\t\t\t\t\t\t\ty2={cy}\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"#888\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrokeDasharray=\"4 4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<title>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tTrend bridge: start to first favourable-side point\n\t\t\t\t\t\t\t\t\t\t\t\t\t</title>\n\t\t\t\t\t\t\t\t\t\t\t\t</line>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{showTrendStartMarkers && sx != null && sy != null && (\n\t\t\t\t\t\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\t\t\t\t\t\tcx={sx}\n\t\t\t\t\t\t\t\t\t\t\t\tcy={sy}\n\t\t\t\t\t\t\t\t\t\t\t\tr={6}\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"white\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"#555\"\n\t\t\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<title>Trend start (run reached N)</title>\n\t\t\t\t\t\t\t\t\t\t\t</circle>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{showFirstFavourableCrossMarkers &&\n\t\t\t\t\t\t\t\t\t\t\tcx != null &&\n\t\t\t\t\t\t\t\t\t\t\tcy != null && (\n\t\t\t\t\t\t\t\t\t\t\t\t<circle cx={cx} cy={cy} r={5} fill=\"#555\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<title>First favourable-side inclusion</title>\n\t\t\t\t\t\t\t\t\t\t\t\t</circle>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t<LineSeriesPrimitive\n\t\t\t\t\t\t\tseries={series[0]}\n\t\t\t\t\t\t\tseriesIndex={0}\n\t\t\t\t\t\t\tpalette=\"categorical\"\n\t\t\t\t\t\t\tshowPoints={false}\n\t\t\t\t\t\t\tfocusablePoints={false}\n\t\t\t\t\t\t\tfocusIndex={-1}\n\t\t\t\t\t\t\tparseX={(d: SPCDatum) =>\n\t\t\t\t\t\t\t\td.x instanceof Date ? d.x : new Date(d.x)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsmooth={false}\n\t\t\t\t\t\t\tstrokeWidth={processLineWidth}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{showPoints &&\n\t\t\t\t\t\t\tall.map((d, i) => {\n\t\t\t\t\t\t\t\tconst cx = xScale(d.x instanceof Date ? d.x : new Date(d.x));\n\t\t\t\t\t\t\t\tconst cy = yScale(d.y);\n\t\t\t\t\t\t\t\tconst ooc = outOfControl.has(i);\n\t\t\t\t\t\t\t\tconst sig = engineSignals?.[i];\n\t\t\t\t\t\t\t\tconst cat = categories[i];\n\t\t\t\t\t\t\t\tconst isImprovement = cat === SpcGradientCategory.Improvement;\n\t\t\t\t\t\t\t\tconst isConcern = cat === SpcGradientCategory.Concern;\n\t\t\t\t\t\t\t\tconst isNoJudgement = cat === SpcGradientCategory.NoJudgement;\n\t\t\t\t\t\t\t\tconst classes = [\n\t\t\t\t\t\t\t\t\t\"fdp-spc__point\",\n\t\t\t\t\t\t\t\t\tooc && highlightOutOfControl ? \"fdp-spc__point--ooc\" : null,\n\t\t\t\t\t\t\t\t\tenableRules && isConcern\n\t\t\t\t\t\t\t\t\t\t? \"fdp-spc__point--sc-concern\"\n\t\t\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\t\t\tenableRules && isImprovement\n\t\t\t\t\t\t\t\t\t\t? \"fdp-spc__point--sc-improvement\"\n\t\t\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\t\t\tenableRules && enableNeutralNoJudgement && isNoJudgement\n\t\t\t\t\t\t\t\t\t\t? \"fdp-spc__point--sc-no-judgement\"\n\t\t\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\t\t\tsig?.assurance === AssuranceIcon.Pass\n\t\t\t\t\t\t\t\t\t\t? \"fdp-spc__point--assurance-pass\"\n\t\t\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\t\t\tsig?.assurance === AssuranceIcon.Fail\n\t\t\t\t\t\t\t\t\t\t? \"fdp-spc__point--assurance-fail\"\n\t\t\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t\t\t\t.join(\" \");\n\t\t\t\t\t\t\t\tconst isFocused = tooltipCtx?.focused?.index === i;\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\t\t\t\tcx={cx}\n\t\t\t\t\t\t\t\t\t\tcy={cy}\n\t\t\t\t\t\t\t\t\t\tr={5}\n\t\t\t\t\t\t\t\t\t\tclassName={classes}\n\t\t\t\t\t\t\t\t\t\tdata-variation={sig?.variation}\n\t\t\t\t\t\t\t\t\t\tdata-assurance={sig?.assurance}\n\t\t\t\t\t\t\t\t\t\taria-label={ariaLabel}\n\t\t\t\t\t\t\t\t\t\t{...(isFocused\n\t\t\t\t\t\t\t\t\t\t\t? { \"aria-describedby\": `spc-tooltip-${i}` }\n\t\t\t\t\t\t\t\t\t\t\t: {})}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t{showFocusIndicator &&\n\t\t\t\t\t\t\tshowSignalsInspector &&\n\t\t\t\t\t\t\ttooltipCtx?.focused &&\n\t\t\t\t\t\t\t(() => {\n\t\t\t\t\t\t\t\tconst f = tooltipCtx.focused;\n\t\t\t\t\t\t\t\tconst ix = typeof f.index === \"number\" ? f.index : -1;\n\t\t\t\t\t\t\t\tif (ix < 0 || !all[ix]) return null;\n\t\t\t\t\t\t\t\tconst px = xScale(\n\t\t\t\t\t\t\t\t\tall[ix].x instanceof Date\n\t\t\t\t\t\t\t\t\t\t? (all[ix].x as Date)\n\t\t\t\t\t\t\t\t\t\t: new Date(all[ix].x)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tconst py = yScale(all[ix].y);\n\t\t\t\t\t\t\t\tconst focusYellow = \"var(--nhs-fdp-color-primary-yellow, #ffeb3b)\";\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<g className=\"fdp-spc__focus-indicator\" aria-hidden=\"true\">\n\t\t\t\t\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\t\t\t\t\tcx={px}\n\t\t\t\t\t\t\t\t\t\t\tcy={py}\n\t\t\t\t\t\t\t\t\t\t\tr={7}\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\tstroke={focusYellow}\n\t\t\t\t\t\t\t\t\t\t\tstrokeWidth={3}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\t\t\t\t\tcx={px}\n\t\t\t\t\t\t\t\t\t\t\tcy={py}\n\t\t\t\t\t\t\t\t\t\t\tr={5}\n\t\t\t\t\t\t\t\t\t\t\tfill=\"#000\"\n\t\t\t\t\t\t\t\t\t\t\tstroke={focusYellow}\n\t\t\t\t\t\t\t\t\t\t\tstrokeWidth={1.5}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\t\t\t\t\tcx={px}\n\t\t\t\t\t\t\t\t\t\t\tcy={py}\n\t\t\t\t\t\t\t\t\t\t\tr={2.5}\n\t\t\t\t\t\t\t\t\t\t\tfill=\"var(--nhs-fdp-color-data-viz-spc-common-cause, #A6A6A6)\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"#fff\"\n\t\t\t\t\t\t\t\t\t\t\tstrokeWidth={0.5}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t{chartCtx && (\n\t\t\t\t\t\t\t<InteractionLayer\n\t\t\t\t\t\t\t\twidth={xScale.range()[1]}\n\t\t\t\t\t\t\t\theight={yScale.range()[0]}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{!showSignalsInspector && (\n\t\t\t\t\t\t\t<SPCTooltipOverlay\n\t\t\t\t\t\t\t\tengineRows={engineRows}\n\t\t\t\t\t\t\t\tlimits={{ mean: limits.mean, sigma: limits.sigma }}\n\t\t\t\t\t\t\t\tpointDescriber={describePoint}\n\t\t\t\t\t\t\t\tmeasureName={narrationContext?.measureName}\n\t\t\t\t\t\t\t\tmeasureUnit={narrationContext?.measureUnit}\n\t\t\t\t\t\t\t\tdateFormatter={(d: Date) => formatDateLong(d)}\n\t\t\t\t\t\t\t\tenableNeutralNoJudgement={enableNeutralNoJudgement}\n\t\t\t\t\t\t\t\tshowTrendGatingExplanation={showTrendGatingExplanation}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t\t{showSignalsInspector && (\n\t\t\t\t\t<div style={{ marginTop: 8 }}>\n\t\t\t\t\t\t<SPCSignalsInspector\n\t\t\t\t\t\t\tengineRows={engineRows}\n\t\t\t\t\t\t\tmeasureName={narrationContext?.measureName}\n\t\t\t\t\t\t\tmeasureUnit={effectiveUnit || narrationContext?.measureUnit}\n\t\t\t\t\t\t\tonSignalFocus={onSignalFocus}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t{announceFocus && (\n\t\t\t\t\t<VisuallyHiddenLiveRegion\n\t\t\t\t\t\tformat={(d: any) =>\n\t\t\t\t\t\t\tformatLive({ ...d, x: d.x instanceof Date ? d.x : new Date(d.x) })\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</TooltipProvider>\n\t);\n};\n\nconst InteractionLayer: React.FC<{ width: number; height: number }> = ({\n\twidth,\n\theight,\n}) => {\n\tconst t = useTooltipContext();\n\tif (!t) return null;\n\treturn (\n\t\t<rect\n\t\t\tclassName=\"fdp-spc__interaction-layer\"\n\t\t\twidth={width}\n\t\t\theight={height}\n\t\t\tfill=\"transparent\"\n\t\t\ttabIndex={0}\n\t\t\taria-label=\"Interactive chart area. Use arrow keys to move between points.\"\n\t\t\tonMouseMove={(e) => {\n\t\t\t\tconst target = e.currentTarget as SVGRectElement;\n\t\t\t\tconst bounds = target.getBoundingClientRect();\n\t\t\t\tconst x = e.clientX - bounds.left;\n\t\t\t\tconst y = e.clientY - bounds.top;\n\t\t\t\tt.focusNearest(x, y);\n\t\t\t}}\n\t\t\tonMouseLeave={() => t.clear()}\n\t\t\tonKeyDown={(e) => {\n\t\t\t\tswitch (e.key) {\n\t\t\t\t\tcase \"ArrowRight\":\n\t\t\t\t\t\tt.focusNextPoint();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"ArrowLeft\":\n\t\t\t\t\t\tt.focusPrevPoint();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"ArrowDown\":\n\t\t\t\t\t\tt.focusNextSeries();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"ArrowUp\":\n\t\t\t\t\t\tt.focusPrevSeries();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"Home\":\n\t\t\t\t\t\tt.focusFirstPoint();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"End\":\n\t\t\t\t\t\tt.focusLastPoint();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}}\n\t\t\tstyle={{ cursor: \"crosshair\" }}\n\t\t/>\n\t);\n};\n\nexport default InternalSPC;\n","import type { MetricCardProps } from \"../../../components/MetricCard/MetricCard\";\n\nexport type IntervalHint =\n\t| \"hourly\"\n\t| \"daily\"\n\t| \"weekly\"\n\t| \"monthly\"\n\t| \"quarterly\"\n\t| \"annually\";\n\nexport interface DeltaConfig {\n\tstrategy?: \"previous\" | \"n-points\" | \"year-over-year\";\n\tn?: number;\n\tabsolute?: boolean; // when false => percentage change\n\tskipNulls?: boolean;\n}\n\nexport interface AutoMetricsInput {\n\tvalues: Array<number | null | undefined>;\n\tdates?: Array<Date | string | number | undefined>;\n\tintervalHint?: IntervalHint;\n\tstartDate?: Date | string | number;\n\tprovidedUnit?: string; // explicit unit from props (takes precedence)\n\tdefaultUnit?: string; // fallback unit when not inferable\n\t/** Percent inference heuristic. Default '0-100' (values within 0..100). Use '0-1' for proportion series. */\n\tpercentHeuristic?: \"0-100\" | \"0-1\";\n\tautoValue?: boolean;\n\tautoDelta?: boolean;\n\tautoMetadata?: boolean;\n\tdeltaConfig?: DeltaConfig;\n}\n\nexport interface AutoMetricsResult {\n\tvalue?: number;\n\tunit?: string;\n\tdelta?: MetricCardProps[\"delta\"];\n\tmetadata?: string;\n\tlatestDate?: Date;\n\tfrequency?: IntervalHint;\n}\n\nfunction toDate(v: Date | string | number | undefined): Date | undefined {\n\tif (v == null) return undefined;\n\tconst d = v instanceof Date ? v : new Date(v);\n\treturn Number.isNaN(d.valueOf()) ? undefined : d;\n}\n\nfunction synthesizeDates(\n\tlength: number,\n\tstart: Date,\n\thint?: IntervalHint\n): Date[] {\n\tconst arr: Date[] = new Array(length);\n\tconst d = new Date(start);\n\tfor (let i = 0; i < length; i++) {\n\t\tarr[i] = new Date(d);\n\t\tswitch (hint) {\n\t\t\tcase \"hourly\":\n\t\t\t\td.setHours(d.getHours() + 1);\n\t\t\t\tbreak;\n\t\t\tcase \"daily\":\n\t\t\t\td.setDate(d.getDate() + 1);\n\t\t\t\tbreak;\n\t\t\tcase \"weekly\":\n\t\t\t\td.setDate(d.getDate() + 7);\n\t\t\t\tbreak;\n\t\t\tcase \"monthly\":\n\t\t\t\td.setMonth(d.getMonth() + 1);\n\t\t\t\tbreak;\n\t\t\tcase \"quarterly\":\n\t\t\t\td.setMonth(d.getMonth() + 3);\n\t\t\t\tbreak;\n\t\t\tcase \"annually\":\n\t\t\t\td.setFullYear(d.getFullYear() + 1);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\treturn arr;\n}\n\nfunction inferFrequency(\n\tdates: (Date | undefined)[],\n\tfallback?: IntervalHint\n): IntervalHint | undefined {\n\tconst valid = dates.filter(Boolean) as Date[];\n\tif (valid.length < 2) return fallback;\n\tconst diffs: number[] = [];\n\tfor (let i = 1; i < valid.length; i++)\n\t\tdiffs.push(valid[i].getTime() - valid[i - 1].getTime());\n\tconst sorted = diffs.sort((a, b) => a - b);\n\tconst median = sorted[Math.floor(sorted.length / 2)];\n\tconst H = 60 * 60 * 1000;\n\tconst D = 24 * H;\n\tif (median <= 2 * H) return \"hourly\";\n\tif (median <= 2 * D) return \"daily\";\n\tif (median <= 10 * D) return \"weekly\";\n\tif (median <= 45 * D) return \"monthly\";\n\tif (median <= 120 * D) return \"quarterly\";\n\treturn \"annually\";\n}\n\nfunction formatLatest(\n\tdt: Date | undefined,\n\tfreq?: IntervalHint\n): string | undefined {\n\tif (!dt) return undefined;\n\ttry {\n\t\tswitch (freq) {\n\t\t\tcase \"hourly\":\n\t\t\t\treturn new Intl.DateTimeFormat(undefined, {\n\t\t\t\t\thour: \"2-digit\",\n\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t\tday: \"2-digit\",\n\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\tyear: \"numeric\",\n\t\t\t\t}).format(dt);\n\t\t\tcase \"daily\":\n\t\t\t\treturn new Intl.DateTimeFormat(undefined, {\n\t\t\t\t\tday: \"2-digit\",\n\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\tyear: \"numeric\",\n\t\t\t\t}).format(dt);\n\t\t\tcase \"weekly\":\n\t\t\t\treturn `Week of ${new Intl.DateTimeFormat(undefined, { day: \"2-digit\", month: \"short\", year: \"numeric\" }).format(dt)}`;\n\t\t\tcase \"monthly\":\n\t\t\t\treturn new Intl.DateTimeFormat(undefined, {\n\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\tyear: \"numeric\",\n\t\t\t\t}).format(dt);\n\t\t\tcase \"quarterly\": {\n\t\t\t\tconst q = Math.floor(dt.getMonth() / 3) + 1;\n\t\t\t\treturn `Q${q} ${dt.getFullYear()}`;\n\t\t\t}\n\t\t\tcase \"annually\":\n\t\t\t\treturn `${dt.getFullYear()}`;\n\t\t\tdefault:\n\t\t\t\treturn new Intl.DateTimeFormat(undefined, {\n\t\t\t\t\tday: \"2-digit\",\n\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\tyear: \"numeric\",\n\t\t\t\t}).format(dt);\n\t\t}\n\t} catch {\n\t\treturn undefined;\n\t}\n}\n\nfunction inferUnit(\n\tvalues: (number | null)[],\n\tprovided?: string,\n\tdef?: string,\n\tpercentHeuristic: \"0-100\" | \"0-1\" = \"0-100\"\n): string | undefined {\n\tif (provided) return provided;\n\tif (def) return def;\n\tconst vals = values.filter((v): v is number => v != null);\n\tif (!vals.length) return undefined;\n\tconst min = Math.min(...vals);\n\tconst max = Math.max(...vals);\n\tif (percentHeuristic === \"0-1\") {\n\t\tif (min >= 0 && max <= 1 && max > 0) return \"%\";\n\t} else {\n\t\tif (min >= 0 && max <= 100 && max > 0) return \"%\";\n\t}\n\treturn undefined;\n}\n\nfunction periodLabel(freq?: IntervalHint, hint?: IntervalHint, n = 1): string {\n\tconst unit = freq || hint;\n\tswitch (unit) {\n\t\tcase \"hourly\":\n\t\t\treturn n === 1 ? \"last hour\" : `last ${n} hours`;\n\t\tcase \"daily\":\n\t\t\treturn n === 1 ? \"last day\" : `last ${n} days`;\n\t\tcase \"weekly\":\n\t\t\treturn n === 1 ? \"last week\" : `last ${n} weeks`;\n\t\tcase \"monthly\":\n\t\t\treturn n === 1 ? \"last month\" : `last ${n} months`;\n\t\tcase \"quarterly\":\n\t\t\treturn n === 1 ? \"last quarter\" : `last ${n} quarters`;\n\t\tcase \"annually\":\n\t\t\treturn n === 1 ? \"last year\" : `last ${n} years`;\n\t\tdefault:\n\t\t\treturn \"previous\";\n\t}\n}\n\nexport function computeAutoMetrics(input: AutoMetricsInput): AutoMetricsResult {\n\tconst {\n\t\tvalues: rawValues,\n\t\tdates: rawDates,\n\t\tintervalHint,\n\t\tstartDate,\n\t\tprovidedUnit,\n\t\tdefaultUnit,\n\t\tautoValue = true,\n\t\tautoDelta = true,\n\t\tautoMetadata = true,\n\t\tdeltaConfig,\n\t} = input;\n\n\tconst values = rawValues.map((v) =>\n\t\ttypeof v === \"number\" ? v : v == null ? null : Number(v)\n\t);\n\n\t// Latest non-null index\n\tlet lastIndex = -1;\n\tfor (let i = values.length - 1; i >= 0; i--) {\n\t\tif (values[i] != null) {\n\t\t\tlastIndex = i;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Dates resolution: prefer provided dates; otherwise synthesise from hint+startDate\n\tlet dates: (Date | undefined)[] = (rawDates || []).map(toDate);\n\tconst anyDates = dates.some(Boolean);\n\tif (!anyDates) {\n\t\tconst start = toDate(startDate);\n\t\tif (start && intervalHint)\n\t\t\tdates = synthesizeDates(values.length, start, intervalHint);\n\t\telse dates = new Array(values.length).fill(undefined);\n\t}\n\n\tconst frequency = inferFrequency(dates, intervalHint);\n\tconst unit = inferUnit(\n\t\tvalues,\n\t\tprovidedUnit,\n\t\tdefaultUnit,\n\t\tinput.percentHeuristic\n\t);\n\n\tconst value =\n\t\tautoValue && lastIndex >= 0 && values[lastIndex] != null\n\t\t\t? (values[lastIndex] as number)\n\t\t\t: undefined;\n\n\t// Baseline index for delta\n\tconst cfg = {\n\t\tstrategy: \"previous\" as const,\n\t\tn: 1,\n\t\tabsolute: true,\n\t\tskipNulls: true,\n\t\t...(deltaConfig || {}),\n\t};\n\tfunction findBaselineIndex(): number {\n\t\tif (lastIndex < 0) return -1;\n\t\tif (cfg.strategy === \"previous\" || cfg.strategy === \"n-points\") {\n\t\t\tlet idx =\n\t\t\t\tlastIndex - (cfg.strategy === \"previous\" ? 1 : Math.max(1, cfg.n || 1));\n\t\t\tif (!cfg.skipNulls) return idx;\n\t\t\tfor (let i = idx; i >= 0; i--) if (values[i] != null) return i;\n\t\t\treturn -1;\n\t\t}\n\t\t// year-over-year: require dates\n\t\tconst latestDate = dates[lastIndex];\n\t\tif (!latestDate) return -1;\n\t\tconst target = new Date(latestDate);\n\t\ttarget.setFullYear(target.getFullYear() - 1);\n\t\tlet bestIdx = -1;\n\t\tlet bestDiff = Infinity;\n\t\tfor (let i = 0; i < dates.length; i++) {\n\t\t\tconst d = dates[i];\n\t\t\tif (!d || values[i] == null) continue;\n\t\t\tconst diff = Math.abs(d.getTime() - target.getTime());\n\t\t\tif (diff < bestDiff) {\n\t\t\t\tbestDiff = diff;\n\t\t\t\tbestIdx = i;\n\t\t\t}\n\t\t}\n\t\treturn bestIdx;\n\t}\n\tconst baselineIndex = findBaselineIndex();\n\tconst baselineValue = baselineIndex >= 0 ? values[baselineIndex] : null;\n\n\tlet delta: MetricCardProps[\"delta\"] | undefined;\n\tif (autoDelta && value != null && baselineValue != null) {\n\t\tconst abs = value - (baselineValue as number);\n\t\tconst useAbsolute = cfg.absolute !== false;\n\t\tconst val = useAbsolute\n\t\t\t? abs\n\t\t\t: (baselineValue as number) === 0\n\t\t\t\t? 0\n\t\t\t\t: (abs / Math.abs(baselineValue as number)) * 100;\n\t\tdelta = {\n\t\t\tvalue: Number.isFinite(val) ? Number(val.toFixed(2)) : 0,\n\t\t\tisPercent: useAbsolute ? unit === \"%\" : true,\n\t\t\tperiod: `vs ${periodLabel(frequency, intervalHint, cfg.strategy === \"n-points\" ? Math.max(1, cfg.n || 1) : 1)}`,\n\t\t};\n\t}\n\n\tconst latestDate = lastIndex >= 0 ? dates[lastIndex] : undefined;\n\tconst metadata = autoMetadata\n\t\t? formatLatest(latestDate, frequency)\n\t\t\t? `Latest: ${formatLatest(latestDate, frequency)}`\n\t\t\t: undefined\n\t\t: undefined;\n\n\treturn { value, unit, delta, metadata, latestDate, frequency };\n}\n\nexport default computeAutoMetrics;\n","// Lightweight adapter to build v2 rows and visual categories in one call.\n// This helps migrate SPCChart away from legacy engine dependencies.\n\nimport { buildSpcV26a, buildSpcV26aWithVisuals } from \"./engine\";\nimport { SpcVisualCategory } from \"./postprocess/visualCategories\";\nimport { BuildArgsV2, SpcResultV2 } from \"./types\";\n\nexport interface BuildWithVisualsResult extends SpcResultV2 {\n\tvisuals: SpcVisualCategory[];\n}\n\nexport function buildWithVisuals(args: BuildArgsV2): BuildWithVisualsResult {\n\tconst { rows } = buildSpcV26a(args);\n\t// Default visuals derived from engine output without window overrides\n\tconst base = buildSpcV26aWithVisuals(args);\n\treturn { rows, visuals: base.visuals };\n}\n\nexport default { buildWithVisuals };\n","// Centralised SPC UI defaults (keep engine-internal defaults separate)\n\n/** Recommended minimum eligible points before enabling chart-level eligibility */\nexport const DEFAULT_MIN_POINTS = 13;\n","import { ChartType, ImprovementDirection, SpcVisualCategory } from \"../engine\";\nimport { VariationIcon as UiVariationIcon } from \"../SPCChart/types\";\nimport {\n\tChartType as V2ChartType,\n\tImprovementDirection as V2ImprovementDirection,\n\tSpcSettingsV26a as V2Settings,\n} from \"../SPCChart/logic_v2/types\";\nimport { DEFAULT_MIN_POINTS } from \"./constants\";\n\n// Typed point signal values based on UI-level VariationIcon enum (subset only)\nexport type PointSignal =\n\t| UiVariationIcon.Improvement\n\t| UiVariationIcon.Concern\n\t| UiVariationIcon.Neither;\n\nexport function visualsToPointSignals(\n\tvisuals: SpcVisualCategory[] | undefined\n): Array<PointSignal | null> | undefined {\n\tif (!visuals || visuals.length === 0) return undefined;\n\treturn visuals.map((c) => {\n\t\tswitch (c) {\n\t\t\tcase SpcVisualCategory.Improvement:\n\t\t\t\treturn UiVariationIcon.Improvement;\n\t\t\tcase SpcVisualCategory.Concern:\n\t\t\t\treturn UiVariationIcon.Concern;\n\t\t\tcase SpcVisualCategory.NoJudgement:\n\t\t\t\treturn UiVariationIcon.Neither;\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t});\n}\n\nexport function visualsToNeutralFlags(\n\tvisuals: SpcVisualCategory[] | undefined\n) {\n\tif (!visuals || visuals.length === 0) return undefined;\n\treturn visuals.map((c) => c === SpcVisualCategory.NoJudgement);\n}\n\nexport function toV2Enums(\n\tchartType: ChartType,\n\tmetricImprovement: ImprovementDirection\n) {\n\tconst ct: V2ChartType =\n\t\tchartType === ChartType.G\n\t\t\t? V2ChartType.G\n\t\t\t: chartType === ChartType.T\n\t\t\t\t? V2ChartType.T\n\t\t\t\t: V2ChartType.XmR;\n\tconst dir: V2ImprovementDirection =\n\t\tmetricImprovement === ImprovementDirection.Up\n\t\t\t? V2ImprovementDirection.Up\n\t\t\t: metricImprovement === ImprovementDirection.Down\n\t\t\t\t? V2ImprovementDirection.Down\n\t\t\t\t: V2ImprovementDirection.Neither;\n\treturn { chartType: ct, metricImprovement: dir };\n}\n\nexport function toV2Settings(\n\teffEngineSettings: Partial<V2Settings> | undefined,\n\trowsInputMaybeAuto: Array<{\n\t\tvalue?: number | null | undefined;\n\t\tghost?: boolean;\n\t}>,\n\tvisualsEngineSettings?: Partial<V2Settings>\n): Partial<V2Settings> | undefined {\n\tconst min =\n\t\ttypeof effEngineSettings?.minimumPoints === \"number\" &&\n\t\t!isNaN(effEngineSettings!.minimumPoints!)\n\t\t\t? effEngineSettings!.minimumPoints!\n\t\t\t: DEFAULT_MIN_POINTS;\n\tconst out: Partial<V2Settings> = { minimumPoints: min };\n\tconst eligibleCount = rowsInputMaybeAuto.filter(\n\t\t(r) => !r.ghost && typeof r.value === \"number\"\n\t).length;\n\tif (eligibleCount >= min) (out as any).chartLevelEligibility = true;\n\tif (effEngineSettings?.enableFourOfFiveRule != null)\n\t\t(out as any).enableFourOfFiveRule =\n\t\t\t!!effEngineSettings.enableFourOfFiveRule;\n\tif (visualsEngineSettings) Object.assign(out, visualsEngineSettings);\n\treturn Object.keys(out).length ? out : undefined;\n}\n","import * as React from \"react\";\nimport {\n  AXIS_Y_ZERO_BREAK_DEFAULT_GAP_PX,\n  AXIS_Y_ZERO_BREAK_DEFAULT_EXTRA_CLEARANCE_PX,\n  AXIS_Y_ZERO_BREAK_MIN_GAP_PX,\n} from \"../../../Axis/Axis.tokens\";\n\n/**\n * Decide if the y-axis zero break should be shown and compute clamped slot and total reserved pixels.\n * - Preserves true y-domain (range-only lift)\n * - Clamps reserved space relative to inner height to avoid dominating short charts\n */\nexport function useZeroAxisBreak(\n  yDomain: [number, number] | undefined,\n  chartHeight: number | undefined,\n  options?: { maxFraction?: number }\n) {\n  const show = React.useMemo(() => {\n    if (!yDomain || yDomain.length < 2) return false;\n    const min = Math.min(yDomain[0], yDomain[1]);\n    const max = Math.max(yDomain[0], yDomain[1]);\n    return !(0 >= min && 0 <= max);\n  }, [yDomain]);\n\n  const { slotPx, totalReservedPx } = React.useMemo(() => {\n    if (!show) return { slotPx: 0, totalReservedPx: 0 };\n    const height = chartHeight ?? 260;\n    const innerHeightApprox = height - (12 + 48); // ChartRoot top/bottom margins\n\n    const requestedSlot = AXIS_Y_ZERO_BREAK_DEFAULT_GAP_PX;\n    const requestedExtra = AXIS_Y_ZERO_BREAK_DEFAULT_EXTRA_CLEARANCE_PX;\n    const requestedTotal = requestedSlot + requestedExtra;\n    const maxFraction = options?.maxFraction ?? 0.35;\n\n    const maxTotal = Math.max(\n      AXIS_Y_ZERO_BREAK_MIN_GAP_PX,\n      Math.floor(innerHeightApprox * maxFraction)\n    );\n    const totalReservedPx = Math.min(requestedTotal, maxTotal);\n    const slotPx = Math.min(requestedSlot, totalReservedPx);\n\n    return { slotPx, totalReservedPx };\n  }, [show, chartHeight, options?.maxFraction]);\n\n  return { show, slotPx, totalReservedPx } as const;\n}\n","import type { SPCDatum } from \"../SPCChart.props\";\n\n/** Compute y-domain given data, optional limits, flags, and targets. */\nexport function computeYDomain(\n\tdata: SPCDatum[],\n\tlimits: {\n\t\tmean?: number | null;\n\t\tucl?: number | null;\n\t\tlcl?: number | null;\n\t\tonePos?: number | null;\n\t\toneNeg?: number | null;\n\t\ttwoPos?: number | null;\n\t\ttwoNeg?: number | null;\n\t},\n\tflags: {\n\t\talwaysShowZeroY: boolean;\n\t\talwaysShowHundredY: boolean;\n\t\tpercentScale: boolean;\n\t},\n\ttargets?: Array<number | null | undefined> | null\n): [number, number] | undefined {\n\tif (flags.percentScale) {\n\t\tconst allVals = data.map((d) => d.y);\n\t\tconst overMax = Math.max(100, ...allVals);\n\t\tconst underMin = Math.min(0, ...allVals);\n\t\treturn [underMin < 0 ? underMin : 0, overMax > 100 ? overMax : 100];\n\t}\n\n\tconst base: number[] = data.map((d) => d.y);\n\tconst add = (v: number | null | undefined) => {\n\t\tif (v != null) base.push(v);\n\t};\n\t\n\tadd(limits.mean);\n\tadd(limits.ucl);\n\tadd(limits.lcl);\n\tadd(limits.onePos);\n\tadd(limits.oneNeg);\n\tadd(limits.twoPos);\n\tadd(limits.twoNeg);\n\n\tif (targets && targets.length) {\n\t\tfor (const t of targets)\n\t\t\tif (typeof t === \"number\" && !isNaN(t)) base.push(t);\n\t}\n\tif (!base.length) return undefined;\n\tlet min = Math.min(...base);\n\tlet max = Math.max(...base);\n\tif (flags.alwaysShowZeroY) min = Math.min(0, min);\n\tif (flags.alwaysShowHundredY) max = Math.max(100, max);\n\treturn [min, max];\n}\n","import { ChartType, ImprovementDirection, SpcInputRowV2 } from \"../types\";\n\nexport type AutoRecalcArgsV2 = {\n  metricImprovement: ImprovementDirection;\n  chartType: ChartType;\n  shiftLength?: number; // default 6 (inherits shiftPoints in settings typically)\n  deltaSigma?: number; // default 0.5\n  minGap?: number; // optional points since last baseline\n  /**\n   * Optional maximum number of synthetic baselines to insert when using the multi variant.\n   * Defaults to 1 for backward compatibility (same as single-insert behaviour).\n   */\n  maxInsertions?: number;\n};\n\n/**\n * Compute the 0-based index in the original rows where a synthetic baseline should be inserted\n * based on a sustained favourable shift. XmR only; returns null for other chart types or when\n * insufficient evidence. Ghost and non-numeric values are ignored for windowing and MR.\n */\nexport function findAutoRecalcBaselineIndexV2(\n  rows: ReadonlyArray<SpcInputRowV2>,\n  args: AutoRecalcArgsV2\n): number | null {\n  if (!rows?.length) return null;\n  if (args.chartType !== ChartType.XmR) return null;\n\n  const shiftN = Math.max(2, Math.floor(args.shiftLength ?? 6));\n  // Build numeric, non-ghost projection with original indices\n  const numeric: { idx: number; value: number }[] = [];\n  for (let i = 0; i < rows.length; i++) {\n    const r = rows[i];\n    const v = (r as any).value as number | null | undefined;\n    if (r?.ghost) continue;\n    if (typeof v === \"number\" && Number.isFinite(v)) numeric.push({ idx: i, value: v });\n  }\n  if (numeric.length < shiftN * 2) return null;\n\n  // Sigma proxy from MRbar: MRbar * (2.66/3)\n  let mrSum = 0;\n  let mrCount = 0;\n  for (let i = 1; i < numeric.length; i++) {\n    mrSum += Math.abs(numeric[i].value - numeric[i - 1].value);\n    mrCount++;\n  }\n  if (mrCount === 0) return null;\n  const mrBar = mrSum / mrCount;\n  const sigmaProxy = mrBar * (2.66 / 3);\n  if (!Number.isFinite(sigmaProxy) || sigmaProxy <= 0) return null;\n\n  const deltaThreshold = Math.max(0, args.deltaSigma ?? 0.5);\n  const favourUp = args.metricImprovement === ImprovementDirection.Up;\n  const favourDown = args.metricImprovement === ImprovementDirection.Down;\n  const lastBaselineIdx = (() => {\n    for (let i = rows.length - 1; i >= 0; i--) if (rows[i]?.baseline) return i;\n    return -1;\n  })();\n\n  function windowMean(fromIncl: number, toExcl: number): number {\n    let s = 0;\n    let c = 0;\n    for (let i = fromIncl; i < toExcl; i++) {\n      s += numeric[i].value;\n      c++;\n    }\n    return c ? s / c : NaN;\n  }\n\n  for (let start = shiftN; start <= numeric.length - shiftN; start++) {\n    const preMean = windowMean(start - shiftN, start);\n    const postMean = windowMean(start, start + shiftN);\n    if (!Number.isFinite(preMean) || !Number.isFinite(postMean)) continue;\n    const delta = postMean - preMean;\n    const deltaSigma = delta / sigmaProxy;\n\n    // Decide favourability\n    let favourable = false;\n    let directionUp = false; // which side the post window sits relative to preMean\n    if (favourUp) {\n      favourable = deltaSigma >= deltaThreshold;\n      directionUp = true;\n    } else if (favourDown) {\n      favourable = -deltaSigma >= deltaThreshold;\n      directionUp = false;\n    } else {\n      // Neither: use absolute change and pick the sign from delta\n      favourable = Math.abs(deltaSigma) >= deltaThreshold;\n      directionUp = delta > 0;\n    }\n    if (!favourable) continue;\n\n    // Directional gate: all post values strictly on the selected side of preMean\n    const onSide = (v: number) => (directionUp ? v > preMean : v < preMean);\n    let ok = true;\n    for (let j = start; j < start + shiftN; j++) {\n      if (!onSide(numeric[j].value)) {\n        ok = false;\n        break;\n      }\n    }\n    if (!ok) continue;\n\n    // Enforce gap since previous baseline if requested\n    const candidateIdx = numeric[start].idx;\n    if (args.minGap && lastBaselineIdx >= 0) {\n      const pointsSince = candidateIdx - lastBaselineIdx;\n      if (pointsSince < args.minGap) continue;\n    }\n\n    return candidateIdx;\n  }\n\n  return null;\n}\n\n/**\n * Returns a shallow-copied rows array with baseline=true at the computed index (if any).\n */\nexport function autoInsertBaselinesV2(\n  rows: ReadonlyArray<SpcInputRowV2>,\n  args: AutoRecalcArgsV2\n): SpcInputRowV2[] {\n  const idx = findAutoRecalcBaselineIndexV2(rows, args);\n  if (idx == null) return rows.slice();\n  return rows.map((r, i) => (i === idx ? { ...r, baseline: true } : r));\n}\n\n/**\n * Iteratively inserts up to `maxInsertions` synthetic baselines where sustained favourable\n * shifts are detected. Ensures progress by enforcing a minimum gap of at least 1 from the\n * most recent baseline between iterations (even if the caller doesn't specify minGap),\n * preventing repeated selection of the same index.\n */\nexport function autoInsertBaselinesMultiV2(\n  rows: ReadonlyArray<SpcInputRowV2>,\n  args: AutoRecalcArgsV2\n): SpcInputRowV2[] {\n  const max = Math.max(1, Math.floor(args.maxInsertions ?? 1));\n  if (max <= 1) return autoInsertBaselinesV2(rows, args);\n\n  let out = rows.slice();\n  let inserted = 0;\n  // Always enforce at least 1 point since the last baseline to avoid re-picking the same index\n  const baseMinGap = Math.max(1, args.minGap ?? 0);\n\n  while (inserted < max) {\n    const idx = findAutoRecalcBaselineIndexV2(out, { ...args, minGap: baseMinGap });\n    if (idx == null) break;\n    if (out[idx]?.baseline) {\n      // Already a baseline at this index; to ensure we make progress, increase minGap and retry once\n      // (defensive, typically baseMinGap>=1 plus lastBaselineIdx logic avoids reselecting the same index)\n      const nextIdx = findAutoRecalcBaselineIndexV2(out, { ...args, minGap: baseMinGap + 1 });\n      if (nextIdx == null || nextIdx === idx) break;\n      out = out.map((r, i) => (i === nextIdx ? { ...r, baseline: true } : r));\n      inserted++;\n      continue;\n    }\n    out = out.map((r, i) => (i === idx ? { ...r, baseline: true } : r));\n    inserted++;\n  }\n\n  return out;\n}\n","import * as React from \"react\";\nimport \"../../../DataVisualisation.scss\";\nimport \"./SPCChart.scss\";\nimport { ChartRoot } from \"../../../core/ChartRoot\";\nimport { LineScalesProvider } from \"../../../core/ScaleContext\";\nimport { type LineSeries as DVLineSeries } from \"../../../series/LineSeriesPrimitive\";\nimport { DiagnosticsPanel } from \"./components/DiagnosticsPanel\";\nimport { EmbeddedIconsRow } from \"./components/EmbeddedIconsRow\";\nimport { buildEmbeddedIcon } from \"./utils/embeddedIcon\";\nimport InternalSPC from \"./InternalSPC\";\nimport type { InternalSPCProps } from \"./InternalSPC.types\";\n// (Embedded icon constants now encapsulated in utils/embeddedIcon)\n// SPC Logic & types\nimport {\n    SpcWarningSeverity,\n    SpcWarningCategory,\n    SpcWarningCode,\n} from \"./logic_v2/types\";\nimport { VariationIcon } from \"./types\";\nimport computeAutoMetrics from \"../utils/autoMetrics\";\nimport type { EngineRowUI } from \"./SPCChart.types\";\n// v2 engine visuals and presets\nimport { SpcVisualCategory } from \"./logic_v2\";\nimport { BuildArgsV2 as V2BuildArgs, SpcRowV2 as V2Row } from \"./logic_v2/types\";\nimport { VariationIcon as V2VariationIcon } from \"./logic_v2/types\";\nimport {\n\tbuildVisualsForScenario,\n\tVisualsScenario as V2VisualsScenario,\n} from \"./logic_v2/presets\";\nimport { TrendVisualMode as V2TrendVisualMode } from \"./logic_v2\";\nimport { buildWithVisuals as buildWithVisualsV2 } from \"./logic_v2/adapter\";\nimport { toV2Enums, toV2Settings } from \"../utils/transform\";\n// Centralised SPC props/types and normalisation helper\nimport type { SPCDatum, SPCChartProps } from \"./SPCChart.props\";\nimport { normalizeSpcProps, TrendVisualMode } from \"./SPCChart.props\";\nimport { useZeroAxisBreak } from \"./hooks/useZeroAxisBreak\";\nimport { computeYDomain } from \"./utils/domain\";\nimport { autoInsertBaselinesMultiV2 } from \"./logic_v2/utils/autoRecalc\";\n// (InternalSPC owns gradient id base counter)\n\n// Visuals presets for boundary-window and dataset-specific overrides\n// VisualsScenario is re-exported from engine presets\n\nexport const SPCChart: React.FC<SPCChartProps> = (props) => {\n\t// Optional flags now available as props\n\t// Human-friendly label for SpcWarningCode values (snake_case -> Capitalised words)\n\tconst formatWarningCode = React.useCallback(\n\t\t(code: SpcWarningCode | string): string => {\n\t\t\tconst raw = String(code);\n\t\t\treturn raw\n\t\t\t\t.replace(/^spc_warning_code\\.?/i, \"\") // defensive: strip enum prefix if ever serialized\n\t\t\t\t.replace(/[_\\-]+/g, \" \") // underscores/hyphens -> space\n\t\t\t\t.trim()\n\t\t\t\t.split(\" \")\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map((w) => (w.length ? w[0].toUpperCase() + w.slice(1) : w))\n\t\t\t\t.join(\" \");\n\t\t},\n\t\t[]\n\t);\n\n\t// Human friendly label for SpcWarningCategory values (snake_case -> Capitalised words)\n\tconst formatWarningCategory = React.useCallback(\n\t\t(cat: SpcWarningCategory | string): string => {\n\t\t\treturn String(cat)\n\t\t\t\t.replace(/[_\\-]+/g, \" \")\n\t\t\t\t.trim()\n\t\t\t\t.split(\" \")\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map((w) => (w.length ? w[0].toUpperCase() + w.slice(1) : w))\n\t\t\t\t.join(\" \");\n\t\t},\n\t\t[]\n\t);\n\n\t// Removed effectiveEnableTrendSideGating constant)\n\tif (\n\t\tprocess.env.NODE_ENV !== \"production\" &&\n\t\tprops.disableTrendSideGating !== undefined\n\t) {\n\t\tconsole.warn(\n\t\t\t\"SPCChart: 'disableTrendSideGating' prop is deprecated and ignored (trend side gating always enabled).\"\n\t\t);\n\t}\n\n\t// ----- Effective props resolution (grouped props take precedence over flat props) -----\n\tconst {\n\t\teffData,\n\t\teffTargets,\n\t\teffBaselines,\n\t\teffGhosts,\n\t\teffChartTypeCore,\n\t\teffMetricImprovementCore,\n\t\teffEngineSettings,\n\t\teffAlwaysShowZeroY,\n\t\teffAlwaysShowHundredY,\n\t\teffPercentScale,\n\t\teffGradientSequences,\n\t\teffSequenceTransition,\n\t\teffProcessLineWidth,\n\t\teffTrendVisualMode,\n\t\teffShowTrendGatingExplanation,\n\t\teffEnableNeutralNoJudgement,\n\t\teffEnableRules,\n\t\teffShowPartitionMarkers,\n\t\teffShowTrendStartMarkers,\n\t\teffShowFirstFavourableCrossMarkers,\n\t\teffShowTrendBridgeOverlay,\n\t\teffShowSignalsInspector,\n\t\teffOnSignalFocus,\n\t\teffShowWarningsPanel,\n\t\teffWarningsFilter,\n\t\teffShowEmbeddedIcon,\n\t\teffEmbeddedIconVariant,\n\t\teffEmbeddedIconRunLength,\n\t\teffShowFocusIndicator,\n\t\teffHeight,\n\t\teffClassName,\n\t\teffAriaLabel,\n\t\teffUnit,\n\t\teffNarrationContext,\n\t\teffShowZones,\n\t\teffShowPoints,\n\t\teffHighlightOutOfControl,\n\t\teffVisualsScenario,\n\t\teffVisualsEngineSettings,\n\t\t\teffSource,\n\t\t\teffPrecomputedVisuals,\n\t\teffEngineAutoRecalc,\n\t} = normalizeSpcProps(props);\n\n\t// Effective precedence: prefer grouped eff* when provided, otherwise fall back to flat props\n\tconst ariaLabel = effAriaLabel ?? props.ariaLabel;\n\tconst height = effHeight ?? props.height ?? 260;\n\tconst className = effClassName ?? props.className;\n\tconst unit = effUnit ?? props.unit;\n\tconst narrationContext = effNarrationContext ?? props.narrationContext;\n\tconst showZones = (effShowZones ?? props.showZones) as boolean;\n\tconst showPoints = (effShowPoints ?? props.showPoints) as boolean;\n\tconst highlightOutOfControl = (\n\t\teffHighlightOutOfControl ?? props.highlightOutOfControl\n\t) as boolean;\n\tconst visualsScenario = (effVisualsScenario ?? props.visualsScenario) ?? V2VisualsScenario.None;\n\tconst visualsEngineSettings =\n\t\teffVisualsEngineSettings ?? props.visualsEngineSettings;\n\tconst source = effSource ?? props.source;\n\tconst announceFocus = props.a11y?.announceFocus ?? props.announceFocus ?? false;\n\n\t// Build SPC engine instance (memoised)\n\t// NB: settings object is assumed stable if not changing reference (no deep equality check)\n\t// NB: data array is assumed stable if not changing reference (no deep equality check)\n\t// NB: targets/baselines/ghosts are assumed stable if not changing reference (no deep equality check)\n\t// NB: chartType and metricImprovement are primitive values\n\t// NB: useSqlCompatEngine removed – always using native engine rows via v2 adapter for UI\n\t// If any of the above change by reference/value, a new engine is built.\n\t// If the build fails (e.g. insufficient data), engine will be null.\n\t// This is a best-effort attempt to avoid unnecessary rebuilds while still responding to changes.\n\t// Parent components should memoise props where possible to avoid unnecessary rebuilds.\n\t// If more granular control is needed, consider memoising settings and data at a higher level.\n\t// Shared canonical rows input used by both engines and v2 visuals\n\tconst rowsInput = React.useMemo(() => {\n\t\treturn effData.map((d, i) => ({\n\t\t\tx: d.x,\n\t\t\tvalue: d.y,\n\t\t\ttarget: effTargets?.[i] ?? undefined,\n\t\t\tbaseline: effBaselines?.[i] ?? undefined,\n\t\t\tghost: effGhosts?.[i] ?? undefined,\n\t\t}));\n\t}, [effData, effTargets, effBaselines, effGhosts]);\n\n\t// Optional UI pre-processor: auto-insert a baseline after a sustained favourable shift (XmR only)\n\tconst rowsInputMaybeAuto = React.useMemo(() => {\n\t\ttry {\n\t\t\tconst cfg = effEngineAutoRecalc;\n\t\t\tif (!cfg?.enabled) return rowsInput;\n\t\t\t// Only applies to XmR via v2 UI helper; use core values already normalised\n\t\t\t\t\t\treturn autoInsertBaselinesMultiV2(rowsInput, {\n\t\t\t\tchartType: effChartTypeCore as any,\n\t\t\t\tmetricImprovement: effMetricImprovementCore as any,\n\t\t\t\tshiftLength: cfg.shiftLength,\n\t\t\t\tdeltaSigma: cfg.deltaSigma,\n\t\t\t\t\t\t\tminGap: cfg.minGap,\n\t\t\t\t\t\t\tmaxInsertions: (cfg as any).maxInsertions,\n\t\t\t});\n\t\t} catch {\n\t\t\treturn rowsInput;\n\t\t}\n\t}, [rowsInput, effEngineAutoRecalc, effChartTypeCore, effMetricImprovementCore]);\n\n\t// Note: v2 visuals/rows are now the canonical path for UI; legacy engine build removed.\n\n\t// Effective UI options are provided by normalizeSpcProps\n\n\t// Compute engine v2 visuals (UI-agnostic categories) so the engine drives colour coding\n\tconst v2Visuals: SpcVisualCategory[] = React.useMemo(() => {\n\t\t// Prefer precomputed visuals if provided\n\t\tif (effPrecomputedVisuals?.visuals) return effPrecomputedVisuals.visuals;\n\t\ttry {\n\t\t\t// Map legacy SPC settings to v2 engine settings for visual parity (typed)\n\t\t\t// Always resolve a concrete minimumPoints (default 13) and compute chart-level eligibility\n\t\t\tconst v2Settings = toV2Settings(\n\t\t\t\teffEngineSettings as any,\n\t\t\t\trowsInputMaybeAuto,\n\t\t\t\tvisualsEngineSettings as any\n\t\t\t);\n\t\t\tconst { chartType: v2ChartType, metricImprovement: v2Dir } = toV2Enums(\n\t\t\t\teffChartTypeCore,\n\t\t\t\teffMetricImprovementCore\n\t\t\t);\n\t\t\tconst v2Args: V2BuildArgs = {\n\t\t\t\tchartType: v2ChartType,\n\t\t\t\tmetricImprovement: v2Dir,\n\t\t\t\tdata: rowsInputMaybeAuto,\n\t\t\t\tsettings: v2Settings,\n\t\t\t};\n\t\t\tconst { visuals } = buildVisualsForScenario(v2Args, visualsScenario, {\n\t\t\t\ttrendVisualMode:\n\t\t\t\t\teffTrendVisualMode === TrendVisualMode.Ungated\n\t\t\t\t\t\t? V2TrendVisualMode.Ungated\n\t\t\t\t\t\t: V2TrendVisualMode.Gated,\n\t\t\t\tenableNeutralNoJudgement: effEnableNeutralNoJudgement,\n\t\t\t});\n\t\t\treturn visuals || [];\n\t\t} catch {\n\t\t\treturn [];\n\t\t}\n\t}, [\n\t\teffPrecomputedVisuals?.visuals?.length,\n\t\trowsInputMaybeAuto,\n\t\teffChartTypeCore,\n\t\teffMetricImprovementCore,\n\t\teffTrendVisualMode,\n\t\teffEnableNeutralNoJudgement,\n\t\teffEngineSettings,\n\t\tvisualsScenario,\n\t\tvisualsEngineSettings,\n\t]);\n\n\t// Optional: build v2 rows via adapter and map to a UI-compatible shape when enabled\n\tconst v2RowsForUi: EngineRowUI[] | null = React.useMemo(() => {\n\t\t// Prefer precomputed rows if provided\n\t\tif (effPrecomputedVisuals?.rows) {\n\t\t\ttry {\n\t\t\t\tconst rows = effPrecomputedVisuals.rows;\n\t\t\t\tconst mapVariation = (v: V2VariationIcon): VariationIcon => {\n\t\t\t\t\tswitch (v) {\n\t\t\t\t\t\tcase V2VariationIcon.ImprovementHigh:\n\t\t\t\t\t\tcase V2VariationIcon.ImprovementLow:\n\t\t\t\t\t\t\treturn VariationIcon.Improvement;\n\t\t\t\t\t\tcase V2VariationIcon.ConcernHigh:\n\t\t\t\t\t\tcase V2VariationIcon.ConcernLow:\n\t\t\t\t\t\t\treturn VariationIcon.Concern;\n\t\t\t\t\t\tcase V2VariationIcon.NeitherHigh:\n\t\t\t\t\t\tcase V2VariationIcon.NeitherLow:\n\t\t\t\t\t\t\treturn VariationIcon.Neither;\n\t\t\t\t\t\tcase V2VariationIcon.CommonCause:\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn VariationIcon.Neither;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\treturn rows.map(\n\t\t\t\t\t(r: V2Row, i: number): EngineRowUI => ({\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tvalue: r.value,\n\t\t\t\t\t\t\tghost: !!r.ghost,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpartition: { id: r.partitionId },\n\t\t\t\t\t\tlimits: {\n\t\t\t\t\t\t\tmean: r.mean,\n\t\t\t\t\t\t\tucl: r.upperProcessLimit,\n\t\t\t\t\t\t\tlcl: r.lowerProcessLimit,\n\t\t\t\t\t\t\toneSigma: { upper: r.upperOneSigma, lower: r.lowerOneSigma },\n\t\t\t\t\t\t\ttwoSigma: { upper: r.upperTwoSigma, lower: r.lowerTwoSigma },\n\t\t\t\t\t\t},\n\t\t\t\t\t\trules: {\n\t\t\t\t\t\t\tsinglePoint: { up: !!r.singlePointUp, down: !!r.singlePointDown },\n\t\t\t\t\t\t\ttwoOfThree: { up: !!r.twoSigmaUp, down: !!r.twoSigmaDown },\n\t\t\t\t\t\t\tfourOfFive: { up: !!r.fourOfFiveUp, down: !!r.fourOfFiveDown },\n\t\t\t\t\t\t\tshift: { up: !!r.shiftUp, down: !!r.shiftDown },\n\t\t\t\t\t\t\ttrend: { up: !!r.trendUp, down: !!r.trendDown },\n\t\t\t\t\t\t},\n\t\t\t\t\t\tclassification: {\n\t\t\t\t\t\t\tvariation: mapVariation(r.variationIcon),\n\t\t\t\t\t\t\tneutralSpecialCauseValue:\n\t\t\t\t\t\t\t\tr.variationIcon === V2VariationIcon.NeitherHigh ||\n\t\t\t\t\t\t\t\tr.variationIcon === V2VariationIcon.NeitherLow\n\t\t\t\t\t\t\t\t\t? (r.specialCauseImprovementValue ??\n\t\t\t\t\t\t\t\t\t\tr.specialCauseConcernValue ??\n\t\t\t\t\t\t\t\t\t\t1)\n\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\tassurance: undefined,\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttarget: rowsInputMaybeAuto[i]?.target ?? null,\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t} catch {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\ttry {\n\t\t\tconst v2Settings = toV2Settings(\n\t\t\t\teffEngineSettings as any,\n\t\t\t\trowsInputMaybeAuto,\n\t\t\t\tvisualsEngineSettings as any\n\t\t\t);\n\t\t\tconst { chartType: v2ChartType, metricImprovement: v2Dir } = toV2Enums(\n\t\t\t\teffChartTypeCore,\n\t\t\t\teffMetricImprovementCore\n\t\t\t);\n\t\t\tconst v2Args: V2BuildArgs = {\n\t\t\t\tchartType: v2ChartType,\n\t\t\t\tmetricImprovement: v2Dir,\n\t\t\t\tdata: rowsInputMaybeAuto,\n\t\t\t\tsettings: v2Settings,\n\t\t\t};\n\t\t\tconst { rows } = buildWithVisualsV2(v2Args);\n\t\t\t// Map v2 VariationIcon to UI VariationIcon for rendering booleans\n\t\t\tconst mapVariation = (v: V2VariationIcon): VariationIcon => {\n\t\t\t\tswitch (v) {\n\t\t\t\t\tcase V2VariationIcon.ImprovementHigh:\n\t\t\t\t\tcase V2VariationIcon.ImprovementLow:\n\t\t\t\t\t\treturn VariationIcon.Improvement;\n\t\t\t\t\tcase V2VariationIcon.ConcernHigh:\n\t\t\t\t\tcase V2VariationIcon.ConcernLow:\n\t\t\t\t\t\treturn VariationIcon.Concern;\n\t\t\t\t\tcase V2VariationIcon.NeitherHigh:\n\t\t\t\t\tcase V2VariationIcon.NeitherLow:\n\t\t\t\t\t\treturn VariationIcon.Neither;\n\t\t\t\t\tcase V2VariationIcon.CommonCause:\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn VariationIcon.Neither;\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn rows.map(\n\t\t\t\t(r: V2Row, i: number): EngineRowUI => ({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tvalue: r.value,\n\t\t\t\t\t\tghost: !!r.ghost,\n\t\t\t\t\t},\n\t\t\t\t\tpartition: { id: r.partitionId },\n\t\t\t\t\tlimits: {\n\t\t\t\t\t\tmean: r.mean,\n\t\t\t\t\t\tucl: r.upperProcessLimit,\n\t\t\t\t\t\tlcl: r.lowerProcessLimit,\n\t\t\t\t\t\toneSigma: { upper: r.upperOneSigma, lower: r.lowerOneSigma },\n\t\t\t\t\t\ttwoSigma: { upper: r.upperTwoSigma, lower: r.lowerTwoSigma },\n\t\t\t\t\t},\n\t\t\t\t\trules: {\n\t\t\t\t\t\tsinglePoint: { up: !!r.singlePointUp, down: !!r.singlePointDown },\n\t\t\t\t\t\ttwoOfThree: { up: !!r.twoSigmaUp, down: !!r.twoSigmaDown },\n\t\t\t\t\t\tfourOfFive: { up: !!r.fourOfFiveUp, down: !!r.fourOfFiveDown },\n\t\t\t\t\t\tshift: { up: !!r.shiftUp, down: !!r.shiftDown },\n\t\t\t\t\t\ttrend: { up: !!r.trendUp, down: !!r.trendDown },\n\t\t\t\t\t},\n\t\t\t\t\tclassification: {\n\t\t\t\t\t\tvariation: mapVariation(r.variationIcon),\n\t\t\t\t\t\tneutralSpecialCauseValue:\n\t\t\t\t\t\t\tr.variationIcon === V2VariationIcon.NeitherHigh ||\n\t\t\t\t\t\t\tr.variationIcon === V2VariationIcon.NeitherLow\n\t\t\t\t\t\t\t\t? (r.specialCauseImprovementValue ??\n\t\t\t\t\t\t\t\t\tr.specialCauseConcernValue ??\n\t\t\t\t\t\t\t\t\t1)\n\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tassurance: undefined,\n\t\t\t\t\t},\n\t\t\t\t\ttarget: rowsInputMaybeAuto[i]?.target ?? null,\n\t\t\t\t})\n\t\t\t);\n\t\t} catch {\n\t\t\treturn null;\n\t\t}\n\t}, [\n\t\teffPrecomputedVisuals?.rows?.length,\n\t\trowsInputMaybeAuto,\n\t\teffChartTypeCore,\n\t\teffMetricImprovementCore,\n\t\teffEngineSettings,\n\t\tvisualsEngineSettings,\n\t]);\n\n\t// Representative row with populated limits (last available)\n\tconst rowsForUi: EngineRowUI[] | null = v2RowsForUi || null;\n\n\t// Representative row with populated limits (last available)\n\tconst engineRepresentative = (rowsForUi || [])\n\t\t.slice()\n\t\t.reverse()\n\t\t.find((r) => r.limits.mean != null);\n\tconst mean = engineRepresentative?.limits.mean ?? null;\n\t// Basic diagnostics derived in the chart (until v2 engine surfaces warnings directly)\n\tinterface WarningItem {\n\t\tcode: SpcWarningCode;\n\t\tseverity: SpcWarningSeverity;\n\t\tcategory: SpcWarningCategory;\n\t\tmessage: string;\n\t\tcontext?: Record<string, unknown>;\n\t}\n\tconst warnings = React.useMemo<WarningItem[]>(() => {\n\t\tconst list: WarningItem[] = [];\n\t\ttry {\n\t\t\tconst engineRows = rowsForUi;\n\t\t\tconst minPointsGlobal = effEngineSettings?.minimumPoints ?? 13;\n\t\t\tconst minPointsPartition = effEngineSettings?.minimumPoints ?? 12;\n\t\t\tif (engineRows && engineRows.length) {\n\t\t\t\t// Global non-ghost count\n\t\t\t\tconst nonGhostCount = engineRows.filter(\n\t\t\t\t\t(r) => !r.data.ghost && r.data.value != null\n\t\t\t\t).length;\n\t\t\t\tif (nonGhostCount < minPointsGlobal) {\n\t\t\t\t\tlist.push({\n\t\t\t\t\t\tcode: SpcWarningCode.InsufficientPointsGlobal,\n\t\t\t\t\t\tseverity: SpcWarningSeverity.Warning,\n\t\t\t\t\t\tcategory: SpcWarningCategory.Data,\n\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\t\"Not enough non-ghost points to compute stable limits/icons.\",\n\t\t\t\t\t\tcontext: { nonGhostCount, minimumPoints: minPointsGlobal },\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// Partition sizing diagnostics\n\t\t\t\tconst partitions = new Map<\n\t\t\t\t\tnumber,\n\t\t\t\t\t{ size: number; nonGhost: number }\n\t\t\t\t>();\n\t\t\t\tfor (const r of engineRows) {\n\t\t\t\t\tconst pid = r.partition.id ?? 0;\n\t\t\t\t\tconst rec = partitions.get(pid) || { size: 0, nonGhost: 0 };\n\t\t\t\t\trec.size += 1;\n\t\t\t\t\tif (!r.data.ghost && r.data.value != null) rec.nonGhost += 1;\n\t\t\t\t\tpartitions.set(pid, rec);\n\t\t\t\t}\n\t\t\t\tfor (const [pid, rec] of partitions) {\n\t\t\t\t\tif (rec.nonGhost > 0 && rec.nonGhost < minPointsPartition) {\n\t\t\t\t\t\tlist.push({\n\t\t\t\t\t\t\tcode: SpcWarningCode.InsufficientPointsPartition,\n\t\t\t\t\t\t\tseverity: SpcWarningSeverity.Warning,\n\t\t\t\t\t\t\tcategory: SpcWarningCategory.Partition,\n\t\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\t\t\"A partition/baseline segment has too few points for recommended stability.\",\n\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\tpartitionId: pid,\n\t\t\t\t\t\t\t\tnonGhostCount: rec.nonGhost,\n\t\t\t\t\t\t\t\tminimumPointsPartition: minPointsPartition,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch {\n\t\t\t// swallow – diagnostics are best-effort\n\t\t}\n\t\treturn list;\n\t}, [rowsForUi, effEngineSettings?.minimumPoints]);\n\tconst filteredWarnings = React.useMemo(() => {\n\t\tif (!warnings.length) return [] as typeof warnings;\n\t\t\tif (!effWarningsFilter) return warnings;\n\t\treturn warnings.filter((w) => {\n\t\t\tif (\n\t\t\t\t\teffWarningsFilter.severities &&\n\t\t\t\tw.severity &&\n\t\t\t\t\t!effWarningsFilter.severities.includes(w.severity)\n\t\t\t)\n\t\t\t\treturn false;\n\t\t\tif (\n\t\t\t\t\teffWarningsFilter.categories &&\n\t\t\t\tw.category &&\n\t\t\t\t\t!effWarningsFilter.categories.includes(w.category)\n\t\t\t)\n\t\t\t\treturn false;\n\t\t\tif (\n\t\t\t\t\teffWarningsFilter.codes &&\n\t\t\t\t\t!effWarningsFilter.codes.includes(w.code as SpcWarningCode)\n\t\t\t)\n\t\t\t\treturn false;\n\t\t\treturn true;\n\t\t});\n\t\t}, [warnings, effWarningsFilter]);\n\n// Diagnostics live region and table are handled by DiagnosticsPanel now\n\n\t// Y-axis domain including limits\n\tconst ucl = engineRepresentative?.limits.ucl ?? null;\n\tconst lcl = engineRepresentative?.limits.lcl ?? null;\n\tconst onePos = engineRepresentative?.limits.oneSigma.upper ?? null;\n\tconst oneNeg = engineRepresentative?.limits.oneSigma.lower ?? null;\n\tconst twoPos = engineRepresentative?.limits.twoSigma.upper ?? null;\n\tconst twoNeg = engineRepresentative?.limits.twoSigma.lower ?? null;\n\tconst sigma = mean != null && onePos != null ? Math.abs(onePos - mean) : 0;\n\n\t// Force SPC process line to neutral grey (#A6A6A6) to align with default point (common cause) colour.\n\tconst series: DVLineSeries[] = React.useMemo(\n\t\t() => [{ id: \"process\", data: effData, color: \"#A6A6A6\" }],\n\t\t[effData]\n\t);\n\tconst yDomain = React.useMemo(() =>\n\t\tcomputeYDomain(\n\t\t\teffData,\n\t\t\t{ mean, ucl, lcl, onePos, oneNeg, twoPos, twoNeg },\n\t\t\t{\n\t\t\t\talwaysShowZeroY: !!effAlwaysShowZeroY,\n\t\t\t\talwaysShowHundredY: !!effAlwaysShowHundredY,\n\t\t\t\tpercentScale: !!effPercentScale,\n\t\t\t},\n\t\t\teffTargets ?? null\n\t\t),\n\t[\n\t\teffData,\n\t\tmean,\n\t\tucl,\n\t\tlcl,\n\t\tonePos,\n\t\toneNeg,\n\t\ttwoPos,\n\t\ttwoNeg,\n\t\teffTargets,\n\t\teffAlwaysShowZeroY,\n\t\teffAlwaysShowHundredY,\n\t\teffPercentScale,\n\t]);\n\n\t// Compute a uniform target once at the outer level (rows + raw targets available)\n\tconst uniformTarget = React.useMemo(() => {\n\t\tconst collectUniform = (\n\t\t\tarr: Array<number | null | undefined>\n\t\t): number | null => {\n\t\t\tconst nums = arr.filter(\n\t\t\t\t(t): t is number => typeof t === \"number\" && !isNaN(t)\n\t\t\t);\n\t\t\tif (!nums.length) return null;\n\t\t\tconst first = nums[0];\n\t\t\treturn nums.every((v) => v === first) ? first : null;\n\t\t};\n\t\t// Try from adapter rows first (if targets were preserved)\n\t\tif (rowsForUi && rowsForUi.length) {\n\t\t\tconst fromRows = collectUniform(rowsForUi.map((r) => r.target));\n\t\t\tif (fromRows != null) return fromRows;\n\t\t}\n\t\t// Fallback to the effective targets array\n\t\tif (effTargets && effTargets.length) {\n\t\t\treturn collectUniform(effTargets);\n\t\t}\n\t\treturn null;\n\t}, [rowsForUi, effTargets]);\n\n\t// Reserve extra bottom gap (range-only) when zero is not in the y-domain to visually accommodate the axis break\n\tconst { show: showZeroBreakOuter, slotPx: slotGapPx, totalReservedPx } = useZeroAxisBreak(\n\t\tyDomain,\n\t\theight,\n\t\t{ maxFraction: 0.35 }\n\t);\n\tconst yBottomGapPx = showZeroBreakOuter ? totalReservedPx : 0;\n\n\t// Use shared auto metrics helper to infer unit consistently with SPCMetricCard\n\tconst autoFromHelper = React.useMemo(() => {\n\t\t// SPCDatum.x is already Date | string | number; pass through directly for auto metrics\n\t\tconst dateCandidates = effData.map((d) => d.x);\n\t\treturn computeAutoMetrics({\n\t\t\tvalues: effData.map((d) => d.y),\n\t\t\tdates: dateCandidates,\n\t\t\tprovidedUnit: unit || narrationContext?.measureUnit,\n\t\t\tpercentHeuristic: \"0-1\",\n\t\t\tautoValue: false,\n\t\t\tautoDelta: false,\n\t\t\tautoMetadata: false,\n\t\t});\n\t}, [effData, unit, narrationContext?.measureUnit]);\n\n\tconst effectiveUnit = unit ?? narrationContext?.measureUnit ?? autoFromHelper.unit;\n\tconst effectiveNarrationContext = React.useMemo(() => {\n\t\treturn effectiveUnit\n\t\t\t? { ...(narrationContext || {}), measureUnit: effectiveUnit }\n\t\t\t: narrationContext;\n\t}, [narrationContext, effectiveUnit]);\n\n\t// Partition markers (after engine available)\n\tconst partitionMarkers = React.useMemo(() => {\n\t\tif (!rowsForUi) return [] as number[];\n\t\tconst markers: number[] = [];\n\t\tfor (let i = 1; i < rowsForUi.length; i++) {\n\t\t\tif (rowsForUi[i].partition.id !== rowsForUi[i - 1].partition.id)\n\t\t\t\tmarkers.push(i);\n\t\t}\n\t\treturn markers;\n\t}, [rowsForUi]);\n\n\t// Derive embedded variation/assurance icons as a single React node\n\tconst embeddedIcon = React.useMemo(\n\t\t() =>\n\t\t\tbuildEmbeddedIcon({\n\t\t\t\tshow: !!effShowEmbeddedIcon,\n\t\t\t\trowsForUi,\n\t\t\t\tminPoints: effEngineSettings?.minimumPoints ?? 13,\n\t\t\t\tmetricImprovement: effMetricImprovementCore,\n\t\t\t\tvariant: effEmbeddedIconVariant,\n\t\t\t\trunLength: effEmbeddedIconRunLength,\n\t\t\t}),\n\t\t[\n\t\t\teffShowEmbeddedIcon,\n\t\t\trowsForUi,\n\t\t\teffEngineSettings?.minimumPoints,\n\t\t\teffMetricImprovementCore,\n\t\t\teffEmbeddedIconVariant,\n\t\t\teffEmbeddedIconRunLength,\n\t\t]\n\t);\n\n\treturn (\n\t\t<div\n\t\t\tclassName={\n\t\t\t\tclassName\n\t\t\t\t\t? `fdp-spc-chart-wrapper ${className}`\n\t\t\t\t\t: \"fdp-spc-chart-wrapper\"\n\t\t\t}\n\t\t>\n\t\t\t{/* Top row containing right-aligned embedded variation + assurance icons */}\n\t\t\t<EmbeddedIconsRow\n\t\t\t\tshow={!!effShowEmbeddedIcon}\n\t\t\t\tvariationNode={embeddedIcon}\n\t\t\t\tassuranceNode={null /* assurance icon is already part of embeddedIcon block */}\n\t\t\t/>\n\n\t\t\t<ChartRoot\n\t\t\t\theight={height}\n\t\t\t\tariaLabel={ariaLabel}\n\t\t\t\tmargin={{ bottom: 48, left: 56, right: 16, top: 12 }}\n\t\t\t>\n\t\t\t\t<LineScalesProvider<SPCDatum> series={series} yDomain={yDomain} yBottomGapPx={yBottomGapPx}>\n\t\t\t\t\t{(() => {\n\t\t\t\t\t\tconst internalProps: InternalSPCProps = {\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tseries,\n\t\t\t\t\t\t\t\tengineRows: rowsForUi,\n\t\t\t\t\t\t\t\tvisualCategories: v2Visuals,\n\t\t\t\t\t\t\t\tpartitionMarkers: effShowPartitionMarkers ? partitionMarkers : [],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttargets: {\n\t\t\t\t\t\t\t\tlimits: { mean, ucl, lcl, sigma, onePos, oneNeg, twoPos, twoNeg },\n\t\t\t\t\t\t\t\tuniformTarget,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tvisuals: {\n\t\t\t\t\t\t\t\tshowPoints,\n\t\t\t\t\t\t\t\tshowZones,\n\t\t\t\t\t\t\t\thighlightOutOfControl,\n\t\t\t\t\t\t\t\tgradientSequences: effGradientSequences,\n\t\t\t\t\t\t\t\tsequenceTransition: effSequenceTransition,\n\t\t\t\t\t\t\t\tprocessLineWidth: effProcessLineWidth,\n\t\t\t\t\t\t\t\tshowFocusIndicator: effShowFocusIndicator,\n\t\t\t\t\t\t\t\tenableRules: effEnableRules,\n\t\t\t\t\t\t\t\tenableNeutralNoJudgement: effEnableNeutralNoJudgement,\n\t\t\t\t\t\t\t\tshowTrendStartMarkers: effShowTrendStartMarkers,\n\t\t\t\t\t\t\t\tshowFirstFavourableCrossMarkers: effShowFirstFavourableCrossMarkers,\n\t\t\t\t\t\t\t\tshowTrendBridgeOverlay: effShowTrendBridgeOverlay,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ta11y: {\n\t\t\t\t\t\t\t\tannounceFocus,\n\t\t\t\t\t\t\t\tariaLabel,\n\t\t\t\t\t\t\t\tnarrationContext: effectiveNarrationContext,\n\t\t\t\t\t\t\t\tshowSignalsInspector: effShowSignalsInspector,\n\t\t\t\t\t\t\t\tonSignalFocus: effOnSignalFocus,\n\t\t\t\t\t\t\t\tshowTrendGatingExplanation: effShowTrendGatingExplanation,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\taxis: { zeroBreakSlotGapPx: slotGapPx },\n\t\t\t\t\t\t\tcompute: { effectiveUnit, metricImprovement: effMetricImprovementCore },\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn <InternalSPC {...internalProps} />;\n\t\t\t\t\t})()}\n\t\t\t\t</LineScalesProvider>\n\t\t\t</ChartRoot>\n\t\t\t{source && (\n\t\t\t\t<div className=\"fdp-spc-chart__source\" aria-label=\"Chart data source\">\n\t\t\t\t\t{typeof source === \"string\" ? (\n\t\t\t\t\t\t<small>Source: {source}</small>\n\t\t\t\t\t) : (\n\t\t\t\t\t\tsource\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t\t<DiagnosticsPanel\n\t\t\t\tshow={!!effShowWarningsPanel}\n\t\t\t\twarnings={filteredWarnings as any}\n\t\t\t\tformatWarningCategory={formatWarningCategory}\n\t\t\t\tformatWarningCode={formatWarningCode}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\n// Transparent rectangle capturing pointer + keyboard events to drive tooltip focus\n/* InteractionLayer lives with InternalSPC */\n\nexport default SPCChart;\n","// Shared SPC state helpers to keep mapping logic DRY across hooks, stories, and components.\n// Publicly exported via the SPC barrel for reuse by consumers (e.g., dashboards) without deep imports.\n\nimport { VariationState } from \"../SPCIcons/SPCConstants\";\nimport { VariationIcon } from \"../engine\";\n\n/** Map engine VariationIcon to VariationState used by icons and narration */\nexport function mapIconToVariation(\n\ticon?: VariationIcon | null\n): VariationState | null {\n\tswitch (icon) {\n\t\tcase VariationIcon.ImprovementHigh:\n\t\tcase VariationIcon.ImprovementLow:\n\t\t\treturn VariationState.SpecialCauseImproving;\n\t\tcase VariationIcon.ConcernHigh:\n\t\tcase VariationIcon.ConcernLow:\n\t\t\treturn VariationState.SpecialCauseDeteriorating;\n\t\tcase VariationIcon.NeitherHigh:\n\t\tcase VariationIcon.NeitherLow:\n\t\t\treturn VariationState.SpecialCauseNoJudgement;\n\t\tcase VariationIcon.CommonCause:\n\t\t\treturn VariationState.CommonCause;\n\t\tdefault:\n\t\t\treturn null;\n\t}\n}\n\n/** Whether a VariationIcon represents a special-cause data point */\nexport function isSpecialCauseIcon(icon?: VariationIcon | null): boolean {\n\treturn (\n\t\ticon === VariationIcon.ImprovementHigh ||\n\t\ticon === VariationIcon.ImprovementLow ||\n\t\ticon === VariationIcon.ConcernHigh ||\n\t\ticon === VariationIcon.ConcernLow ||\n\t\ticon === VariationIcon.NeitherHigh ||\n\t\ticon === VariationIcon.NeitherLow\n\t);\n}\n","import {\n\tbuildSpcV26a,\n\tChartType,\n\tcomputeSpcVisualCategories,\n\tSpcVisualCategory,\n\tVariationIcon,\n} from \"../engine\";\nimport { ImprovementDirection } from \"../engine\";\nimport { mapIconToVariation } from \"./state\";\nimport { DEFAULT_MIN_POINTS } from \"./constants\";\nimport { visualsToNeutralFlags, visualsToPointSignals, type PointSignal } from \"./transform\";\nimport type { VariationState } from \"../SPCIcons/SPCConstants\";\n\nexport type SpcDatum =\n\t| { x: string | number | Date; value: number | null }\n\t| { x: string | number | Date; y: number | null };\n\nexport interface SpcPrecomputedSummary {\n\trows: any[];\n\tvisuals: SpcVisualCategory[];\n\tlatestState: VariationState | null;\n\t/** Engine variation icon on the last real row (preserves side for neutral special cause) */\n\tlastVariationIcon: VariationIcon | null;\n\tcenterLine: number | null;\n\tcontrolLimits: { lower: number | null; upper: number | null } | null;\n\tsigmaBands: {\n\t\tupperOne: number | null;\n\t\tupperTwo: number | null;\n\t\tlowerOne: number | null;\n\t\tlowerTwo: number | null;\n\t} | null;\n\t/** Optional convenience arrays for spark fallback colouring when visuals aren’t used */\n\tpointSignals?: Array<PointSignal | null>;\n\tpointNeutralSpecialCause?: boolean[];\n}\n\nexport interface ComputeSpcPrecomputedOptions {\n\tchartType?: ChartType;\n\tmetricImprovement: ImprovementDirection;\n\t/** Minimum eligible points to turn on chart-level eligibility (defaults 13 to mirror SPCChart) */\n\tminimumPoints?: number;\n\t/** Whether to enable neutral no judgement categorisation (default true) */\n\tenableNeutralNoJudgement?: boolean;\n\t/** Include signal fallbacks (derived from visual categories). Default true */\n\tincludeSignalFallbacks?: boolean;\n}\n\n/**\n * Compute engine rows and visual categories once for a series (e.g., one table row),\n * plus derived latest state and limits/bands for rendering SPCChart and SPCSpark with parity.\n */\nexport function computeSpcPrecomputed(\n\tdata: SpcDatum[],\n\topts: ComputeSpcPrecomputedOptions\n): SpcPrecomputedSummary {\n\tconst {\n\t\tchartType = ChartType.XmR,\n\t\tmetricImprovement,\n\t\tminimumPoints = DEFAULT_MIN_POINTS,\n\t\tenableNeutralNoJudgement = true,\n\t\tincludeSignalFallbacks = true,\n\t} = opts;\n\n\t// Normalise to engine rows shape { x, value }\n\tconst normalized = data.map((d: any) => ({ x: d.x, value: d.value ?? d.y ?? null }));\n\n\tlet engine: any = null;\n\ttry {\n\t\tconst eligibleCount = normalized.filter(\n\t\t\t(d) => typeof d.value === \"number\"\n\t\t).length;\n\t\tconst settings: any = { minimumPoints };\n\t\tif (eligibleCount >= minimumPoints) settings.chartLevelEligibility = true;\n\t\tengine = buildSpcV26a({ chartType, metricImprovement, data: normalized, settings });\n\t} catch {\n\t\tengine = null;\n\t}\n\n\tconst rows: any[] = (engine?.rows ?? []) as any[];\n\t// last real row for limits/means\n\tlet last: any = rows[rows.length - 1] ?? null;\n\tfor (let i = rows.length - 1; i >= 0; i--) {\n\t\tconst r = rows[i];\n\t\tif (r && r.value != null && !r.ghost) {\n\t\t\tlast = r;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tlet visuals: SpcVisualCategory[] = [];\n\ttry {\n\t\tvisuals = computeSpcVisualCategories(rows as any, {\n\t\t\tmetricImprovement,\n\t\t\tenableNeutralNoJudgement,\n\t\t});\n\t} catch {\n\t\tvisuals = [];\n\t}\n\n\tconst latestState = mapIconToVariation(\n\t\tlast?.variationIcon as VariationIcon | null\n\t);\n\tconst lastVariationIcon = (last?.variationIcon ?? null) as VariationIcon | null;\n\tconst centerLine = (last?.mean ?? null) as number | null;\n\tconst controlLimits = last\n\t\t? {\n\t\t\tlower: (last?.lowerProcessLimit ?? null) as number | null,\n\t\t\tupper: (last?.upperProcessLimit ?? null) as number | null,\n\t\t\t}\n\t: null;\n\tconst sigmaBands = last ? {\n\t\t\tupperOne: (last?.upperOneSigma ?? null) as number | null,\n\t\t\tupperTwo: (last?.upperTwoSigma ?? null) as number | null,\n\t\t\tlowerOne: (last?.lowerOneSigma ?? null) as number | null,\n\t\t\tlowerTwo: (last?.lowerTwoSigma ?? null) as number | null,\n\t} : null;\n\n\tlet pointSignals: SpcPrecomputedSummary[\"pointSignals\"] | undefined;\n\tlet pointNeutralSpecialCause:\n\t\t| SpcPrecomputedSummary[\"pointNeutralSpecialCause\"]\n\t\t| undefined;\n\tif (includeSignalFallbacks) {\n\t\tpointSignals = visualsToPointSignals(visuals as SpcVisualCategory[]);\n\t\tpointNeutralSpecialCause = visualsToNeutralFlags(visuals as SpcVisualCategory[]);\n\t}\n\n\treturn {\n\t\trows,\n\t\tvisuals,\n\t\tlatestState,\n\t\tlastVariationIcon,\n\t\tcenterLine,\n\t\tcontrolLimits,\n\t\tsigmaBands,\n\t\tpointSignals,\n\t\tpointNeutralSpecialCause,\n\t};\n}\n"],"names":["useChartDimensions","initial","ref","React","margin","dims","setDims","ro","entries","entry","width","height","innerWidth","innerHeight","ChartContext","useChartContext","ChartRoot","className","children","role","ariaLabel","style","ascending","a","b","descending","bisector","f","compare1","compare2","delta","d","x","zero","left","lo","hi","mid","right","center","i","number","ascendingBisect","bisectRight","extent","values","valueof","min","max","value","index","e10","e5","e2","tickSpec","start","stop","count","step","power","error","factor","i1","i2","inc","ticks","reverse","n","tickIncrement","tickStep","initRange","domain","range","define","constructor","factory","prototype","extend","parent","definition","key","Color","darker","brighter","reI","reN","reP","reHex","reRgbInteger","reRgbPercent","reRgbaInteger","reRgbaPercent","reHslPercent","reHslaPercent","named","color","channels","color_formatHex","color_formatHex8","color_formatHsl","color_formatRgb","hslConvert","format","m","l","rgbn","Rgb","rgba","hsla","r","g","rgbConvert","o","rgb","opacity","k","clampi","clampa","rgb_formatHex","rgb_formatHex8","rgb_formatRgb","hex","h","s","Hsl","hsl","m2","m1","hsl2rgb","clamph","clampt","constant$1","linear","t","exponential","y","gamma","nogamma","constant","rgbGamma","end","colorRgb","numberArray","c","isNumberArray","genericArray","nb","na","date$1","interpolateNumber","object","reA","reB","one","string","bi","am","bm","bs","q","interpolate","date","interpolateRound","constants","unit","identity","normalize","clamper","bimap","d0","d1","r0","r1","polymap","j","bisect","copy","source","target","transformer","interpolateValue","transform","untransform","unknown","clamp","piecewise","output","input","rescale","scale","_","u","continuous","formatDecimal","formatDecimalParts","p","coefficient","exponent","formatGroup","grouping","thousands","length","formatNumerals","numerals","re","formatSpecifier","specifier","match","FormatSpecifier","formatTrim","out","i0","prefixExponent","formatPrefixAuto","formatRounded","formatTypes","map","prefixes","formatLocale$1","locale","group","currencyPrefix","currencySuffix","decimal","percent","minus","nan","newFormat","fill","align","sign","symbol","comma","precision","trim","type","prefix","suffix","formatType","maybeSuffix","valuePrefix","valueSuffix","valueNegative","padding","formatPrefix","e","defaultLocale","formatLocale","precisionFixed","precisionPrefix","precisionRound","tickFormat","linearish","prestep","maxIter","nice","interval","x0","x1","t0","t1","timeInterval","floori","offseti","field","previous","test","millisecond","durationSecond","durationMinute","durationHour","durationDay","durationWeek","durationMonth","durationYear","second","timeMinute","utcMinute","timeHour","utcHour","timeDay","utcDay","unixDay","timeWeekday","timeSunday","timeMonday","timeTuesday","timeWednesday","timeThursday","timeFriday","timeSaturday","utcWeekday","utcSunday","utcMonday","utcTuesday","utcWednesday","utcThursday","utcFriday","utcSaturday","timeMonth","utcMonth","timeYear","utcYear","ticker","year","month","week","day","hour","minute","tickIntervals","tickInterval","timeTicks","timeTickInterval","localDate","utcDate","newDate","locale_dateTime","locale_date","locale_time","locale_periods","locale_weekdays","locale_shortWeekdays","locale_months","locale_shortMonths","periodRe","formatRe","periodLookup","formatLookup","weekdayRe","weekdayLookup","shortWeekdayRe","shortWeekdayLookup","monthRe","monthLookup","shortMonthRe","shortMonthLookup","formats","formatShortWeekday","formatWeekday","formatShortMonth","formatMonth","formatDayOfMonth","formatMicroseconds","formatYearISO","formatFullYearISO","formatHour24","formatHour12","formatDayOfYear","formatMilliseconds","formatMonthNumber","formatMinutes","formatPeriod","formatQuarter","formatUnixTimestamp","formatUnixTimestampSeconds","formatSeconds","formatWeekdayNumberMonday","formatWeekNumberSunday","formatWeekNumberISO","formatWeekdayNumberSunday","formatWeekNumberMonday","formatYear","formatFullYear","formatZone","formatLiteralPercent","utcFormats","formatUTCShortWeekday","formatUTCWeekday","formatUTCShortMonth","formatUTCMonth","formatUTCDayOfMonth","formatUTCMicroseconds","formatUTCYearISO","formatUTCFullYearISO","formatUTCHour24","formatUTCHour12","formatUTCDayOfYear","formatUTCMilliseconds","formatUTCMonthNumber","formatUTCMinutes","formatUTCPeriod","formatUTCQuarter","formatUTCSeconds","formatUTCWeekdayNumberMonday","formatUTCWeekNumberSunday","formatUTCWeekNumberISO","formatUTCWeekdayNumberSunday","formatUTCWeekNumberMonday","formatUTCYear","formatUTCFullYear","formatUTCZone","parses","parseShortWeekday","parseWeekday","parseShortMonth","parseMonth","parseLocaleDateTime","parseDayOfMonth","parseMicroseconds","parseYear","parseFullYear","parseHour24","parseDayOfYear","parseMilliseconds","parseMonthNumber","parseMinutes","parsePeriod","parseQuarter","parseUnixTimestamp","parseUnixTimestampSeconds","parseSeconds","parseWeekdayNumberMonday","parseWeekNumberSunday","parseWeekNumberISO","parseWeekdayNumberSunday","parseWeekNumberMonday","parseLocaleDate","parseLocaleTime","parseZone","parseLiteralPercent","pad","pads","newParse","Z","parseSpecifier","parse","numberRe","percentRe","requoteRe","requote","names","name","dISO","z","dow","UTCdISO","timeFormat","calendar","invert","formatMillisecond","formatSecond","formatMinute","formatHour","formatDay","formatWeek","time","timeWeek","timeSecond","pi","tau","epsilon","tauEpsilon","append","strings","appendRound","digits","Path","y1","x2","y2","y0","x21","y21","x01","y01","l01_2","x20","y20","l21_2","l20_2","l21","l01","t01","t21","a0","a1","ccw","dx","dy","cw","da","w","withPath","shape","array","Linear","context","curveLinear","d3Line","defined","curve","path","line","pointX","pointY","data","defined0","buffer","d3Area","area","x0z","y0z","arealine","slope3","that","h0","h1","s0","s1","slope2","point","MonotoneX","monotoneX","createXTimeScale","accessor","scaleTime","createYLinearScale","scaleLinear","lower","span","upper","createLinePath","options","lineGen","curveMonotoneX","ScaleContext","useScaleContext","LineScalesProvider","series","innerWidthProp","innerHeightProp","parseXProp","xTickCount","yTickCount","yDomain","xPadding","yPadding","yBottomGapPx","chartDims","allData","parseX","raw","xPad","yPad","xScale","yScale","extraBottom","bottomPixel","hasOwn","classNames","classes","arg","appendClass","parseValue","newClass","module","deriveLevel","size","mapHeadingProps","level","Heading","text","html","marginBottom","rest","model","content","createElement","Panel","id","headingText","headingHtml","headingLevel","bodyText","bodyHtml","props","panelClasses","renderHeading","renderBody","prismGlobalRef","ensurePrismGlobal","fallbackHighlight","code","patterns","highlightCode","lang","disable","Prism","resolvedLang","TableBase","rows","head","caption","captionSize","firstCellIsHeader","responsive","heading","panel","tableClasses","attributes","testId","columns","visuallyHiddenCaption","captionClass","tableClassList","containerClassList","renderHeaderCell","cell","headerClasses","headerAttributes","isArray","codeString","isMultiline","codeProps","highlighted","renderCell","cellIndex","isFirstCell","isHeaderCell","cellClasses","cellAttributes","inner","cellContent","Component","derivedHead","derivedRows","rowObj","rIdx","base","rendered","renderTable","row","rowIndex","TableCaption","cls","TableBodyRow","roleAttrs","TableHeaderCell","node","codeLanguage","codeClassName","disableHighlight","colspan","rowspan","as","TableCell","rowHeader","isHeader","Tag","cellAttrs","Table","__warnedRow","__warnedTH","mapTagProps","noBorder","closable","disabled","onClose","handleClose","DiagnosticsPanel","warnings","show","formatWarningCategory","formatWarningCode","diagnosticsMessage","setDiagnosticsMessage","lastDiagnosticsRef","total","msg","counts","SpcWarningSeverity","breakdownParts","severityColor","EmbeddedIconsRow","variationNode","assuranceNode","buildEmbeddedIcon","args","rowsForUi","minPoints","metricImprovement","variant","runLength","engineRows","lastIdx","lastRow","variation","assuranceRaw","hasNeutralSpecialCause","VariationIcon","assuranceRenderStatus","AssuranceIcon","AssuranceResult","trend","singleHigh","singleLow","ImprovementDirection","Direction","anyHighSide","anyLowSide","iconSize","highSideSignal","lowSideSignal","variationEngine","V2VariationIcon","SPCVariationIcon","LetterMode","SpcEmbeddedIconVariant","SPCAssuranceIcon","AXIS_Y_ZERO_BREAK_DEFAULT_GAP_PX","AXIS_Y_ZERO_BREAK_MIN_GAP_PX","AXIS_Y_ZERO_BREAK_DEFAULT_EXTRA_CLEARANCE_PX","AXIS_ZIGZAG_DEFAULT_AMPLITUDE_PX","AXIS_ZIGZAG_DEFAULT_CYCLES","AXIS_ZIGZAG_DEFAULT_STEP_X_PX","AXIS_ZIGZAG_DEFAULT_HEIGHT_PX","Axis","tickCount","tickValues","rawFormatTick","label","offset","minLabelSpacing","maxTickLabelLength","autoMinLabelSpacing","labelAngle","allowLabelWrap","tickFormatPreset","yZeroBreak","scaleCtx","resolvedScale","defaultCount","hasUserFormatter","presetFormatter","dtf","opts","v","effectiveFormatTick","first","last","spanMs","oneDay","oneYear","sameYear","dtfMonth","dtfTime","seenMonths","isBandScale","bandwidth","tickPos","resolvedMinSpacing","labels","avgLen","filteredTicks","accepted","lastPos","pos","rawLabel","displayLabel","lines","anchor","ln","li","showZeroAxisBreak","gapPx","topSolidEnd","bottom","slotTop","slotHeight","defaultAmp","defaultCycles","amp","stepX","desired","heightDesired","cycles","zigLen","maxHeight","zigStart","zigEnd","pairCount","halfDy","halfDx","GridLines","axis","stroke","dasharray","legacyCategorical","categoricalPalette","optimizedCategoricalPalette","extendedPaletteCache","categoricalStrategy","buildPalette","root","colorTokens","dataVizTokens","resolve","seen","acc","palette","tokenPath","getPalette","hexToRgb","srgbToLinear","rgbToXyz","R","G","B","xyzToLab","X","Y","hexToLab","xyz","deltaE76","c1","c2","dL","db","buildOptimizedCategoricalPalette","labs","bestStartIdx","bestAvg","avg","remaining","order","nextIdx","bestMin","idx","minD","getOptimizedPalette","labToXyz","L","t3","xyzToRgb","linToSrgb","rgbToHex","adjustLightness","deltaL","lab","buildExtendedPalette","variants","extended","getExtendedPalette","extendedPaletteCacheStrategyMismatch","lastExtendedStrategy","pickSeriesColor","ext","categoricalStrokeMap","regionStrokeMap","severityStrokeMap","orgLevelStrokeMap","buildStrokeMaps","cat","reg","sev","org","ensureStrokeMaps","pickSeriesStroke","getRegionStroke","pickRegionStroke","fallbackIndex","regionMap","REGION_IDS","normalizeRegionId","buildRegionMap","missing","getRegionMap","getRegionColor","pickRegionColor","VisibilityContext","useVisibility","TooltipContext","useTooltipContext","TooltipProvider","maxDistance","wrapAround","visibility","focused","setFocused","seriesRef","aggregated","setAggregated","registerSeries","seriesId","unregisterSeries","focusNearest","plotX","plotY","best","bestDist","sid","px","py","dist","clear","agg","focusRelativePoint","nextIndex","focusSeriesAtIndex","seriesDelta","ids","currentSeriesIdx","nextSeriesIdx","nextSeriesId","nextData","focusFirstPoint","targetSeriesId","focusLastPoint","lastIndex","focusNextPoint","focusPrevPoint","focusNextSeries","focusPrevSeries","LineSeriesPrimitive","seriesIndex","showPoints","focusablePoints","focusIndex","visibilityMode","strokeWidth","smooth","gradientFillId","colors","isHidden","faded","tooltip","normalized","areaPath","domainMin","gen","paletteOverride","di","cx","cy","tabIndex","isFocusedPoint","handleEnter","handleLeave","SPCTooltipOverlay","limits","pointDescriber","measureName","measureUnit","dateFormatter","enableNeutralNoJudgement","showTrendGatingExplanation","chart","cachedFocus","setCachedFocus","hoveringTooltip","setHoveringTooltip","hideTimeoutRef","visible","setVisible","clampX","clampY","host","rules","extractRuleIds","ruleGlossary","dateObj","dateLabel","valueLabel","variationDesc","variationLabel","assuranceDesc","assuranceLabel","zone","zoneLabel","narrative","showBadges","trendFlag","variationNeutral","gatingExplanation","hasRules","primeDirection","primeRuleId","isNoJudgement","focusYellow","spcDotColor","getVariationColorToken","charPx","contentWidthEstimate","minWidth","maxWidth","boxWidth","top","tooltipId","pointIndex","portal","createPortal","isPass","idStr","ruleColorClass","SpcRawRuleTag","primeColorClass","primeLabel","VisuallyHiddenLiveRegion","polite","message","setMessage","lastRef","parts","defaultFormatter","timeout","xLabel","SPCSignalsInspector","onSignalFocus","uniqueRuleNarr","lastKeyRef","computeGradientSequences","categories","absorbSingles","cats","SpcGradientCategory","runCat","len","SequenceTransition","TrendVisualMode","normalizeSpcProps","ui","engine","container","a11y","visualsEngine","meta","showZones","announceFocus","targets","baselines","ghosts","settings","chartType","gradientSequences","sequenceTransition","processLineWidth","showPartitionMarkers","showWarningsPanel","warningsFilter","trendVisualMode","alwaysShowZeroY","alwaysShowHundredY","percentScale","showTrendStartMarkers","showFirstFavourableCrossMarkers","showTrendBridgeOverlay","showSignalsInspector","showIcons","showEmbeddedIcon","embeddedIconVariant","embeddedIconRunLength","showFocusIndicator","visualsScenario","visualsEngineSettings","narrationContext","highlightOutOfControl","precomputed","effData","effTargets","effBaselines","effGhosts","effChartTypeCore","ChartType","effMetricImprovementCore","effEngineSettings","effEngineAutoRecalc","effAlwaysShowZeroY","effAlwaysShowHundredY","effPercentScale","effGradientSequences","effSequenceTransition","effProcessLineWidth","effTrendVisualMode","effShowTrendGatingExplanation","effEnableNeutralNoJudgement","effEnableRules","effShowZones","effShowPoints","effHighlightOutOfControl","effHeight","effClassName","effAriaLabel","effUnit","effNarrationContext","effVisualsScenario","effVisualsEngineSettings","effSource","effShowPartitionMarkers","effShowTrendStartMarkers","effShowFirstFavourableCrossMarkers","effShowTrendBridgeOverlay","effShowSignalsInspector","effOnSignalFocus","effShowWarningsPanel","effWarningsFilter","effShowIcons","effShowEmbeddedIcon","effEmbeddedIconVariant","effEmbeddedIconRunLength","effShowFocusIndicator","spcSequenceInstanceCounter","InternalSPC","visuals","compute","visualCategories","partitionMarkers","uniformTarget","enableRules","zeroBreakSlotGapPx","effectiveUnit","chartCtx","gradientIdBaseRef","tooltipCtx","all","outOfControl","set","engineSignals","anySpecial","upAny","downAny","SpcVisualCategory","sequences","xPositions","plotWidth","plotLeft","trendInsights","earliestUp","earliestDown","useUp","direction","Side","detectedAt","isFavourable","firstFavourableCrossAt","persistedAcrossMean","favourableCount","limitSegments","buildFrom","extractor","segs","current","sequenceDefs","seq","baseVar","sequenceAreas","baseY","areas","firstIdx","category","firstX","lastX","prevSeq","nextSeq","leftX","leftY","rightX","rightY","prevColoured","nextColoured","firstY","lastY","startBaselineX","endBaselineX","prevX","prevY","deltaPrev","nextFirstX","nextFirstY","deltaNext","wedge","computedTimeframe","xs","diffDays","weeks","ordinal","mod10","mod100","formatDateLong","toRuleFlags","formatLive","measure","varLabel","ruleIds","ruleNarr","ctxParts","describePoint","showZeroBreak","dom","next","startIdx","crossIdx","sx","sy","ooc","sig","isImprovement","isConcern","isFocused","ix","InteractionLayer","bounds","toDate","synthesizeDates","hint","arr","inferFrequency","dates","fallback","valid","diffs","sorted","median","H","D","formatLatest","dt","freq","inferUnit","provided","def","percentHeuristic","vals","periodLabel","computeAutoMetrics","rawValues","rawDates","intervalHint","startDate","providedUnit","defaultUnit","autoValue","autoDelta","autoMetadata","deltaConfig","frequency","cfg","findBaselineIndex","latestDate","bestIdx","bestDiff","diff","baselineIndex","baselineValue","abs","useAbsolute","val","metadata","buildWithVisuals","buildSpcV26a","buildSpcV26aWithVisuals","DEFAULT_MIN_POINTS","visualsToPointSignals","UiVariationIcon","visualsToNeutralFlags","toV2Enums","ct","V2ChartType","dir","V2ImprovementDirection","toV2Settings","rowsInputMaybeAuto","useZeroAxisBreak","chartHeight","slotPx","totalReservedPx","innerHeightApprox","requestedSlot","requestedTotal","maxFraction","maxTotal","computeYDomain","flags","allVals","overMax","underMin","add","findAutoRecalcBaselineIndexV2","shiftN","numeric","mrSum","mrCount","sigmaProxy","deltaThreshold","favourUp","favourDown","lastBaselineIdx","windowMean","fromIncl","toExcl","preMean","postMean","deltaSigma","favourable","directionUp","onSide","ok","candidateIdx","autoInsertBaselinesV2","autoInsertBaselinesMultiV2","inserted","baseMinGap","SPCChart","effPrecomputedVisuals","V2VisualsScenario","rowsInput","v2Visuals","v2Settings","v2ChartType","v2Dir","v2Args","buildVisualsForScenario","V2TrendVisualMode","mapVariation","buildWithVisualsV2","engineRepresentative","mean","list","minPointsGlobal","minPointsPartition","nonGhostCount","SpcWarningCode","SpcWarningCategory","partitions","pid","rec","filteredWarnings","ucl","lcl","onePos","oneNeg","twoPos","twoNeg","sigma","collectUniform","nums","fromRows","showZeroBreakOuter","slotGapPx","autoFromHelper","dateCandidates","effectiveNarrationContext","markers","embeddedIcon","internalProps","mapIconToVariation","icon","VariationState","isSpecialCauseIcon","computeSpcPrecomputed","minimumPoints","includeSignalFallbacks","eligibleCount","computeSpcVisualCategories","latestState","lastVariationIcon","centerLine","controlLimits","sigmaBands","pointSignals","pointNeutralSpecialCause"],"mappings":"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","x_google_ignoreList":[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,69]}